function gF(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function E1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function yF(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){var r=!1;try{r=this instanceof s}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var EE={exports:{}},sy={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rO;function BX(){if(rO)return sy;rO=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,i){var a=null;if(i!==void 0&&(a=""+i),r.key!==void 0&&(a=""+r.key),"key"in r){i={};for(var o in r)o!=="key"&&(i[o]=r[o])}else i=r;return r=i.ref,{$$typeof:n,type:s,key:a,ref:r!==void 0?r:null,props:i}}return sy.Fragment=e,sy.jsx=t,sy.jsxs=t,sy}var iO;function zX(){return iO||(iO=1,EE.exports=BX()),EE.exports}var y=zX(),NE={exports:{}},jt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aO;function VX(){if(aO)return jt;aO=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;function m(K){return K===null||typeof K!="object"?null:(K=p&&K[p]||K["@@iterator"],typeof K=="function"?K:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,w={};function T(K,ie,de){this.props=K,this.context=ie,this.refs=w,this.updater=de||v}T.prototype.isReactComponent={},T.prototype.setState=function(K,ie){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,ie,"setState")},T.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function E(){}E.prototype=T.prototype;function C(K,ie,de){this.props=K,this.context=ie,this.refs=w,this.updater=de||v}var A=C.prototype=new E;A.constructor=C,_(A,T.prototype),A.isPureReactComponent=!0;var D=Array.isArray,F={H:null,A:null,T:null,S:null,V:null},W=Object.prototype.hasOwnProperty;function B(K,ie,de,ce,Se,Te){return de=Te.ref,{$$typeof:n,type:K,key:ie,ref:de!==void 0?de:null,props:Te}}function P(K,ie){return B(K.type,ie,void 0,void 0,void 0,K.props)}function O(K){return typeof K=="object"&&K!==null&&K.$$typeof===n}function M(K){var ie={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(de){return ie[de]})}var k=/\/+/g;function V(K,ie){return typeof K=="object"&&K!==null&&K.key!=null?M(""+K.key):ie.toString(36)}function G(){}function ae(K){switch(K.status){case"fulfilled":return K.value;case"rejected":throw K.reason;default:switch(typeof K.status=="string"?K.then(G,G):(K.status="pending",K.then(function(ie){K.status==="pending"&&(K.status="fulfilled",K.value=ie)},function(ie){K.status==="pending"&&(K.status="rejected",K.reason=ie)})),K.status){case"fulfilled":return K.value;case"rejected":throw K.reason}}throw K}function J(K,ie,de,ce,Se){var Te=typeof K;(Te==="undefined"||Te==="boolean")&&(K=null);var Ie=!1;if(K===null)Ie=!0;else switch(Te){case"bigint":case"string":case"number":Ie=!0;break;case"object":switch(K.$$typeof){case n:case e:Ie=!0;break;case h:return Ie=K._init,J(Ie(K._payload),ie,de,ce,Se)}}if(Ie)return Se=Se(K),Ie=ce===""?"."+V(K,0):ce,D(Se)?(de="",Ie!=null&&(de=Ie.replace(k,"$&/")+"/"),J(Se,ie,de,"",function(Qe){return Qe})):Se!=null&&(O(Se)&&(Se=P(Se,de+(Se.key==null||K&&K.key===Se.key?"":(""+Se.key).replace(k,"$&/")+"/")+Ie)),ie.push(Se)),1;Ie=0;var He=ce===""?".":ce+":";if(D(K))for(var qe=0;qe<K.length;qe++)ce=K[qe],Te=He+V(ce,qe),Ie+=J(ce,ie,de,Te,Se);else if(qe=m(K),typeof qe=="function")for(K=qe.call(K),qe=0;!(ce=K.next()).done;)ce=ce.value,Te=He+V(ce,qe++),Ie+=J(ce,ie,de,Te,Se);else if(Te==="object"){if(typeof K.then=="function")return J(ae(K),ie,de,ce,Se);throw ie=String(K),Error("Objects are not valid as a React child (found: "+(ie==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":ie)+"). If you meant to render a collection of children, use an array instead.")}return Ie}function X(K,ie,de){if(K==null)return K;var ce=[],Se=0;return J(K,ce,"","",function(Te){return ie.call(de,Te,Se++)}),ce}function se(K){if(K._status===-1){var ie=K._result;ie=ie(),ie.then(function(de){(K._status===0||K._status===-1)&&(K._status=1,K._result=de)},function(de){(K._status===0||K._status===-1)&&(K._status=2,K._result=de)}),K._status===-1&&(K._status=0,K._result=ie)}if(K._status===1)return K._result.default;throw K._result}var ne=typeof reportError=="function"?reportError:function(K){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ie=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof K=="object"&&K!==null&&typeof K.message=="string"?String(K.message):String(K),error:K});if(!window.dispatchEvent(ie))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",K);return}console.error(K)};function le(){}return jt.Children={map:X,forEach:function(K,ie,de){X(K,function(){ie.apply(this,arguments)},de)},count:function(K){var ie=0;return X(K,function(){ie++}),ie},toArray:function(K){return X(K,function(ie){return ie})||[]},only:function(K){if(!O(K))throw Error("React.Children.only expected to receive a single React element child.");return K}},jt.Component=T,jt.Fragment=t,jt.Profiler=r,jt.PureComponent=C,jt.StrictMode=s,jt.Suspense=l,jt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,jt.__COMPILER_RUNTIME={__proto__:null,c:function(K){return F.H.useMemoCache(K)}},jt.cache=function(K){return function(){return K.apply(null,arguments)}},jt.cloneElement=function(K,ie,de){if(K==null)throw Error("The argument must be a React element, but you passed "+K+".");var ce=_({},K.props),Se=K.key,Te=void 0;if(ie!=null)for(Ie in ie.ref!==void 0&&(Te=void 0),ie.key!==void 0&&(Se=""+ie.key),ie)!W.call(ie,Ie)||Ie==="key"||Ie==="__self"||Ie==="__source"||Ie==="ref"&&ie.ref===void 0||(ce[Ie]=ie[Ie]);var Ie=arguments.length-2;if(Ie===1)ce.children=de;else if(1<Ie){for(var He=Array(Ie),qe=0;qe<Ie;qe++)He[qe]=arguments[qe+2];ce.children=He}return B(K.type,Se,void 0,void 0,Te,ce)},jt.createContext=function(K){return K={$$typeof:a,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null},K.Provider=K,K.Consumer={$$typeof:i,_context:K},K},jt.createElement=function(K,ie,de){var ce,Se={},Te=null;if(ie!=null)for(ce in ie.key!==void 0&&(Te=""+ie.key),ie)W.call(ie,ce)&&ce!=="key"&&ce!=="__self"&&ce!=="__source"&&(Se[ce]=ie[ce]);var Ie=arguments.length-2;if(Ie===1)Se.children=de;else if(1<Ie){for(var He=Array(Ie),qe=0;qe<Ie;qe++)He[qe]=arguments[qe+2];Se.children=He}if(K&&K.defaultProps)for(ce in Ie=K.defaultProps,Ie)Se[ce]===void 0&&(Se[ce]=Ie[ce]);return B(K,Te,void 0,void 0,null,Se)},jt.createRef=function(){return{current:null}},jt.forwardRef=function(K){return{$$typeof:o,render:K}},jt.isValidElement=O,jt.lazy=function(K){return{$$typeof:h,_payload:{_status:-1,_result:K},_init:se}},jt.memo=function(K,ie){return{$$typeof:c,type:K,compare:ie===void 0?null:ie}},jt.startTransition=function(K){var ie=F.T,de={};F.T=de;try{var ce=K(),Se=F.S;Se!==null&&Se(de,ce),typeof ce=="object"&&ce!==null&&typeof ce.then=="function"&&ce.then(le,ne)}catch(Te){ne(Te)}finally{F.T=ie}},jt.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},jt.use=function(K){return F.H.use(K)},jt.useActionState=function(K,ie,de){return F.H.useActionState(K,ie,de)},jt.useCallback=function(K,ie){return F.H.useCallback(K,ie)},jt.useContext=function(K){return F.H.useContext(K)},jt.useDebugValue=function(){},jt.useDeferredValue=function(K,ie){return F.H.useDeferredValue(K,ie)},jt.useEffect=function(K,ie,de){var ce=F.H;if(typeof de=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ce.useEffect(K,ie)},jt.useId=function(){return F.H.useId()},jt.useImperativeHandle=function(K,ie,de){return F.H.useImperativeHandle(K,ie,de)},jt.useInsertionEffect=function(K,ie){return F.H.useInsertionEffect(K,ie)},jt.useLayoutEffect=function(K,ie){return F.H.useLayoutEffect(K,ie)},jt.useMemo=function(K,ie){return F.H.useMemo(K,ie)},jt.useOptimistic=function(K,ie){return F.H.useOptimistic(K,ie)},jt.useReducer=function(K,ie,de){return F.H.useReducer(K,ie,de)},jt.useRef=function(K){return F.H.useRef(K)},jt.useState=function(K){return F.H.useState(K)},jt.useSyncExternalStore=function(K,ie,de){return F.H.useSyncExternalStore(K,ie,de)},jt.useTransition=function(){return F.H.useTransition()},jt.version="19.1.1",jt}var oO;function bC(){return oO||(oO=1,NE.exports=VX()),NE.exports}var ve=bC(),IE={exports:{}},ry={},CE={exports:{}},kE={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lO;function UX(){return lO||(lO=1,(function(n){function e(X,se){var ne=X.length;X.push(se);e:for(;0<ne;){var le=ne-1>>>1,K=X[le];if(0<r(K,se))X[le]=se,X[ne]=K,ne=le;else break e}}function t(X){return X.length===0?null:X[0]}function s(X){if(X.length===0)return null;var se=X[0],ne=X.pop();if(ne!==se){X[0]=ne;e:for(var le=0,K=X.length,ie=K>>>1;le<ie;){var de=2*(le+1)-1,ce=X[de],Se=de+1,Te=X[Se];if(0>r(ce,ne))Se<K&&0>r(Te,ce)?(X[le]=Te,X[Se]=ne,le=Se):(X[le]=ce,X[de]=ne,le=de);else if(Se<K&&0>r(Te,ne))X[le]=Te,X[Se]=ne,le=Se;else break e}}return se}function r(X,se){var ne=X.sortIndex-se.sortIndex;return ne!==0?ne:X.id-se.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,p=null,m=3,v=!1,_=!1,w=!1,T=!1,E=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function D(X){for(var se=t(c);se!==null;){if(se.callback===null)s(c);else if(se.startTime<=X)s(c),se.sortIndex=se.expirationTime,e(l,se);else break;se=t(c)}}function F(X){if(w=!1,D(X),!_)if(t(l)!==null)_=!0,W||(W=!0,V());else{var se=t(c);se!==null&&J(F,se.startTime-X)}}var W=!1,B=-1,P=5,O=-1;function M(){return T?!0:!(n.unstable_now()-O<P)}function k(){if(T=!1,W){var X=n.unstable_now();O=X;var se=!0;try{e:{_=!1,w&&(w=!1,C(B),B=-1),v=!0;var ne=m;try{t:{for(D(X),p=t(l);p!==null&&!(p.expirationTime>X&&M());){var le=p.callback;if(typeof le=="function"){p.callback=null,m=p.priorityLevel;var K=le(p.expirationTime<=X);if(X=n.unstable_now(),typeof K=="function"){p.callback=K,D(X),se=!0;break t}p===t(l)&&s(l),D(X)}else s(l);p=t(l)}if(p!==null)se=!0;else{var ie=t(c);ie!==null&&J(F,ie.startTime-X),se=!1}}break e}finally{p=null,m=ne,v=!1}se=void 0}}finally{se?V():W=!1}}}var V;if(typeof A=="function")V=function(){A(k)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,ae=G.port2;G.port1.onmessage=k,V=function(){ae.postMessage(null)}}else V=function(){E(k,0)};function J(X,se){B=E(function(){X(n.unstable_now())},se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(X){X.callback=null},n.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<X?Math.floor(1e3/X):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_next=function(X){switch(m){case 1:case 2:case 3:var se=3;break;default:se=m}var ne=m;m=se;try{return X()}finally{m=ne}},n.unstable_requestPaint=function(){T=!0},n.unstable_runWithPriority=function(X,se){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var ne=m;m=X;try{return se()}finally{m=ne}},n.unstable_scheduleCallback=function(X,se,ne){var le=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?le+ne:le):ne=le,X){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=ne+K,X={id:h++,callback:se,priorityLevel:X,startTime:ne,expirationTime:K,sortIndex:-1},ne>le?(X.sortIndex=ne,e(c,X),t(l)===null&&X===t(c)&&(w?(C(B),B=-1):w=!0,J(F,ne-le))):(X.sortIndex=K,e(l,X),_||v||(_=!0,W||(W=!0,V()))),X},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(X){var se=m;return function(){var ne=m;m=se;try{return X.apply(this,arguments)}finally{m=ne}}}})(kE)),kE}var cO;function GX(){return cO||(cO=1,CE.exports=UX()),CE.exports}var $E={exports:{}},ri={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uO;function WX(){if(uO)return ri;uO=1;var n=bC();function e(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(l,c,h){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:l,containerInfo:c,implementation:h}}var a=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return ri.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,ri.createPortal=function(l,c){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return i(l,c,null,h)},ri.flushSync=function(l){var c=a.T,h=s.p;try{if(a.T=null,s.p=2,l)return l()}finally{a.T=c,s.p=h,s.d.f()}},ri.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,s.d.C(l,c))},ri.prefetchDNS=function(l){typeof l=="string"&&s.d.D(l)},ri.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var h=c.as,p=o(h,c.crossOrigin),m=typeof c.integrity=="string"?c.integrity:void 0,v=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;h==="style"?s.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:v}):h==="script"&&s.d.X(l,{crossOrigin:p,integrity:m,fetchPriority:v,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},ri.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var h=o(c.as,c.crossOrigin);s.d.M(l,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&s.d.M(l)},ri.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var h=c.as,p=o(h,c.crossOrigin);s.d.L(l,h,{crossOrigin:p,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},ri.preloadModule=function(l,c){if(typeof l=="string")if(c){var h=o(c.as,c.crossOrigin);s.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else s.d.m(l)},ri.requestFormReset=function(l){s.d.r(l)},ri.unstable_batchedUpdates=function(l,c){return l(c)},ri.useFormState=function(l,c,h){return a.H.useFormState(l,c,h)},ri.useFormStatus=function(){return a.H.useHostTransitionStatus()},ri.version="19.1.1",ri}var hO;function HX(){if(hO)return $E.exports;hO=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),$E.exports=WX(),$E.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dO;function qX(){if(dO)return ry;dO=1;var n=GX(),e=bC(),t=HX();function s(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function i(u){var d=u,g=u;if(u.alternate)for(;d.return;)d=d.return;else{u=d;do d=u,(d.flags&4098)!==0&&(g=d.return),u=d.return;while(u)}return d.tag===3?g:null}function a(u){if(u.tag===13){var d=u.memoizedState;if(d===null&&(u=u.alternate,u!==null&&(d=u.memoizedState)),d!==null)return d.dehydrated}return null}function o(u){if(i(u)!==u)throw Error(s(188))}function l(u){var d=u.alternate;if(!d){if(d=i(u),d===null)throw Error(s(188));return d!==u?null:u}for(var g=u,x=d;;){var I=g.return;if(I===null)break;var $=I.alternate;if($===null){if(x=I.return,x!==null){g=x;continue}break}if(I.child===$.child){for($=I.child;$;){if($===g)return o(I),u;if($===x)return o(I),d;$=$.sibling}throw Error(s(188))}if(g.return!==x.return)g=I,x=$;else{for(var q=!1,Y=I.child;Y;){if(Y===g){q=!0,g=I,x=$;break}if(Y===x){q=!0,x=I,g=$;break}Y=Y.sibling}if(!q){for(Y=$.child;Y;){if(Y===g){q=!0,g=$,x=I;break}if(Y===x){q=!0,x=$,g=I;break}Y=Y.sibling}if(!q)throw Error(s(189))}}if(g.alternate!==x)throw Error(s(190))}if(g.tag!==3)throw Error(s(188));return g.stateNode.current===g?u:d}function c(u){var d=u.tag;if(d===5||d===26||d===27||d===6)return u;for(u=u.child;u!==null;){if(d=c(u),d!==null)return d;u=u.sibling}return null}var h=Object.assign,p=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),A=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),k=Symbol.iterator;function V(u){return u===null||typeof u!="object"?null:(u=k&&u[k]||u["@@iterator"],typeof u=="function"?u:null)}var G=Symbol.for("react.client.reference");function ae(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===G?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case _:return"Fragment";case T:return"Profiler";case w:return"StrictMode";case F:return"Suspense";case W:return"SuspenseList";case O:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case v:return"Portal";case A:return(u.displayName||"Context")+".Provider";case C:return(u._context.displayName||"Context")+".Consumer";case D:var d=u.render;return u=u.displayName,u||(u=d.displayName||d.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case B:return d=u.displayName||null,d!==null?d:ae(u.type)||"Memo";case P:d=u._payload,u=u._init;try{return ae(u(d))}catch{}}return null}var J=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne={pending:!1,data:null,method:null,action:null},le=[],K=-1;function ie(u){return{current:u}}function de(u){0>K||(u.current=le[K],le[K]=null,K--)}function ce(u,d){K++,le[K]=u.current,u.current=d}var Se=ie(null),Te=ie(null),Ie=ie(null),He=ie(null);function qe(u,d){switch(ce(Ie,d),ce(Te,u),ce(Se,null),d.nodeType){case 9:case 11:u=(u=d.documentElement)&&(u=u.namespaceURI)?RL(u):0;break;default:if(u=d.tagName,d=d.namespaceURI)d=RL(d),u=DL(d,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}de(Se),ce(Se,u)}function Qe(){de(Se),de(Te),de(Ie)}function ut(u){u.memoizedState!==null&&ce(He,u);var d=Se.current,g=DL(d,u.type);d!==g&&(ce(Te,u),ce(Se,g))}function mt(u){Te.current===u&&(de(Se),de(Te)),He.current===u&&(de(He),Qg._currentValue=ne)}var At=Object.prototype.hasOwnProperty,Gt=n.unstable_scheduleCallback,gn=n.unstable_cancelCallback,Jt=n.unstable_shouldYield,Zt=n.unstable_requestPaint,Pt=n.unstable_now,un=n.unstable_getCurrentPriorityLevel,Cr=n.unstable_ImmediatePriority,Rn=n.unstable_UserBlockingPriority,zs=n.unstable_NormalPriority,Vs=n.unstable_LowPriority,kr=n.unstable_IdlePriority,sr=n.log,Zr=n.unstable_setDisableYieldValue,an=null,Mt=null;function ts(u){if(typeof sr=="function"&&Zr(u),Mt&&typeof Mt.setStrictMode=="function")try{Mt.setStrictMode(an,u)}catch{}}var os=Math.clz32?Math.clz32:go,mo=Math.log,el=Math.LN2;function go(u){return u>>>=0,u===0?32:31-(mo(u)/el|0)|0}var _i=256,ta=4194304;function Yr(u){var d=u&42;if(d!==0)return d;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function ou(u,d,g){var x=u.pendingLanes;if(x===0)return 0;var I=0,$=u.suspendedLanes,q=u.pingedLanes;u=u.warmLanes;var Y=x&134217727;return Y!==0?(x=Y&~$,x!==0?I=Yr(x):(q&=Y,q!==0?I=Yr(q):g||(g=Y&~u,g!==0&&(I=Yr(g))))):(Y=x&~$,Y!==0?I=Yr(Y):q!==0?I=Yr(q):g||(g=x&~u,g!==0&&(I=Yr(g)))),I===0?0:d!==0&&d!==I&&(d&$)===0&&($=I&-I,g=d&-d,$>=g||$===32&&(g&4194048)!==0)?d:I}function na(u,d){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&d)===0}function cd(u,d){switch(u){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ud(){var u=_i;return _i<<=1,(_i&4194048)===0&&(_i=256),u}function lu(){var u=ta;return ta<<=1,(ta&62914560)===0&&(ta=4194304),u}function Ra(u){for(var d=[],g=0;31>g;g++)d.push(u);return d}function Da(u,d){u.pendingLanes|=d,d!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function hd(u,d,g,x,I,$){var q=u.pendingLanes;u.pendingLanes=g,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=g,u.entangledLanes&=g,u.errorRecoveryDisabledLanes&=g,u.shellSuspendCounter=0;var Y=u.entanglements,he=u.expirationTimes,$e=u.hiddenUpdates;for(g=q&~g;0<g;){var Fe=31-os(g),Ve=1<<Fe;Y[Fe]=0,he[Fe]=-1;var Ae=$e[Fe];if(Ae!==null)for($e[Fe]=null,Fe=0;Fe<Ae.length;Fe++){var De=Ae[Fe];De!==null&&(De.lane&=-536870913)}g&=~Ve}x!==0&&La(u,x,0),$!==0&&I===0&&u.tag!==0&&(u.suspendedLanes|=$&~(q&~d))}function La(u,d,g){u.pendingLanes|=d,u.suspendedLanes&=~d;var x=31-os(d);u.entangledLanes|=d,u.entanglements[x]=u.entanglements[x]|1073741824|g&4194090}function dd(u,d){var g=u.entangledLanes|=d;for(u=u.entanglements;g;){var x=31-os(g),I=1<<x;I&d|u[x]&d&&(u[x]|=d),g&=~I}}function tl(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function cu(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function nl(){var u=se.p;return u!==0?u:(u=window.event,u===void 0?32:QL(u.type))}function uu(u,d){var g=se.p;try{return se.p=u,d()}finally{se.p=g}}var qn=Math.random().toString(36).slice(2),$s="__reactFiber$"+qn,bs="__reactProps$"+qn,Pi="__reactContainer$"+qn,Qr="__reactEvents$"+qn,ct="__reactListeners$"+qn,yo="__reactHandles$"+qn,fd="__reactResources$"+qn,sl="__reactMarker$"+qn;function vo(u){delete u[$s],delete u[bs],delete u[Qr],delete u[ct],delete u[yo]}function sa(u){var d=u[$s];if(d)return d;for(var g=u.parentNode;g;){if(d=g[Pi]||g[$s]){if(g=d.alternate,d.child!==null||g!==null&&g.child!==null)for(u=ML(u);u!==null;){if(g=u[$s])return g;u=ML(u)}return d}u=g,g=u.parentNode}return null}function ra(u){if(u=u[$s]||u[Pi]){var d=u.tag;if(d===5||d===6||d===13||d===26||d===27||d===3)return u}return null}function $r(u){var d=u.tag;if(d===5||d===26||d===27||d===6)return u.stateNode;throw Error(s(33))}function pr(u){var d=u[fd];return d||(d=u[fd]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function ps(u){u[sl]=!0}var pd=new Set,hu={};function ia(u,d){Oa(u,d),Oa(u+"Capture",d)}function Oa(u,d){for(hu[u]=d,u=0;u<d.length;u++)pd.add(d[u])}var tp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),oc={},lc={};function np(u){return At.call(lc,u)?!0:At.call(oc,u)?!1:tp.test(u)?lc[u]=!0:(oc[u]=!0,!1)}function rl(u,d,g){if(np(d))if(g===null)u.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":u.removeAttribute(d);return;case"boolean":var x=d.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){u.removeAttribute(d);return}}u.setAttribute(d,""+g)}}function Pa(u,d,g){if(g===null)u.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(d);return}u.setAttribute(d,""+g)}}function rr(u,d,g,x){if(x===null)u.removeAttribute(g);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(g);return}u.setAttributeNS(d,g,""+x)}}var bo,il;function Ma(u){if(bo===void 0)try{throw Error()}catch(g){var d=g.stack.trim().match(/\n( *(at )?)/);bo=d&&d[1]||"",il=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bo+u+il}var cc=!1;function Fa(u,d){if(!u||cc)return"";cc=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(d){var Ve=function(){throw Error()};if(Object.defineProperty(Ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ve,[])}catch(De){var Ae=De}Reflect.construct(u,[],Ve)}else{try{Ve.call()}catch(De){Ae=De}u.call(Ve.prototype)}}else{try{throw Error()}catch(De){Ae=De}(Ve=u())&&typeof Ve.catch=="function"&&Ve.catch(function(){})}}catch(De){if(De&&Ae&&typeof De.stack=="string")return[De.stack,Ae.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var I=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");I&&I.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var $=x.DetermineComponentFrameRoot(),q=$[0],Y=$[1];if(q&&Y){var he=q.split(`
`),$e=Y.split(`
`);for(I=x=0;x<he.length&&!he[x].includes("DetermineComponentFrameRoot");)x++;for(;I<$e.length&&!$e[I].includes("DetermineComponentFrameRoot");)I++;if(x===he.length||I===$e.length)for(x=he.length-1,I=$e.length-1;1<=x&&0<=I&&he[x]!==$e[I];)I--;for(;1<=x&&0<=I;x--,I--)if(he[x]!==$e[I]){if(x!==1||I!==1)do if(x--,I--,0>I||he[x]!==$e[I]){var Fe=`
`+he[x].replace(" at new "," at ");return u.displayName&&Fe.includes("<anonymous>")&&(Fe=Fe.replace("<anonymous>",u.displayName)),Fe}while(1<=x&&0<=I);break}}}finally{cc=!1,Error.prepareStackTrace=g}return(g=u?u.displayName||u.name:"")?Ma(g):""}function qt(u){switch(u.tag){case 26:case 27:case 5:return Ma(u.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 15:return Fa(u.type,!1);case 11:return Fa(u.type.render,!1);case 1:return Fa(u.type,!0);case 31:return Ma("Activity");default:return""}}function Tn(u){try{var d="";do d+=qt(u),u=u.return;while(u);return d}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}function Us(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function ja(u){var d=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function al(u){var d=ja(u)?"checked":"value",g=Object.getOwnPropertyDescriptor(u.constructor.prototype,d),x=""+u[d];if(!u.hasOwnProperty(d)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var I=g.get,$=g.set;return Object.defineProperty(u,d,{configurable:!0,get:function(){return I.call(this)},set:function(q){x=""+q,$.call(this,q)}}),Object.defineProperty(u,d,{enumerable:g.enumerable}),{getValue:function(){return x},setValue:function(q){x=""+q},stopTracking:function(){u._valueTracker=null,delete u[d]}}}}function ol(u){u._valueTracker||(u._valueTracker=al(u))}function kt(u){if(!u)return!1;var d=u._valueTracker;if(!d)return!0;var g=d.getValue(),x="";return u&&(x=ja(u)?u.checked?"true":"false":u.value),u=x,u!==g?(d.setValue(u),!0):!1}function Cn(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var md=/[\n"\\]/g;function ns(u){return u.replace(md,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function Kn(u,d,g,x,I,$,q,Y){u.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?u.type=q:u.removeAttribute("type"),d!=null?q==="number"?(d===0&&u.value===""||u.value!=d)&&(u.value=""+Us(d)):u.value!==""+Us(d)&&(u.value=""+Us(d)):q!=="submit"&&q!=="reset"||u.removeAttribute("value"),d!=null?aa(u,q,Us(d)):g!=null?aa(u,q,Us(g)):x!=null&&u.removeAttribute("value"),I==null&&$!=null&&(u.defaultChecked=!!$),I!=null&&(u.checked=I&&typeof I!="function"&&typeof I!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?u.name=""+Us(Y):u.removeAttribute("name")}function uc(u,d,g,x,I,$,q,Y){if($!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(u.type=$),d!=null||g!=null){if(!($!=="submit"&&$!=="reset"||d!=null))return;g=g!=null?""+Us(g):"",d=d!=null?""+Us(d):g,Y||d===u.value||(u.value=d),u.defaultValue=d}x=x??I,x=typeof x!="function"&&typeof x!="symbol"&&!!x,u.checked=Y?u.checked:!!x,u.defaultChecked=!!x,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(u.name=q)}function aa(u,d,g){d==="number"&&Cn(u.ownerDocument)===u||u.defaultValue===""+g||(u.defaultValue=""+g)}function Ar(u,d,g,x){if(u=u.options,d){d={};for(var I=0;I<g.length;I++)d["$"+g[I]]=!0;for(g=0;g<u.length;g++)I=d.hasOwnProperty("$"+u[g].value),u[g].selected!==I&&(u[g].selected=I),I&&x&&(u[g].defaultSelected=!0)}else{for(g=""+Us(g),d=null,I=0;I<u.length;I++){if(u[I].value===g){u[I].selected=!0,x&&(u[I].defaultSelected=!0);return}d!==null||u[I].disabled||(d=u[I])}d!==null&&(d.selected=!0)}}function Tt(u,d,g){if(d!=null&&(d=""+Us(d),d!==u.value&&(u.value=d),g==null)){u.defaultValue!==d&&(u.defaultValue=d);return}u.defaultValue=g!=null?""+Us(g):""}function xi(u,d,g,x){if(d==null){if(x!=null){if(g!=null)throw Error(s(92));if(J(x)){if(1<x.length)throw Error(s(93));x=x[0]}g=x}g==null&&(g=""),d=g}g=Us(d),u.defaultValue=g,x=u.textContent,x===g&&x!==""&&x!==null&&(u.value=x)}function mr(u,d){if(d){var g=u.firstChild;if(g&&g===u.lastChild&&g.nodeType===3){g.nodeValue=d;return}}u.textContent=d}var oa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function du(u,d,g){var x=d.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?x?u.setProperty(d,""):d==="float"?u.cssFloat="":u[d]="":x?u.setProperty(d,g):typeof g!="number"||g===0||oa.has(d)?d==="float"?u.cssFloat=g:u[d]=(""+g).trim():u[d]=g+"px"}function _o(u,d,g){if(d!=null&&typeof d!="object")throw Error(s(62));if(u=u.style,g!=null){for(var x in g)!g.hasOwnProperty(x)||d!=null&&d.hasOwnProperty(x)||(x.indexOf("--")===0?u.setProperty(x,""):x==="float"?u.cssFloat="":u[x]="");for(var I in d)x=d[I],d.hasOwnProperty(I)&&g[I]!==x&&du(u,I,x)}else for(var $ in d)d.hasOwnProperty($)&&du(u,$,d[$])}function hc(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),fu=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ll(u){return fu.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}var la=null;function Rr(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Ba=null,ca=null;function yd(u){var d=ra(u);if(d&&(u=d.stateNode)){var g=u[bs]||null;e:switch(u=d.stateNode,d.type){case"input":if(Kn(u,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),d=g.name,g.type==="radio"&&d!=null){for(g=u;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+ns(""+d)+'"][type="radio"]'),d=0;d<g.length;d++){var x=g[d];if(x!==u&&x.form===u.form){var I=x[bs]||null;if(!I)throw Error(s(90));Kn(x,I.value,I.defaultValue,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name)}}for(d=0;d<g.length;d++)x=g[d],x.form===u.form&&kt(x)}break e;case"textarea":Tt(u,g.value,g.defaultValue);break e;case"select":d=g.value,d!=null&&Ar(u,!!g.multiple,d,!1)}}}var vt=!1;function wi(u,d,g){if(vt)return u(d,g);vt=!0;try{var x=u(d);return x}finally{if(vt=!1,(Ba!==null||ca!==null)&&(X_(),Ba&&(d=Ba,u=ca,ca=Ba=null,yd(d),u)))for(d=0;d<u.length;d++)yd(u[d])}}function hn(u,d){var g=u.stateNode;if(g===null)return null;var x=g[bs]||null;if(x===null)return null;g=x[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(u=u.type,x=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!x;break e;default:u=!1}if(u)return null;if(g&&typeof g!="function")throw Error(s(231,d,typeof g));return g}var Mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jr=!1;if(Mi)try{var xo={};Object.defineProperty(xo,"passive",{get:function(){Jr=!0}}),window.addEventListener("test",xo,xo),window.removeEventListener("test",xo,xo)}catch{Jr=!1}var Fi=null,ei=null,ua=null;function wo(){if(ua)return ua;var u,d=ei,g=d.length,x,I="value"in Fi?Fi.value:Fi.textContent,$=I.length;for(u=0;u<g&&d[u]===I[u];u++);var q=g-u;for(x=1;x<=q&&d[g-x]===I[$-x];x++);return ua=I.slice(u,1<x?1-x:void 0)}function Dn(u){var d=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&d===13&&(u=13)):u=d,u===10&&(u=13),32<=u||u===13?u:0}function gr(){return!0}function pu(){return!1}function As(u){function d(g,x,I,$,q){this._reactName=g,this._targetInst=I,this.type=x,this.nativeEvent=$,this.target=q,this.currentTarget=null;for(var Y in u)u.hasOwnProperty(Y)&&(g=u[Y],this[Y]=g?g($):$[Y]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?gr:pu,this.isPropagationStopped=pu,this}return h(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=gr)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=gr)},persist:function(){},isPersistent:gr}),d}var yn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dc=As(yn),To=h({},yn,{view:0,detail:0}),sp=As(To),fc,Ft,za,ir=h({},To,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ul,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==za&&(za&&u.type==="mousemove"?(fc=u.screenX-za.screenX,Ft=u.screenY-za.screenY):Ft=fc=0,za=u),fc)},movementY:function(u){return"movementY"in u?u.movementY:Ft}}),yr=As(ir),vd=h({},ir,{dataTransfer:0}),mg=As(vd),So=h({},To,{relatedTarget:0}),mu=As(So),gu=h({},yn,{animationName:0,elapsedTime:0,pseudoElement:0}),yu=As(gu),rp=h({},yn,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),cl=As(rp),gg=h({},yn,{data:0}),ti=As(gg),pc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ha={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vu(u){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(u):(u=ha[u])?!!d[u]:!1}function ul(){return vu}var bu=h({},To,{key:function(u){if(u.key){var d=pc[u.key]||u.key;if(d!=="Unidentified")return d}return u.type==="keypress"?(u=Dn(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?bd[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ul,charCode:function(u){return u.type==="keypress"?Dn(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?Dn(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),_u=As(bu),_d=h({},ir,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xu=As(_d),Eo=h({},To,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ul}),ip=As(Eo),wu=h({},yn,{propertyName:0,elapsedTime:0,pseudoElement:0}),ap=As(wu),xd=h({},ir,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),mc=As(xd),Gs=h({},yn,{newState:0,oldState:0}),Va=As(Gs),op=[9,13,27,32],ni=Mi&&"CompositionEvent"in window,S=null;Mi&&"documentMode"in document&&(S=document.documentMode);var j=Mi&&"TextEvent"in window&&!S,H=Mi&&(!ni||S&&8<S&&11>=S),ee=" ",Ee=!1;function Oe(u,d){switch(u){case"keyup":return op.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xe(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var en=!1;function _s(u,d){switch(u){case"compositionend":return Xe(d);case"keypress":return d.which!==32?null:(Ee=!0,ee);case"textInput":return u=d.data,u===ee&&Ee?null:u;default:return null}}function tn(u,d){if(en)return u==="compositionend"||!ni&&Oe(u,d)?(u=wo(),ua=ei=Fi=null,en=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return H&&d.locale!=="ko"?null:d.data;default:return null}}var Sn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xn(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d==="input"?!!Sn[u.type]:d==="textarea"}function No(u,d,g,x){Ba?ca?ca.push(x):ca=[x]:Ba=x,d=tx(d,"onChange"),0<d.length&&(g=new dc("onChange","change",null,g,x),u.push({event:g,listeners:d}))}var jn=null,Ua=null;function Ga(u){IL(u,0)}function lp(u){var d=$r(u);if(kt(d))return u}function Tu(u,d){if(u==="change")return d}var yg=!1;if(Mi){var Su;if(Mi){var vg="oninput"in document;if(!vg){var Io=document.createElement("div");Io.setAttribute("oninput","return;"),vg=typeof Io.oninput=="function"}Su=vg}else Su=!1;yg=Su&&(!document.documentMode||9<document.documentMode)}function wd(){jn&&(jn.detachEvent("onpropertychange",p_),Ua=jn=null)}function p_(u){if(u.propertyName==="value"&&lp(Ua)){var d=[];No(d,Ua,u,Rr(u)),wi(Ga,d)}}function bg(u,d,g){u==="focusin"?(wd(),jn=d,Ua=g,jn.attachEvent("onpropertychange",p_)):u==="focusout"&&wd()}function XT(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return lp(Ua)}function Co(u,d){if(u==="click")return lp(d)}function ZT(u,d){if(u==="input"||u==="change")return lp(d)}function Eu(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var Ti=typeof Object.is=="function"?Object.is:Eu;function Si(u,d){if(Ti(u,d))return!0;if(typeof u!="object"||u===null||typeof d!="object"||d===null)return!1;var g=Object.keys(u),x=Object.keys(d);if(g.length!==x.length)return!1;for(x=0;x<g.length;x++){var I=g[x];if(!At.call(d,I)||!Ti(u[I],d[I]))return!1}return!0}function Td(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function _g(u,d){var g=Td(u);u=0;for(var x;g;){if(g.nodeType===3){if(x=u+g.textContent.length,u<=d&&x>=d)return{node:g,offset:d-u};u=x}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=Td(g)}}function cp(u,d){return u&&d?u===d?!0:u&&u.nodeType===3?!1:d&&d.nodeType===3?cp(u,d.parentNode):"contains"in u?u.contains(d):u.compareDocumentPosition?!!(u.compareDocumentPosition(d)&16):!1:!1}function Sd(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var d=Cn(u.document);d instanceof u.HTMLIFrameElement;){try{var g=typeof d.contentWindow.location.href=="string"}catch{g=!1}if(g)u=d.contentWindow;else break;d=Cn(u.document)}return d}function Ed(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d&&(d==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||d==="textarea"||u.contentEditable==="true")}var up=Mi&&"documentMode"in document&&11>=document.documentMode,da=null,Nu=null,gc=null,hp=!1;function m_(u,d,g){var x=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;hp||da==null||da!==Cn(x)||(x=da,"selectionStart"in x&&Ed(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),gc&&Si(gc,x)||(gc=x,x=tx(Nu,"onSelect"),0<x.length&&(d=new dc("onSelect","select",null,d,g),u.push({event:d,listeners:x}),d.target=da)))}function Wa(u,d){var g={};return g[u.toLowerCase()]=d.toLowerCase(),g["Webkit"+u]="webkit"+d,g["Moz"+u]="moz"+d,g}var Iu={animationend:Wa("Animation","AnimationEnd"),animationiteration:Wa("Animation","AnimationIteration"),animationstart:Wa("Animation","AnimationStart"),transitionrun:Wa("Transition","TransitionRun"),transitionstart:Wa("Transition","TransitionStart"),transitioncancel:Wa("Transition","TransitionCancel"),transitionend:Wa("Transition","TransitionEnd")},dp={},g_={};Mi&&(g_=document.createElement("div").style,"AnimationEvent"in window||(delete Iu.animationend.animation,delete Iu.animationiteration.animation,delete Iu.animationstart.animation),"TransitionEvent"in window||delete Iu.transitionend.transition);function hl(u){if(dp[u])return dp[u];if(!Iu[u])return u;var d=Iu[u],g;for(g in d)if(d.hasOwnProperty(g)&&g in g_)return dp[u]=d[g];return u}var y_=hl("animationend"),fa=hl("animationiteration"),Nd=hl("animationstart"),YT=hl("transitionrun"),fp=hl("transitionstart"),QT=hl("transitioncancel"),xg=hl("transitionend"),v_=new Map,yc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yc.push("scrollEnd");function pa(u,d){v_.set(u,d),ia(d,[u])}var vc=new WeakMap;function Ei(u,d){if(typeof u=="object"&&u!==null){var g=vc.get(u);return g!==void 0?g:(d={value:u,source:d,stack:Tn(d)},vc.set(u,d),d)}return{value:u,source:d,stack:Tn(d)}}var Ni=[],Cu=0,ma=0;function Id(){for(var u=Cu,d=ma=Cu=0;d<u;){var g=Ni[d];Ni[d++]=null;var x=Ni[d];Ni[d++]=null;var I=Ni[d];Ni[d++]=null;var $=Ni[d];if(Ni[d++]=null,x!==null&&I!==null){var q=x.pending;q===null?I.next=I:(I.next=q.next,q.next=I),x.pending=I}$!==0&&kd(g,I,$)}}function Cd(u,d,g,x){Ni[Cu++]=u,Ni[Cu++]=d,Ni[Cu++]=g,Ni[Cu++]=x,ma|=x,u.lanes|=x,u=u.alternate,u!==null&&(u.lanes|=x)}function bc(u,d,g,x){return Cd(u,d,g,x),dl(u)}function ku(u,d){return Cd(u,null,null,d),dl(u)}function kd(u,d,g){u.lanes|=g;var x=u.alternate;x!==null&&(x.lanes|=g);for(var I=!1,$=u.return;$!==null;)$.childLanes|=g,x=$.alternate,x!==null&&(x.childLanes|=g),$.tag===22&&(u=$.stateNode,u===null||u._visibility&1||(I=!0)),u=$,$=$.return;return u.tag===3?($=u.stateNode,I&&d!==null&&(I=31-os(g),u=$.hiddenUpdates,x=u[I],x===null?u[I]=[d]:x.push(d),d.lane=g|536870912),$):null}function dl(u){if(50<Gg)throw Gg=0,XS=null,Error(s(185));for(var d=u.return;d!==null;)u=d,d=u.return;return u.tag===3?u.stateNode:null}var _c={};function b_(u,d,g,x){this.tag=u,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ii(u,d,g,x){return new b_(u,d,g,x)}function pp(u){return u=u.prototype,!(!u||!u.isReactComponent)}function Ha(u,d){var g=u.alternate;return g===null?(g=Ii(u.tag,d,u.key,u.mode),g.elementType=u.elementType,g.type=u.type,g.stateNode=u.stateNode,g.alternate=u,u.alternate=g):(g.pendingProps=d,g.type=u.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=u.flags&65011712,g.childLanes=u.childLanes,g.lanes=u.lanes,g.child=u.child,g.memoizedProps=u.memoizedProps,g.memoizedState=u.memoizedState,g.updateQueue=u.updateQueue,d=u.dependencies,g.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},g.sibling=u.sibling,g.index=u.index,g.ref=u.ref,g.refCleanup=u.refCleanup,g}function wg(u,d){u.flags&=65011714;var g=u.alternate;return g===null?(u.childLanes=0,u.lanes=d,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=g.childLanes,u.lanes=g.lanes,u.child=g.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=g.memoizedProps,u.memoizedState=g.memoizedState,u.updateQueue=g.updateQueue,u.type=g.type,d=g.dependencies,u.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),u}function $d(u,d,g,x,I,$){var q=0;if(x=u,typeof u=="function")pp(u)&&(q=1);else if(typeof u=="string")q=IX(u,g,Se.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case O:return u=Ii(31,g,d,I),u.elementType=O,u.lanes=$,u;case _:return fl(g.children,I,$,d);case w:q=8,I|=24;break;case T:return u=Ii(12,g,d,I|2),u.elementType=T,u.lanes=$,u;case F:return u=Ii(13,g,d,I),u.elementType=F,u.lanes=$,u;case W:return u=Ii(19,g,d,I),u.elementType=W,u.lanes=$,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case E:case A:q=10;break e;case C:q=9;break e;case D:q=11;break e;case B:q=14;break e;case P:q=16,x=null;break e}q=29,g=Error(s(130,u===null?"null":typeof u,"")),x=null}return d=Ii(q,g,d,I),d.elementType=u,d.type=x,d.lanes=$,d}function fl(u,d,g,x){return u=Ii(7,u,x,d),u.lanes=g,u}function Tg(u,d,g){return u=Ii(6,u,null,d),u.lanes=g,u}function mp(u,d,g){return d=Ii(4,u.children!==null?u.children:[],u.key,d),d.lanes=g,d.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},d}var xc=[],$u=0,f=null,b=0,N=[],R=0,z=null,Z=1,ue="";function Ne(u,d){xc[$u++]=b,xc[$u++]=f,f=u,b=d}function Le(u,d,g){N[R++]=Z,N[R++]=ue,N[R++]=z,z=u;var x=Z;u=ue;var I=32-os(x)-1;x&=~(1<<I),g+=1;var $=32-os(d)+I;if(30<$){var q=I-I%5;$=(x&(1<<q)-1).toString(32),x>>=q,I-=q,Z=1<<32-os(d)+I|g<<I|x,ue=$+u}else Z=1<<$|g<<I|x,ue=u}function Ge(u){u.return!==null&&(Ne(u,1),Le(u,1,0))}function Je(u){for(;u===f;)f=xc[--$u],xc[$u]=null,b=xc[--$u],xc[$u]=null;for(;u===z;)z=N[--R],N[R]=null,ue=N[--R],N[R]=null,Z=N[--R],N[R]=null}var rt=null,lt=null,Ct=!1,Zn=null,ms=!1,vr=Error(s(519));function ji(u){var d=Error(s(418,""));throw Ru(Ei(d,u)),vr}function __(u){var d=u.stateNode,g=u.type,x=u.memoizedProps;switch(d[$s]=u,d[bs]=x,g){case"dialog":Qt("cancel",d),Qt("close",d);break;case"iframe":case"object":case"embed":Qt("load",d);break;case"video":case"audio":for(g=0;g<Hg.length;g++)Qt(Hg[g],d);break;case"source":Qt("error",d);break;case"img":case"image":case"link":Qt("error",d),Qt("load",d);break;case"details":Qt("toggle",d);break;case"input":Qt("invalid",d),uc(d,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0),ol(d);break;case"select":Qt("invalid",d);break;case"textarea":Qt("invalid",d),xi(d,x.value,x.defaultValue,x.children),ol(d)}g=x.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||d.textContent===""+g||x.suppressHydrationWarning===!0||AL(d.textContent,g)?(x.popover!=null&&(Qt("beforetoggle",d),Qt("toggle",d)),x.onScroll!=null&&Qt("scroll",d),x.onScrollEnd!=null&&Qt("scrollend",d),x.onClick!=null&&(d.onclick=nx),d=!0):d=!1,d||ji(u)}function x_(u){for(rt=u.return;rt;)switch(rt.tag){case 5:case 13:ms=!1;return;case 27:case 3:ms=!0;return;default:rt=rt.return}}function Ad(u){if(u!==rt)return!1;if(!Ct)return x_(u),Ct=!0,!1;var d=u.tag,g;if((g=d!==3&&d!==27)&&((g=d===5)&&(g=u.type,g=!(g!=="form"&&g!=="button")||hE(u.type,u.memoizedProps)),g=!g),g&&lt&&ji(u),x_(u),d===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));e:{for(u=u.nextSibling,d=0;u;){if(u.nodeType===8)if(g=u.data,g==="/$"){if(d===0){lt=Ro(u.nextSibling);break e}d--}else g!=="$"&&g!=="$!"&&g!=="$?"||d++;u=u.nextSibling}lt=null}}else d===27?(d=lt,qu(u.type)?(u=mE,mE=null,lt=u):lt=d):lt=rt?Ro(u.stateNode.nextSibling):null;return!0}function Au(){lt=rt=null,Ct=!1}function w_(){var u=Zn;return u!==null&&(Vi===null?Vi=u:Vi.push.apply(Vi,u),Zn=null),u}function Ru(u){Zn===null?Zn=[u]:Zn.push(u)}var ls=ie(null),qa=null,ko=null;function pl(u,d,g){ce(ls,d._currentValue),d._currentValue=g}function $o(u){u._currentValue=ls.current,de(ls)}function Rd(u,d,g){for(;u!==null;){var x=u.alternate;if((u.childLanes&d)!==d?(u.childLanes|=d,x!==null&&(x.childLanes|=d)):x!==null&&(x.childLanes&d)!==d&&(x.childLanes|=d),u===g)break;u=u.return}}function gp(u,d,g,x){var I=u.child;for(I!==null&&(I.return=u);I!==null;){var $=I.dependencies;if($!==null){var q=I.child;$=$.firstContext;e:for(;$!==null;){var Y=$;$=I;for(var he=0;he<d.length;he++)if(Y.context===d[he]){$.lanes|=g,Y=$.alternate,Y!==null&&(Y.lanes|=g),Rd($.return,g,u),x||(q=null);break e}$=Y.next}}else if(I.tag===18){if(q=I.return,q===null)throw Error(s(341));q.lanes|=g,$=q.alternate,$!==null&&($.lanes|=g),Rd(q,g,u),q=null}else q=I.child;if(q!==null)q.return=I;else for(q=I;q!==null;){if(q===u){q=null;break}if(I=q.sibling,I!==null){I.return=q.return,q=I;break}q=q.return}I=q}}function Dd(u,d,g,x){u=null;for(var I=d,$=!1;I!==null;){if(!$){if((I.flags&524288)!==0)$=!0;else if((I.flags&262144)!==0)break}if(I.tag===10){var q=I.alternate;if(q===null)throw Error(s(387));if(q=q.memoizedProps,q!==null){var Y=I.type;Ti(I.pendingProps.value,q.value)||(u!==null?u.push(Y):u=[Y])}}else if(I===He.current){if(q=I.alternate,q===null)throw Error(s(387));q.memoizedState.memoizedState!==I.memoizedState.memoizedState&&(u!==null?u.push(Qg):u=[Qg])}I=I.return}u!==null&&gp(d,u,g,x),d.flags|=262144}function T_(u){for(u=u.firstContext;u!==null;){if(!Ti(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function Ld(u){qa=u,ko=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function si(u){return yR(qa,u)}function S_(u,d){return qa===null&&Ld(u),yR(u,d)}function yR(u,d){var g=d._currentValue;if(d={context:d,memoizedValue:g,next:null},ko===null){if(u===null)throw Error(s(308));ko=d,u.dependencies={lanes:0,firstContext:d},u.flags|=524288}else ko=ko.next=d;return g}var N7=typeof AbortController<"u"?AbortController:function(){var u=[],d=this.signal={aborted:!1,addEventListener:function(g,x){u.push(x)}};this.abort=function(){d.aborted=!0,u.forEach(function(g){return g()})}},I7=n.unstable_scheduleCallback,C7=n.unstable_NormalPriority,ar={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function JT(){return{controller:new N7,data:new Map,refCount:0}}function Sg(u){u.refCount--,u.refCount===0&&I7(C7,function(){u.controller.abort()})}var Eg=null,eS=0,yp=0,vp=null;function k7(u,d){if(Eg===null){var g=Eg=[];eS=0,yp=nE(),vp={status:"pending",value:void 0,then:function(x){g.push(x)}}}return eS++,d.then(vR,vR),d}function vR(){if(--eS===0&&Eg!==null){vp!==null&&(vp.status="fulfilled");var u=Eg;Eg=null,yp=0,vp=null;for(var d=0;d<u.length;d++)(0,u[d])()}}function $7(u,d){var g=[],x={status:"pending",value:null,reason:null,then:function(I){g.push(I)}};return u.then(function(){x.status="fulfilled",x.value=d;for(var I=0;I<g.length;I++)(0,g[I])(d)},function(I){for(x.status="rejected",x.reason=I,I=0;I<g.length;I++)(0,g[I])(void 0)}),x}var bR=X.S;X.S=function(u,d){typeof d=="object"&&d!==null&&typeof d.then=="function"&&k7(u,d),bR!==null&&bR(u,d)};var Od=ie(null);function tS(){var u=Od.current;return u!==null?u:Yn.pooledCache}function E_(u,d){d===null?ce(Od,Od.current):ce(Od,d.pool)}function _R(){var u=tS();return u===null?null:{parent:ar._currentValue,pool:u}}var Ng=Error(s(460)),xR=Error(s(474)),N_=Error(s(542)),nS={then:function(){}};function wR(u){return u=u.status,u==="fulfilled"||u==="rejected"}function I_(){}function TR(u,d,g){switch(g=u[g],g===void 0?u.push(d):g!==d&&(d.then(I_,I_),d=g),d.status){case"fulfilled":return d.value;case"rejected":throw u=d.reason,ER(u),u;default:if(typeof d.status=="string")d.then(I_,I_);else{if(u=Yn,u!==null&&100<u.shellSuspendCounter)throw Error(s(482));u=d,u.status="pending",u.then(function(x){if(d.status==="pending"){var I=d;I.status="fulfilled",I.value=x}},function(x){if(d.status==="pending"){var I=d;I.status="rejected",I.reason=x}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw u=d.reason,ER(u),u}throw Ig=d,Ng}}var Ig=null;function SR(){if(Ig===null)throw Error(s(459));var u=Ig;return Ig=null,u}function ER(u){if(u===Ng||u===N_)throw Error(s(483))}var Du=!1;function sS(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rS(u,d){u=u.updateQueue,d.updateQueue===u&&(d.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Lu(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function Ou(u,d,g){var x=u.updateQueue;if(x===null)return null;if(x=x.shared,(kn&2)!==0){var I=x.pending;return I===null?d.next=d:(d.next=I.next,I.next=d),x.pending=d,d=dl(u),kd(u,null,g),d}return Cd(u,x,d,g),dl(u)}function Cg(u,d,g){if(d=d.updateQueue,d!==null&&(d=d.shared,(g&4194048)!==0)){var x=d.lanes;x&=u.pendingLanes,g|=x,d.lanes=g,dd(u,g)}}function iS(u,d){var g=u.updateQueue,x=u.alternate;if(x!==null&&(x=x.updateQueue,g===x)){var I=null,$=null;if(g=g.firstBaseUpdate,g!==null){do{var q={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};$===null?I=$=q:$=$.next=q,g=g.next}while(g!==null);$===null?I=$=d:$=$.next=d}else I=$=d;g={baseState:x.baseState,firstBaseUpdate:I,lastBaseUpdate:$,shared:x.shared,callbacks:x.callbacks},u.updateQueue=g;return}u=g.lastBaseUpdate,u===null?g.firstBaseUpdate=d:u.next=d,g.lastBaseUpdate=d}var aS=!1;function kg(){if(aS){var u=vp;if(u!==null)throw u}}function $g(u,d,g,x){aS=!1;var I=u.updateQueue;Du=!1;var $=I.firstBaseUpdate,q=I.lastBaseUpdate,Y=I.shared.pending;if(Y!==null){I.shared.pending=null;var he=Y,$e=he.next;he.next=null,q===null?$=$e:q.next=$e,q=he;var Fe=u.alternate;Fe!==null&&(Fe=Fe.updateQueue,Y=Fe.lastBaseUpdate,Y!==q&&(Y===null?Fe.firstBaseUpdate=$e:Y.next=$e,Fe.lastBaseUpdate=he))}if($!==null){var Ve=I.baseState;q=0,Fe=$e=he=null,Y=$;do{var Ae=Y.lane&-536870913,De=Ae!==Y.lane;if(De?(dn&Ae)===Ae:(x&Ae)===Ae){Ae!==0&&Ae===yp&&(aS=!0),Fe!==null&&(Fe=Fe.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});e:{var It=u,bt=Y;Ae=d;var Pn=g;switch(bt.tag){case 1:if(It=bt.payload,typeof It=="function"){Ve=It.call(Pn,Ve,Ae);break e}Ve=It;break e;case 3:It.flags=It.flags&-65537|128;case 0:if(It=bt.payload,Ae=typeof It=="function"?It.call(Pn,Ve,Ae):It,Ae==null)break e;Ve=h({},Ve,Ae);break e;case 2:Du=!0}}Ae=Y.callback,Ae!==null&&(u.flags|=64,De&&(u.flags|=8192),De=I.callbacks,De===null?I.callbacks=[Ae]:De.push(Ae))}else De={lane:Ae,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Fe===null?($e=Fe=De,he=Ve):Fe=Fe.next=De,q|=Ae;if(Y=Y.next,Y===null){if(Y=I.shared.pending,Y===null)break;De=Y,Y=De.next,De.next=null,I.lastBaseUpdate=De,I.shared.pending=null}}while(!0);Fe===null&&(he=Ve),I.baseState=he,I.firstBaseUpdate=$e,I.lastBaseUpdate=Fe,$===null&&(I.shared.lanes=0),Uu|=q,u.lanes=q,u.memoizedState=Ve}}function NR(u,d){if(typeof u!="function")throw Error(s(191,u));u.call(d)}function IR(u,d){var g=u.callbacks;if(g!==null)for(u.callbacks=null,u=0;u<g.length;u++)NR(g[u],d)}var bp=ie(null),C_=ie(0);function CR(u,d){u=Cc,ce(C_,u),ce(bp,d),Cc=u|d.baseLanes}function oS(){ce(C_,Cc),ce(bp,bp.current)}function lS(){Cc=C_.current,de(bp),de(C_)}var Pu=0,Wt=null,Ln=null,Ws=null,k_=!1,_p=!1,Pd=!1,$_=0,Ag=0,xp=null,A7=0;function Rs(){throw Error(s(321))}function cS(u,d){if(d===null)return!1;for(var g=0;g<d.length&&g<u.length;g++)if(!Ti(u[g],d[g]))return!1;return!0}function uS(u,d,g,x,I,$){return Pu=$,Wt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,X.H=u===null||u.memoizedState===null?hD:dD,Pd=!1,$=g(x,I),Pd=!1,_p&&($=$R(d,g,x,I)),kR(u),$}function kR(u){X.H=P_;var d=Ln!==null&&Ln.next!==null;if(Pu=0,Ws=Ln=Wt=null,k_=!1,Ag=0,xp=null,d)throw Error(s(300));u===null||br||(u=u.dependencies,u!==null&&T_(u)&&(br=!0))}function $R(u,d,g,x){Wt=u;var I=0;do{if(_p&&(xp=null),Ag=0,_p=!1,25<=I)throw Error(s(301));if(I+=1,Ws=Ln=null,u.updateQueue!=null){var $=u.updateQueue;$.lastEffect=null,$.events=null,$.stores=null,$.memoCache!=null&&($.memoCache.index=0)}X.H=F7,$=d(g,x)}while(_p);return $}function R7(){var u=X.H,d=u.useState()[0];return d=typeof d.then=="function"?Rg(d):d,u=u.useState()[0],(Ln!==null?Ln.memoizedState:null)!==u&&(Wt.flags|=1024),d}function hS(){var u=$_!==0;return $_=0,u}function dS(u,d,g){d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~g}function fS(u){if(k_){for(u=u.memoizedState;u!==null;){var d=u.queue;d!==null&&(d.pending=null),u=u.next}k_=!1}Pu=0,Ws=Ln=Wt=null,_p=!1,Ag=$_=0,xp=null}function Bi(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ws===null?Wt.memoizedState=Ws=u:Ws=Ws.next=u,Ws}function Hs(){if(Ln===null){var u=Wt.alternate;u=u!==null?u.memoizedState:null}else u=Ln.next;var d=Ws===null?Wt.memoizedState:Ws.next;if(d!==null)Ws=d,Ln=u;else{if(u===null)throw Wt.alternate===null?Error(s(467)):Error(s(310));Ln=u,u={memoizedState:Ln.memoizedState,baseState:Ln.baseState,baseQueue:Ln.baseQueue,queue:Ln.queue,next:null},Ws===null?Wt.memoizedState=Ws=u:Ws=Ws.next=u}return Ws}function pS(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rg(u){var d=Ag;return Ag+=1,xp===null&&(xp=[]),u=TR(xp,u,d),d=Wt,(Ws===null?d.memoizedState:Ws.next)===null&&(d=d.alternate,X.H=d===null||d.memoizedState===null?hD:dD),u}function A_(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return Rg(u);if(u.$$typeof===A)return si(u)}throw Error(s(438,String(u)))}function mS(u){var d=null,g=Wt.updateQueue;if(g!==null&&(d=g.memoCache),d==null){var x=Wt.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(d={data:x.data.map(function(I){return I.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),g===null&&(g=pS(),Wt.updateQueue=g),g.memoCache=d,g=d.data[d.index],g===void 0)for(g=d.data[d.index]=Array(u),x=0;x<u;x++)g[x]=M;return d.index++,g}function wc(u,d){return typeof d=="function"?d(u):d}function R_(u){var d=Hs();return gS(d,Ln,u)}function gS(u,d,g){var x=u.queue;if(x===null)throw Error(s(311));x.lastRenderedReducer=g;var I=u.baseQueue,$=x.pending;if($!==null){if(I!==null){var q=I.next;I.next=$.next,$.next=q}d.baseQueue=I=$,x.pending=null}if($=u.baseState,I===null)u.memoizedState=$;else{d=I.next;var Y=q=null,he=null,$e=d,Fe=!1;do{var Ve=$e.lane&-536870913;if(Ve!==$e.lane?(dn&Ve)===Ve:(Pu&Ve)===Ve){var Ae=$e.revertLane;if(Ae===0)he!==null&&(he=he.next={lane:0,revertLane:0,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null}),Ve===yp&&(Fe=!0);else if((Pu&Ae)===Ae){$e=$e.next,Ae===yp&&(Fe=!0);continue}else Ve={lane:0,revertLane:$e.revertLane,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null},he===null?(Y=he=Ve,q=$):he=he.next=Ve,Wt.lanes|=Ae,Uu|=Ae;Ve=$e.action,Pd&&g($,Ve),$=$e.hasEagerState?$e.eagerState:g($,Ve)}else Ae={lane:Ve,revertLane:$e.revertLane,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null},he===null?(Y=he=Ae,q=$):he=he.next=Ae,Wt.lanes|=Ve,Uu|=Ve;$e=$e.next}while($e!==null&&$e!==d);if(he===null?q=$:he.next=Y,!Ti($,u.memoizedState)&&(br=!0,Fe&&(g=vp,g!==null)))throw g;u.memoizedState=$,u.baseState=q,u.baseQueue=he,x.lastRenderedState=$}return I===null&&(x.lanes=0),[u.memoizedState,x.dispatch]}function yS(u){var d=Hs(),g=d.queue;if(g===null)throw Error(s(311));g.lastRenderedReducer=u;var x=g.dispatch,I=g.pending,$=d.memoizedState;if(I!==null){g.pending=null;var q=I=I.next;do $=u($,q.action),q=q.next;while(q!==I);Ti($,d.memoizedState)||(br=!0),d.memoizedState=$,d.baseQueue===null&&(d.baseState=$),g.lastRenderedState=$}return[$,x]}function AR(u,d,g){var x=Wt,I=Hs(),$=Ct;if($){if(g===void 0)throw Error(s(407));g=g()}else g=d();var q=!Ti((Ln||I).memoizedState,g);q&&(I.memoizedState=g,br=!0),I=I.queue;var Y=LR.bind(null,x,I,u);if(Dg(2048,8,Y,[u]),I.getSnapshot!==d||q||Ws!==null&&Ws.memoizedState.tag&1){if(x.flags|=2048,wp(9,D_(),DR.bind(null,x,I,g,d),null),Yn===null)throw Error(s(349));$||(Pu&124)!==0||RR(x,d,g)}return g}function RR(u,d,g){u.flags|=16384,u={getSnapshot:d,value:g},d=Wt.updateQueue,d===null?(d=pS(),Wt.updateQueue=d,d.stores=[u]):(g=d.stores,g===null?d.stores=[u]:g.push(u))}function DR(u,d,g,x){d.value=g,d.getSnapshot=x,OR(d)&&PR(u)}function LR(u,d,g){return g(function(){OR(d)&&PR(u)})}function OR(u){var d=u.getSnapshot;u=u.value;try{var g=d();return!Ti(u,g)}catch{return!0}}function PR(u){var d=ku(u,2);d!==null&&_a(d,u,2)}function vS(u){var d=Bi();if(typeof u=="function"){var g=u;if(u=g(),Pd){ts(!0);try{g()}finally{ts(!1)}}}return d.memoizedState=d.baseState=u,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wc,lastRenderedState:u},d}function MR(u,d,g,x){return u.baseState=g,gS(u,Ln,typeof x=="function"?x:wc)}function D7(u,d,g,x,I){if(O_(u))throw Error(s(485));if(u=d.action,u!==null){var $={payload:I,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){$.listeners.push(q)}};X.T!==null?g(!0):$.isTransition=!1,x($),g=d.pending,g===null?($.next=d.pending=$,FR(d,$)):($.next=g.next,d.pending=g.next=$)}}function FR(u,d){var g=d.action,x=d.payload,I=u.state;if(d.isTransition){var $=X.T,q={};X.T=q;try{var Y=g(I,x),he=X.S;he!==null&&he(q,Y),jR(u,d,Y)}catch($e){bS(u,d,$e)}finally{X.T=$}}else try{$=g(I,x),jR(u,d,$)}catch($e){bS(u,d,$e)}}function jR(u,d,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(x){BR(u,d,x)},function(x){return bS(u,d,x)}):BR(u,d,g)}function BR(u,d,g){d.status="fulfilled",d.value=g,zR(d),u.state=g,d=u.pending,d!==null&&(g=d.next,g===d?u.pending=null:(g=g.next,d.next=g,FR(u,g)))}function bS(u,d,g){var x=u.pending;if(u.pending=null,x!==null){x=x.next;do d.status="rejected",d.reason=g,zR(d),d=d.next;while(d!==x)}u.action=null}function zR(u){u=u.listeners;for(var d=0;d<u.length;d++)(0,u[d])()}function VR(u,d){return d}function UR(u,d){if(Ct){var g=Yn.formState;if(g!==null){e:{var x=Wt;if(Ct){if(lt){t:{for(var I=lt,$=ms;I.nodeType!==8;){if(!$){I=null;break t}if(I=Ro(I.nextSibling),I===null){I=null;break t}}$=I.data,I=$==="F!"||$==="F"?I:null}if(I){lt=Ro(I.nextSibling),x=I.data==="F!";break e}}ji(x)}x=!1}x&&(d=g[0])}}return g=Bi(),g.memoizedState=g.baseState=d,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:VR,lastRenderedState:d},g.queue=x,g=lD.bind(null,Wt,x),x.dispatch=g,x=vS(!1),$=SS.bind(null,Wt,!1,x.queue),x=Bi(),I={state:d,dispatch:null,action:u,pending:null},x.queue=I,g=D7.bind(null,Wt,I,$,g),I.dispatch=g,x.memoizedState=u,[d,g,!1]}function GR(u){var d=Hs();return WR(d,Ln,u)}function WR(u,d,g){if(d=gS(u,d,VR)[0],u=R_(wc)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var x=Rg(d)}catch(q){throw q===Ng?N_:q}else x=d;d=Hs();var I=d.queue,$=I.dispatch;return g!==d.memoizedState&&(Wt.flags|=2048,wp(9,D_(),L7.bind(null,I,g),null)),[x,$,u]}function L7(u,d){u.action=d}function HR(u){var d=Hs(),g=Ln;if(g!==null)return WR(d,g,u);Hs(),d=d.memoizedState,g=Hs();var x=g.queue.dispatch;return g.memoizedState=u,[d,x,!1]}function wp(u,d,g,x){return u={tag:u,create:g,deps:x,inst:d,next:null},d=Wt.updateQueue,d===null&&(d=pS(),Wt.updateQueue=d),g=d.lastEffect,g===null?d.lastEffect=u.next=u:(x=g.next,g.next=u,u.next=x,d.lastEffect=u),u}function D_(){return{destroy:void 0,resource:void 0}}function qR(){return Hs().memoizedState}function L_(u,d,g,x){var I=Bi();x=x===void 0?null:x,Wt.flags|=u,I.memoizedState=wp(1|d,D_(),g,x)}function Dg(u,d,g,x){var I=Hs();x=x===void 0?null:x;var $=I.memoizedState.inst;Ln!==null&&x!==null&&cS(x,Ln.memoizedState.deps)?I.memoizedState=wp(d,$,g,x):(Wt.flags|=u,I.memoizedState=wp(1|d,$,g,x))}function KR(u,d){L_(8390656,8,u,d)}function XR(u,d){Dg(2048,8,u,d)}function ZR(u,d){return Dg(4,2,u,d)}function YR(u,d){return Dg(4,4,u,d)}function QR(u,d){if(typeof d=="function"){u=u();var g=d(u);return function(){typeof g=="function"?g():d(null)}}if(d!=null)return u=u(),d.current=u,function(){d.current=null}}function JR(u,d,g){g=g!=null?g.concat([u]):null,Dg(4,4,QR.bind(null,d,u),g)}function _S(){}function eD(u,d){var g=Hs();d=d===void 0?null:d;var x=g.memoizedState;return d!==null&&cS(d,x[1])?x[0]:(g.memoizedState=[u,d],u)}function tD(u,d){var g=Hs();d=d===void 0?null:d;var x=g.memoizedState;if(d!==null&&cS(d,x[1]))return x[0];if(x=u(),Pd){ts(!0);try{u()}finally{ts(!1)}}return g.memoizedState=[x,d],x}function xS(u,d,g){return g===void 0||(Pu&1073741824)!==0?u.memoizedState=d:(u.memoizedState=g,u=rL(),Wt.lanes|=u,Uu|=u,g)}function nD(u,d,g,x){return Ti(g,d)?g:bp.current!==null?(u=xS(u,g,x),Ti(u,d)||(br=!0),u):(Pu&42)===0?(br=!0,u.memoizedState=g):(u=rL(),Wt.lanes|=u,Uu|=u,d)}function sD(u,d,g,x,I){var $=se.p;se.p=$!==0&&8>$?$:8;var q=X.T,Y={};X.T=Y,SS(u,!1,d,g);try{var he=I(),$e=X.S;if($e!==null&&$e(Y,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var Fe=$7(he,x);Lg(u,d,Fe,ba(u))}else Lg(u,d,x,ba(u))}catch(Ve){Lg(u,d,{then:function(){},status:"rejected",reason:Ve},ba())}finally{se.p=$,X.T=q}}function O7(){}function wS(u,d,g,x){if(u.tag!==5)throw Error(s(476));var I=rD(u).queue;sD(u,I,d,ne,g===null?O7:function(){return iD(u),g(x)})}function rD(u){var d=u.memoizedState;if(d!==null)return d;d={memoizedState:ne,baseState:ne,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wc,lastRenderedState:ne},next:null};var g={};return d.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wc,lastRenderedState:g},next:null},u.memoizedState=d,u=u.alternate,u!==null&&(u.memoizedState=d),d}function iD(u){var d=rD(u).next.queue;Lg(u,d,{},ba())}function TS(){return si(Qg)}function aD(){return Hs().memoizedState}function oD(){return Hs().memoizedState}function P7(u){for(var d=u.return;d!==null;){switch(d.tag){case 24:case 3:var g=ba();u=Lu(g);var x=Ou(d,u,g);x!==null&&(_a(x,d,g),Cg(x,d,g)),d={cache:JT()},u.payload=d;return}d=d.return}}function M7(u,d,g){var x=ba();g={lane:x,revertLane:0,action:g,hasEagerState:!1,eagerState:null,next:null},O_(u)?cD(d,g):(g=bc(u,d,g,x),g!==null&&(_a(g,u,x),uD(g,d,x)))}function lD(u,d,g){var x=ba();Lg(u,d,g,x)}function Lg(u,d,g,x){var I={lane:x,revertLane:0,action:g,hasEagerState:!1,eagerState:null,next:null};if(O_(u))cD(d,I);else{var $=u.alternate;if(u.lanes===0&&($===null||$.lanes===0)&&($=d.lastRenderedReducer,$!==null))try{var q=d.lastRenderedState,Y=$(q,g);if(I.hasEagerState=!0,I.eagerState=Y,Ti(Y,q))return Cd(u,d,I,0),Yn===null&&Id(),!1}catch{}finally{}if(g=bc(u,d,I,x),g!==null)return _a(g,u,x),uD(g,d,x),!0}return!1}function SS(u,d,g,x){if(x={lane:2,revertLane:nE(),action:x,hasEagerState:!1,eagerState:null,next:null},O_(u)){if(d)throw Error(s(479))}else d=bc(u,g,x,2),d!==null&&_a(d,u,2)}function O_(u){var d=u.alternate;return u===Wt||d!==null&&d===Wt}function cD(u,d){_p=k_=!0;var g=u.pending;g===null?d.next=d:(d.next=g.next,g.next=d),u.pending=d}function uD(u,d,g){if((g&4194048)!==0){var x=d.lanes;x&=u.pendingLanes,g|=x,d.lanes=g,dd(u,g)}}var P_={readContext:si,use:A_,useCallback:Rs,useContext:Rs,useEffect:Rs,useImperativeHandle:Rs,useLayoutEffect:Rs,useInsertionEffect:Rs,useMemo:Rs,useReducer:Rs,useRef:Rs,useState:Rs,useDebugValue:Rs,useDeferredValue:Rs,useTransition:Rs,useSyncExternalStore:Rs,useId:Rs,useHostTransitionStatus:Rs,useFormState:Rs,useActionState:Rs,useOptimistic:Rs,useMemoCache:Rs,useCacheRefresh:Rs},hD={readContext:si,use:A_,useCallback:function(u,d){return Bi().memoizedState=[u,d===void 0?null:d],u},useContext:si,useEffect:KR,useImperativeHandle:function(u,d,g){g=g!=null?g.concat([u]):null,L_(4194308,4,QR.bind(null,d,u),g)},useLayoutEffect:function(u,d){return L_(4194308,4,u,d)},useInsertionEffect:function(u,d){L_(4,2,u,d)},useMemo:function(u,d){var g=Bi();d=d===void 0?null:d;var x=u();if(Pd){ts(!0);try{u()}finally{ts(!1)}}return g.memoizedState=[x,d],x},useReducer:function(u,d,g){var x=Bi();if(g!==void 0){var I=g(d);if(Pd){ts(!0);try{g(d)}finally{ts(!1)}}}else I=d;return x.memoizedState=x.baseState=I,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:I},x.queue=u,u=u.dispatch=M7.bind(null,Wt,u),[x.memoizedState,u]},useRef:function(u){var d=Bi();return u={current:u},d.memoizedState=u},useState:function(u){u=vS(u);var d=u.queue,g=lD.bind(null,Wt,d);return d.dispatch=g,[u.memoizedState,g]},useDebugValue:_S,useDeferredValue:function(u,d){var g=Bi();return xS(g,u,d)},useTransition:function(){var u=vS(!1);return u=sD.bind(null,Wt,u.queue,!0,!1),Bi().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,d,g){var x=Wt,I=Bi();if(Ct){if(g===void 0)throw Error(s(407));g=g()}else{if(g=d(),Yn===null)throw Error(s(349));(dn&124)!==0||RR(x,d,g)}I.memoizedState=g;var $={value:g,getSnapshot:d};return I.queue=$,KR(LR.bind(null,x,$,u),[u]),x.flags|=2048,wp(9,D_(),DR.bind(null,x,$,g,d),null),g},useId:function(){var u=Bi(),d=Yn.identifierPrefix;if(Ct){var g=ue,x=Z;g=(x&~(1<<32-os(x)-1)).toString(32)+g,d="«"+d+"R"+g,g=$_++,0<g&&(d+="H"+g.toString(32)),d+="»"}else g=A7++,d="«"+d+"r"+g.toString(32)+"»";return u.memoizedState=d},useHostTransitionStatus:TS,useFormState:UR,useActionState:UR,useOptimistic:function(u){var d=Bi();d.memoizedState=d.baseState=u;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=g,d=SS.bind(null,Wt,!0,g),g.dispatch=d,[u,d]},useMemoCache:mS,useCacheRefresh:function(){return Bi().memoizedState=P7.bind(null,Wt)}},dD={readContext:si,use:A_,useCallback:eD,useContext:si,useEffect:XR,useImperativeHandle:JR,useInsertionEffect:ZR,useLayoutEffect:YR,useMemo:tD,useReducer:R_,useRef:qR,useState:function(){return R_(wc)},useDebugValue:_S,useDeferredValue:function(u,d){var g=Hs();return nD(g,Ln.memoizedState,u,d)},useTransition:function(){var u=R_(wc)[0],d=Hs().memoizedState;return[typeof u=="boolean"?u:Rg(u),d]},useSyncExternalStore:AR,useId:aD,useHostTransitionStatus:TS,useFormState:GR,useActionState:GR,useOptimistic:function(u,d){var g=Hs();return MR(g,Ln,u,d)},useMemoCache:mS,useCacheRefresh:oD},F7={readContext:si,use:A_,useCallback:eD,useContext:si,useEffect:XR,useImperativeHandle:JR,useInsertionEffect:ZR,useLayoutEffect:YR,useMemo:tD,useReducer:yS,useRef:qR,useState:function(){return yS(wc)},useDebugValue:_S,useDeferredValue:function(u,d){var g=Hs();return Ln===null?xS(g,u,d):nD(g,Ln.memoizedState,u,d)},useTransition:function(){var u=yS(wc)[0],d=Hs().memoizedState;return[typeof u=="boolean"?u:Rg(u),d]},useSyncExternalStore:AR,useId:aD,useHostTransitionStatus:TS,useFormState:HR,useActionState:HR,useOptimistic:function(u,d){var g=Hs();return Ln!==null?MR(g,Ln,u,d):(g.baseState=u,[u,g.queue.dispatch])},useMemoCache:mS,useCacheRefresh:oD},Tp=null,Og=0;function M_(u){var d=Og;return Og+=1,Tp===null&&(Tp=[]),TR(Tp,u,d)}function Pg(u,d){d=d.props.ref,u.ref=d!==void 0?d:null}function F_(u,d){throw d.$$typeof===p?Error(s(525)):(u=Object.prototype.toString.call(d),Error(s(31,u==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":u)))}function fD(u){var d=u._init;return d(u._payload)}function pD(u){function d(we,ge){if(u){var Ce=we.deletions;Ce===null?(we.deletions=[ge],we.flags|=16):Ce.push(ge)}}function g(we,ge){if(!u)return null;for(;ge!==null;)d(we,ge),ge=ge.sibling;return null}function x(we){for(var ge=new Map;we!==null;)we.key!==null?ge.set(we.key,we):ge.set(we.index,we),we=we.sibling;return ge}function I(we,ge){return we=Ha(we,ge),we.index=0,we.sibling=null,we}function $(we,ge,Ce){return we.index=Ce,u?(Ce=we.alternate,Ce!==null?(Ce=Ce.index,Ce<ge?(we.flags|=67108866,ge):Ce):(we.flags|=67108866,ge)):(we.flags|=1048576,ge)}function q(we){return u&&we.alternate===null&&(we.flags|=67108866),we}function Y(we,ge,Ce,je){return ge===null||ge.tag!==6?(ge=Tg(Ce,we.mode,je),ge.return=we,ge):(ge=I(ge,Ce),ge.return=we,ge)}function he(we,ge,Ce,je){var at=Ce.type;return at===_?Fe(we,ge,Ce.props.children,je,Ce.key):ge!==null&&(ge.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===P&&fD(at)===ge.type)?(ge=I(ge,Ce.props),Pg(ge,Ce),ge.return=we,ge):(ge=$d(Ce.type,Ce.key,Ce.props,null,we.mode,je),Pg(ge,Ce),ge.return=we,ge)}function $e(we,ge,Ce,je){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Ce.containerInfo||ge.stateNode.implementation!==Ce.implementation?(ge=mp(Ce,we.mode,je),ge.return=we,ge):(ge=I(ge,Ce.children||[]),ge.return=we,ge)}function Fe(we,ge,Ce,je,at){return ge===null||ge.tag!==7?(ge=fl(Ce,we.mode,je,at),ge.return=we,ge):(ge=I(ge,Ce),ge.return=we,ge)}function Ve(we,ge,Ce){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ge=Tg(""+ge,we.mode,Ce),ge.return=we,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case m:return Ce=$d(ge.type,ge.key,ge.props,null,we.mode,Ce),Pg(Ce,ge),Ce.return=we,Ce;case v:return ge=mp(ge,we.mode,Ce),ge.return=we,ge;case P:var je=ge._init;return ge=je(ge._payload),Ve(we,ge,Ce)}if(J(ge)||V(ge))return ge=fl(ge,we.mode,Ce,null),ge.return=we,ge;if(typeof ge.then=="function")return Ve(we,M_(ge),Ce);if(ge.$$typeof===A)return Ve(we,S_(we,ge),Ce);F_(we,ge)}return null}function Ae(we,ge,Ce,je){var at=ge!==null?ge.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return at!==null?null:Y(we,ge,""+Ce,je);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case m:return Ce.key===at?he(we,ge,Ce,je):null;case v:return Ce.key===at?$e(we,ge,Ce,je):null;case P:return at=Ce._init,Ce=at(Ce._payload),Ae(we,ge,Ce,je)}if(J(Ce)||V(Ce))return at!==null?null:Fe(we,ge,Ce,je,null);if(typeof Ce.then=="function")return Ae(we,ge,M_(Ce),je);if(Ce.$$typeof===A)return Ae(we,ge,S_(we,Ce),je);F_(we,Ce)}return null}function De(we,ge,Ce,je,at){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return we=we.get(Ce)||null,Y(ge,we,""+je,at);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case m:return we=we.get(je.key===null?Ce:je.key)||null,he(ge,we,je,at);case v:return we=we.get(je.key===null?Ce:je.key)||null,$e(ge,we,je,at);case P:var Kt=je._init;return je=Kt(je._payload),De(we,ge,Ce,je,at)}if(J(je)||V(je))return we=we.get(Ce)||null,Fe(ge,we,je,at,null);if(typeof je.then=="function")return De(we,ge,Ce,M_(je),at);if(je.$$typeof===A)return De(we,ge,Ce,S_(ge,je),at);F_(ge,je)}return null}function It(we,ge,Ce,je){for(var at=null,Kt=null,dt=ge,xt=ge=0,xr=null;dt!==null&&xt<Ce.length;xt++){dt.index>xt?(xr=dt,dt=null):xr=dt.sibling;var vn=Ae(we,dt,Ce[xt],je);if(vn===null){dt===null&&(dt=xr);break}u&&dt&&vn.alternate===null&&d(we,dt),ge=$(vn,ge,xt),Kt===null?at=vn:Kt.sibling=vn,Kt=vn,dt=xr}if(xt===Ce.length)return g(we,dt),Ct&&Ne(we,xt),at;if(dt===null){for(;xt<Ce.length;xt++)dt=Ve(we,Ce[xt],je),dt!==null&&(ge=$(dt,ge,xt),Kt===null?at=dt:Kt.sibling=dt,Kt=dt);return Ct&&Ne(we,xt),at}for(dt=x(dt);xt<Ce.length;xt++)xr=De(dt,we,xt,Ce[xt],je),xr!==null&&(u&&xr.alternate!==null&&dt.delete(xr.key===null?xt:xr.key),ge=$(xr,ge,xt),Kt===null?at=xr:Kt.sibling=xr,Kt=xr);return u&&dt.forEach(function(Qu){return d(we,Qu)}),Ct&&Ne(we,xt),at}function bt(we,ge,Ce,je){if(Ce==null)throw Error(s(151));for(var at=null,Kt=null,dt=ge,xt=ge=0,xr=null,vn=Ce.next();dt!==null&&!vn.done;xt++,vn=Ce.next()){dt.index>xt?(xr=dt,dt=null):xr=dt.sibling;var Qu=Ae(we,dt,vn.value,je);if(Qu===null){dt===null&&(dt=xr);break}u&&dt&&Qu.alternate===null&&d(we,dt),ge=$(Qu,ge,xt),Kt===null?at=Qu:Kt.sibling=Qu,Kt=Qu,dt=xr}if(vn.done)return g(we,dt),Ct&&Ne(we,xt),at;if(dt===null){for(;!vn.done;xt++,vn=Ce.next())vn=Ve(we,vn.value,je),vn!==null&&(ge=$(vn,ge,xt),Kt===null?at=vn:Kt.sibling=vn,Kt=vn);return Ct&&Ne(we,xt),at}for(dt=x(dt);!vn.done;xt++,vn=Ce.next())vn=De(dt,we,xt,vn.value,je),vn!==null&&(u&&vn.alternate!==null&&dt.delete(vn.key===null?xt:vn.key),ge=$(vn,ge,xt),Kt===null?at=vn:Kt.sibling=vn,Kt=vn);return u&&dt.forEach(function(jX){return d(we,jX)}),Ct&&Ne(we,xt),at}function Pn(we,ge,Ce,je){if(typeof Ce=="object"&&Ce!==null&&Ce.type===_&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case m:e:{for(var at=Ce.key;ge!==null;){if(ge.key===at){if(at=Ce.type,at===_){if(ge.tag===7){g(we,ge.sibling),je=I(ge,Ce.props.children),je.return=we,we=je;break e}}else if(ge.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===P&&fD(at)===ge.type){g(we,ge.sibling),je=I(ge,Ce.props),Pg(je,Ce),je.return=we,we=je;break e}g(we,ge);break}else d(we,ge);ge=ge.sibling}Ce.type===_?(je=fl(Ce.props.children,we.mode,je,Ce.key),je.return=we,we=je):(je=$d(Ce.type,Ce.key,Ce.props,null,we.mode,je),Pg(je,Ce),je.return=we,we=je)}return q(we);case v:e:{for(at=Ce.key;ge!==null;){if(ge.key===at)if(ge.tag===4&&ge.stateNode.containerInfo===Ce.containerInfo&&ge.stateNode.implementation===Ce.implementation){g(we,ge.sibling),je=I(ge,Ce.children||[]),je.return=we,we=je;break e}else{g(we,ge);break}else d(we,ge);ge=ge.sibling}je=mp(Ce,we.mode,je),je.return=we,we=je}return q(we);case P:return at=Ce._init,Ce=at(Ce._payload),Pn(we,ge,Ce,je)}if(J(Ce))return It(we,ge,Ce,je);if(V(Ce)){if(at=V(Ce),typeof at!="function")throw Error(s(150));return Ce=at.call(Ce),bt(we,ge,Ce,je)}if(typeof Ce.then=="function")return Pn(we,ge,M_(Ce),je);if(Ce.$$typeof===A)return Pn(we,ge,S_(we,Ce),je);F_(we,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint"?(Ce=""+Ce,ge!==null&&ge.tag===6?(g(we,ge.sibling),je=I(ge,Ce),je.return=we,we=je):(g(we,ge),je=Tg(Ce,we.mode,je),je.return=we,we=je),q(we)):g(we,ge)}return function(we,ge,Ce,je){try{Og=0;var at=Pn(we,ge,Ce,je);return Tp=null,at}catch(dt){if(dt===Ng||dt===N_)throw dt;var Kt=Ii(29,dt,null,we.mode);return Kt.lanes=je,Kt.return=we,Kt}finally{}}}var Sp=pD(!0),mD=pD(!1),Ka=ie(null),ml=null;function Mu(u){var d=u.alternate;ce(or,or.current&1),ce(Ka,u),ml===null&&(d===null||bp.current!==null||d.memoizedState!==null)&&(ml=u)}function gD(u){if(u.tag===22){if(ce(or,or.current),ce(Ka,u),ml===null){var d=u.alternate;d!==null&&d.memoizedState!==null&&(ml=u)}}else Fu()}function Fu(){ce(or,or.current),ce(Ka,Ka.current)}function Tc(u){de(Ka),ml===u&&(ml=null),de(or)}var or=ie(0);function j_(u){for(var d=u;d!==null;){if(d.tag===13){var g=d.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||pE(g)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}function ES(u,d,g,x){d=u.memoizedState,g=g(x,d),g=g==null?d:h({},d,g),u.memoizedState=g,u.lanes===0&&(u.updateQueue.baseState=g)}var NS={enqueueSetState:function(u,d,g){u=u._reactInternals;var x=ba(),I=Lu(x);I.payload=d,g!=null&&(I.callback=g),d=Ou(u,I,x),d!==null&&(_a(d,u,x),Cg(d,u,x))},enqueueReplaceState:function(u,d,g){u=u._reactInternals;var x=ba(),I=Lu(x);I.tag=1,I.payload=d,g!=null&&(I.callback=g),d=Ou(u,I,x),d!==null&&(_a(d,u,x),Cg(d,u,x))},enqueueForceUpdate:function(u,d){u=u._reactInternals;var g=ba(),x=Lu(g);x.tag=2,d!=null&&(x.callback=d),d=Ou(u,x,g),d!==null&&(_a(d,u,g),Cg(d,u,g))}};function yD(u,d,g,x,I,$,q){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(x,$,q):d.prototype&&d.prototype.isPureReactComponent?!Si(g,x)||!Si(I,$):!0}function vD(u,d,g,x){u=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(g,x),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(g,x),d.state!==u&&NS.enqueueReplaceState(d,d.state,null)}function Md(u,d){var g=d;if("ref"in d){g={};for(var x in d)x!=="ref"&&(g[x]=d[x])}if(u=u.defaultProps){g===d&&(g=h({},g));for(var I in u)g[I]===void 0&&(g[I]=u[I])}return g}var B_=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)};function bD(u){B_(u)}function _D(u){console.error(u)}function xD(u){B_(u)}function z_(u,d){try{var g=u.onUncaughtError;g(d.value,{componentStack:d.stack})}catch(x){setTimeout(function(){throw x})}}function wD(u,d,g){try{var x=u.onCaughtError;x(g.value,{componentStack:g.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(I){setTimeout(function(){throw I})}}function IS(u,d,g){return g=Lu(g),g.tag=3,g.payload={element:null},g.callback=function(){z_(u,d)},g}function TD(u){return u=Lu(u),u.tag=3,u}function SD(u,d,g,x){var I=g.type.getDerivedStateFromError;if(typeof I=="function"){var $=x.value;u.payload=function(){return I($)},u.callback=function(){wD(d,g,x)}}var q=g.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(u.callback=function(){wD(d,g,x),typeof I!="function"&&(Gu===null?Gu=new Set([this]):Gu.add(this));var Y=x.stack;this.componentDidCatch(x.value,{componentStack:Y!==null?Y:""})})}function j7(u,d,g,x,I){if(g.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(d=g.alternate,d!==null&&Dd(d,g,I,!0),g=Ka.current,g!==null){switch(g.tag){case 13:return ml===null?YS():g.alternate===null&&xs===0&&(xs=3),g.flags&=-257,g.flags|=65536,g.lanes=I,x===nS?g.flags|=16384:(d=g.updateQueue,d===null?g.updateQueue=new Set([x]):d.add(x),JS(u,x,I)),!1;case 22:return g.flags|=65536,x===nS?g.flags|=16384:(d=g.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([x])},g.updateQueue=d):(g=d.retryQueue,g===null?d.retryQueue=new Set([x]):g.add(x)),JS(u,x,I)),!1}throw Error(s(435,g.tag))}return JS(u,x,I),YS(),!1}if(Ct)return d=Ka.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=I,x!==vr&&(u=Error(s(422),{cause:x}),Ru(Ei(u,g)))):(x!==vr&&(d=Error(s(423),{cause:x}),Ru(Ei(d,g))),u=u.current.alternate,u.flags|=65536,I&=-I,u.lanes|=I,x=Ei(x,g),I=IS(u.stateNode,x,I),iS(u,I),xs!==4&&(xs=2)),!1;var $=Error(s(520),{cause:x});if($=Ei($,g),Ug===null?Ug=[$]:Ug.push($),xs!==4&&(xs=2),d===null)return!0;x=Ei(x,g),g=d;do{switch(g.tag){case 3:return g.flags|=65536,u=I&-I,g.lanes|=u,u=IS(g.stateNode,x,u),iS(g,u),!1;case 1:if(d=g.type,$=g.stateNode,(g.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(Gu===null||!Gu.has($))))return g.flags|=65536,I&=-I,g.lanes|=I,I=TD(I),SD(I,u,g,x),iS(g,I),!1}g=g.return}while(g!==null);return!1}var ED=Error(s(461)),br=!1;function Dr(u,d,g,x){d.child=u===null?mD(d,null,g,x):Sp(d,u.child,g,x)}function ND(u,d,g,x,I){g=g.render;var $=d.ref;if("ref"in x){var q={};for(var Y in x)Y!=="ref"&&(q[Y]=x[Y])}else q=x;return Ld(d),x=uS(u,d,g,q,$,I),Y=hS(),u!==null&&!br?(dS(u,d,I),Sc(u,d,I)):(Ct&&Y&&Ge(d),d.flags|=1,Dr(u,d,x,I),d.child)}function ID(u,d,g,x,I){if(u===null){var $=g.type;return typeof $=="function"&&!pp($)&&$.defaultProps===void 0&&g.compare===null?(d.tag=15,d.type=$,CD(u,d,$,x,I)):(u=$d(g.type,null,x,d,d.mode,I),u.ref=d.ref,u.return=d,d.child=u)}if($=u.child,!OS(u,I)){var q=$.memoizedProps;if(g=g.compare,g=g!==null?g:Si,g(q,x)&&u.ref===d.ref)return Sc(u,d,I)}return d.flags|=1,u=Ha($,x),u.ref=d.ref,u.return=d,d.child=u}function CD(u,d,g,x,I){if(u!==null){var $=u.memoizedProps;if(Si($,x)&&u.ref===d.ref)if(br=!1,d.pendingProps=x=$,OS(u,I))(u.flags&131072)!==0&&(br=!0);else return d.lanes=u.lanes,Sc(u,d,I)}return CS(u,d,g,x,I)}function kD(u,d,g){var x=d.pendingProps,I=x.children,$=u!==null?u.memoizedState:null;if(x.mode==="hidden"){if((d.flags&128)!==0){if(x=$!==null?$.baseLanes|g:g,u!==null){for(I=d.child=u.child,$=0;I!==null;)$=$|I.lanes|I.childLanes,I=I.sibling;d.childLanes=$&~x}else d.childLanes=0,d.child=null;return $D(u,d,x,g)}if((g&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},u!==null&&E_(d,$!==null?$.cachePool:null),$!==null?CR(d,$):oS(),gD(d);else return d.lanes=d.childLanes=536870912,$D(u,d,$!==null?$.baseLanes|g:g,g)}else $!==null?(E_(d,$.cachePool),CR(d,$),Fu(),d.memoizedState=null):(u!==null&&E_(d,null),oS(),Fu());return Dr(u,d,I,g),d.child}function $D(u,d,g,x){var I=tS();return I=I===null?null:{parent:ar._currentValue,pool:I},d.memoizedState={baseLanes:g,cachePool:I},u!==null&&E_(d,null),oS(),gD(d),u!==null&&Dd(u,d,x,!0),null}function V_(u,d){var g=d.ref;if(g===null)u!==null&&u.ref!==null&&(d.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(s(284));(u===null||u.ref!==g)&&(d.flags|=4194816)}}function CS(u,d,g,x,I){return Ld(d),g=uS(u,d,g,x,void 0,I),x=hS(),u!==null&&!br?(dS(u,d,I),Sc(u,d,I)):(Ct&&x&&Ge(d),d.flags|=1,Dr(u,d,g,I),d.child)}function AD(u,d,g,x,I,$){return Ld(d),d.updateQueue=null,g=$R(d,x,g,I),kR(u),x=hS(),u!==null&&!br?(dS(u,d,$),Sc(u,d,$)):(Ct&&x&&Ge(d),d.flags|=1,Dr(u,d,g,$),d.child)}function RD(u,d,g,x,I){if(Ld(d),d.stateNode===null){var $=_c,q=g.contextType;typeof q=="object"&&q!==null&&($=si(q)),$=new g(x,$),d.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,$.updater=NS,d.stateNode=$,$._reactInternals=d,$=d.stateNode,$.props=x,$.state=d.memoizedState,$.refs={},sS(d),q=g.contextType,$.context=typeof q=="object"&&q!==null?si(q):_c,$.state=d.memoizedState,q=g.getDerivedStateFromProps,typeof q=="function"&&(ES(d,g,q,x),$.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(q=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),q!==$.state&&NS.enqueueReplaceState($,$.state,null),$g(d,x,$,I),kg(),$.state=d.memoizedState),typeof $.componentDidMount=="function"&&(d.flags|=4194308),x=!0}else if(u===null){$=d.stateNode;var Y=d.memoizedProps,he=Md(g,Y);$.props=he;var $e=$.context,Fe=g.contextType;q=_c,typeof Fe=="object"&&Fe!==null&&(q=si(Fe));var Ve=g.getDerivedStateFromProps;Fe=typeof Ve=="function"||typeof $.getSnapshotBeforeUpdate=="function",Y=d.pendingProps!==Y,Fe||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(Y||$e!==q)&&vD(d,$,x,q),Du=!1;var Ae=d.memoizedState;$.state=Ae,$g(d,x,$,I),kg(),$e=d.memoizedState,Y||Ae!==$e||Du?(typeof Ve=="function"&&(ES(d,g,Ve,x),$e=d.memoizedState),(he=Du||yD(d,g,he,x,Ae,$e,q))?(Fe||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(d.flags|=4194308)):(typeof $.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=x,d.memoizedState=$e),$.props=x,$.state=$e,$.context=q,x=he):(typeof $.componentDidMount=="function"&&(d.flags|=4194308),x=!1)}else{$=d.stateNode,rS(u,d),q=d.memoizedProps,Fe=Md(g,q),$.props=Fe,Ve=d.pendingProps,Ae=$.context,$e=g.contextType,he=_c,typeof $e=="object"&&$e!==null&&(he=si($e)),Y=g.getDerivedStateFromProps,($e=typeof Y=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(q!==Ve||Ae!==he)&&vD(d,$,x,he),Du=!1,Ae=d.memoizedState,$.state=Ae,$g(d,x,$,I),kg();var De=d.memoizedState;q!==Ve||Ae!==De||Du||u!==null&&u.dependencies!==null&&T_(u.dependencies)?(typeof Y=="function"&&(ES(d,g,Y,x),De=d.memoizedState),(Fe=Du||yD(d,g,Fe,x,Ae,De,he)||u!==null&&u.dependencies!==null&&T_(u.dependencies))?($e||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(x,De,he),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(x,De,he)),typeof $.componentDidUpdate=="function"&&(d.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof $.componentDidUpdate!="function"||q===u.memoizedProps&&Ae===u.memoizedState||(d.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||q===u.memoizedProps&&Ae===u.memoizedState||(d.flags|=1024),d.memoizedProps=x,d.memoizedState=De),$.props=x,$.state=De,$.context=he,x=Fe):(typeof $.componentDidUpdate!="function"||q===u.memoizedProps&&Ae===u.memoizedState||(d.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||q===u.memoizedProps&&Ae===u.memoizedState||(d.flags|=1024),x=!1)}return $=x,V_(u,d),x=(d.flags&128)!==0,$||x?($=d.stateNode,g=x&&typeof g.getDerivedStateFromError!="function"?null:$.render(),d.flags|=1,u!==null&&x?(d.child=Sp(d,u.child,null,I),d.child=Sp(d,null,g,I)):Dr(u,d,g,I),d.memoizedState=$.state,u=d.child):u=Sc(u,d,I),u}function DD(u,d,g,x){return Au(),d.flags|=256,Dr(u,d,g,x),d.child}var kS={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $S(u){return{baseLanes:u,cachePool:_R()}}function AS(u,d,g){return u=u!==null?u.childLanes&~g:0,d&&(u|=Xa),u}function LD(u,d,g){var x=d.pendingProps,I=!1,$=(d.flags&128)!==0,q;if((q=$)||(q=u!==null&&u.memoizedState===null?!1:(or.current&2)!==0),q&&(I=!0,d.flags&=-129),q=(d.flags&32)!==0,d.flags&=-33,u===null){if(Ct){if(I?Mu(d):Fu(),Ct){var Y=lt,he;if(he=Y){e:{for(he=Y,Y=ms;he.nodeType!==8;){if(!Y){Y=null;break e}if(he=Ro(he.nextSibling),he===null){Y=null;break e}}Y=he}Y!==null?(d.memoizedState={dehydrated:Y,treeContext:z!==null?{id:Z,overflow:ue}:null,retryLane:536870912,hydrationErrors:null},he=Ii(18,null,null,0),he.stateNode=Y,he.return=d,d.child=he,rt=d,lt=null,he=!0):he=!1}he||ji(d)}if(Y=d.memoizedState,Y!==null&&(Y=Y.dehydrated,Y!==null))return pE(Y)?d.lanes=32:d.lanes=536870912,null;Tc(d)}return Y=x.children,x=x.fallback,I?(Fu(),I=d.mode,Y=U_({mode:"hidden",children:Y},I),x=fl(x,I,g,null),Y.return=d,x.return=d,Y.sibling=x,d.child=Y,I=d.child,I.memoizedState=$S(g),I.childLanes=AS(u,q,g),d.memoizedState=kS,x):(Mu(d),RS(d,Y))}if(he=u.memoizedState,he!==null&&(Y=he.dehydrated,Y!==null)){if($)d.flags&256?(Mu(d),d.flags&=-257,d=DS(u,d,g)):d.memoizedState!==null?(Fu(),d.child=u.child,d.flags|=128,d=null):(Fu(),I=x.fallback,Y=d.mode,x=U_({mode:"visible",children:x.children},Y),I=fl(I,Y,g,null),I.flags|=2,x.return=d,I.return=d,x.sibling=I,d.child=x,Sp(d,u.child,null,g),x=d.child,x.memoizedState=$S(g),x.childLanes=AS(u,q,g),d.memoizedState=kS,d=I);else if(Mu(d),pE(Y)){if(q=Y.nextSibling&&Y.nextSibling.dataset,q)var $e=q.dgst;q=$e,x=Error(s(419)),x.stack="",x.digest=q,Ru({value:x,source:null,stack:null}),d=DS(u,d,g)}else if(br||Dd(u,d,g,!1),q=(g&u.childLanes)!==0,br||q){if(q=Yn,q!==null&&(x=g&-g,x=(x&42)!==0?1:tl(x),x=(x&(q.suspendedLanes|g))!==0?0:x,x!==0&&x!==he.retryLane))throw he.retryLane=x,ku(u,x),_a(q,u,x),ED;Y.data==="$?"||YS(),d=DS(u,d,g)}else Y.data==="$?"?(d.flags|=192,d.child=u.child,d=null):(u=he.treeContext,lt=Ro(Y.nextSibling),rt=d,Ct=!0,Zn=null,ms=!1,u!==null&&(N[R++]=Z,N[R++]=ue,N[R++]=z,Z=u.id,ue=u.overflow,z=d),d=RS(d,x.children),d.flags|=4096);return d}return I?(Fu(),I=x.fallback,Y=d.mode,he=u.child,$e=he.sibling,x=Ha(he,{mode:"hidden",children:x.children}),x.subtreeFlags=he.subtreeFlags&65011712,$e!==null?I=Ha($e,I):(I=fl(I,Y,g,null),I.flags|=2),I.return=d,x.return=d,x.sibling=I,d.child=x,x=I,I=d.child,Y=u.child.memoizedState,Y===null?Y=$S(g):(he=Y.cachePool,he!==null?($e=ar._currentValue,he=he.parent!==$e?{parent:$e,pool:$e}:he):he=_R(),Y={baseLanes:Y.baseLanes|g,cachePool:he}),I.memoizedState=Y,I.childLanes=AS(u,q,g),d.memoizedState=kS,x):(Mu(d),g=u.child,u=g.sibling,g=Ha(g,{mode:"visible",children:x.children}),g.return=d,g.sibling=null,u!==null&&(q=d.deletions,q===null?(d.deletions=[u],d.flags|=16):q.push(u)),d.child=g,d.memoizedState=null,g)}function RS(u,d){return d=U_({mode:"visible",children:d},u.mode),d.return=u,u.child=d}function U_(u,d){return u=Ii(22,u,null,d),u.lanes=0,u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},u}function DS(u,d,g){return Sp(d,u.child,null,g),u=RS(d,d.pendingProps.children),u.flags|=2,d.memoizedState=null,u}function OD(u,d,g){u.lanes|=d;var x=u.alternate;x!==null&&(x.lanes|=d),Rd(u.return,d,g)}function LS(u,d,g,x,I){var $=u.memoizedState;$===null?u.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:x,tail:g,tailMode:I}:($.isBackwards=d,$.rendering=null,$.renderingStartTime=0,$.last=x,$.tail=g,$.tailMode=I)}function PD(u,d,g){var x=d.pendingProps,I=x.revealOrder,$=x.tail;if(Dr(u,d,x.children,g),x=or.current,(x&2)!==0)x=x&1|2,d.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=d.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&OD(u,g,d);else if(u.tag===19)OD(u,g,d);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===d)break e;for(;u.sibling===null;){if(u.return===null||u.return===d)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}x&=1}switch(ce(or,x),I){case"forwards":for(g=d.child,I=null;g!==null;)u=g.alternate,u!==null&&j_(u)===null&&(I=g),g=g.sibling;g=I,g===null?(I=d.child,d.child=null):(I=g.sibling,g.sibling=null),LS(d,!1,I,g,$);break;case"backwards":for(g=null,I=d.child,d.child=null;I!==null;){if(u=I.alternate,u!==null&&j_(u)===null){d.child=I;break}u=I.sibling,I.sibling=g,g=I,I=u}LS(d,!0,g,null,$);break;case"together":LS(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Sc(u,d,g){if(u!==null&&(d.dependencies=u.dependencies),Uu|=d.lanes,(g&d.childLanes)===0)if(u!==null){if(Dd(u,d,g,!1),(g&d.childLanes)===0)return null}else return null;if(u!==null&&d.child!==u.child)throw Error(s(153));if(d.child!==null){for(u=d.child,g=Ha(u,u.pendingProps),d.child=g,g.return=d;u.sibling!==null;)u=u.sibling,g=g.sibling=Ha(u,u.pendingProps),g.return=d;g.sibling=null}return d.child}function OS(u,d){return(u.lanes&d)!==0?!0:(u=u.dependencies,!!(u!==null&&T_(u)))}function B7(u,d,g){switch(d.tag){case 3:qe(d,d.stateNode.containerInfo),pl(d,ar,u.memoizedState.cache),Au();break;case 27:case 5:ut(d);break;case 4:qe(d,d.stateNode.containerInfo);break;case 10:pl(d,d.type,d.memoizedProps.value);break;case 13:var x=d.memoizedState;if(x!==null)return x.dehydrated!==null?(Mu(d),d.flags|=128,null):(g&d.child.childLanes)!==0?LD(u,d,g):(Mu(d),u=Sc(u,d,g),u!==null?u.sibling:null);Mu(d);break;case 19:var I=(u.flags&128)!==0;if(x=(g&d.childLanes)!==0,x||(Dd(u,d,g,!1),x=(g&d.childLanes)!==0),I){if(x)return PD(u,d,g);d.flags|=128}if(I=d.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),ce(or,or.current),x)break;return null;case 22:case 23:return d.lanes=0,kD(u,d,g);case 24:pl(d,ar,u.memoizedState.cache)}return Sc(u,d,g)}function MD(u,d,g){if(u!==null)if(u.memoizedProps!==d.pendingProps)br=!0;else{if(!OS(u,g)&&(d.flags&128)===0)return br=!1,B7(u,d,g);br=(u.flags&131072)!==0}else br=!1,Ct&&(d.flags&1048576)!==0&&Le(d,b,d.index);switch(d.lanes=0,d.tag){case 16:e:{u=d.pendingProps;var x=d.elementType,I=x._init;if(x=I(x._payload),d.type=x,typeof x=="function")pp(x)?(u=Md(x,u),d.tag=1,d=RD(null,d,x,u,g)):(d.tag=0,d=CS(null,d,x,u,g));else{if(x!=null){if(I=x.$$typeof,I===D){d.tag=11,d=ND(null,d,x,u,g);break e}else if(I===B){d.tag=14,d=ID(null,d,x,u,g);break e}}throw d=ae(x)||x,Error(s(306,d,""))}}return d;case 0:return CS(u,d,d.type,d.pendingProps,g);case 1:return x=d.type,I=Md(x,d.pendingProps),RD(u,d,x,I,g);case 3:e:{if(qe(d,d.stateNode.containerInfo),u===null)throw Error(s(387));x=d.pendingProps;var $=d.memoizedState;I=$.element,rS(u,d),$g(d,x,null,g);var q=d.memoizedState;if(x=q.cache,pl(d,ar,x),x!==$.cache&&gp(d,[ar],g,!0),kg(),x=q.element,$.isDehydrated)if($={element:x,isDehydrated:!1,cache:q.cache},d.updateQueue.baseState=$,d.memoizedState=$,d.flags&256){d=DD(u,d,x,g);break e}else if(x!==I){I=Ei(Error(s(424)),d),Ru(I),d=DD(u,d,x,g);break e}else{switch(u=d.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(lt=Ro(u.firstChild),rt=d,Ct=!0,Zn=null,ms=!0,g=mD(d,null,x,g),d.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(Au(),x===I){d=Sc(u,d,g);break e}Dr(u,d,x,g)}d=d.child}return d;case 26:return V_(u,d),u===null?(g=zL(d.type,null,d.pendingProps,null))?d.memoizedState=g:Ct||(g=d.type,u=d.pendingProps,x=sx(Ie.current).createElement(g),x[$s]=d,x[bs]=u,Or(x,g,u),ps(x),d.stateNode=x):d.memoizedState=zL(d.type,u.memoizedProps,d.pendingProps,u.memoizedState),null;case 27:return ut(d),u===null&&Ct&&(x=d.stateNode=FL(d.type,d.pendingProps,Ie.current),rt=d,ms=!0,I=lt,qu(d.type)?(mE=I,lt=Ro(x.firstChild)):lt=I),Dr(u,d,d.pendingProps.children,g),V_(u,d),u===null&&(d.flags|=4194304),d.child;case 5:return u===null&&Ct&&((I=x=lt)&&(x=pX(x,d.type,d.pendingProps,ms),x!==null?(d.stateNode=x,rt=d,lt=Ro(x.firstChild),ms=!1,I=!0):I=!1),I||ji(d)),ut(d),I=d.type,$=d.pendingProps,q=u!==null?u.memoizedProps:null,x=$.children,hE(I,$)?x=null:q!==null&&hE(I,q)&&(d.flags|=32),d.memoizedState!==null&&(I=uS(u,d,R7,null,null,g),Qg._currentValue=I),V_(u,d),Dr(u,d,x,g),d.child;case 6:return u===null&&Ct&&((u=g=lt)&&(g=mX(g,d.pendingProps,ms),g!==null?(d.stateNode=g,rt=d,lt=null,u=!0):u=!1),u||ji(d)),null;case 13:return LD(u,d,g);case 4:return qe(d,d.stateNode.containerInfo),x=d.pendingProps,u===null?d.child=Sp(d,null,x,g):Dr(u,d,x,g),d.child;case 11:return ND(u,d,d.type,d.pendingProps,g);case 7:return Dr(u,d,d.pendingProps,g),d.child;case 8:return Dr(u,d,d.pendingProps.children,g),d.child;case 12:return Dr(u,d,d.pendingProps.children,g),d.child;case 10:return x=d.pendingProps,pl(d,d.type,x.value),Dr(u,d,x.children,g),d.child;case 9:return I=d.type._context,x=d.pendingProps.children,Ld(d),I=si(I),x=x(I),d.flags|=1,Dr(u,d,x,g),d.child;case 14:return ID(u,d,d.type,d.pendingProps,g);case 15:return CD(u,d,d.type,d.pendingProps,g);case 19:return PD(u,d,g);case 31:return x=d.pendingProps,g=d.mode,x={mode:x.mode,children:x.children},u===null?(g=U_(x,g),g.ref=d.ref,d.child=g,g.return=d,d=g):(g=Ha(u.child,x),g.ref=d.ref,d.child=g,g.return=d,d=g),d;case 22:return kD(u,d,g);case 24:return Ld(d),x=si(ar),u===null?(I=tS(),I===null&&(I=Yn,$=JT(),I.pooledCache=$,$.refCount++,$!==null&&(I.pooledCacheLanes|=g),I=$),d.memoizedState={parent:x,cache:I},sS(d),pl(d,ar,I)):((u.lanes&g)!==0&&(rS(u,d),$g(d,null,null,g),kg()),I=u.memoizedState,$=d.memoizedState,I.parent!==x?(I={parent:x,cache:x},d.memoizedState=I,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=I),pl(d,ar,x)):(x=$.cache,pl(d,ar,x),x!==I.cache&&gp(d,[ar],g,!0))),Dr(u,d,d.pendingProps.children,g),d.child;case 29:throw d.pendingProps}throw Error(s(156,d.tag))}function Ec(u){u.flags|=4}function FD(u,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!HL(d)){if(d=Ka.current,d!==null&&((dn&4194048)===dn?ml!==null:(dn&62914560)!==dn&&(dn&536870912)===0||d!==ml))throw Ig=nS,xR;u.flags|=8192}}function G_(u,d){d!==null&&(u.flags|=4),u.flags&16384&&(d=u.tag!==22?lu():536870912,u.lanes|=d,Cp|=d)}function Mg(u,d){if(!Ct)switch(u.tailMode){case"hidden":d=u.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?u.tail=null:g.sibling=null;break;case"collapsed":g=u.tail;for(var x=null;g!==null;)g.alternate!==null&&(x=g),g=g.sibling;x===null?d||u.tail===null?u.tail=null:u.tail.sibling=null:x.sibling=null}}function gs(u){var d=u.alternate!==null&&u.alternate.child===u.child,g=0,x=0;if(d)for(var I=u.child;I!==null;)g|=I.lanes|I.childLanes,x|=I.subtreeFlags&65011712,x|=I.flags&65011712,I.return=u,I=I.sibling;else for(I=u.child;I!==null;)g|=I.lanes|I.childLanes,x|=I.subtreeFlags,x|=I.flags,I.return=u,I=I.sibling;return u.subtreeFlags|=x,u.childLanes=g,d}function z7(u,d,g){var x=d.pendingProps;switch(Je(d),d.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gs(d),null;case 1:return gs(d),null;case 3:return g=d.stateNode,x=null,u!==null&&(x=u.memoizedState.cache),d.memoizedState.cache!==x&&(d.flags|=2048),$o(ar),Qe(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(u===null||u.child===null)&&(Ad(d)?Ec(d):u===null||u.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,w_())),gs(d),null;case 26:return g=d.memoizedState,u===null?(Ec(d),g!==null?(gs(d),FD(d,g)):(gs(d),d.flags&=-16777217)):g?g!==u.memoizedState?(Ec(d),gs(d),FD(d,g)):(gs(d),d.flags&=-16777217):(u.memoizedProps!==x&&Ec(d),gs(d),d.flags&=-16777217),null;case 27:mt(d),g=Ie.current;var I=d.type;if(u!==null&&d.stateNode!=null)u.memoizedProps!==x&&Ec(d);else{if(!x){if(d.stateNode===null)throw Error(s(166));return gs(d),null}u=Se.current,Ad(d)?__(d):(u=FL(I,x,g),d.stateNode=u,Ec(d))}return gs(d),null;case 5:if(mt(d),g=d.type,u!==null&&d.stateNode!=null)u.memoizedProps!==x&&Ec(d);else{if(!x){if(d.stateNode===null)throw Error(s(166));return gs(d),null}if(u=Se.current,Ad(d))__(d);else{switch(I=sx(Ie.current),u){case 1:u=I.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:u=I.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":u=I.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":u=I.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":u=I.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof x.is=="string"?I.createElement("select",{is:x.is}):I.createElement("select"),x.multiple?u.multiple=!0:x.size&&(u.size=x.size);break;default:u=typeof x.is=="string"?I.createElement(g,{is:x.is}):I.createElement(g)}}u[$s]=d,u[bs]=x;e:for(I=d.child;I!==null;){if(I.tag===5||I.tag===6)u.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===d)break e;for(;I.sibling===null;){if(I.return===null||I.return===d)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}d.stateNode=u;e:switch(Or(u,g,x),g){case"button":case"input":case"select":case"textarea":u=!!x.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&Ec(d)}}return gs(d),d.flags&=-16777217,null;case 6:if(u&&d.stateNode!=null)u.memoizedProps!==x&&Ec(d);else{if(typeof x!="string"&&d.stateNode===null)throw Error(s(166));if(u=Ie.current,Ad(d)){if(u=d.stateNode,g=d.memoizedProps,x=null,I=rt,I!==null)switch(I.tag){case 27:case 5:x=I.memoizedProps}u[$s]=d,u=!!(u.nodeValue===g||x!==null&&x.suppressHydrationWarning===!0||AL(u.nodeValue,g)),u||ji(d)}else u=sx(u).createTextNode(x),u[$s]=d,d.stateNode=u}return gs(d),null;case 13:if(x=d.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(I=Ad(d),x!==null&&x.dehydrated!==null){if(u===null){if(!I)throw Error(s(318));if(I=d.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(s(317));I[$s]=d}else Au(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;gs(d),I=!1}else I=w_(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=I),I=!0;if(!I)return d.flags&256?(Tc(d),d):(Tc(d),null)}if(Tc(d),(d.flags&128)!==0)return d.lanes=g,d;if(g=x!==null,u=u!==null&&u.memoizedState!==null,g){x=d.child,I=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(I=x.alternate.memoizedState.cachePool.pool);var $=null;x.memoizedState!==null&&x.memoizedState.cachePool!==null&&($=x.memoizedState.cachePool.pool),$!==I&&(x.flags|=2048)}return g!==u&&g&&(d.child.flags|=8192),G_(d,d.updateQueue),gs(d),null;case 4:return Qe(),u===null&&aE(d.stateNode.containerInfo),gs(d),null;case 10:return $o(d.type),gs(d),null;case 19:if(de(or),I=d.memoizedState,I===null)return gs(d),null;if(x=(d.flags&128)!==0,$=I.rendering,$===null)if(x)Mg(I,!1);else{if(xs!==0||u!==null&&(u.flags&128)!==0)for(u=d.child;u!==null;){if($=j_(u),$!==null){for(d.flags|=128,Mg(I,!1),u=$.updateQueue,d.updateQueue=u,G_(d,u),d.subtreeFlags=0,u=g,g=d.child;g!==null;)wg(g,u),g=g.sibling;return ce(or,or.current&1|2),d.child}u=u.sibling}I.tail!==null&&Pt()>q_&&(d.flags|=128,x=!0,Mg(I,!1),d.lanes=4194304)}else{if(!x)if(u=j_($),u!==null){if(d.flags|=128,x=!0,u=u.updateQueue,d.updateQueue=u,G_(d,u),Mg(I,!0),I.tail===null&&I.tailMode==="hidden"&&!$.alternate&&!Ct)return gs(d),null}else 2*Pt()-I.renderingStartTime>q_&&g!==536870912&&(d.flags|=128,x=!0,Mg(I,!1),d.lanes=4194304);I.isBackwards?($.sibling=d.child,d.child=$):(u=I.last,u!==null?u.sibling=$:d.child=$,I.last=$)}return I.tail!==null?(d=I.tail,I.rendering=d,I.tail=d.sibling,I.renderingStartTime=Pt(),d.sibling=null,u=or.current,ce(or,x?u&1|2:u&1),d):(gs(d),null);case 22:case 23:return Tc(d),lS(),x=d.memoizedState!==null,u!==null?u.memoizedState!==null!==x&&(d.flags|=8192):x&&(d.flags|=8192),x?(g&536870912)!==0&&(d.flags&128)===0&&(gs(d),d.subtreeFlags&6&&(d.flags|=8192)):gs(d),g=d.updateQueue,g!==null&&G_(d,g.retryQueue),g=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==g&&(d.flags|=2048),u!==null&&de(Od),null;case 24:return g=null,u!==null&&(g=u.memoizedState.cache),d.memoizedState.cache!==g&&(d.flags|=2048),$o(ar),gs(d),null;case 25:return null;case 30:return null}throw Error(s(156,d.tag))}function V7(u,d){switch(Je(d),d.tag){case 1:return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 3:return $o(ar),Qe(),u=d.flags,(u&65536)!==0&&(u&128)===0?(d.flags=u&-65537|128,d):null;case 26:case 27:case 5:return mt(d),null;case 13:if(Tc(d),u=d.memoizedState,u!==null&&u.dehydrated!==null){if(d.alternate===null)throw Error(s(340));Au()}return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 19:return de(or),null;case 4:return Qe(),null;case 10:return $o(d.type),null;case 22:case 23:return Tc(d),lS(),u!==null&&de(Od),u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 24:return $o(ar),null;case 25:return null;default:return null}}function jD(u,d){switch(Je(d),d.tag){case 3:$o(ar),Qe();break;case 26:case 27:case 5:mt(d);break;case 4:Qe();break;case 13:Tc(d);break;case 19:de(or);break;case 10:$o(d.type);break;case 22:case 23:Tc(d),lS(),u!==null&&de(Od);break;case 24:$o(ar)}}function Fg(u,d){try{var g=d.updateQueue,x=g!==null?g.lastEffect:null;if(x!==null){var I=x.next;g=I;do{if((g.tag&u)===u){x=void 0;var $=g.create,q=g.inst;x=$(),q.destroy=x}g=g.next}while(g!==I)}}catch(Y){Bn(d,d.return,Y)}}function ju(u,d,g){try{var x=d.updateQueue,I=x!==null?x.lastEffect:null;if(I!==null){var $=I.next;x=$;do{if((x.tag&u)===u){var q=x.inst,Y=q.destroy;if(Y!==void 0){q.destroy=void 0,I=d;var he=g,$e=Y;try{$e()}catch(Fe){Bn(I,he,Fe)}}}x=x.next}while(x!==$)}}catch(Fe){Bn(d,d.return,Fe)}}function BD(u){var d=u.updateQueue;if(d!==null){var g=u.stateNode;try{IR(d,g)}catch(x){Bn(u,u.return,x)}}}function zD(u,d,g){g.props=Md(u.type,u.memoizedProps),g.state=u.memoizedState;try{g.componentWillUnmount()}catch(x){Bn(u,d,x)}}function jg(u,d){try{var g=u.ref;if(g!==null){switch(u.tag){case 26:case 27:case 5:var x=u.stateNode;break;case 30:x=u.stateNode;break;default:x=u.stateNode}typeof g=="function"?u.refCleanup=g(x):g.current=x}}catch(I){Bn(u,d,I)}}function gl(u,d){var g=u.ref,x=u.refCleanup;if(g!==null)if(typeof x=="function")try{x()}catch(I){Bn(u,d,I)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(I){Bn(u,d,I)}else g.current=null}function VD(u){var d=u.type,g=u.memoizedProps,x=u.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":g.autoFocus&&x.focus();break e;case"img":g.src?x.src=g.src:g.srcSet&&(x.srcset=g.srcSet)}}catch(I){Bn(u,u.return,I)}}function PS(u,d,g){try{var x=u.stateNode;cX(x,u.type,g,d),x[bs]=d}catch(I){Bn(u,u.return,I)}}function UD(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&qu(u.type)||u.tag===4}function MS(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||UD(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&qu(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function FS(u,d,g){var x=u.tag;if(x===5||x===6)u=u.stateNode,d?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(u,d):(d=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,d.appendChild(u),g=g._reactRootContainer,g!=null||d.onclick!==null||(d.onclick=nx));else if(x!==4&&(x===27&&qu(u.type)&&(g=u.stateNode,d=null),u=u.child,u!==null))for(FS(u,d,g),u=u.sibling;u!==null;)FS(u,d,g),u=u.sibling}function W_(u,d,g){var x=u.tag;if(x===5||x===6)u=u.stateNode,d?g.insertBefore(u,d):g.appendChild(u);else if(x!==4&&(x===27&&qu(u.type)&&(g=u.stateNode),u=u.child,u!==null))for(W_(u,d,g),u=u.sibling;u!==null;)W_(u,d,g),u=u.sibling}function GD(u){var d=u.stateNode,g=u.memoizedProps;try{for(var x=u.type,I=d.attributes;I.length;)d.removeAttributeNode(I[0]);Or(d,x,g),d[$s]=u,d[bs]=g}catch($){Bn(u,u.return,$)}}var Nc=!1,Ds=!1,jS=!1,WD=typeof WeakSet=="function"?WeakSet:Set,_r=null;function U7(u,d){if(u=u.containerInfo,cE=cx,u=Sd(u),Ed(u)){if("selectionStart"in u)var g={start:u.selectionStart,end:u.selectionEnd};else e:{g=(g=u.ownerDocument)&&g.defaultView||window;var x=g.getSelection&&g.getSelection();if(x&&x.rangeCount!==0){g=x.anchorNode;var I=x.anchorOffset,$=x.focusNode;x=x.focusOffset;try{g.nodeType,$.nodeType}catch{g=null;break e}var q=0,Y=-1,he=-1,$e=0,Fe=0,Ve=u,Ae=null;t:for(;;){for(var De;Ve!==g||I!==0&&Ve.nodeType!==3||(Y=q+I),Ve!==$||x!==0&&Ve.nodeType!==3||(he=q+x),Ve.nodeType===3&&(q+=Ve.nodeValue.length),(De=Ve.firstChild)!==null;)Ae=Ve,Ve=De;for(;;){if(Ve===u)break t;if(Ae===g&&++$e===I&&(Y=q),Ae===$&&++Fe===x&&(he=q),(De=Ve.nextSibling)!==null)break;Ve=Ae,Ae=Ve.parentNode}Ve=De}g=Y===-1||he===-1?null:{start:Y,end:he}}else g=null}g=g||{start:0,end:0}}else g=null;for(uE={focusedElem:u,selectionRange:g},cx=!1,_r=d;_r!==null;)if(d=_r,u=d.child,(d.subtreeFlags&1024)!==0&&u!==null)u.return=d,_r=u;else for(;_r!==null;){switch(d=_r,$=d.alternate,u=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((u&1024)!==0&&$!==null){u=void 0,g=d,I=$.memoizedProps,$=$.memoizedState,x=g.stateNode;try{var It=Md(g.type,I,g.elementType===g.type);u=x.getSnapshotBeforeUpdate(It,$),x.__reactInternalSnapshotBeforeUpdate=u}catch(bt){Bn(g,g.return,bt)}}break;case 3:if((u&1024)!==0){if(u=d.stateNode.containerInfo,g=u.nodeType,g===9)fE(u);else if(g===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":fE(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(s(163))}if(u=d.sibling,u!==null){u.return=d.return,_r=u;break}_r=d.return}}function HD(u,d,g){var x=g.flags;switch(g.tag){case 0:case 11:case 15:Bu(u,g),x&4&&Fg(5,g);break;case 1:if(Bu(u,g),x&4)if(u=g.stateNode,d===null)try{u.componentDidMount()}catch(q){Bn(g,g.return,q)}else{var I=Md(g.type,d.memoizedProps);d=d.memoizedState;try{u.componentDidUpdate(I,d,u.__reactInternalSnapshotBeforeUpdate)}catch(q){Bn(g,g.return,q)}}x&64&&BD(g),x&512&&jg(g,g.return);break;case 3:if(Bu(u,g),x&64&&(u=g.updateQueue,u!==null)){if(d=null,g.child!==null)switch(g.child.tag){case 27:case 5:d=g.child.stateNode;break;case 1:d=g.child.stateNode}try{IR(u,d)}catch(q){Bn(g,g.return,q)}}break;case 27:d===null&&x&4&&GD(g);case 26:case 5:Bu(u,g),d===null&&x&4&&VD(g),x&512&&jg(g,g.return);break;case 12:Bu(u,g);break;case 13:Bu(u,g),x&4&&XD(u,g),x&64&&(u=g.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(g=Q7.bind(null,g),gX(u,g))));break;case 22:if(x=g.memoizedState!==null||Nc,!x){d=d!==null&&d.memoizedState!==null||Ds,I=Nc;var $=Ds;Nc=x,(Ds=d)&&!$?zu(u,g,(g.subtreeFlags&8772)!==0):Bu(u,g),Nc=I,Ds=$}break;case 30:break;default:Bu(u,g)}}function qD(u){var d=u.alternate;d!==null&&(u.alternate=null,qD(d)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(d=u.stateNode,d!==null&&vo(d)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var cs=null,zi=!1;function Ic(u,d,g){for(g=g.child;g!==null;)KD(u,d,g),g=g.sibling}function KD(u,d,g){if(Mt&&typeof Mt.onCommitFiberUnmount=="function")try{Mt.onCommitFiberUnmount(an,g)}catch{}switch(g.tag){case 26:Ds||gl(g,d),Ic(u,d,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:Ds||gl(g,d);var x=cs,I=zi;qu(g.type)&&(cs=g.stateNode,zi=!1),Ic(u,d,g),Kg(g.stateNode),cs=x,zi=I;break;case 5:Ds||gl(g,d);case 6:if(x=cs,I=zi,cs=null,Ic(u,d,g),cs=x,zi=I,cs!==null)if(zi)try{(cs.nodeType===9?cs.body:cs.nodeName==="HTML"?cs.ownerDocument.body:cs).removeChild(g.stateNode)}catch($){Bn(g,d,$)}else try{cs.removeChild(g.stateNode)}catch($){Bn(g,d,$)}break;case 18:cs!==null&&(zi?(u=cs,PL(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,g.stateNode),ny(u)):PL(cs,g.stateNode));break;case 4:x=cs,I=zi,cs=g.stateNode.containerInfo,zi=!0,Ic(u,d,g),cs=x,zi=I;break;case 0:case 11:case 14:case 15:Ds||ju(2,g,d),Ds||ju(4,g,d),Ic(u,d,g);break;case 1:Ds||(gl(g,d),x=g.stateNode,typeof x.componentWillUnmount=="function"&&zD(g,d,x)),Ic(u,d,g);break;case 21:Ic(u,d,g);break;case 22:Ds=(x=Ds)||g.memoizedState!==null,Ic(u,d,g),Ds=x;break;default:Ic(u,d,g)}}function XD(u,d){if(d.memoizedState===null&&(u=d.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{ny(u)}catch(g){Bn(d,d.return,g)}}function G7(u){switch(u.tag){case 13:case 19:var d=u.stateNode;return d===null&&(d=u.stateNode=new WD),d;case 22:return u=u.stateNode,d=u._retryCache,d===null&&(d=u._retryCache=new WD),d;default:throw Error(s(435,u.tag))}}function BS(u,d){var g=G7(u);d.forEach(function(x){var I=J7.bind(null,u,x);g.has(x)||(g.add(x),x.then(I,I))})}function ga(u,d){var g=d.deletions;if(g!==null)for(var x=0;x<g.length;x++){var I=g[x],$=u,q=d,Y=q;e:for(;Y!==null;){switch(Y.tag){case 27:if(qu(Y.type)){cs=Y.stateNode,zi=!1;break e}break;case 5:cs=Y.stateNode,zi=!1;break e;case 3:case 4:cs=Y.stateNode.containerInfo,zi=!0;break e}Y=Y.return}if(cs===null)throw Error(s(160));KD($,q,I),cs=null,zi=!1,$=I.alternate,$!==null&&($.return=null),I.return=null}if(d.subtreeFlags&13878)for(d=d.child;d!==null;)ZD(d,u),d=d.sibling}var Ao=null;function ZD(u,d){var g=u.alternate,x=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:ga(d,u),ya(u),x&4&&(ju(3,u,u.return),Fg(3,u),ju(5,u,u.return));break;case 1:ga(d,u),ya(u),x&512&&(Ds||g===null||gl(g,g.return)),x&64&&Nc&&(u=u.updateQueue,u!==null&&(x=u.callbacks,x!==null&&(g=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=g===null?x:g.concat(x))));break;case 26:var I=Ao;if(ga(d,u),ya(u),x&512&&(Ds||g===null||gl(g,g.return)),x&4){var $=g!==null?g.memoizedState:null;if(x=u.memoizedState,g===null)if(x===null)if(u.stateNode===null){e:{x=u.type,g=u.memoizedProps,I=I.ownerDocument||I;t:switch(x){case"title":$=I.getElementsByTagName("title")[0],(!$||$[sl]||$[$s]||$.namespaceURI==="http://www.w3.org/2000/svg"||$.hasAttribute("itemprop"))&&($=I.createElement(x),I.head.insertBefore($,I.querySelector("head > title"))),Or($,x,g),$[$s]=u,ps($),x=$;break e;case"link":var q=GL("link","href",I).get(x+(g.href||""));if(q){for(var Y=0;Y<q.length;Y++)if($=q[Y],$.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&$.getAttribute("rel")===(g.rel==null?null:g.rel)&&$.getAttribute("title")===(g.title==null?null:g.title)&&$.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){q.splice(Y,1);break t}}$=I.createElement(x),Or($,x,g),I.head.appendChild($);break;case"meta":if(q=GL("meta","content",I).get(x+(g.content||""))){for(Y=0;Y<q.length;Y++)if($=q[Y],$.getAttribute("content")===(g.content==null?null:""+g.content)&&$.getAttribute("name")===(g.name==null?null:g.name)&&$.getAttribute("property")===(g.property==null?null:g.property)&&$.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&$.getAttribute("charset")===(g.charSet==null?null:g.charSet)){q.splice(Y,1);break t}}$=I.createElement(x),Or($,x,g),I.head.appendChild($);break;default:throw Error(s(468,x))}$[$s]=u,ps($),x=$}u.stateNode=x}else WL(I,u.type,u.stateNode);else u.stateNode=UL(I,x,u.memoizedProps);else $!==x?($===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):$.count--,x===null?WL(I,u.type,u.stateNode):UL(I,x,u.memoizedProps)):x===null&&u.stateNode!==null&&PS(u,u.memoizedProps,g.memoizedProps)}break;case 27:ga(d,u),ya(u),x&512&&(Ds||g===null||gl(g,g.return)),g!==null&&x&4&&PS(u,u.memoizedProps,g.memoizedProps);break;case 5:if(ga(d,u),ya(u),x&512&&(Ds||g===null||gl(g,g.return)),u.flags&32){I=u.stateNode;try{mr(I,"")}catch(De){Bn(u,u.return,De)}}x&4&&u.stateNode!=null&&(I=u.memoizedProps,PS(u,I,g!==null?g.memoizedProps:I)),x&1024&&(jS=!0);break;case 6:if(ga(d,u),ya(u),x&4){if(u.stateNode===null)throw Error(s(162));x=u.memoizedProps,g=u.stateNode;try{g.nodeValue=x}catch(De){Bn(u,u.return,De)}}break;case 3:if(ax=null,I=Ao,Ao=rx(d.containerInfo),ga(d,u),Ao=I,ya(u),x&4&&g!==null&&g.memoizedState.isDehydrated)try{ny(d.containerInfo)}catch(De){Bn(u,u.return,De)}jS&&(jS=!1,YD(u));break;case 4:x=Ao,Ao=rx(u.stateNode.containerInfo),ga(d,u),ya(u),Ao=x;break;case 12:ga(d,u),ya(u);break;case 13:ga(d,u),ya(u),u.child.flags&8192&&u.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(HS=Pt()),x&4&&(x=u.updateQueue,x!==null&&(u.updateQueue=null,BS(u,x)));break;case 22:I=u.memoizedState!==null;var he=g!==null&&g.memoizedState!==null,$e=Nc,Fe=Ds;if(Nc=$e||I,Ds=Fe||he,ga(d,u),Ds=Fe,Nc=$e,ya(u),x&8192)e:for(d=u.stateNode,d._visibility=I?d._visibility&-2:d._visibility|1,I&&(g===null||he||Nc||Ds||Fd(u)),g=null,d=u;;){if(d.tag===5||d.tag===26){if(g===null){he=g=d;try{if($=he.stateNode,I)q=$.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{Y=he.stateNode;var Ve=he.memoizedProps.style,Ae=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null;Y.style.display=Ae==null||typeof Ae=="boolean"?"":(""+Ae).trim()}}catch(De){Bn(he,he.return,De)}}}else if(d.tag===6){if(g===null){he=d;try{he.stateNode.nodeValue=I?"":he.memoizedProps}catch(De){Bn(he,he.return,De)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===u)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break e;for(;d.sibling===null;){if(d.return===null||d.return===u)break e;g===d&&(g=null),d=d.return}g===d&&(g=null),d.sibling.return=d.return,d=d.sibling}x&4&&(x=u.updateQueue,x!==null&&(g=x.retryQueue,g!==null&&(x.retryQueue=null,BS(u,g))));break;case 19:ga(d,u),ya(u),x&4&&(x=u.updateQueue,x!==null&&(u.updateQueue=null,BS(u,x)));break;case 30:break;case 21:break;default:ga(d,u),ya(u)}}function ya(u){var d=u.flags;if(d&2){try{for(var g,x=u.return;x!==null;){if(UD(x)){g=x;break}x=x.return}if(g==null)throw Error(s(160));switch(g.tag){case 27:var I=g.stateNode,$=MS(u);W_(u,$,I);break;case 5:var q=g.stateNode;g.flags&32&&(mr(q,""),g.flags&=-33);var Y=MS(u);W_(u,Y,q);break;case 3:case 4:var he=g.stateNode.containerInfo,$e=MS(u);FS(u,$e,he);break;default:throw Error(s(161))}}catch(Fe){Bn(u,u.return,Fe)}u.flags&=-3}d&4096&&(u.flags&=-4097)}function YD(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var d=u;YD(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),u=u.sibling}}function Bu(u,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)HD(u,d.alternate,d),d=d.sibling}function Fd(u){for(u=u.child;u!==null;){var d=u;switch(d.tag){case 0:case 11:case 14:case 15:ju(4,d,d.return),Fd(d);break;case 1:gl(d,d.return);var g=d.stateNode;typeof g.componentWillUnmount=="function"&&zD(d,d.return,g),Fd(d);break;case 27:Kg(d.stateNode);case 26:case 5:gl(d,d.return),Fd(d);break;case 22:d.memoizedState===null&&Fd(d);break;case 30:Fd(d);break;default:Fd(d)}u=u.sibling}}function zu(u,d,g){for(g=g&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var x=d.alternate,I=u,$=d,q=$.flags;switch($.tag){case 0:case 11:case 15:zu(I,$,g),Fg(4,$);break;case 1:if(zu(I,$,g),x=$,I=x.stateNode,typeof I.componentDidMount=="function")try{I.componentDidMount()}catch($e){Bn(x,x.return,$e)}if(x=$,I=x.updateQueue,I!==null){var Y=x.stateNode;try{var he=I.shared.hiddenCallbacks;if(he!==null)for(I.shared.hiddenCallbacks=null,I=0;I<he.length;I++)NR(he[I],Y)}catch($e){Bn(x,x.return,$e)}}g&&q&64&&BD($),jg($,$.return);break;case 27:GD($);case 26:case 5:zu(I,$,g),g&&x===null&&q&4&&VD($),jg($,$.return);break;case 12:zu(I,$,g);break;case 13:zu(I,$,g),g&&q&4&&XD(I,$);break;case 22:$.memoizedState===null&&zu(I,$,g),jg($,$.return);break;case 30:break;default:zu(I,$,g)}d=d.sibling}}function zS(u,d){var g=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),u=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(u=d.memoizedState.cachePool.pool),u!==g&&(u!=null&&u.refCount++,g!=null&&Sg(g))}function VS(u,d){u=null,d.alternate!==null&&(u=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==u&&(d.refCount++,u!=null&&Sg(u))}function yl(u,d,g,x){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)QD(u,d,g,x),d=d.sibling}function QD(u,d,g,x){var I=d.flags;switch(d.tag){case 0:case 11:case 15:yl(u,d,g,x),I&2048&&Fg(9,d);break;case 1:yl(u,d,g,x);break;case 3:yl(u,d,g,x),I&2048&&(u=null,d.alternate!==null&&(u=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==u&&(d.refCount++,u!=null&&Sg(u)));break;case 12:if(I&2048){yl(u,d,g,x),u=d.stateNode;try{var $=d.memoizedProps,q=$.id,Y=$.onPostCommit;typeof Y=="function"&&Y(q,d.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(he){Bn(d,d.return,he)}}else yl(u,d,g,x);break;case 13:yl(u,d,g,x);break;case 23:break;case 22:$=d.stateNode,q=d.alternate,d.memoizedState!==null?$._visibility&2?yl(u,d,g,x):Bg(u,d):$._visibility&2?yl(u,d,g,x):($._visibility|=2,Ep(u,d,g,x,(d.subtreeFlags&10256)!==0)),I&2048&&zS(q,d);break;case 24:yl(u,d,g,x),I&2048&&VS(d.alternate,d);break;default:yl(u,d,g,x)}}function Ep(u,d,g,x,I){for(I=I&&(d.subtreeFlags&10256)!==0,d=d.child;d!==null;){var $=u,q=d,Y=g,he=x,$e=q.flags;switch(q.tag){case 0:case 11:case 15:Ep($,q,Y,he,I),Fg(8,q);break;case 23:break;case 22:var Fe=q.stateNode;q.memoizedState!==null?Fe._visibility&2?Ep($,q,Y,he,I):Bg($,q):(Fe._visibility|=2,Ep($,q,Y,he,I)),I&&$e&2048&&zS(q.alternate,q);break;case 24:Ep($,q,Y,he,I),I&&$e&2048&&VS(q.alternate,q);break;default:Ep($,q,Y,he,I)}d=d.sibling}}function Bg(u,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var g=u,x=d,I=x.flags;switch(x.tag){case 22:Bg(g,x),I&2048&&zS(x.alternate,x);break;case 24:Bg(g,x),I&2048&&VS(x.alternate,x);break;default:Bg(g,x)}d=d.sibling}}var zg=8192;function Np(u){if(u.subtreeFlags&zg)for(u=u.child;u!==null;)JD(u),u=u.sibling}function JD(u){switch(u.tag){case 26:Np(u),u.flags&zg&&u.memoizedState!==null&&kX(Ao,u.memoizedState,u.memoizedProps);break;case 5:Np(u);break;case 3:case 4:var d=Ao;Ao=rx(u.stateNode.containerInfo),Np(u),Ao=d;break;case 22:u.memoizedState===null&&(d=u.alternate,d!==null&&d.memoizedState!==null?(d=zg,zg=16777216,Np(u),zg=d):Np(u));break;default:Np(u)}}function eL(u){var d=u.alternate;if(d!==null&&(u=d.child,u!==null)){d.child=null;do d=u.sibling,u.sibling=null,u=d;while(u!==null)}}function Vg(u){var d=u.deletions;if((u.flags&16)!==0){if(d!==null)for(var g=0;g<d.length;g++){var x=d[g];_r=x,nL(x,u)}eL(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)tL(u),u=u.sibling}function tL(u){switch(u.tag){case 0:case 11:case 15:Vg(u),u.flags&2048&&ju(9,u,u.return);break;case 3:Vg(u);break;case 12:Vg(u);break;case 22:var d=u.stateNode;u.memoizedState!==null&&d._visibility&2&&(u.return===null||u.return.tag!==13)?(d._visibility&=-3,H_(u)):Vg(u);break;default:Vg(u)}}function H_(u){var d=u.deletions;if((u.flags&16)!==0){if(d!==null)for(var g=0;g<d.length;g++){var x=d[g];_r=x,nL(x,u)}eL(u)}for(u=u.child;u!==null;){switch(d=u,d.tag){case 0:case 11:case 15:ju(8,d,d.return),H_(d);break;case 22:g=d.stateNode,g._visibility&2&&(g._visibility&=-3,H_(d));break;default:H_(d)}u=u.sibling}}function nL(u,d){for(;_r!==null;){var g=_r;switch(g.tag){case 0:case 11:case 15:ju(8,g,d);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var x=g.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:Sg(g.memoizedState.cache)}if(x=g.child,x!==null)x.return=g,_r=x;else e:for(g=u;_r!==null;){x=_r;var I=x.sibling,$=x.return;if(qD(x),x===g){_r=null;break e}if(I!==null){I.return=$,_r=I;break e}_r=$}}}var W7={getCacheForType:function(u){var d=si(ar),g=d.data.get(u);return g===void 0&&(g=u(),d.data.set(u,g)),g}},H7=typeof WeakMap=="function"?WeakMap:Map,kn=0,Yn=null,Yt=null,dn=0,$n=0,va=null,Vu=!1,Ip=!1,US=!1,Cc=0,xs=0,Uu=0,jd=0,GS=0,Xa=0,Cp=0,Ug=null,Vi=null,WS=!1,HS=0,q_=1/0,K_=null,Gu=null,Lr=0,Wu=null,kp=null,$p=0,qS=0,KS=null,sL=null,Gg=0,XS=null;function ba(){if((kn&2)!==0&&dn!==0)return dn&-dn;if(X.T!==null){var u=yp;return u!==0?u:nE()}return nl()}function rL(){Xa===0&&(Xa=(dn&536870912)===0||Ct?ud():536870912);var u=Ka.current;return u!==null&&(u.flags|=32),Xa}function _a(u,d,g){(u===Yn&&($n===2||$n===9)||u.cancelPendingCommit!==null)&&(Ap(u,0),Hu(u,dn,Xa,!1)),Da(u,g),((kn&2)===0||u!==Yn)&&(u===Yn&&((kn&2)===0&&(jd|=g),xs===4&&Hu(u,dn,Xa,!1)),vl(u))}function iL(u,d,g){if((kn&6)!==0)throw Error(s(327));var x=!g&&(d&124)===0&&(d&u.expiredLanes)===0||na(u,d),I=x?X7(u,d):QS(u,d,!0),$=x;do{if(I===0){Ip&&!x&&Hu(u,d,0,!1);break}else{if(g=u.current.alternate,$&&!q7(g)){I=QS(u,d,!1),$=!1;continue}if(I===2){if($=d,u.errorRecoveryDisabledLanes&$)var q=0;else q=u.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){d=q;e:{var Y=u;I=Ug;var he=Y.current.memoizedState.isDehydrated;if(he&&(Ap(Y,q).flags|=256),q=QS(Y,q,!1),q!==2){if(US&&!he){Y.errorRecoveryDisabledLanes|=$,jd|=$,I=4;break e}$=Vi,Vi=I,$!==null&&(Vi===null?Vi=$:Vi.push.apply(Vi,$))}I=q}if($=!1,I!==2)continue}}if(I===1){Ap(u,0),Hu(u,d,0,!0);break}e:{switch(x=u,$=I,$){case 0:case 1:throw Error(s(345));case 4:if((d&4194048)!==d)break;case 6:Hu(x,d,Xa,!Vu);break e;case 2:Vi=null;break;case 3:case 5:break;default:throw Error(s(329))}if((d&62914560)===d&&(I=HS+300-Pt(),10<I)){if(Hu(x,d,Xa,!Vu),ou(x,0,!0)!==0)break e;x.timeoutHandle=LL(aL.bind(null,x,g,Vi,K_,WS,d,Xa,jd,Cp,Vu,$,2,-0,0),I);break e}aL(x,g,Vi,K_,WS,d,Xa,jd,Cp,Vu,$,0,-0,0)}}break}while(!0);vl(u)}function aL(u,d,g,x,I,$,q,Y,he,$e,Fe,Ve,Ae,De){if(u.timeoutHandle=-1,Ve=d.subtreeFlags,(Ve&8192||(Ve&16785408)===16785408)&&(Yg={stylesheets:null,count:0,unsuspend:CX},JD(d),Ve=$X(),Ve!==null)){u.cancelPendingCommit=Ve(fL.bind(null,u,d,$,g,x,I,q,Y,he,Fe,1,Ae,De)),Hu(u,$,q,!$e);return}fL(u,d,$,g,x,I,q,Y,he)}function q7(u){for(var d=u;;){var g=d.tag;if((g===0||g===11||g===15)&&d.flags&16384&&(g=d.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var x=0;x<g.length;x++){var I=g[x],$=I.getSnapshot;I=I.value;try{if(!Ti($(),I))return!1}catch{return!1}}if(g=d.child,d.subtreeFlags&16384&&g!==null)g.return=d,d=g;else{if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Hu(u,d,g,x){d&=~GS,d&=~jd,u.suspendedLanes|=d,u.pingedLanes&=~d,x&&(u.warmLanes|=d),x=u.expirationTimes;for(var I=d;0<I;){var $=31-os(I),q=1<<$;x[$]=-1,I&=~q}g!==0&&La(u,g,d)}function X_(){return(kn&6)===0?(Wg(0),!1):!0}function ZS(){if(Yt!==null){if($n===0)var u=Yt.return;else u=Yt,ko=qa=null,fS(u),Tp=null,Og=0,u=Yt;for(;u!==null;)jD(u.alternate,u),u=u.return;Yt=null}}function Ap(u,d){var g=u.timeoutHandle;g!==-1&&(u.timeoutHandle=-1,hX(g)),g=u.cancelPendingCommit,g!==null&&(u.cancelPendingCommit=null,g()),ZS(),Yn=u,Yt=g=Ha(u.current,null),dn=d,$n=0,va=null,Vu=!1,Ip=na(u,d),US=!1,Cp=Xa=GS=jd=Uu=xs=0,Vi=Ug=null,WS=!1,(d&8)!==0&&(d|=d&32);var x=u.entangledLanes;if(x!==0)for(u=u.entanglements,x&=d;0<x;){var I=31-os(x),$=1<<I;d|=u[I],x&=~$}return Cc=d,Id(),g}function oL(u,d){Wt=null,X.H=P_,d===Ng||d===N_?(d=SR(),$n=3):d===xR?(d=SR(),$n=4):$n=d===ED?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,va=d,Yt===null&&(xs=1,z_(u,Ei(d,u.current)))}function lL(){var u=X.H;return X.H=P_,u===null?P_:u}function cL(){var u=X.A;return X.A=W7,u}function YS(){xs=4,Vu||(dn&4194048)!==dn&&Ka.current!==null||(Ip=!0),(Uu&134217727)===0&&(jd&134217727)===0||Yn===null||Hu(Yn,dn,Xa,!1)}function QS(u,d,g){var x=kn;kn|=2;var I=lL(),$=cL();(Yn!==u||dn!==d)&&(K_=null,Ap(u,d)),d=!1;var q=xs;e:do try{if($n!==0&&Yt!==null){var Y=Yt,he=va;switch($n){case 8:ZS(),q=6;break e;case 3:case 2:case 9:case 6:Ka.current===null&&(d=!0);var $e=$n;if($n=0,va=null,Rp(u,Y,he,$e),g&&Ip){q=0;break e}break;default:$e=$n,$n=0,va=null,Rp(u,Y,he,$e)}}K7(),q=xs;break}catch(Fe){oL(u,Fe)}while(!0);return d&&u.shellSuspendCounter++,ko=qa=null,kn=x,X.H=I,X.A=$,Yt===null&&(Yn=null,dn=0,Id()),q}function K7(){for(;Yt!==null;)uL(Yt)}function X7(u,d){var g=kn;kn|=2;var x=lL(),I=cL();Yn!==u||dn!==d?(K_=null,q_=Pt()+500,Ap(u,d)):Ip=na(u,d);e:do try{if($n!==0&&Yt!==null){d=Yt;var $=va;t:switch($n){case 1:$n=0,va=null,Rp(u,d,$,1);break;case 2:case 9:if(wR($)){$n=0,va=null,hL(d);break}d=function(){$n!==2&&$n!==9||Yn!==u||($n=7),vl(u)},$.then(d,d);break e;case 3:$n=7;break e;case 4:$n=5;break e;case 7:wR($)?($n=0,va=null,hL(d)):($n=0,va=null,Rp(u,d,$,7));break;case 5:var q=null;switch(Yt.tag){case 26:q=Yt.memoizedState;case 5:case 27:var Y=Yt;if(!q||HL(q)){$n=0,va=null;var he=Y.sibling;if(he!==null)Yt=he;else{var $e=Y.return;$e!==null?(Yt=$e,Z_($e)):Yt=null}break t}}$n=0,va=null,Rp(u,d,$,5);break;case 6:$n=0,va=null,Rp(u,d,$,6);break;case 8:ZS(),xs=6;break e;default:throw Error(s(462))}}Z7();break}catch(Fe){oL(u,Fe)}while(!0);return ko=qa=null,X.H=x,X.A=I,kn=g,Yt!==null?0:(Yn=null,dn=0,Id(),xs)}function Z7(){for(;Yt!==null&&!Jt();)uL(Yt)}function uL(u){var d=MD(u.alternate,u,Cc);u.memoizedProps=u.pendingProps,d===null?Z_(u):Yt=d}function hL(u){var d=u,g=d.alternate;switch(d.tag){case 15:case 0:d=AD(g,d,d.pendingProps,d.type,void 0,dn);break;case 11:d=AD(g,d,d.pendingProps,d.type.render,d.ref,dn);break;case 5:fS(d);default:jD(g,d),d=Yt=wg(d,Cc),d=MD(g,d,Cc)}u.memoizedProps=u.pendingProps,d===null?Z_(u):Yt=d}function Rp(u,d,g,x){ko=qa=null,fS(d),Tp=null,Og=0;var I=d.return;try{if(j7(u,I,d,g,dn)){xs=1,z_(u,Ei(g,u.current)),Yt=null;return}}catch($){if(I!==null)throw Yt=I,$;xs=1,z_(u,Ei(g,u.current)),Yt=null;return}d.flags&32768?(Ct||x===1?u=!0:Ip||(dn&536870912)!==0?u=!1:(Vu=u=!0,(x===2||x===9||x===3||x===6)&&(x=Ka.current,x!==null&&x.tag===13&&(x.flags|=16384))),dL(d,u)):Z_(d)}function Z_(u){var d=u;do{if((d.flags&32768)!==0){dL(d,Vu);return}u=d.return;var g=z7(d.alternate,d,Cc);if(g!==null){Yt=g;return}if(d=d.sibling,d!==null){Yt=d;return}Yt=d=u}while(d!==null);xs===0&&(xs=5)}function dL(u,d){do{var g=V7(u.alternate,u);if(g!==null){g.flags&=32767,Yt=g;return}if(g=u.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!d&&(u=u.sibling,u!==null)){Yt=u;return}Yt=u=g}while(u!==null);xs=6,Yt=null}function fL(u,d,g,x,I,$,q,Y,he){u.cancelPendingCommit=null;do Y_();while(Lr!==0);if((kn&6)!==0)throw Error(s(327));if(d!==null){if(d===u.current)throw Error(s(177));if($=d.lanes|d.childLanes,$|=ma,hd(u,g,$,q,Y,he),u===Yn&&(Yt=Yn=null,dn=0),kp=d,Wu=u,$p=g,qS=$,KS=I,sL=x,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,eX(zs,function(){return vL(),null})):(u.callbackNode=null,u.callbackPriority=0),x=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||x){x=X.T,X.T=null,I=se.p,se.p=2,q=kn,kn|=4;try{U7(u,d,g)}finally{kn=q,se.p=I,X.T=x}}Lr=1,pL(),mL(),gL()}}function pL(){if(Lr===1){Lr=0;var u=Wu,d=kp,g=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||g){g=X.T,X.T=null;var x=se.p;se.p=2;var I=kn;kn|=4;try{ZD(d,u);var $=uE,q=Sd(u.containerInfo),Y=$.focusedElem,he=$.selectionRange;if(q!==Y&&Y&&Y.ownerDocument&&cp(Y.ownerDocument.documentElement,Y)){if(he!==null&&Ed(Y)){var $e=he.start,Fe=he.end;if(Fe===void 0&&(Fe=$e),"selectionStart"in Y)Y.selectionStart=$e,Y.selectionEnd=Math.min(Fe,Y.value.length);else{var Ve=Y.ownerDocument||document,Ae=Ve&&Ve.defaultView||window;if(Ae.getSelection){var De=Ae.getSelection(),It=Y.textContent.length,bt=Math.min(he.start,It),Pn=he.end===void 0?bt:Math.min(he.end,It);!De.extend&&bt>Pn&&(q=Pn,Pn=bt,bt=q);var we=_g(Y,bt),ge=_g(Y,Pn);if(we&&ge&&(De.rangeCount!==1||De.anchorNode!==we.node||De.anchorOffset!==we.offset||De.focusNode!==ge.node||De.focusOffset!==ge.offset)){var Ce=Ve.createRange();Ce.setStart(we.node,we.offset),De.removeAllRanges(),bt>Pn?(De.addRange(Ce),De.extend(ge.node,ge.offset)):(Ce.setEnd(ge.node,ge.offset),De.addRange(Ce))}}}}for(Ve=[],De=Y;De=De.parentNode;)De.nodeType===1&&Ve.push({element:De,left:De.scrollLeft,top:De.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<Ve.length;Y++){var je=Ve[Y];je.element.scrollLeft=je.left,je.element.scrollTop=je.top}}cx=!!cE,uE=cE=null}finally{kn=I,se.p=x,X.T=g}}u.current=d,Lr=2}}function mL(){if(Lr===2){Lr=0;var u=Wu,d=kp,g=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||g){g=X.T,X.T=null;var x=se.p;se.p=2;var I=kn;kn|=4;try{HD(u,d.alternate,d)}finally{kn=I,se.p=x,X.T=g}}Lr=3}}function gL(){if(Lr===4||Lr===3){Lr=0,Zt();var u=Wu,d=kp,g=$p,x=sL;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Lr=5:(Lr=0,kp=Wu=null,yL(u,u.pendingLanes));var I=u.pendingLanes;if(I===0&&(Gu=null),cu(g),d=d.stateNode,Mt&&typeof Mt.onCommitFiberRoot=="function")try{Mt.onCommitFiberRoot(an,d,void 0,(d.current.flags&128)===128)}catch{}if(x!==null){d=X.T,I=se.p,se.p=2,X.T=null;try{for(var $=u.onRecoverableError,q=0;q<x.length;q++){var Y=x[q];$(Y.value,{componentStack:Y.stack})}}finally{X.T=d,se.p=I}}($p&3)!==0&&Y_(),vl(u),I=u.pendingLanes,(g&4194090)!==0&&(I&42)!==0?u===XS?Gg++:(Gg=0,XS=u):Gg=0,Wg(0)}}function yL(u,d){(u.pooledCacheLanes&=d)===0&&(d=u.pooledCache,d!=null&&(u.pooledCache=null,Sg(d)))}function Y_(u){return pL(),mL(),gL(),vL()}function vL(){if(Lr!==5)return!1;var u=Wu,d=qS;qS=0;var g=cu($p),x=X.T,I=se.p;try{se.p=32>g?32:g,X.T=null,g=KS,KS=null;var $=Wu,q=$p;if(Lr=0,kp=Wu=null,$p=0,(kn&6)!==0)throw Error(s(331));var Y=kn;if(kn|=4,tL($.current),QD($,$.current,q,g),kn=Y,Wg(0,!1),Mt&&typeof Mt.onPostCommitFiberRoot=="function")try{Mt.onPostCommitFiberRoot(an,$)}catch{}return!0}finally{se.p=I,X.T=x,yL(u,d)}}function bL(u,d,g){d=Ei(g,d),d=IS(u.stateNode,d,2),u=Ou(u,d,2),u!==null&&(Da(u,2),vl(u))}function Bn(u,d,g){if(u.tag===3)bL(u,u,g);else for(;d!==null;){if(d.tag===3){bL(d,u,g);break}else if(d.tag===1){var x=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Gu===null||!Gu.has(x))){u=Ei(g,u),g=TD(2),x=Ou(d,g,2),x!==null&&(SD(g,x,d,u),Da(x,2),vl(x));break}}d=d.return}}function JS(u,d,g){var x=u.pingCache;if(x===null){x=u.pingCache=new H7;var I=new Set;x.set(d,I)}else I=x.get(d),I===void 0&&(I=new Set,x.set(d,I));I.has(g)||(US=!0,I.add(g),u=Y7.bind(null,u,d,g),d.then(u,u))}function Y7(u,d,g){var x=u.pingCache;x!==null&&x.delete(d),u.pingedLanes|=u.suspendedLanes&g,u.warmLanes&=~g,Yn===u&&(dn&g)===g&&(xs===4||xs===3&&(dn&62914560)===dn&&300>Pt()-HS?(kn&2)===0&&Ap(u,0):GS|=g,Cp===dn&&(Cp=0)),vl(u)}function _L(u,d){d===0&&(d=lu()),u=ku(u,d),u!==null&&(Da(u,d),vl(u))}function Q7(u){var d=u.memoizedState,g=0;d!==null&&(g=d.retryLane),_L(u,g)}function J7(u,d){var g=0;switch(u.tag){case 13:var x=u.stateNode,I=u.memoizedState;I!==null&&(g=I.retryLane);break;case 19:x=u.stateNode;break;case 22:x=u.stateNode._retryCache;break;default:throw Error(s(314))}x!==null&&x.delete(d),_L(u,g)}function eX(u,d){return Gt(u,d)}var Q_=null,Dp=null,eE=!1,J_=!1,tE=!1,Bd=0;function vl(u){u!==Dp&&u.next===null&&(Dp===null?Q_=Dp=u:Dp=Dp.next=u),J_=!0,eE||(eE=!0,nX())}function Wg(u,d){if(!tE&&J_){tE=!0;do for(var g=!1,x=Q_;x!==null;){if(u!==0){var I=x.pendingLanes;if(I===0)var $=0;else{var q=x.suspendedLanes,Y=x.pingedLanes;$=(1<<31-os(42|u)+1)-1,$&=I&~(q&~Y),$=$&201326741?$&201326741|1:$?$|2:0}$!==0&&(g=!0,SL(x,$))}else $=dn,$=ou(x,x===Yn?$:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),($&3)===0||na(x,$)||(g=!0,SL(x,$));x=x.next}while(g);tE=!1}}function tX(){xL()}function xL(){J_=eE=!1;var u=0;Bd!==0&&(uX()&&(u=Bd),Bd=0);for(var d=Pt(),g=null,x=Q_;x!==null;){var I=x.next,$=wL(x,d);$===0?(x.next=null,g===null?Q_=I:g.next=I,I===null&&(Dp=g)):(g=x,(u!==0||($&3)!==0)&&(J_=!0)),x=I}Wg(u)}function wL(u,d){for(var g=u.suspendedLanes,x=u.pingedLanes,I=u.expirationTimes,$=u.pendingLanes&-62914561;0<$;){var q=31-os($),Y=1<<q,he=I[q];he===-1?((Y&g)===0||(Y&x)!==0)&&(I[q]=cd(Y,d)):he<=d&&(u.expiredLanes|=Y),$&=~Y}if(d=Yn,g=dn,g=ou(u,u===d?g:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),x=u.callbackNode,g===0||u===d&&($n===2||$n===9)||u.cancelPendingCommit!==null)return x!==null&&x!==null&&gn(x),u.callbackNode=null,u.callbackPriority=0;if((g&3)===0||na(u,g)){if(d=g&-g,d===u.callbackPriority)return d;switch(x!==null&&gn(x),cu(g)){case 2:case 8:g=Rn;break;case 32:g=zs;break;case 268435456:g=kr;break;default:g=zs}return x=TL.bind(null,u),g=Gt(g,x),u.callbackPriority=d,u.callbackNode=g,d}return x!==null&&x!==null&&gn(x),u.callbackPriority=2,u.callbackNode=null,2}function TL(u,d){if(Lr!==0&&Lr!==5)return u.callbackNode=null,u.callbackPriority=0,null;var g=u.callbackNode;if(Y_()&&u.callbackNode!==g)return null;var x=dn;return x=ou(u,u===Yn?x:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),x===0?null:(iL(u,x,d),wL(u,Pt()),u.callbackNode!=null&&u.callbackNode===g?TL.bind(null,u):null)}function SL(u,d){if(Y_())return null;iL(u,d,!0)}function nX(){dX(function(){(kn&6)!==0?Gt(Cr,tX):xL()})}function nE(){return Bd===0&&(Bd=ud()),Bd}function EL(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:ll(""+u)}function NL(u,d){var g=d.ownerDocument.createElement("input");return g.name=d.name,g.value=d.value,u.id&&g.setAttribute("form",u.id),d.parentNode.insertBefore(g,d),u=new FormData(u),g.parentNode.removeChild(g),u}function sX(u,d,g,x,I){if(d==="submit"&&g&&g.stateNode===I){var $=EL((I[bs]||null).action),q=x.submitter;q&&(d=(d=q[bs]||null)?EL(d.formAction):q.getAttribute("formAction"),d!==null&&($=d,q=null));var Y=new dc("action","action",null,x,I);u.push({event:Y,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(Bd!==0){var he=q?NL(I,q):new FormData(I);wS(g,{pending:!0,data:he,method:I.method,action:$},null,he)}}else typeof $=="function"&&(Y.preventDefault(),he=q?NL(I,q):new FormData(I),wS(g,{pending:!0,data:he,method:I.method,action:$},$,he))},currentTarget:I}]})}}for(var sE=0;sE<yc.length;sE++){var rE=yc[sE],rX=rE.toLowerCase(),iX=rE[0].toUpperCase()+rE.slice(1);pa(rX,"on"+iX)}pa(y_,"onAnimationEnd"),pa(fa,"onAnimationIteration"),pa(Nd,"onAnimationStart"),pa("dblclick","onDoubleClick"),pa("focusin","onFocus"),pa("focusout","onBlur"),pa(YT,"onTransitionRun"),pa(fp,"onTransitionStart"),pa(QT,"onTransitionCancel"),pa(xg,"onTransitionEnd"),Oa("onMouseEnter",["mouseout","mouseover"]),Oa("onMouseLeave",["mouseout","mouseover"]),Oa("onPointerEnter",["pointerout","pointerover"]),Oa("onPointerLeave",["pointerout","pointerover"]),ia("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ia("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ia("onBeforeInput",["compositionend","keypress","textInput","paste"]),ia("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),aX=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Hg));function IL(u,d){d=(d&4)!==0;for(var g=0;g<u.length;g++){var x=u[g],I=x.event;x=x.listeners;e:{var $=void 0;if(d)for(var q=x.length-1;0<=q;q--){var Y=x[q],he=Y.instance,$e=Y.currentTarget;if(Y=Y.listener,he!==$&&I.isPropagationStopped())break e;$=Y,I.currentTarget=$e;try{$(I)}catch(Fe){B_(Fe)}I.currentTarget=null,$=he}else for(q=0;q<x.length;q++){if(Y=x[q],he=Y.instance,$e=Y.currentTarget,Y=Y.listener,he!==$&&I.isPropagationStopped())break e;$=Y,I.currentTarget=$e;try{$(I)}catch(Fe){B_(Fe)}I.currentTarget=null,$=he}}}}function Qt(u,d){var g=d[Qr];g===void 0&&(g=d[Qr]=new Set);var x=u+"__bubble";g.has(x)||(CL(d,u,2,!1),g.add(x))}function iE(u,d,g){var x=0;d&&(x|=4),CL(g,u,x,d)}var ex="_reactListening"+Math.random().toString(36).slice(2);function aE(u){if(!u[ex]){u[ex]=!0,pd.forEach(function(g){g!=="selectionchange"&&(aX.has(g)||iE(g,!1,u),iE(g,!0,u))});var d=u.nodeType===9?u:u.ownerDocument;d===null||d[ex]||(d[ex]=!0,iE("selectionchange",!1,d))}}function CL(u,d,g,x){switch(QL(d)){case 2:var I=DX;break;case 8:I=LX;break;default:I=_E}g=I.bind(null,d,g,u),I=void 0,!Jr||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(I=!0),x?I!==void 0?u.addEventListener(d,g,{capture:!0,passive:I}):u.addEventListener(d,g,!0):I!==void 0?u.addEventListener(d,g,{passive:I}):u.addEventListener(d,g,!1)}function oE(u,d,g,x,I){var $=x;if((d&1)===0&&(d&2)===0&&x!==null)e:for(;;){if(x===null)return;var q=x.tag;if(q===3||q===4){var Y=x.stateNode.containerInfo;if(Y===I)break;if(q===4)for(q=x.return;q!==null;){var he=q.tag;if((he===3||he===4)&&q.stateNode.containerInfo===I)return;q=q.return}for(;Y!==null;){if(q=sa(Y),q===null)return;if(he=q.tag,he===5||he===6||he===26||he===27){x=$=q;continue e}Y=Y.parentNode}}x=x.return}wi(function(){var $e=$,Fe=Rr(g),Ve=[];e:{var Ae=v_.get(u);if(Ae!==void 0){var De=dc,It=u;switch(u){case"keypress":if(Dn(g)===0)break e;case"keydown":case"keyup":De=_u;break;case"focusin":It="focus",De=mu;break;case"focusout":It="blur",De=mu;break;case"beforeblur":case"afterblur":De=mu;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=yr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=mg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=ip;break;case y_:case fa:case Nd:De=yu;break;case xg:De=ap;break;case"scroll":case"scrollend":De=sp;break;case"wheel":De=mc;break;case"copy":case"cut":case"paste":De=cl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=xu;break;case"toggle":case"beforetoggle":De=Va}var bt=(d&4)!==0,Pn=!bt&&(u==="scroll"||u==="scrollend"),we=bt?Ae!==null?Ae+"Capture":null:Ae;bt=[];for(var ge=$e,Ce;ge!==null;){var je=ge;if(Ce=je.stateNode,je=je.tag,je!==5&&je!==26&&je!==27||Ce===null||we===null||(je=hn(ge,we),je!=null&&bt.push(qg(ge,je,Ce))),Pn)break;ge=ge.return}0<bt.length&&(Ae=new De(Ae,It,null,g,Fe),Ve.push({event:Ae,listeners:bt}))}}if((d&7)===0){e:{if(Ae=u==="mouseover"||u==="pointerover",De=u==="mouseout"||u==="pointerout",Ae&&g!==la&&(It=g.relatedTarget||g.fromElement)&&(sa(It)||It[Pi]))break e;if((De||Ae)&&(Ae=Fe.window===Fe?Fe:(Ae=Fe.ownerDocument)?Ae.defaultView||Ae.parentWindow:window,De?(It=g.relatedTarget||g.toElement,De=$e,It=It?sa(It):null,It!==null&&(Pn=i(It),bt=It.tag,It!==Pn||bt!==5&&bt!==27&&bt!==6)&&(It=null)):(De=null,It=$e),De!==It)){if(bt=yr,je="onMouseLeave",we="onMouseEnter",ge="mouse",(u==="pointerout"||u==="pointerover")&&(bt=xu,je="onPointerLeave",we="onPointerEnter",ge="pointer"),Pn=De==null?Ae:$r(De),Ce=It==null?Ae:$r(It),Ae=new bt(je,ge+"leave",De,g,Fe),Ae.target=Pn,Ae.relatedTarget=Ce,je=null,sa(Fe)===$e&&(bt=new bt(we,ge+"enter",It,g,Fe),bt.target=Ce,bt.relatedTarget=Pn,je=bt),Pn=je,De&&It)t:{for(bt=De,we=It,ge=0,Ce=bt;Ce;Ce=Lp(Ce))ge++;for(Ce=0,je=we;je;je=Lp(je))Ce++;for(;0<ge-Ce;)bt=Lp(bt),ge--;for(;0<Ce-ge;)we=Lp(we),Ce--;for(;ge--;){if(bt===we||we!==null&&bt===we.alternate)break t;bt=Lp(bt),we=Lp(we)}bt=null}else bt=null;De!==null&&kL(Ve,Ae,De,bt,!1),It!==null&&Pn!==null&&kL(Ve,Pn,It,bt,!0)}}e:{if(Ae=$e?$r($e):window,De=Ae.nodeName&&Ae.nodeName.toLowerCase(),De==="select"||De==="input"&&Ae.type==="file")var at=Tu;else if(Xn(Ae))if(yg)at=ZT;else{at=XT;var Kt=bg}else De=Ae.nodeName,!De||De.toLowerCase()!=="input"||Ae.type!=="checkbox"&&Ae.type!=="radio"?$e&&hc($e.elementType)&&(at=Tu):at=Co;if(at&&(at=at(u,$e))){No(Ve,at,g,Fe);break e}Kt&&Kt(u,Ae,$e),u==="focusout"&&$e&&Ae.type==="number"&&$e.memoizedProps.value!=null&&aa(Ae,"number",Ae.value)}switch(Kt=$e?$r($e):window,u){case"focusin":(Xn(Kt)||Kt.contentEditable==="true")&&(da=Kt,Nu=$e,gc=null);break;case"focusout":gc=Nu=da=null;break;case"mousedown":hp=!0;break;case"contextmenu":case"mouseup":case"dragend":hp=!1,m_(Ve,g,Fe);break;case"selectionchange":if(up)break;case"keydown":case"keyup":m_(Ve,g,Fe)}var dt;if(ni)e:{switch(u){case"compositionstart":var xt="onCompositionStart";break e;case"compositionend":xt="onCompositionEnd";break e;case"compositionupdate":xt="onCompositionUpdate";break e}xt=void 0}else en?Oe(u,g)&&(xt="onCompositionEnd"):u==="keydown"&&g.keyCode===229&&(xt="onCompositionStart");xt&&(H&&g.locale!=="ko"&&(en||xt!=="onCompositionStart"?xt==="onCompositionEnd"&&en&&(dt=wo()):(Fi=Fe,ei="value"in Fi?Fi.value:Fi.textContent,en=!0)),Kt=tx($e,xt),0<Kt.length&&(xt=new ti(xt,u,null,g,Fe),Ve.push({event:xt,listeners:Kt}),dt?xt.data=dt:(dt=Xe(g),dt!==null&&(xt.data=dt)))),(dt=j?_s(u,g):tn(u,g))&&(xt=tx($e,"onBeforeInput"),0<xt.length&&(Kt=new ti("onBeforeInput","beforeinput",null,g,Fe),Ve.push({event:Kt,listeners:xt}),Kt.data=dt)),sX(Ve,u,$e,g,Fe)}IL(Ve,d)})}function qg(u,d,g){return{instance:u,listener:d,currentTarget:g}}function tx(u,d){for(var g=d+"Capture",x=[];u!==null;){var I=u,$=I.stateNode;if(I=I.tag,I!==5&&I!==26&&I!==27||$===null||(I=hn(u,g),I!=null&&x.unshift(qg(u,I,$)),I=hn(u,d),I!=null&&x.push(qg(u,I,$))),u.tag===3)return x;u=u.return}return[]}function Lp(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function kL(u,d,g,x,I){for(var $=d._reactName,q=[];g!==null&&g!==x;){var Y=g,he=Y.alternate,$e=Y.stateNode;if(Y=Y.tag,he!==null&&he===x)break;Y!==5&&Y!==26&&Y!==27||$e===null||(he=$e,I?($e=hn(g,$),$e!=null&&q.unshift(qg(g,$e,he))):I||($e=hn(g,$),$e!=null&&q.push(qg(g,$e,he)))),g=g.return}q.length!==0&&u.push({event:d,listeners:q})}var oX=/\r\n?/g,lX=/\u0000|\uFFFD/g;function $L(u){return(typeof u=="string"?u:""+u).replace(oX,`
`).replace(lX,"")}function AL(u,d){return d=$L(d),$L(u)===d}function nx(){}function On(u,d,g,x,I,$){switch(g){case"children":typeof x=="string"?d==="body"||d==="textarea"&&x===""||mr(u,x):(typeof x=="number"||typeof x=="bigint")&&d!=="body"&&mr(u,""+x);break;case"className":Pa(u,"class",x);break;case"tabIndex":Pa(u,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":Pa(u,g,x);break;case"style":_o(u,x,$);break;case"data":if(d!=="object"){Pa(u,"data",x);break}case"src":case"href":if(x===""&&(d!=="a"||g!=="href")){u.removeAttribute(g);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){u.removeAttribute(g);break}x=ll(""+x),u.setAttribute(g,x);break;case"action":case"formAction":if(typeof x=="function"){u.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof $=="function"&&(g==="formAction"?(d!=="input"&&On(u,d,"name",I.name,I,null),On(u,d,"formEncType",I.formEncType,I,null),On(u,d,"formMethod",I.formMethod,I,null),On(u,d,"formTarget",I.formTarget,I,null)):(On(u,d,"encType",I.encType,I,null),On(u,d,"method",I.method,I,null),On(u,d,"target",I.target,I,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){u.removeAttribute(g);break}x=ll(""+x),u.setAttribute(g,x);break;case"onClick":x!=null&&(u.onclick=nx);break;case"onScroll":x!=null&&Qt("scroll",u);break;case"onScrollEnd":x!=null&&Qt("scrollend",u);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(s(61));if(g=x.__html,g!=null){if(I.children!=null)throw Error(s(60));u.innerHTML=g}}break;case"multiple":u.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":u.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){u.removeAttribute("xlink:href");break}g=ll(""+x),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?u.setAttribute(g,""+x):u.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?u.setAttribute(g,""):u.removeAttribute(g);break;case"capture":case"download":x===!0?u.setAttribute(g,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?u.setAttribute(g,x):u.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?u.setAttribute(g,x):u.removeAttribute(g);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?u.removeAttribute(g):u.setAttribute(g,x);break;case"popover":Qt("beforetoggle",u),Qt("toggle",u),rl(u,"popover",x);break;case"xlinkActuate":rr(u,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":rr(u,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":rr(u,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":rr(u,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":rr(u,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":rr(u,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":rr(u,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":rr(u,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":rr(u,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":rl(u,"is",x);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=gd.get(g)||g,rl(u,g,x))}}function lE(u,d,g,x,I,$){switch(g){case"style":_o(u,x,$);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(s(61));if(g=x.__html,g!=null){if(I.children!=null)throw Error(s(60));u.innerHTML=g}}break;case"children":typeof x=="string"?mr(u,x):(typeof x=="number"||typeof x=="bigint")&&mr(u,""+x);break;case"onScroll":x!=null&&Qt("scroll",u);break;case"onScrollEnd":x!=null&&Qt("scrollend",u);break;case"onClick":x!=null&&(u.onclick=nx);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!hu.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(I=g.endsWith("Capture"),d=g.slice(2,I?g.length-7:void 0),$=u[bs]||null,$=$!=null?$[g]:null,typeof $=="function"&&u.removeEventListener(d,$,I),typeof x=="function")){typeof $!="function"&&$!==null&&(g in u?u[g]=null:u.hasAttribute(g)&&u.removeAttribute(g)),u.addEventListener(d,x,I);break e}g in u?u[g]=x:x===!0?u.setAttribute(g,""):rl(u,g,x)}}}function Or(u,d,g){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qt("error",u),Qt("load",u);var x=!1,I=!1,$;for($ in g)if(g.hasOwnProperty($)){var q=g[$];if(q!=null)switch($){case"src":x=!0;break;case"srcSet":I=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,d));default:On(u,d,$,q,g,null)}}I&&On(u,d,"srcSet",g.srcSet,g,null),x&&On(u,d,"src",g.src,g,null);return;case"input":Qt("invalid",u);var Y=$=q=I=null,he=null,$e=null;for(x in g)if(g.hasOwnProperty(x)){var Fe=g[x];if(Fe!=null)switch(x){case"name":I=Fe;break;case"type":q=Fe;break;case"checked":he=Fe;break;case"defaultChecked":$e=Fe;break;case"value":$=Fe;break;case"defaultValue":Y=Fe;break;case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(s(137,d));break;default:On(u,d,x,Fe,g,null)}}uc(u,$,Y,he,$e,q,I,!1),ol(u);return;case"select":Qt("invalid",u),x=q=$=null;for(I in g)if(g.hasOwnProperty(I)&&(Y=g[I],Y!=null))switch(I){case"value":$=Y;break;case"defaultValue":q=Y;break;case"multiple":x=Y;default:On(u,d,I,Y,g,null)}d=$,g=q,u.multiple=!!x,d!=null?Ar(u,!!x,d,!1):g!=null&&Ar(u,!!x,g,!0);return;case"textarea":Qt("invalid",u),$=I=x=null;for(q in g)if(g.hasOwnProperty(q)&&(Y=g[q],Y!=null))switch(q){case"value":x=Y;break;case"defaultValue":I=Y;break;case"children":$=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(91));break;default:On(u,d,q,Y,g,null)}xi(u,x,I,$),ol(u);return;case"option":for(he in g)if(g.hasOwnProperty(he)&&(x=g[he],x!=null))switch(he){case"selected":u.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:On(u,d,he,x,g,null)}return;case"dialog":Qt("beforetoggle",u),Qt("toggle",u),Qt("cancel",u),Qt("close",u);break;case"iframe":case"object":Qt("load",u);break;case"video":case"audio":for(x=0;x<Hg.length;x++)Qt(Hg[x],u);break;case"image":Qt("error",u),Qt("load",u);break;case"details":Qt("toggle",u);break;case"embed":case"source":case"link":Qt("error",u),Qt("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for($e in g)if(g.hasOwnProperty($e)&&(x=g[$e],x!=null))switch($e){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,d));default:On(u,d,$e,x,g,null)}return;default:if(hc(d)){for(Fe in g)g.hasOwnProperty(Fe)&&(x=g[Fe],x!==void 0&&lE(u,d,Fe,x,g,void 0));return}}for(Y in g)g.hasOwnProperty(Y)&&(x=g[Y],x!=null&&On(u,d,Y,x,g,null))}function cX(u,d,g,x){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var I=null,$=null,q=null,Y=null,he=null,$e=null,Fe=null;for(De in g){var Ve=g[De];if(g.hasOwnProperty(De)&&Ve!=null)switch(De){case"checked":break;case"value":break;case"defaultValue":he=Ve;default:x.hasOwnProperty(De)||On(u,d,De,null,x,Ve)}}for(var Ae in x){var De=x[Ae];if(Ve=g[Ae],x.hasOwnProperty(Ae)&&(De!=null||Ve!=null))switch(Ae){case"type":$=De;break;case"name":I=De;break;case"checked":$e=De;break;case"defaultChecked":Fe=De;break;case"value":q=De;break;case"defaultValue":Y=De;break;case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(s(137,d));break;default:De!==Ve&&On(u,d,Ae,De,x,Ve)}}Kn(u,q,Y,he,$e,Fe,$,I);return;case"select":De=q=Y=Ae=null;for($ in g)if(he=g[$],g.hasOwnProperty($)&&he!=null)switch($){case"value":break;case"multiple":De=he;default:x.hasOwnProperty($)||On(u,d,$,null,x,he)}for(I in x)if($=x[I],he=g[I],x.hasOwnProperty(I)&&($!=null||he!=null))switch(I){case"value":Ae=$;break;case"defaultValue":Y=$;break;case"multiple":q=$;default:$!==he&&On(u,d,I,$,x,he)}d=Y,g=q,x=De,Ae!=null?Ar(u,!!g,Ae,!1):!!x!=!!g&&(d!=null?Ar(u,!!g,d,!0):Ar(u,!!g,g?[]:"",!1));return;case"textarea":De=Ae=null;for(Y in g)if(I=g[Y],g.hasOwnProperty(Y)&&I!=null&&!x.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:On(u,d,Y,null,x,I)}for(q in x)if(I=x[q],$=g[q],x.hasOwnProperty(q)&&(I!=null||$!=null))switch(q){case"value":Ae=I;break;case"defaultValue":De=I;break;case"children":break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(s(91));break;default:I!==$&&On(u,d,q,I,x,$)}Tt(u,Ae,De);return;case"option":for(var It in g)if(Ae=g[It],g.hasOwnProperty(It)&&Ae!=null&&!x.hasOwnProperty(It))switch(It){case"selected":u.selected=!1;break;default:On(u,d,It,null,x,Ae)}for(he in x)if(Ae=x[he],De=g[he],x.hasOwnProperty(he)&&Ae!==De&&(Ae!=null||De!=null))switch(he){case"selected":u.selected=Ae&&typeof Ae!="function"&&typeof Ae!="symbol";break;default:On(u,d,he,Ae,x,De)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var bt in g)Ae=g[bt],g.hasOwnProperty(bt)&&Ae!=null&&!x.hasOwnProperty(bt)&&On(u,d,bt,null,x,Ae);for($e in x)if(Ae=x[$e],De=g[$e],x.hasOwnProperty($e)&&Ae!==De&&(Ae!=null||De!=null))switch($e){case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(s(137,d));break;default:On(u,d,$e,Ae,x,De)}return;default:if(hc(d)){for(var Pn in g)Ae=g[Pn],g.hasOwnProperty(Pn)&&Ae!==void 0&&!x.hasOwnProperty(Pn)&&lE(u,d,Pn,void 0,x,Ae);for(Fe in x)Ae=x[Fe],De=g[Fe],!x.hasOwnProperty(Fe)||Ae===De||Ae===void 0&&De===void 0||lE(u,d,Fe,Ae,x,De);return}}for(var we in g)Ae=g[we],g.hasOwnProperty(we)&&Ae!=null&&!x.hasOwnProperty(we)&&On(u,d,we,null,x,Ae);for(Ve in x)Ae=x[Ve],De=g[Ve],!x.hasOwnProperty(Ve)||Ae===De||Ae==null&&De==null||On(u,d,Ve,Ae,x,De)}var cE=null,uE=null;function sx(u){return u.nodeType===9?u:u.ownerDocument}function RL(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function DL(u,d){if(u===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&d==="foreignObject"?0:u}function hE(u,d){return u==="textarea"||u==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var dE=null;function uX(){var u=window.event;return u&&u.type==="popstate"?u===dE?!1:(dE=u,!0):(dE=null,!1)}var LL=typeof setTimeout=="function"?setTimeout:void 0,hX=typeof clearTimeout=="function"?clearTimeout:void 0,OL=typeof Promise=="function"?Promise:void 0,dX=typeof queueMicrotask=="function"?queueMicrotask:typeof OL<"u"?function(u){return OL.resolve(null).then(u).catch(fX)}:LL;function fX(u){setTimeout(function(){throw u})}function qu(u){return u==="head"}function PL(u,d){var g=d,x=0,I=0;do{var $=g.nextSibling;if(u.removeChild(g),$&&$.nodeType===8)if(g=$.data,g==="/$"){if(0<x&&8>x){g=x;var q=u.ownerDocument;if(g&1&&Kg(q.documentElement),g&2&&Kg(q.body),g&4)for(g=q.head,Kg(g),q=g.firstChild;q;){var Y=q.nextSibling,he=q.nodeName;q[sl]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&q.rel.toLowerCase()==="stylesheet"||g.removeChild(q),q=Y}}if(I===0){u.removeChild($),ny(d);return}I--}else g==="$"||g==="$?"||g==="$!"?I++:x=g.charCodeAt(0)-48;else x=0;g=$}while(g);ny(d)}function fE(u){var d=u.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var g=d;switch(d=d.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":fE(g),vo(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}u.removeChild(g)}}function pX(u,d,g,x){for(;u.nodeType===1;){var I=g;if(u.nodeName.toLowerCase()!==d.toLowerCase()){if(!x&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(x){if(!u[sl])switch(d){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if($=u.getAttribute("rel"),$==="stylesheet"&&u.hasAttribute("data-precedence"))break;if($!==I.rel||u.getAttribute("href")!==(I.href==null||I.href===""?null:I.href)||u.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin)||u.getAttribute("title")!==(I.title==null?null:I.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if($=u.getAttribute("src"),($!==(I.src==null?null:I.src)||u.getAttribute("type")!==(I.type==null?null:I.type)||u.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin))&&$&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(d==="input"&&u.type==="hidden"){var $=I.name==null?null:""+I.name;if(I.type==="hidden"&&u.getAttribute("name")===$)return u}else return u;if(u=Ro(u.nextSibling),u===null)break}return null}function mX(u,d,g){if(d==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!g||(u=Ro(u.nextSibling),u===null))return null;return u}function pE(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState==="complete"}function gX(u,d){var g=u.ownerDocument;if(u.data!=="$?"||g.readyState==="complete")d();else{var x=function(){d(),g.removeEventListener("DOMContentLoaded",x)};g.addEventListener("DOMContentLoaded",x),u._reactRetry=x}}function Ro(u){for(;u!=null;u=u.nextSibling){var d=u.nodeType;if(d===1||d===3)break;if(d===8){if(d=u.data,d==="$"||d==="$!"||d==="$?"||d==="F!"||d==="F")break;if(d==="/$")return null}}return u}var mE=null;function ML(u){u=u.previousSibling;for(var d=0;u;){if(u.nodeType===8){var g=u.data;if(g==="$"||g==="$!"||g==="$?"){if(d===0)return u;d--}else g==="/$"&&d++}u=u.previousSibling}return null}function FL(u,d,g){switch(d=sx(g),u){case"html":if(u=d.documentElement,!u)throw Error(s(452));return u;case"head":if(u=d.head,!u)throw Error(s(453));return u;case"body":if(u=d.body,!u)throw Error(s(454));return u;default:throw Error(s(451))}}function Kg(u){for(var d=u.attributes;d.length;)u.removeAttributeNode(d[0]);vo(u)}var Za=new Map,jL=new Set;function rx(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var kc=se.d;se.d={f:yX,r:vX,D:bX,C:_X,L:xX,m:wX,X:SX,S:TX,M:EX};function yX(){var u=kc.f(),d=X_();return u||d}function vX(u){var d=ra(u);d!==null&&d.tag===5&&d.type==="form"?iD(d):kc.r(u)}var Op=typeof document>"u"?null:document;function BL(u,d,g){var x=Op;if(x&&typeof d=="string"&&d){var I=ns(d);I='link[rel="'+u+'"][href="'+I+'"]',typeof g=="string"&&(I+='[crossorigin="'+g+'"]'),jL.has(I)||(jL.add(I),u={rel:u,crossOrigin:g,href:d},x.querySelector(I)===null&&(d=x.createElement("link"),Or(d,"link",u),ps(d),x.head.appendChild(d)))}}function bX(u){kc.D(u),BL("dns-prefetch",u,null)}function _X(u,d){kc.C(u,d),BL("preconnect",u,d)}function xX(u,d,g){kc.L(u,d,g);var x=Op;if(x&&u&&d){var I='link[rel="preload"][as="'+ns(d)+'"]';d==="image"&&g&&g.imageSrcSet?(I+='[imagesrcset="'+ns(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(I+='[imagesizes="'+ns(g.imageSizes)+'"]')):I+='[href="'+ns(u)+'"]';var $=I;switch(d){case"style":$=Pp(u);break;case"script":$=Mp(u)}Za.has($)||(u=h({rel:"preload",href:d==="image"&&g&&g.imageSrcSet?void 0:u,as:d},g),Za.set($,u),x.querySelector(I)!==null||d==="style"&&x.querySelector(Xg($))||d==="script"&&x.querySelector(Zg($))||(d=x.createElement("link"),Or(d,"link",u),ps(d),x.head.appendChild(d)))}}function wX(u,d){kc.m(u,d);var g=Op;if(g&&u){var x=d&&typeof d.as=="string"?d.as:"script",I='link[rel="modulepreload"][as="'+ns(x)+'"][href="'+ns(u)+'"]',$=I;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":$=Mp(u)}if(!Za.has($)&&(u=h({rel:"modulepreload",href:u},d),Za.set($,u),g.querySelector(I)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(Zg($)))return}x=g.createElement("link"),Or(x,"link",u),ps(x),g.head.appendChild(x)}}}function TX(u,d,g){kc.S(u,d,g);var x=Op;if(x&&u){var I=pr(x).hoistableStyles,$=Pp(u);d=d||"default";var q=I.get($);if(!q){var Y={loading:0,preload:null};if(q=x.querySelector(Xg($)))Y.loading=5;else{u=h({rel:"stylesheet",href:u,"data-precedence":d},g),(g=Za.get($))&&gE(u,g);var he=q=x.createElement("link");ps(he),Or(he,"link",u),he._p=new Promise(function($e,Fe){he.onload=$e,he.onerror=Fe}),he.addEventListener("load",function(){Y.loading|=1}),he.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,ix(q,d,x)}q={type:"stylesheet",instance:q,count:1,state:Y},I.set($,q)}}}function SX(u,d){kc.X(u,d);var g=Op;if(g&&u){var x=pr(g).hoistableScripts,I=Mp(u),$=x.get(I);$||($=g.querySelector(Zg(I)),$||(u=h({src:u,async:!0},d),(d=Za.get(I))&&yE(u,d),$=g.createElement("script"),ps($),Or($,"link",u),g.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},x.set(I,$))}}function EX(u,d){kc.M(u,d);var g=Op;if(g&&u){var x=pr(g).hoistableScripts,I=Mp(u),$=x.get(I);$||($=g.querySelector(Zg(I)),$||(u=h({src:u,async:!0,type:"module"},d),(d=Za.get(I))&&yE(u,d),$=g.createElement("script"),ps($),Or($,"link",u),g.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},x.set(I,$))}}function zL(u,d,g,x){var I=(I=Ie.current)?rx(I):null;if(!I)throw Error(s(446));switch(u){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(d=Pp(g.href),g=pr(I).hoistableStyles,x=g.get(d),x||(x={type:"style",instance:null,count:0,state:null},g.set(d,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){u=Pp(g.href);var $=pr(I).hoistableStyles,q=$.get(u);if(q||(I=I.ownerDocument||I,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},$.set(u,q),($=I.querySelector(Xg(u)))&&!$._p&&(q.instance=$,q.state.loading=5),Za.has(u)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},Za.set(u,g),$||NX(I,u,g,q.state))),d&&x===null)throw Error(s(528,""));return q}if(d&&x!==null)throw Error(s(529,""));return null;case"script":return d=g.async,g=g.src,typeof g=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Mp(g),g=pr(I).hoistableScripts,x=g.get(d),x||(x={type:"script",instance:null,count:0,state:null},g.set(d,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,u))}}function Pp(u){return'href="'+ns(u)+'"'}function Xg(u){return'link[rel="stylesheet"]['+u+"]"}function VL(u){return h({},u,{"data-precedence":u.precedence,precedence:null})}function NX(u,d,g,x){u.querySelector('link[rel="preload"][as="style"]['+d+"]")?x.loading=1:(d=u.createElement("link"),x.preload=d,d.addEventListener("load",function(){return x.loading|=1}),d.addEventListener("error",function(){return x.loading|=2}),Or(d,"link",g),ps(d),u.head.appendChild(d))}function Mp(u){return'[src="'+ns(u)+'"]'}function Zg(u){return"script[async]"+u}function UL(u,d,g){if(d.count++,d.instance===null)switch(d.type){case"style":var x=u.querySelector('style[data-href~="'+ns(g.href)+'"]');if(x)return d.instance=x,ps(x),x;var I=h({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return x=(u.ownerDocument||u).createElement("style"),ps(x),Or(x,"style",I),ix(x,g.precedence,u),d.instance=x;case"stylesheet":I=Pp(g.href);var $=u.querySelector(Xg(I));if($)return d.state.loading|=4,d.instance=$,ps($),$;x=VL(g),(I=Za.get(I))&&gE(x,I),$=(u.ownerDocument||u).createElement("link"),ps($);var q=$;return q._p=new Promise(function(Y,he){q.onload=Y,q.onerror=he}),Or($,"link",x),d.state.loading|=4,ix($,g.precedence,u),d.instance=$;case"script":return $=Mp(g.src),(I=u.querySelector(Zg($)))?(d.instance=I,ps(I),I):(x=g,(I=Za.get($))&&(x=h({},g),yE(x,I)),u=u.ownerDocument||u,I=u.createElement("script"),ps(I),Or(I,"link",x),u.head.appendChild(I),d.instance=I);case"void":return null;default:throw Error(s(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(x=d.instance,d.state.loading|=4,ix(x,g.precedence,u));return d.instance}function ix(u,d,g){for(var x=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),I=x.length?x[x.length-1]:null,$=I,q=0;q<x.length;q++){var Y=x[q];if(Y.dataset.precedence===d)$=Y;else if($!==I)break}$?$.parentNode.insertBefore(u,$.nextSibling):(d=g.nodeType===9?g.head:g,d.insertBefore(u,d.firstChild))}function gE(u,d){u.crossOrigin==null&&(u.crossOrigin=d.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=d.referrerPolicy),u.title==null&&(u.title=d.title)}function yE(u,d){u.crossOrigin==null&&(u.crossOrigin=d.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=d.referrerPolicy),u.integrity==null&&(u.integrity=d.integrity)}var ax=null;function GL(u,d,g){if(ax===null){var x=new Map,I=ax=new Map;I.set(g,x)}else I=ax,x=I.get(g),x||(x=new Map,I.set(g,x));if(x.has(u))return x;for(x.set(u,null),g=g.getElementsByTagName(u),I=0;I<g.length;I++){var $=g[I];if(!($[sl]||$[$s]||u==="link"&&$.getAttribute("rel")==="stylesheet")&&$.namespaceURI!=="http://www.w3.org/2000/svg"){var q=$.getAttribute(d)||"";q=u+q;var Y=x.get(q);Y?Y.push($):x.set(q,[$])}}return x}function WL(u,d,g){u=u.ownerDocument||u,u.head.insertBefore(g,d==="title"?u.querySelector("head > title"):null)}function IX(u,d,g){if(g===1||d.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return u=d.disabled,typeof d.precedence=="string"&&u==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function HL(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}var Yg=null;function CX(){}function kX(u,d,g){if(Yg===null)throw Error(s(475));var x=Yg;if(d.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var I=Pp(g.href),$=u.querySelector(Xg(I));if($){u=$._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(x.count++,x=ox.bind(x),u.then(x,x)),d.state.loading|=4,d.instance=$,ps($);return}$=u.ownerDocument||u,g=VL(g),(I=Za.get(I))&&gE(g,I),$=$.createElement("link"),ps($);var q=$;q._p=new Promise(function(Y,he){q.onload=Y,q.onerror=he}),Or($,"link",g),d.instance=$}x.stylesheets===null&&(x.stylesheets=new Map),x.stylesheets.set(d,u),(u=d.state.preload)&&(d.state.loading&3)===0&&(x.count++,d=ox.bind(x),u.addEventListener("load",d),u.addEventListener("error",d))}}function $X(){if(Yg===null)throw Error(s(475));var u=Yg;return u.stylesheets&&u.count===0&&vE(u,u.stylesheets),0<u.count?function(d){var g=setTimeout(function(){if(u.stylesheets&&vE(u,u.stylesheets),u.unsuspend){var x=u.unsuspend;u.unsuspend=null,x()}},6e4);return u.unsuspend=d,function(){u.unsuspend=null,clearTimeout(g)}}:null}function ox(){if(this.count--,this.count===0){if(this.stylesheets)vE(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var lx=null;function vE(u,d){u.stylesheets=null,u.unsuspend!==null&&(u.count++,lx=new Map,d.forEach(AX,u),lx=null,ox.call(u))}function AX(u,d){if(!(d.state.loading&4)){var g=lx.get(u);if(g)var x=g.get(null);else{g=new Map,lx.set(u,g);for(var I=u.querySelectorAll("link[data-precedence],style[data-precedence]"),$=0;$<I.length;$++){var q=I[$];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(g.set(q.dataset.precedence,q),x=q)}x&&g.set(null,x)}I=d.instance,q=I.getAttribute("data-precedence"),$=g.get(q)||x,$===x&&g.set(null,I),g.set(q,I),this.count++,x=ox.bind(this),I.addEventListener("load",x),I.addEventListener("error",x),$?$.parentNode.insertBefore(I,$.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(I,u.firstChild)),d.state.loading|=4}}var Qg={$$typeof:A,Provider:null,Consumer:null,_currentValue:ne,_currentValue2:ne,_threadCount:0};function RX(u,d,g,x,I,$,q,Y){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ra(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ra(0),this.hiddenUpdates=Ra(null),this.identifierPrefix=x,this.onUncaughtError=I,this.onCaughtError=$,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Y,this.incompleteTransitions=new Map}function qL(u,d,g,x,I,$,q,Y,he,$e,Fe,Ve){return u=new RX(u,d,g,q,Y,he,$e,Ve),d=1,$===!0&&(d|=24),$=Ii(3,null,null,d),u.current=$,$.stateNode=u,d=JT(),d.refCount++,u.pooledCache=d,d.refCount++,$.memoizedState={element:x,isDehydrated:g,cache:d},sS($),u}function KL(u){return u?(u=_c,u):_c}function XL(u,d,g,x,I,$){I=KL(I),x.context===null?x.context=I:x.pendingContext=I,x=Lu(d),x.payload={element:g},$=$===void 0?null:$,$!==null&&(x.callback=$),g=Ou(u,x,d),g!==null&&(_a(g,u,d),Cg(g,u,d))}function ZL(u,d){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var g=u.retryLane;u.retryLane=g!==0&&g<d?g:d}}function bE(u,d){ZL(u,d),(u=u.alternate)&&ZL(u,d)}function YL(u){if(u.tag===13){var d=ku(u,67108864);d!==null&&_a(d,u,67108864),bE(u,67108864)}}var cx=!0;function DX(u,d,g,x){var I=X.T;X.T=null;var $=se.p;try{se.p=2,_E(u,d,g,x)}finally{se.p=$,X.T=I}}function LX(u,d,g,x){var I=X.T;X.T=null;var $=se.p;try{se.p=8,_E(u,d,g,x)}finally{se.p=$,X.T=I}}function _E(u,d,g,x){if(cx){var I=xE(x);if(I===null)oE(u,d,x,ux,g),JL(u,x);else if(PX(I,u,d,g,x))x.stopPropagation();else if(JL(u,x),d&4&&-1<OX.indexOf(u)){for(;I!==null;){var $=ra(I);if($!==null)switch($.tag){case 3:if($=$.stateNode,$.current.memoizedState.isDehydrated){var q=Yr($.pendingLanes);if(q!==0){var Y=$;for(Y.pendingLanes|=2,Y.entangledLanes|=2;q;){var he=1<<31-os(q);Y.entanglements[1]|=he,q&=~he}vl($),(kn&6)===0&&(q_=Pt()+500,Wg(0))}}break;case 13:Y=ku($,2),Y!==null&&_a(Y,$,2),X_(),bE($,2)}if($=xE(x),$===null&&oE(u,d,x,ux,g),$===I)break;I=$}I!==null&&x.stopPropagation()}else oE(u,d,x,null,g)}}function xE(u){return u=Rr(u),wE(u)}var ux=null;function wE(u){if(ux=null,u=sa(u),u!==null){var d=i(u);if(d===null)u=null;else{var g=d.tag;if(g===13){if(u=a(d),u!==null)return u;u=null}else if(g===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;u=null}else d!==u&&(u=null)}}return ux=u,null}function QL(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(un()){case Cr:return 2;case Rn:return 8;case zs:case Vs:return 32;case kr:return 268435456;default:return 32}default:return 32}}var TE=!1,Ku=null,Xu=null,Zu=null,Jg=new Map,ey=new Map,Yu=[],OX="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function JL(u,d){switch(u){case"focusin":case"focusout":Ku=null;break;case"dragenter":case"dragleave":Xu=null;break;case"mouseover":case"mouseout":Zu=null;break;case"pointerover":case"pointerout":Jg.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":ey.delete(d.pointerId)}}function ty(u,d,g,x,I,$){return u===null||u.nativeEvent!==$?(u={blockedOn:d,domEventName:g,eventSystemFlags:x,nativeEvent:$,targetContainers:[I]},d!==null&&(d=ra(d),d!==null&&YL(d)),u):(u.eventSystemFlags|=x,d=u.targetContainers,I!==null&&d.indexOf(I)===-1&&d.push(I),u)}function PX(u,d,g,x,I){switch(d){case"focusin":return Ku=ty(Ku,u,d,g,x,I),!0;case"dragenter":return Xu=ty(Xu,u,d,g,x,I),!0;case"mouseover":return Zu=ty(Zu,u,d,g,x,I),!0;case"pointerover":var $=I.pointerId;return Jg.set($,ty(Jg.get($)||null,u,d,g,x,I)),!0;case"gotpointercapture":return $=I.pointerId,ey.set($,ty(ey.get($)||null,u,d,g,x,I)),!0}return!1}function eO(u){var d=sa(u.target);if(d!==null){var g=i(d);if(g!==null){if(d=g.tag,d===13){if(d=a(g),d!==null){u.blockedOn=d,uu(u.priority,function(){if(g.tag===13){var x=ba();x=tl(x);var I=ku(g,x);I!==null&&_a(I,g,x),bE(g,x)}});return}}else if(d===3&&g.stateNode.current.memoizedState.isDehydrated){u.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}u.blockedOn=null}function hx(u){if(u.blockedOn!==null)return!1;for(var d=u.targetContainers;0<d.length;){var g=xE(u.nativeEvent);if(g===null){g=u.nativeEvent;var x=new g.constructor(g.type,g);la=x,g.target.dispatchEvent(x),la=null}else return d=ra(g),d!==null&&YL(d),u.blockedOn=g,!1;d.shift()}return!0}function tO(u,d,g){hx(u)&&g.delete(d)}function MX(){TE=!1,Ku!==null&&hx(Ku)&&(Ku=null),Xu!==null&&hx(Xu)&&(Xu=null),Zu!==null&&hx(Zu)&&(Zu=null),Jg.forEach(tO),ey.forEach(tO)}function dx(u,d){u.blockedOn===d&&(u.blockedOn=null,TE||(TE=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,MX)))}var fx=null;function nO(u){fx!==u&&(fx=u,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){fx===u&&(fx=null);for(var d=0;d<u.length;d+=3){var g=u[d],x=u[d+1],I=u[d+2];if(typeof x!="function"){if(wE(x||g)===null)continue;break}var $=ra(g);$!==null&&(u.splice(d,3),d-=3,wS($,{pending:!0,data:I,method:g.method,action:x},x,I))}}))}function ny(u){function d(he){return dx(he,u)}Ku!==null&&dx(Ku,u),Xu!==null&&dx(Xu,u),Zu!==null&&dx(Zu,u),Jg.forEach(d),ey.forEach(d);for(var g=0;g<Yu.length;g++){var x=Yu[g];x.blockedOn===u&&(x.blockedOn=null)}for(;0<Yu.length&&(g=Yu[0],g.blockedOn===null);)eO(g),g.blockedOn===null&&Yu.shift();if(g=(u.ownerDocument||u).$$reactFormReplay,g!=null)for(x=0;x<g.length;x+=3){var I=g[x],$=g[x+1],q=I[bs]||null;if(typeof $=="function")q||nO(g);else if(q){var Y=null;if($&&$.hasAttribute("formAction")){if(I=$,q=$[bs]||null)Y=q.formAction;else if(wE(I)!==null)continue}else Y=q.action;typeof Y=="function"?g[x+1]=Y:(g.splice(x,3),x-=3),nO(g)}}}function SE(u){this._internalRoot=u}px.prototype.render=SE.prototype.render=function(u){var d=this._internalRoot;if(d===null)throw Error(s(409));var g=d.current,x=ba();XL(g,x,u,d,null,null)},px.prototype.unmount=SE.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var d=u.containerInfo;XL(u.current,2,null,u,null,null),X_(),d[Pi]=null}};function px(u){this._internalRoot=u}px.prototype.unstable_scheduleHydration=function(u){if(u){var d=nl();u={blockedOn:null,target:u,priority:d};for(var g=0;g<Yu.length&&d!==0&&d<Yu[g].priority;g++);Yu.splice(g,0,u),g===0&&eO(u)}};var sO=e.version;if(sO!=="19.1.1")throw Error(s(527,sO,"19.1.1"));se.findDOMNode=function(u){var d=u._reactInternals;if(d===void 0)throw typeof u.render=="function"?Error(s(188)):(u=Object.keys(u).join(","),Error(s(268,u)));return u=l(d),u=u!==null?c(u):null,u=u===null?null:u.stateNode,u};var FX={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mx.isDisabled&&mx.supportsFiber)try{an=mx.inject(FX),Mt=mx}catch{}}return ry.createRoot=function(u,d){if(!r(u))throw Error(s(299));var g=!1,x="",I=bD,$=_D,q=xD,Y=null;return d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(x=d.identifierPrefix),d.onUncaughtError!==void 0&&(I=d.onUncaughtError),d.onCaughtError!==void 0&&($=d.onCaughtError),d.onRecoverableError!==void 0&&(q=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(Y=d.unstable_transitionCallbacks)),d=qL(u,1,!1,null,null,g,x,I,$,q,Y,null),u[Pi]=d.current,aE(u),new SE(d)},ry.hydrateRoot=function(u,d,g){if(!r(u))throw Error(s(299));var x=!1,I="",$=bD,q=_D,Y=xD,he=null,$e=null;return g!=null&&(g.unstable_strictMode===!0&&(x=!0),g.identifierPrefix!==void 0&&(I=g.identifierPrefix),g.onUncaughtError!==void 0&&($=g.onUncaughtError),g.onCaughtError!==void 0&&(q=g.onCaughtError),g.onRecoverableError!==void 0&&(Y=g.onRecoverableError),g.unstable_transitionCallbacks!==void 0&&(he=g.unstable_transitionCallbacks),g.formState!==void 0&&($e=g.formState)),d=qL(u,1,!0,d,g??null,x,I,$,q,Y,he,$e),d.context=KL(null),g=d.current,x=ba(),x=tl(x),I=Lu(x),I.callback=null,Ou(g,I,x),g=x,d.current.lanes=g,Da(d,g),vl(d),u[Pi]=d.current,aE(u),new px(d)},ry.version="19.1.1",ry}var fO;function KX(){if(fO)return IE.exports;fO=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),IE.exports=qX(),IE.exports}var XX=KX();/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var pO="popstate";function ZX(n={}){function e(s,r){let{pathname:i,search:a,hash:o}=s.location;return NN("",{pathname:i,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(s,r){return typeof r=="string"?r:jy(r)}return QX(e,t,null,n)}function ys(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Gl(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function YX(){return Math.random().toString(36).substring(2,10)}function mO(n,e){return{usr:n.state,key:n.key,idx:e}}function NN(n,e,t=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Fm(e):e,state:t,key:e&&e.key||s||YX()}}function jy({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Fm(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substring(s),n=n.substring(0,s)),n&&(e.pathname=n)}return e}function QX(n,e,t,s={}){let{window:r=document.defaultView,v5Compat:i=!1}=s,a=r.history,o="POP",l=null,c=h();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function h(){return(a.state||{idx:null}).idx}function p(){o="POP";let T=h(),E=T==null?null:T-c;c=T,l&&l({action:o,location:w.location,delta:E})}function m(T,E){o="PUSH";let C=NN(w.location,T,E);c=h()+1;let A=mO(C,c),D=w.createHref(C);try{a.pushState(A,"",D)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;r.location.assign(D)}i&&l&&l({action:o,location:w.location,delta:1})}function v(T,E){o="REPLACE";let C=NN(w.location,T,E);c=h();let A=mO(C,c),D=w.createHref(C);a.replaceState(A,"",D),i&&l&&l({action:o,location:w.location,delta:0})}function _(T){return JX(T)}let w={get action(){return o},get location(){return n(r,a)},listen(T){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(pO,p),l=T,()=>{r.removeEventListener(pO,p),l=null}},createHref(T){return e(r,T)},createURL:_,encodeLocation(T){let E=_(T);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:m,replace:v,go(T){return a.go(T)}};return w}function JX(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ys(t,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:jy(n);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function vF(n,e,t="/"){return eZ(n,e,t,!1)}function eZ(n,e,t,s){let r=typeof e=="string"?Fm(e):e,i=Gc(r.pathname||"/",t);if(i==null)return null;let a=bF(n);tZ(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=dZ(i);o=uZ(a[l],c,s)}return o}function bF(n,e=[],t=[],s="",r=!1){let i=(a,o,l=r,c)=>{let h={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(s)&&l)return;ys(h.relativePath.startsWith(s),`Absolute route path "${h.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(s.length)}let p=jc([s,h.relativePath]),m=t.concat(h);a.children&&a.children.length>0&&(ys(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),bF(a.children,e,m,p,l)),!(a.path==null&&!a.index)&&e.push({path:p,score:lZ(p,a.index),routesMeta:m})};return n.forEach((a,o)=>{if(a.path===""||!a.path?.includes("?"))i(a,o);else for(let l of _F(a.path))i(a,o,!0,l)}),e}function _F(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,r=t.endsWith("?"),i=t.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let a=_F(s.join("/")),o=[];return o.push(...a.map(l=>l===""?i:[i,l].join("/"))),r&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function tZ(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:cZ(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var nZ=/^:[\w-]+$/,sZ=3,rZ=2,iZ=1,aZ=10,oZ=-2,gO=n=>n==="*";function lZ(n,e){let t=n.split("/"),s=t.length;return t.some(gO)&&(s+=oZ),e&&(s+=rZ),t.filter(r=>!gO(r)).reduce((r,i)=>r+(nZ.test(i)?sZ:i===""?iZ:aZ),s)}function cZ(n,e){return n.length===e.length&&n.slice(0,-1).every((s,r)=>s===e[r])?n[n.length-1]-e[e.length-1]:0}function uZ(n,e,t=!1){let{routesMeta:s}=n,r={},i="/",a=[];for(let o=0;o<s.length;++o){let l=s[o],c=o===s.length-1,h=i==="/"?e:e.slice(i.length)||"/",p=p0({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},h),m=l.route;if(!p&&c&&t&&!s[s.length-1].route.index&&(p=p0({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!p)return null;Object.assign(r,p.params),a.push({params:r,pathname:jc([i,p.pathname]),pathnameBase:gZ(jc([i,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(i=jc([i,p.pathnameBase]))}return a}function p0(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=hZ(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let i=r[0],a=i.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:s.reduce((c,{paramName:h,isOptional:p},m)=>{if(h==="*"){let _=o[m]||"";a=i.slice(0,i.length-_.length).replace(/(.)\/+$/,"$1")}const v=o[m];return p&&!v?c[h]=void 0:c[h]=(v||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:a,pattern:n}}function hZ(n,e=!1,t=!0){Gl(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(s.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(s.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function dZ(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Gl(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Gc(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}function fZ(n,e="/"){let{pathname:t,search:s="",hash:r=""}=typeof n=="string"?Fm(n):n;return{pathname:t?t.startsWith("/")?t:pZ(t,e):e,search:yZ(s),hash:vZ(r)}}function pZ(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function AE(n,e,t,s){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function mZ(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function xF(n){let e=mZ(n);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function wF(n,e,t,s=!1){let r;typeof n=="string"?r=Fm(n):(r={...n},ys(!r.pathname||!r.pathname.includes("?"),AE("?","pathname","search",r)),ys(!r.pathname||!r.pathname.includes("#"),AE("#","pathname","hash",r)),ys(!r.search||!r.search.includes("#"),AE("#","search","hash",r)));let i=n===""||r.pathname==="",a=i?"/":r.pathname,o;if(a==null)o=t;else{let p=e.length-1;if(!s&&a.startsWith("..")){let m=a.split("/");for(;m[0]==="..";)m.shift(),p-=1;r.pathname=m.join("/")}o=p>=0?e[p]:"/"}let l=fZ(r,o),c=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}var jc=n=>n.join("/").replace(/\/\/+/g,"/"),gZ=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),yZ=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,vZ=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function bZ(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var TF=["POST","PUT","PATCH","DELETE"];new Set(TF);var _Z=["GET",...TF];new Set(_Z);var jm=ve.createContext(null);jm.displayName="DataRouter";var N1=ve.createContext(null);N1.displayName="DataRouterState";ve.createContext(!1);var SF=ve.createContext({isTransitioning:!1});SF.displayName="ViewTransition";var xZ=ve.createContext(new Map);xZ.displayName="Fetchers";var wZ=ve.createContext(null);wZ.displayName="Await";var rc=ve.createContext(null);rc.displayName="Navigation";var bv=ve.createContext(null);bv.displayName="Location";var eu=ve.createContext({outlet:null,matches:[],isDataRoute:!1});eu.displayName="Route";var _C=ve.createContext(null);_C.displayName="RouteError";function TZ(n,{relative:e}={}){ys(_v(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=ve.useContext(rc),{hash:r,pathname:i,search:a}=wv(n,{relative:e}),o=i;return t!=="/"&&(o=i==="/"?t:jc([t,i])),s.createHref({pathname:o,search:a,hash:r})}function _v(){return ve.useContext(bv)!=null}function Qo(){return ys(_v(),"useLocation() may be used only in the context of a <Router> component."),ve.useContext(bv).location}var EF="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function NF(n){ve.useContext(rc).static||ve.useLayoutEffect(n)}function xv(){let{isDataRoute:n}=ve.useContext(eu);return n?PZ():SZ()}function SZ(){ys(_v(),"useNavigate() may be used only in the context of a <Router> component.");let n=ve.useContext(jm),{basename:e,navigator:t}=ve.useContext(rc),{matches:s}=ve.useContext(eu),{pathname:r}=Qo(),i=JSON.stringify(xF(s)),a=ve.useRef(!1);return NF(()=>{a.current=!0}),ve.useCallback((l,c={})=>{if(Gl(a.current,EF),!a.current)return;if(typeof l=="number"){t.go(l);return}let h=wF(l,JSON.parse(i),r,c.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:jc([e,h.pathname])),(c.replace?t.replace:t.push)(h,c.state,c)},[e,t,i,r,n])}ve.createContext(null);function wv(n,{relative:e}={}){let{matches:t}=ve.useContext(eu),{pathname:s}=Qo(),r=JSON.stringify(xF(t));return ve.useMemo(()=>wF(n,JSON.parse(r),s,e==="path"),[n,r,s,e])}function EZ(n,e){return IF(n,e)}function IF(n,e,t,s,r){ys(_v(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=ve.useContext(rc),{matches:a}=ve.useContext(eu),o=a[a.length-1],l=o?o.params:{},c=o?o.pathname:"/",h=o?o.pathnameBase:"/",p=o&&o.route;{let C=p&&p.path||"";CF(c,!p||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let m=Qo(),v;if(e){let C=typeof e=="string"?Fm(e):e;ys(h==="/"||C.pathname?.startsWith(h),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${C.pathname}" was given in the \`location\` prop.`),v=C}else v=m;let _=v.pathname||"/",w=_;if(h!=="/"){let C=h.replace(/^\//,"").split("/");w="/"+_.replace(/^\//,"").split("/").slice(C.length).join("/")}let T=vF(n,{pathname:w});Gl(p||T!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Gl(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=$Z(T&&T.map(C=>Object.assign({},C,{params:Object.assign({},l,C.params),pathname:jc([h,i.encodeLocation?i.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?h:jc([h,i.encodeLocation?i.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),a,t,s,r);return e&&E?ve.createElement(bv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},E):E}function NZ(){let n=OZ(),e=bZ(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},a=null;return console.error("Error handled by React Router default ErrorBoundary:",n),a=ve.createElement(ve.Fragment,null,ve.createElement("p",null,"💿 Hey developer 👋"),ve.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ve.createElement("code",{style:i},"ErrorBoundary")," or"," ",ve.createElement("code",{style:i},"errorElement")," prop on your route.")),ve.createElement(ve.Fragment,null,ve.createElement("h2",null,"Unexpected Application Error!"),ve.createElement("h3",{style:{fontStyle:"italic"}},e),t?ve.createElement("pre",{style:r},t):null,a)}var IZ=ve.createElement(NZ,null),CZ=class extends ve.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?ve.createElement(eu.Provider,{value:this.props.routeContext},ve.createElement(_C.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function kZ({routeContext:n,match:e,children:t}){let s=ve.useContext(jm);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),ve.createElement(eu.Provider,{value:n},t)}function $Z(n,e=[],t=null,s=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,a=t?.errors;if(a!=null){let c=i.findIndex(h=>h.route.id&&a?.[h.route.id]!==void 0);ys(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,c+1))}let o=!1,l=-1;if(t)for(let c=0;c<i.length;c++){let h=i[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=c),h.route.id){let{loaderData:p,errors:m}=t,v=h.route.loader&&!p.hasOwnProperty(h.route.id)&&(!m||m[h.route.id]===void 0);if(h.route.lazy||v){o=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}return i.reduceRight((c,h,p)=>{let m,v=!1,_=null,w=null;t&&(m=a&&h.route.id?a[h.route.id]:void 0,_=h.route.errorElement||IZ,o&&(l<0&&p===0?(CF("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,w=null):l===p&&(v=!0,w=h.route.hydrateFallbackElement||null)));let T=e.concat(i.slice(0,p+1)),E=()=>{let C;return m?C=_:v?C=w:h.route.Component?C=ve.createElement(h.route.Component,null):h.route.element?C=h.route.element:C=c,ve.createElement(kZ,{match:h,routeContext:{outlet:c,matches:T,isDataRoute:t!=null},children:C})};return t&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?ve.createElement(CZ,{location:t.location,revalidation:t.revalidation,component:_,error:m,children:E(),routeContext:{outlet:null,matches:T,isDataRoute:!0},unstable_onError:s}):E()},null)}function xC(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AZ(n){let e=ve.useContext(jm);return ys(e,xC(n)),e}function RZ(n){let e=ve.useContext(N1);return ys(e,xC(n)),e}function DZ(n){let e=ve.useContext(eu);return ys(e,xC(n)),e}function wC(n){let e=DZ(n),t=e.matches[e.matches.length-1];return ys(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function LZ(){return wC("useRouteId")}function OZ(){let n=ve.useContext(_C),e=RZ("useRouteError"),t=wC("useRouteError");return n!==void 0?n:e.errors?.[t]}function PZ(){let{router:n}=AZ("useNavigate"),e=wC("useNavigate"),t=ve.useRef(!1);return NF(()=>{t.current=!0}),ve.useCallback(async(r,i={})=>{Gl(t.current,EF),t.current&&(typeof r=="number"?n.navigate(r):await n.navigate(r,{fromRouteId:e,...i}))},[n,e])}var yO={};function CF(n,e,t){!e&&!yO[n]&&(yO[n]=!0,Gl(!1,t))}ve.memo(MZ);function MZ({routes:n,future:e,state:t,unstable_onError:s}){return IF(n,void 0,t,s,e)}function Ls(n){ys(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function FZ({basename:n="/",children:e=null,location:t,navigationType:s="POP",navigator:r,static:i=!1}){ys(!_v(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=n.replace(/^\/*/,"/"),o=ve.useMemo(()=>({basename:a,navigator:r,static:i,future:{}}),[a,r,i]);typeof t=="string"&&(t=Fm(t));let{pathname:l="/",search:c="",hash:h="",state:p=null,key:m="default"}=t,v=ve.useMemo(()=>{let _=Gc(l,a);return _==null?null:{location:{pathname:_,search:c,hash:h,state:p,key:m},navigationType:s}},[a,l,c,h,p,m,s]);return Gl(v!=null,`<Router basename="${a}"> is not able to match the URL "${l}${c}${h}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:ve.createElement(rc.Provider,{value:o},ve.createElement(bv.Provider,{children:e,value:v}))}function jZ({children:n,location:e}){return EZ(IN(n),e)}function IN(n,e=[]){let t=[];return ve.Children.forEach(n,(s,r)=>{if(!ve.isValidElement(s))return;let i=[...e,r];if(s.type===ve.Fragment){t.push.apply(t,IN(s.props.children,i));return}ys(s.type===Ls,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ys(!s.props.index||!s.props.children,"An index route cannot have child routes.");let a={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(a.children=IN(s.props.children,i)),t.push(a)}),t}var Bx="get",zx="application/x-www-form-urlencoded";function I1(n){return n!=null&&typeof n.tagName=="string"}function BZ(n){return I1(n)&&n.tagName.toLowerCase()==="button"}function zZ(n){return I1(n)&&n.tagName.toLowerCase()==="form"}function VZ(n){return I1(n)&&n.tagName.toLowerCase()==="input"}function UZ(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function GZ(n,e){return n.button===0&&(!e||e==="_self")&&!UZ(n)}var gx=null;function WZ(){if(gx===null)try{new FormData(document.createElement("form"),0),gx=!1}catch{gx=!0}return gx}var HZ=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function RE(n){return n!=null&&!HZ.has(n)?(Gl(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${zx}"`),null):n}function qZ(n,e){let t,s,r,i,a;if(zZ(n)){let o=n.getAttribute("action");s=o?Gc(o,e):null,t=n.getAttribute("method")||Bx,r=RE(n.getAttribute("enctype"))||zx,i=new FormData(n)}else if(BZ(n)||VZ(n)&&(n.type==="submit"||n.type==="image")){let o=n.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||o.getAttribute("action");if(s=l?Gc(l,e):null,t=n.getAttribute("formmethod")||o.getAttribute("method")||Bx,r=RE(n.getAttribute("formenctype"))||RE(o.getAttribute("enctype"))||zx,i=new FormData(o,n),!WZ()){let{name:c,type:h,value:p}=n;if(h==="image"){let m=c?`${c}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else c&&i.append(c,p)}}else{if(I1(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Bx,s=null,r=zx,a=n}return i&&r==="text/plain"&&(a=i,i=void 0),{action:s,method:t.toLowerCase(),encType:r,formData:i,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function TC(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function KZ(n,e,t){let s=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&Gc(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function XZ(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ZZ(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function YZ(n,e,t){let s=await Promise.all(n.map(async r=>{let i=e.routes[r.route.id];if(i){let a=await XZ(i,t);return a.links?a.links():[]}return[]}));return tY(s.flat(1).filter(ZZ).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function vO(n,e,t,s,r,i){let a=(l,c)=>t[c]?l.route.id!==t[c].route.id:!0,o=(l,c)=>t[c].pathname!==l.pathname||t[c].route.path?.endsWith("*")&&t[c].params["*"]!==l.params["*"];return i==="assets"?e.filter((l,c)=>a(l,c)||o(l,c)):i==="data"?e.filter((l,c)=>{let h=s.routes[l.route.id];if(!h||!h.hasLoader)return!1;if(a(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function QZ(n,e,{includeHydrateFallback:t}={}){return JZ(n.map(s=>{let r=e.routes[s.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function JZ(n){return[...new Set(n)]}function eY(n){let e={},t=Object.keys(n).sort();for(let s of t)e[s]=n[s];return e}function tY(n,e){let t=new Set;return new Set(e),n.reduce((s,r)=>{let i=JSON.stringify(eY(r));return t.has(i)||(t.add(i),s.push({key:i,link:r})),s},[])}function kF(){let n=ve.useContext(jm);return TC(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function nY(){let n=ve.useContext(N1);return TC(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var SC=ve.createContext(void 0);SC.displayName="FrameworkContext";function $F(){let n=ve.useContext(SC);return TC(n,"You must render this element inside a <HydratedRouter> element"),n}function sY(n,e){let t=ve.useContext(SC),[s,r]=ve.useState(!1),[i,a]=ve.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:h,onTouchStart:p}=e,m=ve.useRef(null);ve.useEffect(()=>{if(n==="render"&&a(!0),n==="viewport"){let w=E=>{E.forEach(C=>{a(C.isIntersecting)})},T=new IntersectionObserver(w,{threshold:.5});return m.current&&T.observe(m.current),()=>{T.disconnect()}}},[n]),ve.useEffect(()=>{if(s){let w=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(w)}}},[s]);let v=()=>{r(!0)},_=()=>{r(!1),a(!1)};return t?n!=="intent"?[i,m,{}]:[i,m,{onFocus:iy(o,v),onBlur:iy(l,_),onMouseEnter:iy(c,v),onMouseLeave:iy(h,_),onTouchStart:iy(p,v)}]:[!1,m,{}]}function iy(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function rY({page:n,...e}){let{router:t}=kF(),s=ve.useMemo(()=>vF(t.routes,n,t.basename),[t.routes,n,t.basename]);return s?ve.createElement(aY,{page:n,matches:s,...e}):null}function iY(n){let{manifest:e,routeModules:t}=$F(),[s,r]=ve.useState([]);return ve.useEffect(()=>{let i=!1;return YZ(n,e,t).then(a=>{i||r(a)}),()=>{i=!0}},[n,e,t]),s}function aY({page:n,matches:e,...t}){let s=Qo(),{manifest:r,routeModules:i}=$F(),{basename:a}=kF(),{loaderData:o,matches:l}=nY(),c=ve.useMemo(()=>vO(n,e,l,r,s,"data"),[n,e,l,r,s]),h=ve.useMemo(()=>vO(n,e,l,r,s,"assets"),[n,e,l,r,s]),p=ve.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let _=new Set,w=!1;if(e.forEach(E=>{let C=r.routes[E.route.id];!C||!C.hasLoader||(!c.some(A=>A.route.id===E.route.id)&&E.route.id in o&&i[E.route.id]?.shouldRevalidate||C.hasClientLoader?w=!0:_.add(E.route.id))}),_.size===0)return[];let T=KZ(n,a,"data");return w&&_.size>0&&T.searchParams.set("_routes",e.filter(E=>_.has(E.route.id)).map(E=>E.route.id).join(",")),[T.pathname+T.search]},[a,o,s,r,c,e,n,i]),m=ve.useMemo(()=>QZ(h,r),[h,r]),v=iY(h);return ve.createElement(ve.Fragment,null,p.map(_=>ve.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...t})),m.map(_=>ve.createElement("link",{key:_,rel:"modulepreload",href:_,...t})),v.map(({key:_,link:w})=>ve.createElement("link",{key:_,nonce:t.nonce,...w})))}function oY(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var AF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{AF&&(window.__reactRouterVersion="7.9.1")}catch{}function lY({basename:n,children:e,window:t}){let s=ve.useRef();s.current==null&&(s.current=ZX({window:t,v5Compat:!0}));let r=s.current,[i,a]=ve.useState({action:r.action,location:r.location}),o=ve.useCallback(l=>{ve.startTransition(()=>a(l))},[a]);return ve.useLayoutEffect(()=>r.listen(o),[r,o]),ve.createElement(FZ,{basename:n,children:e,location:i.location,navigationType:i.action,navigator:r})}var RF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ft=ve.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:r,reloadDocument:i,replace:a,state:o,target:l,to:c,preventScrollReset:h,viewTransition:p,...m},v){let{basename:_}=ve.useContext(rc),w=typeof c=="string"&&RF.test(c),T,E=!1;if(typeof c=="string"&&w&&(T=c,AF))try{let O=new URL(window.location.href),M=c.startsWith("//")?new URL(O.protocol+c):new URL(c),k=Gc(M.pathname,_);M.origin===O.origin&&k!=null?c=k+M.search+M.hash:E=!0}catch{Gl(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=TZ(c,{relative:r}),[A,D,F]=sY(s,m),W=dY(c,{replace:a,state:o,target:l,preventScrollReset:h,relative:r,viewTransition:p});function B(O){e&&e(O),O.defaultPrevented||W(O)}let P=ve.createElement("a",{...m,...F,href:T||C,onClick:E||i?e:B,ref:oY(v,D),target:l,"data-discover":!w&&t==="render"?"true":void 0});return A&&!w?ve.createElement(ve.Fragment,null,P,ve.createElement(rY,{page:C})):P});ft.displayName="Link";var cY=ve.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:r=!1,style:i,to:a,viewTransition:o,children:l,...c},h){let p=wv(a,{relative:c.relative}),m=Qo(),v=ve.useContext(N1),{navigator:_,basename:w}=ve.useContext(rc),T=v!=null&&yY(p)&&o===!0,E=_.encodeLocation?_.encodeLocation(p).pathname:p.pathname,C=m.pathname,A=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(C=C.toLowerCase(),A=A?A.toLowerCase():null,E=E.toLowerCase()),A&&w&&(A=Gc(A,w)||A);const D=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let F=C===E||!r&&C.startsWith(E)&&C.charAt(D)==="/",W=A!=null&&(A===E||!r&&A.startsWith(E)&&A.charAt(E.length)==="/"),B={isActive:F,isPending:W,isTransitioning:T},P=F?e:void 0,O;typeof s=="function"?O=s(B):O=[s,F?"active":null,W?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let M=typeof i=="function"?i(B):i;return ve.createElement(ft,{...c,"aria-current":P,className:O,ref:h,style:M,to:a,viewTransition:o},typeof l=="function"?l(B):l)});cY.displayName="NavLink";var uY=ve.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:r,state:i,method:a=Bx,action:o,onSubmit:l,relative:c,preventScrollReset:h,viewTransition:p,...m},v)=>{let _=mY(),w=gY(o,{relative:c}),T=a.toLowerCase()==="get"?"get":"post",E=typeof o=="string"&&RF.test(o),C=A=>{if(l&&l(A),A.defaultPrevented)return;A.preventDefault();let D=A.nativeEvent.submitter,F=D?.getAttribute("formmethod")||a;_(D||A.currentTarget,{fetcherKey:e,method:F,navigate:t,replace:r,state:i,relative:c,preventScrollReset:h,viewTransition:p})};return ve.createElement("form",{ref:v,method:T,action:w,onSubmit:s?l:C,...m,"data-discover":!E&&n==="render"?"true":void 0})});uY.displayName="Form";function hY(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function DF(n){let e=ve.useContext(jm);return ys(e,hY(n)),e}function dY(n,{target:e,replace:t,state:s,preventScrollReset:r,relative:i,viewTransition:a}={}){let o=xv(),l=Qo(),c=wv(n,{relative:i});return ve.useCallback(h=>{if(GZ(h,e)){h.preventDefault();let p=t!==void 0?t:jy(l)===jy(c);o(n,{replace:p,state:s,preventScrollReset:r,relative:i,viewTransition:a})}},[l,o,c,t,s,e,n,r,i,a])}var fY=0,pY=()=>`__${String(++fY)}__`;function mY(){let{router:n}=DF("useSubmit"),{basename:e}=ve.useContext(rc),t=LZ();return ve.useCallback(async(s,r={})=>{let{action:i,method:a,encType:o,formData:l,body:c}=qZ(s,e);if(r.navigate===!1){let h=r.fetcherKey||pY();await n.fetch(h,t,r.action||i,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||a,formEncType:r.encType||o,flushSync:r.flushSync})}else await n.navigate(r.action||i,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||a,formEncType:r.encType||o,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[n,e,t])}function gY(n,{relative:e}={}){let{basename:t}=ve.useContext(rc),s=ve.useContext(eu);ys(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),i={...wv(n||".",{relative:e})},a=Qo();if(n==null){i.search=a.search;let o=new URLSearchParams(i.search),l=o.getAll("index");if(l.some(h=>h==="")){o.delete("index"),l.filter(p=>p).forEach(p=>o.append("index",p));let h=o.toString();i.search=h?`?${h}`:""}}return(!n||n===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:jc([t,i.pathname])),jy(i)}function yY(n,{relative:e}={}){let t=ve.useContext(SF);ys(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=DF("useViewTransitionState"),r=wv(n,{relative:e});if(!t.isTransitioning)return!1;let i=Gc(t.currentLocation.pathname,s)||t.currentLocation.pathname,a=Gc(t.nextLocation.pathname,s)||t.nextLocation.pathname;return p0(r.pathname,a)!=null||p0(r.pathname,i)!=null}function bO(){Qo();const n=localStorage.getItem("userRole")!==null,e=()=>{const s=localStorage.getItem("userRole");return s==="farmer"?"/farmer":s==="buyer"?"/buyer":s==="admin"?"/admin":"/login"},t=()=>{localStorage.removeItem("userRole"),localStorage.removeItem("userEmail"),window.location.href="/login"};return y.jsx("nav",{className:"navbar-container navbar-farmer",children:y.jsxs("div",{className:"navbar-content",children:[y.jsx("div",{className:"navbar-logo-button",children:y.jsx("button",{children:y.jsxs("a",{href:"./farmer",children:[" ",y.jsx("div",{className:"navbar-logo"})]})})}),y.jsxs("div",{className:"navbar-right",children:[y.jsxs("div",{className:"navbar-nav",children:[y.jsxs(ft,{to:e(),className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"🏠︎"}),"Home"]}),y.jsxs(ft,{to:"/mrv-dashboard-farmer",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"📊"}),"MRV Dashboard"]}),y.jsxs(ft,{to:"/marketplace",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"💰"}),"Market Place"]}),y.jsxs(ft,{to:"/add-project",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"➕"}),"Add Project"]}),y.jsxs(ft,{to:"/profile",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"👤"}),"Profile"]})]}),y.jsx("div",{className:"navbar-buttons",children:n?y.jsx("a",{href:"./login",children:y.jsx("button",{onClick:t,className:"btn-logout",children:"Logout"})}):y.jsxs(y.Fragment,{children:[y.jsx(ft,{to:"/login",className:"btn-signin",children:"Sign In"}),y.jsx(ft,{to:"/signup",className:"btn-signup",children:"Sign Up"})]})})]})]})})}function vY(){return y.jsxs("div",{className:"home-container",children:[y.jsxs("div",{className:"hero-section hero-buyer",children:[y.jsx("div",{className:"hero-background"}),y.jsxs("div",{className:"hero-content",children:[y.jsx("div",{className:"hero-badge",children:"🛒 Buyer Portal"}),y.jsx("h1",{className:"hero-title",children:"Invest in Nature. Own Verified Carbon Credits."}),y.jsx("p",{className:"hero-subtitle",children:"Support Blue Carbon projects in India and track your real climate impact with transparency."}),y.jsxs("div",{className:"hero-actions",children:[y.jsx(ft,{to:"/marketplace",className:"btn-hero-primary",children:"Browse Credits"}),y.jsx(ft,{to:"/mrv-dashboard-buyer",className:"btn-hero-secondary",children:"View Portfolio"})]})]})]}),y.jsxs("div",{className:"dashboard-grid",children:[y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"🛒"}),y.jsx("h3",{children:"Browse Marketplace"}),y.jsx("p",{children:"Explore available carbon credits from verified projects"}),y.jsx(ft,{to:"/marketplace",className:"card-button",children:"Browse Credits"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"📊"}),y.jsx("h3",{children:"MRV Dashboard"}),y.jsx("p",{children:"Monitor carbon credit marketplace and your portfolio"}),y.jsx(ft,{to:"/mrv-dashboard-buyer",className:"card-button",children:"View Dashboard"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"🔍"}),y.jsx("h3",{children:"Project Verification"}),y.jsx("p",{children:"Research project details and verification status"}),y.jsx(ft,{to:"/verification",className:"card-button",children:"Verify Projects"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"📊"}),y.jsx("h3",{children:"Impact Reports"}),y.jsx("p",{children:"Track your carbon offset contributions"}),y.jsx(ft,{to:"/impact-reports",className:"card-button",children:"View Impact"})]})]}),y.jsxs("div",{className:"featured-projects",children:[y.jsx("h2",{children:"Featured Projects"}),y.jsxs("div",{className:"project-grid",children:[y.jsxs("div",{className:"project-card",children:[y.jsx("div",{className:"project-image",children:"🌊"}),y.jsx("h4",{children:"Coastal Mangrove Restoration"}),y.jsx("p",{children:"1,250 credits available"}),y.jsx("span",{className:"project-price",children:"$25/credit"})]}),y.jsxs("div",{className:"project-card",children:[y.jsx("div",{className:"project-image",children:"🐟"}),y.jsx("h4",{children:"Seagrass Conservation"}),y.jsx("p",{children:"800 credits available"}),y.jsx("span",{className:"project-price",children:"$30/credit"})]}),y.jsxs("div",{className:"project-card",children:[y.jsx("div",{className:"project-image",children:"🦪"}),y.jsx("h4",{children:"Oyster Reef Restoration"}),y.jsx("p",{children:"600 credits available"}),y.jsx("span",{className:"project-price",children:"$35/credit"})]})]})]})]})}function bY(){Qo();const n=localStorage.getItem("userRole")!==null,e=()=>{const s=localStorage.getItem("userRole");return s==="farmer"?"/farmer":s==="buyer"?"/buyer":s==="admin"?"/admin":"/login"},t=()=>{localStorage.removeItem("userRole"),localStorage.removeItem("userEmail"),window.location.href="/login"};return y.jsx("nav",{className:"navbar-container navbar-buyer",children:y.jsxs("div",{className:"navbar-content",children:[y.jsx("div",{className:"navbar-logo-button",children:y.jsx("button",{children:y.jsxs("a",{href:"./Buyer",children:[" ",y.jsx("div",{className:"navbar-logo"})]})})}),y.jsxs("div",{className:"navbar-right",children:[y.jsxs("div",{className:"navbar-nav",children:[y.jsxs(ft,{to:e(),className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"🏠︎"}),"Home"]}),y.jsxs(ft,{to:"/mrv-dashboard-buyer",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"📊"}),"MRV Dashboard"]}),y.jsxs(ft,{to:"/marketplace",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"💰"}),"Market Place"]}),y.jsxs(ft,{to:"/my-purchases",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"📋"}),"My Purchases"]}),y.jsxs(ft,{to:"/profile",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"👤"}),"Profile"]})]}),y.jsx("div",{className:"navbar-buttons",children:n?y.jsx("a",{href:"./login",children:y.jsx("button",{onClick:t,className:"btn-logout",children:"Logout"})}):y.jsxs(y.Fragment,{children:[y.jsx(ft,{to:"/login",className:"btn-signin",children:"Sign In"}),y.jsx(ft,{to:"/signup",className:"btn-signup",children:"Sign Up"})]})})]})]})})}function _Y(){Qo();const n=localStorage.getItem("userRole")!==null,e=()=>{const s=localStorage.getItem("userRole");return s==="farmer"?"/farmer":s==="buyer"?"/buyer":s==="admin"?"/admin":"/login"},t=()=>{localStorage.removeItem("userRole"),localStorage.removeItem("userEmail"),window.location.href="/login"};return y.jsx("nav",{className:"navbar-container navbar-admin",children:y.jsxs("div",{className:"navbar-content",children:[y.jsx("div",{className:"navbar-logo-button",children:y.jsx("button",{children:y.jsxs("a",{href:"./admin",children:[" ",y.jsx("div",{className:"navbar-logo"})]})})}),y.jsxs("div",{className:"navbar-right",children:[y.jsxs("div",{className:"navbar-nav",children:[y.jsxs(ft,{to:e(),className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"🏠︎"}),"Home"]}),y.jsxs(ft,{to:"/project-verification",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"✅"}),"Project Verification"]}),y.jsxs(ft,{to:"/user-management",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"👥"}),"User Management"]}),y.jsxs(ft,{to:"/transactions",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"💳"}),"Transactions"]}),y.jsxs(ft,{to:"/reports",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"📋"}),"Reports"]}),y.jsxs(ft,{to:"/profile",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"👤"}),"Profile"]})]}),y.jsx("div",{className:"navbar-buttons",children:n?y.jsx("a",{href:"./login",children:y.jsx("button",{onClick:t,className:"btn-logout",children:"Logout"})}):y.jsxs(y.Fragment,{children:[y.jsx(ft,{to:"/login",className:"btn-signin",children:"Sign In"}),y.jsx(ft,{to:"/signup",className:"btn-signup",children:"Sign Up"})]})})]})]})})}function xY(){const[n,e]=ve.useState(null);switch(ve.useEffect(()=>{const t=localStorage.getItem("userRole");e(t);const s=()=>{const r=localStorage.getItem("userRole");e(r)};return window.addEventListener("storage",s),window.addEventListener("userRoleChanged",s),()=>{window.removeEventListener("storage",s),window.removeEventListener("userRoleChanged",s)}},[]),n){case"farmer":return y.jsx(bO,{});case"buyer":return y.jsx(bY,{});case"admin":return y.jsx(_Y,{});default:return y.jsx(bO,{})}}function C1(){return y.jsx("nav",{className:"navbar-container navbar-default",children:y.jsxs("div",{className:"navbar-content",children:[y.jsx("div",{className:"navbar-logo-button",children:y.jsx("button",{children:y.jsxs("a",{href:"./",children:[" ",y.jsx("div",{className:"navbar-logo"})]})})}),y.jsxs("div",{className:"navbar-right",children:[y.jsxs("div",{className:"navbar-nav",children:[y.jsxs(ft,{to:"/",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"🏠"}),"Home"]}),y.jsxs(ft,{to:"/dashboard",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"📊"}),"Dashboard"]}),y.jsxs(ft,{to:"/about",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"ℹ️"}),"About Us"]}),y.jsxs(ft,{to:"/contact",className:"nav-link",children:[y.jsx("span",{className:"nav-icon",children:"📞"}),"Contact Us"]})]}),y.jsxs("div",{className:"navbar-buttons",children:[y.jsx(ft,{to:"/login",className:"btn-signin",children:"Sign In"}),y.jsx(ft,{to:"/signup",className:"btn-signup",children:"Sign Up"})]})]})]})})}function wY(){return y.jsxs("div",{className:"default-landing",children:[y.jsx(C1,{}),y.jsx("section",{className:"default-hero",children:y.jsxs("div",{className:"default-hero-content",children:[y.jsxs("div",{className:"default-hero-text",children:[y.jsx("h1",{className:"default-hero-title",children:"Welcome to CarbonLens"}),y.jsx("p",{className:"default-hero-subtitle",children:"Revolutionizing carbon credit trading through blockchain technology and sustainable agriculture"}),y.jsxs("div",{className:"default-hero-actions",children:[y.jsx("a",{href:"/login",className:"default-btn-primary",children:"Get Started"}),y.jsx("a",{href:"/about",className:"default-btn-secondary",children:"Learn More"})]})]}),y.jsx("div",{className:"right-side",children:y.jsxs("div",{className:"floating-emojis",children:[y.jsx("span",{className:"emoji e1",children:"🌱"}),y.jsx("span",{className:"emoji e2",children:"🌍"}),y.jsx("span",{className:"emoji e3",children:"☁️"}),y.jsx("span",{className:"emoji e4",children:"🌳"}),y.jsx("span",{className:"emoji e5",children:"🍃"})]})})]})}),y.jsx("section",{className:"default-features",children:y.jsxs("div",{className:"default-container",children:[y.jsx("h2",{className:"default-section-title",children:"Why Choose CarbonLens?"}),y.jsxs("div",{className:"default-features-grid",children:[y.jsxs("div",{className:"default-feature-card",children:[y.jsx("div",{className:"default-feature-icon",children:"🌾"}),y.jsx("h3",{children:"For Farmers"}),y.jsx("p",{children:"Monetize your sustainable farming practices and earn carbon credits"})]}),y.jsxs("div",{className:"default-feature-card",children:[y.jsx("div",{className:"default-feature-icon",children:"💼"}),y.jsx("h3",{children:"For Buyers"}),y.jsx("p",{children:"Invest in verified carbon credits and support environmental sustainability"})]}),y.jsxs("div",{className:"default-feature-card",children:[y.jsx("div",{className:"default-feature-icon",children:"🔒"}),y.jsx("h3",{children:"Secure & Transparent"}),y.jsx("p",{children:"Blockchain-powered verification ensures trust and transparency"})]})]})]})}),y.jsx("section",{className:"default-cta",children:y.jsxs("div",{className:"default-container",children:[y.jsx("h2",{children:"Ready to Make a Difference?"}),y.jsx("p",{children:"Join thousands of farmers and buyers creating a sustainable future"}),y.jsxs("div",{className:"default-cta-buttons",children:[y.jsx("a",{href:"/signup",className:"default-btn-primary",children:"Sign Up Now"}),y.jsx("a",{href:"/contact",className:"default-btn-secondary",children:"Contact Us"})]})]})}),y.jsx("footer",{className:"default-footer",children:y.jsxs("div",{className:"default-container",children:[y.jsxs("div",{className:"default-footer-content",children:[y.jsxs("div",{className:"default-footer-section",children:[y.jsx("h4",{children:"BlueCarbon"}),y.jsx("p",{children:"Sustainable carbon credit trading platform"})]}),y.jsxs("div",{className:"default-footer-section",children:[y.jsx("h4",{children:"Quick Links"}),y.jsxs("ul",{children:[y.jsx("li",{children:y.jsx("a",{href:"/about",children:"About Us"})}),y.jsx("li",{children:y.jsx("a",{href:"/contact",children:"Contact"})}),y.jsx("li",{children:y.jsx("a",{href:"/dashboard",children:"Dashboard"})})]})]}),y.jsxs("div",{className:"default-footer-section",children:[y.jsx("h4",{children:"Get Started"}),y.jsxs("ul",{children:[y.jsx("li",{children:y.jsx("a",{href:"/login",children:"Sign In"})}),y.jsx("li",{children:y.jsx("a",{href:"/signup",children:"Sign Up"})})]})]})]}),y.jsx("div",{className:"default-footer-bottom",children:y.jsx("p",{children:"© 2025 CarbonLens- team Cryptocoral. All rights reserved."})})]})})]})}function TY(){return y.jsxs("div",{className:"default-dashboard",children:[y.jsx(C1,{}),y.jsx("section",{className:"dashboard-header",children:y.jsxs("div",{className:"dashboard-container",children:[y.jsx("h1",{className:"dashboard-title",children:"BlueCarbon Platform Overview"}),y.jsx("p",{className:"dashboard-subtitle",children:"Explore carbon credit trading opportunities and environmental impact data"})]})}),y.jsx("section",{className:"dashboard-stats",children:y.jsx("div",{className:"dashboard-container",children:y.jsxs("div",{className:"stats-grid",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🌱"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("h3",{className:"stat-number",children:"5"}),y.jsx("p",{className:"stat-label",children:"Active Projects"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"💰"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("h3",{className:"stat-number",children:"Rs 120000"}),y.jsx("p",{className:"stat-label",children:"Credits Traded"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🌍"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("h3",{className:"stat-number",children:"85 T"}),y.jsx("p",{className:"stat-label",children:"CO2 Tons Offset"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"👥"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("h3",{className:"stat-number",children:"20"}),y.jsx("p",{className:"stat-label",children:"Registered Users"})]})]})]})})}),y.jsx("section",{className:"market-overview",children:y.jsxs("div",{className:"dashboard-container",children:[y.jsx("h2",{className:"section-title",children:"Market Overview"}),y.jsxs("div",{className:"market-grid",children:[y.jsxs("div",{className:"market-card",children:[y.jsx("h3",{children:"Recent Projects"}),y.jsxs("div",{className:"project-list",children:[y.jsxs("div",{className:"project-item",children:[y.jsx("span",{className:"project-name",children:"Sustainable Rice Farming"}),y.jsx("span",{className:"project-credits",children:"5 Credits"})]}),y.jsxs("div",{className:"project-item",children:[y.jsx("span",{className:"project-name",children:"Forest Conservation"}),y.jsx("span",{className:"project-credits",children:"18 Credits"})]}),y.jsxs("div",{className:"project-item",children:[y.jsx("span",{className:"project-name",children:"Solar Energy Initiative"}),y.jsx("span",{className:"project-credits",children:"6 Credits"})]})]})]}),y.jsxs("div",{className:"market-card",children:[y.jsx("h3",{children:"Price Trends"}),y.jsxs("div",{className:"price-info",children:[y.jsxs("div",{className:"price-item",children:[y.jsx("span",{className:"price-label",children:"Current Price"}),y.jsx("span",{className:"price-value",children:"$15.50/Credit"})]}),y.jsxs("div",{className:"price-item",children:[y.jsx("span",{className:"price-label",children:"24h Change"}),y.jsx("span",{className:"price-value positive",children:"0%"})]}),y.jsxs("div",{className:"price-item",children:[y.jsx("span",{className:"price-label",children:"Volume"}),y.jsx("span",{className:"price-value",children:"1,250 Credits"})]})]})]})]})]})}),y.jsx("section",{className:"dashboard-cta",children:y.jsx("div",{className:"dashboard-container",children:y.jsxs("div",{className:"cta-content",children:[y.jsx("h2",{children:"Ready to Get Started?"}),y.jsx("p",{children:"Join our platform to start trading carbon credits or list your sustainable projects"}),y.jsxs("div",{className:"cta-buttons",children:[y.jsx("a",{href:"/signup",className:"cta-btn primary",children:"Sign Up Now"}),y.jsx("a",{href:"/login",className:"cta-btn secondary",children:"Sign In"})]})]})})})]})}const SY=()=>{};var _O={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LF=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},EY=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],a=n[t++],o=n[t++],l=((r&7)<<18|(i&63)<<12|(a&63)<<6|o&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],a=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|a&63)}}return e.join("")},OF={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],a=r+1<n.length,o=a?n[r+1]:0,l=r+2<n.length,c=l?n[r+2]:0,h=i>>2,p=(i&3)<<4|o>>4;let m=(o&15)<<2|c>>6,v=c&63;l||(v=64,a||(m=64)),s.push(t[h],t[p],t[m],t[v])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(LF(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):EY(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],o=r<n.length?t[n.charAt(r)]:0;++r;const c=r<n.length?t[n.charAt(r)]:64;++r;const p=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||o==null||c==null||p==null)throw new NY;const m=i<<2|o>>4;if(s.push(m),c!==64){const v=o<<4&240|c>>2;if(s.push(v),p!==64){const _=c<<6&192|p;s.push(_)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class NY extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const IY=function(n){const e=LF(n);return OF.encodeByteArray(e,!0)},m0=function(n){return IY(n).replace(/\./g,"")},PF=function(n){try{return OF.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CY(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kY=()=>CY().__FIREBASE_DEFAULTS__,$Y=()=>{if(typeof process>"u"||typeof _O>"u")return;const n=_O.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},AY=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&PF(n[1]);return e&&JSON.parse(e)},k1=()=>{try{return SY()||kY()||$Y()||AY()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},MF=n=>k1()?.emulatorHosts?.[n],FF=n=>{const e=MF(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},jF=()=>k1()?.config,BF=n=>k1()?.[`_${n}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RY{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gh(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function EC(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zF(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[m0(JSON.stringify(t)),m0(JSON.stringify(a)),""].join(".")}const Cy={};function DY(){const n={prod:[],emulator:[]};for(const e of Object.keys(Cy))Cy[e]?n.emulator.push(e):n.prod.push(e);return n}function LY(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let xO=!1;function NC(n,e){if(typeof window>"u"||typeof document>"u"||!Gh(window.location.host)||Cy[n]===e||Cy[n]||xO)return;Cy[n]=e;function t(m){return`__firebase__banner__${m}`}const s="__firebase__banner",i=DY().prod.length>0;function a(){const m=document.getElementById(s);m&&m.remove()}function o(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,v){m.setAttribute("width","24"),m.setAttribute("id",v),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function c(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{xO=!0,a()},m}function h(m,v){m.setAttribute("id",v),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=LY(s),v=t("text"),_=document.getElementById(v)||document.createElement("span"),w=t("learnmore"),T=document.getElementById(w)||document.createElement("a"),E=t("preprendIcon"),C=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const A=m.element;o(A),h(T,w);const D=c();l(C,E),A.append(C,_,T,D),document.body.appendChild(A)}i?(_.innerText="Preview backend disconnected.",C.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(C.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function OY(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(gi())}function PY(){const n=k1()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function MY(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function FY(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function jY(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function BY(){const n=gi();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function zY(){return!PY()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VY(){try{return typeof indexedDB=="object"}catch{return!1}}function UY(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GY="FirebaseError";class ic extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=GY,Object.setPrototypeOf(this,ic.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Tv.prototype.create)}}class Tv{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?WY(i,s):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new ic(r,o,s)}}function WY(n,e){return n.replace(HY,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const HY=/\{\$([^}]+)}/g;function qY(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function hf(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],a=e[r];if(wO(i)&&wO(a)){if(!hf(i,a))return!1}else if(i!==a)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function wO(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sv(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function fy(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function py(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function KY(n,e){const t=new XY(n,e);return t.subscribe.bind(t)}class XY{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");ZY(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=DE),r.error===void 0&&(r.error=DE),r.complete===void 0&&(r.complete=DE);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ZY(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function DE(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(n){return n&&n._delegate?n._delegate:n}class Eh{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YY{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new RY;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(JY(e))try{this.getOrInitializeService({instanceIdentifier:Gd})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Gd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Gd){return this.instances.has(e)}getOptions(e=Gd){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(i);s===o&&a.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:QY(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Gd){return this.component?this.component.multipleInstances?e:Gd:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function QY(n){return n===Gd?void 0:n}function JY(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eQ{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new YY(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nn;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(nn||(nn={}));const tQ={debug:nn.DEBUG,verbose:nn.VERBOSE,info:nn.INFO,warn:nn.WARN,error:nn.ERROR,silent:nn.SILENT},nQ=nn.INFO,sQ={[nn.DEBUG]:"log",[nn.VERBOSE]:"log",[nn.INFO]:"info",[nn.WARN]:"warn",[nn.ERROR]:"error"},rQ=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=sQ[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let IC=class{constructor(e){this.name=e,this._logLevel=nQ,this._logHandler=rQ,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in nn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tQ[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,nn.DEBUG,...e),this._logHandler(this,nn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,nn.VERBOSE,...e),this._logHandler(this,nn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,nn.INFO,...e),this._logHandler(this,nn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,nn.WARN,...e),this._logHandler(this,nn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,nn.ERROR,...e),this._logHandler(this,nn.ERROR,...e)}};const iQ=(n,e)=>e.some(t=>n instanceof t);let TO,SO;function aQ(){return TO||(TO=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function oQ(){return SO||(SO=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const VF=new WeakMap,CN=new WeakMap,UF=new WeakMap,LE=new WeakMap,CC=new WeakMap;function lQ(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(gh(n.result)),r()},a=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&VF.set(t,n)}).catch(()=>{}),CC.set(e,n),e}function cQ(n){if(CN.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});CN.set(n,e)}let kN={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return CN.get(n);if(e==="objectStoreNames")return n.objectStoreNames||UF.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return gh(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function uQ(n){kN=n(kN)}function hQ(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(OE(this),e,...t);return UF.set(s,e.sort?e.sort():[e]),gh(s)}:oQ().includes(n)?function(...e){return n.apply(OE(this),e),gh(VF.get(this))}:function(...e){return gh(n.apply(OE(this),e))}}function dQ(n){return typeof n=="function"?hQ(n):(n instanceof IDBTransaction&&cQ(n),iQ(n,aQ())?new Proxy(n,kN):n)}function gh(n){if(n instanceof IDBRequest)return lQ(n);if(LE.has(n))return LE.get(n);const e=dQ(n);return e!==n&&(LE.set(n,e),CC.set(e,n)),e}const OE=n=>CC.get(n);function fQ(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const a=indexedDB.open(n,e),o=gh(a);return s&&a.addEventListener("upgradeneeded",l=>{s(gh(a.result),l.oldVersion,l.newVersion,gh(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const pQ=["get","getKey","getAll","getAllKeys","count"],mQ=["put","add","delete","clear"],PE=new Map;function EO(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(PE.get(e))return PE.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=mQ.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||pQ.includes(t)))return;const i=async function(a,...o){const l=this.transaction(a,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),r&&l.done]))[0]};return PE.set(e,i),i}uQ(n=>({...n,get:(e,t,s)=>EO(e,t)||n.get(e,t,s),has:(e,t)=>!!EO(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gQ{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(yQ(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function yQ(n){return n.getComponent()?.type==="VERSION"}const $N="@firebase/app",NO="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc=new IC("@firebase/app"),vQ="@firebase/app-compat",bQ="@firebase/analytics-compat",_Q="@firebase/analytics",xQ="@firebase/app-check-compat",wQ="@firebase/app-check",TQ="@firebase/auth",SQ="@firebase/auth-compat",EQ="@firebase/database",NQ="@firebase/data-connect",IQ="@firebase/database-compat",CQ="@firebase/functions",kQ="@firebase/functions-compat",$Q="@firebase/installations",AQ="@firebase/installations-compat",RQ="@firebase/messaging",DQ="@firebase/messaging-compat",LQ="@firebase/performance",OQ="@firebase/performance-compat",PQ="@firebase/remote-config",MQ="@firebase/remote-config-compat",FQ="@firebase/storage",jQ="@firebase/storage-compat",BQ="@firebase/firestore",zQ="@firebase/ai",VQ="@firebase/firestore-compat",UQ="firebase",GQ="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AN="[DEFAULT]",WQ={[$N]:"fire-core",[vQ]:"fire-core-compat",[_Q]:"fire-analytics",[bQ]:"fire-analytics-compat",[wQ]:"fire-app-check",[xQ]:"fire-app-check-compat",[TQ]:"fire-auth",[SQ]:"fire-auth-compat",[EQ]:"fire-rtdb",[NQ]:"fire-data-connect",[IQ]:"fire-rtdb-compat",[CQ]:"fire-fn",[kQ]:"fire-fn-compat",[$Q]:"fire-iid",[AQ]:"fire-iid-compat",[RQ]:"fire-fcm",[DQ]:"fire-fcm-compat",[LQ]:"fire-perf",[OQ]:"fire-perf-compat",[PQ]:"fire-rc",[MQ]:"fire-rc-compat",[FQ]:"fire-gcs",[jQ]:"fire-gcs-compat",[BQ]:"fire-fst",[VQ]:"fire-fst-compat",[zQ]:"fire-vertex","fire-js":"fire-js",[UQ]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0=new Map,HQ=new Map,RN=new Map;function IO(n,e){try{n.container.addComponent(e)}catch(t){Wc.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function df(n){const e=n.name;if(RN.has(e))return Wc.debug(`There were multiple attempts to register component ${e}.`),!1;RN.set(e,n);for(const t of g0.values())IO(t,n);for(const t of HQ.values())IO(t,n);return!0}function $1(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function wa(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qQ={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yh=new Tv("app","Firebase",qQ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KQ{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Eh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yh.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bf=GQ;function GF(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:AN,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw yh.create("bad-app-name",{appName:String(r)});if(t||(t=jF()),!t)throw yh.create("no-options");const i=g0.get(r);if(i){if(hf(t,i.options)&&hf(s,i.config))return i;throw yh.create("duplicate-app",{appName:r})}const a=new eQ(r);for(const l of RN.values())a.addComponent(l);const o=new KQ(t,s,a);return g0.set(r,o),o}function kC(n=AN){const e=g0.get(n);if(!e&&n===AN&&jF())return GF();if(!e)throw yh.create("no-app",{appName:n});return e}function Al(n,e,t){let s=WQ[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wc.warn(a.join(" "));return}df(new Eh(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XQ="firebase-heartbeat-database",ZQ=1,By="firebase-heartbeat-store";let ME=null;function WF(){return ME||(ME=fQ(XQ,ZQ,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(By)}catch(t){console.warn(t)}}}}).catch(n=>{throw yh.create("idb-open",{originalErrorMessage:n.message})})),ME}async function YQ(n){try{const t=(await WF()).transaction(By),s=await t.objectStore(By).get(HF(n));return await t.done,s}catch(e){if(e instanceof ic)Wc.warn(e.message);else{const t=yh.create("idb-get",{originalErrorMessage:e?.message});Wc.warn(t.message)}}}async function CO(n,e){try{const s=(await WF()).transaction(By,"readwrite");await s.objectStore(By).put(e,HF(n)),await s.done}catch(t){if(t instanceof ic)Wc.warn(t.message);else{const s=yh.create("idb-set",{originalErrorMessage:t?.message});Wc.warn(s.message)}}}function HF(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QQ=1024,JQ=30;class eJ{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nJ(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=kO();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>JQ){const r=sJ(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Wc.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=kO(),{heartbeatsToSend:t,unsentEntries:s}=tJ(this._heartbeatsCache.heartbeats),r=m0(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Wc.warn(e),""}}}function kO(){return new Date().toISOString().substring(0,10)}function tJ(n,e=QQ){const t=[];let s=n.slice();for(const r of n){const i=t.find(a=>a.agent===r.agent);if(i){if(i.dates.push(r.date),$O(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),$O(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class nJ{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VY()?UY().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await YQ(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return CO(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return CO(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function $O(n){return m0(JSON.stringify({version:2,heartbeats:n})).length}function sJ(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rJ(n){df(new Eh("platform-logger",e=>new gQ(e),"PRIVATE")),df(new Eh("heartbeat",e=>new eJ(e),"PRIVATE")),Al($N,NO,n),Al($N,NO,"esm2020"),Al("fire-js","")}rJ("");var iJ="firebase",aJ="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Al(iJ,aJ,"app");function qF(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const oJ=qF,KF=new Tv("auth","Firebase",qF());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y0=new IC("@firebase/auth");function lJ(n,...e){y0.logLevel<=nn.WARN&&y0.warn(`Auth (${Bf}): ${n}`,...e)}function Vx(n,...e){y0.logLevel<=nn.ERROR&&y0.error(`Auth (${Bf}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ho(n,...e){throw $C(n,...e)}function Rl(n,...e){return $C(n,...e)}function XF(n,e,t){const s={...oJ(),[e]:t};return new Tv("auth","Firebase",s).create(e,{appName:n.name})}function Bc(n){return XF(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function $C(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return KF.create(n,...e)}function St(n,e,...t){if(!n)throw $C(e,...t)}function Pc(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Vx(e),new Error(e)}function Hc(n,e){n||Pc(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DN(){return typeof self<"u"&&self.location?.href||""}function cJ(){return AO()==="http:"||AO()==="https:"}function AO(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uJ(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(cJ()||FY()||"connection"in navigator)?navigator.onLine:!0}function hJ(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e,t){this.shortDelay=e,this.longDelay=t,Hc(t>e,"Short delay should be less than long delay!"),this.isMobile=OY()||jY()}get(){return uJ()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AC(n,e){Hc(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZF{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Pc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Pc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Pc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dJ={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fJ=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],pJ=new Ev(3e4,6e4);function Wh(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Hh(n,e,t,s,r={}){return YF(n,r,async()=>{let i={},a={};s&&(e==="GET"?a=s:i={body:JSON.stringify(s)});const o=Sv({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...i};return MY()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&Gh(n.emulatorConfig.host)&&(c.credentials="include"),ZF.fetch()(await QF(n,n.config.apiHost,t,o),c)})}async function YF(n,e,t){n._canInitEmulator=!1;const s={...dJ,...e};try{const r=new gJ(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw yx(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const o=i.ok?a.errorMessage:a.error.message,[l,c]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw yx(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw yx(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw yx(n,"user-disabled",a);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw XF(n,h,c);Ho(n,h)}}catch(r){if(r instanceof ic)throw r;Ho(n,"network-request-failed",{message:String(r)})}}async function Nv(n,e,t,s,r={}){const i=await Hh(n,e,t,s,r);return"mfaPendingCredential"in i&&Ho(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function QF(n,e,t,s){const r=`${e}${t}?${s}`,i=n,a=i.config.emulator?AC(n.config,r):`${n.config.apiScheme}://${r}`;return fJ.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function mJ(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class gJ{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Rl(this.auth,"network-request-failed")),pJ.get())})}}function yx(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=Rl(n,e,s);return r.customData._tokenResponse=t,r}function RO(n){return n!==void 0&&n.enterprise!==void 0}class yJ{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return mJ(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function vJ(n,e){return Hh(n,"GET","/v2/recaptchaConfig",Wh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bJ(n,e){return Hh(n,"POST","/v1/accounts:delete",e)}async function v0(n,e){return Hh(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ky(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function _J(n,e=!1){const t=Fs(n),s=await t.getIdToken(e),r=RC(s);St(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,a=i?.sign_in_provider;return{claims:r,token:s,authTime:ky(FE(r.auth_time)),issuedAtTime:ky(FE(r.iat)),expirationTime:ky(FE(r.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function FE(n){return Number(n)*1e3}function RC(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Vx("JWT malformed, contained fewer than 3 sections"),null;try{const r=PF(t);return r?JSON.parse(r):(Vx("Failed to decode base64 JWT payload"),null)}catch(r){return Vx("Caught error parsing JWT payload as JSON",r?.toString()),null}}function DO(n){const e=RC(n);return St(e,"internal-error"),St(typeof e.exp<"u","internal-error"),St(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zy(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof ic&&xJ(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function xJ({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wJ{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ky(this.lastLoginAt),this.creationTime=ky(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b0(n){const e=n.auth,t=await n.getIdToken(),s=await zy(n,v0(e,{idToken:t}));St(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=r.providerUserInfo?.length?JF(r.providerUserInfo):[],a=SJ(n.providerData,i),o=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!a?.length,c=o?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new LN(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(n,h)}async function TJ(n){const e=Fs(n);await b0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function SJ(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function JF(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EJ(n,e){const t=await YF(n,{},async()=>{const s=Sv({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,a=await QF(n,r,"/v1/token",`key=${i}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:s};return n.emulatorConfig&&Gh(n.emulatorConfig.host)&&(l.credentials="include"),ZF.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function NJ(n,e){return Hh(n,"POST","/v2/accounts:revokeToken",Wh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){St(e.idToken,"internal-error"),St(typeof e.idToken<"u","internal-error"),St(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):DO(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){St(e.length!==0,"internal-error");const t=DO(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(St(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await EJ(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,a=new em;return s&&(St(typeof s=="string","internal-error",{appName:e}),a.refreshToken=s),r&&(St(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),i&&(St(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new em,this.toJSON())}_performRefresh(){return Pc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ju(n,e){St(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class jo{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new wJ(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new LN(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await zy(this,this.stsTokenManager.getToken(this.auth,e));return St(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return _J(this,e)}reload(){return TJ(this)}_assign(e){this!==e&&(St(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new jo({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){St(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await b0(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(wa(this.auth.app))return Promise.reject(Bc(this.auth));const e=await this.getIdToken();return await zy(this,bJ(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:v,providerData:_,stsTokenManager:w}=t;St(p&&w,e,"internal-error");const T=em.fromJSON(this.name,w);St(typeof p=="string",e,"internal-error"),Ju(s,e.name),Ju(r,e.name),St(typeof m=="boolean",e,"internal-error"),St(typeof v=="boolean",e,"internal-error"),Ju(i,e.name),Ju(a,e.name),Ju(o,e.name),Ju(l,e.name),Ju(c,e.name),Ju(h,e.name);const E=new jo({uid:p,auth:e,email:r,emailVerified:m,displayName:s,isAnonymous:v,photoURL:a,phoneNumber:i,tenantId:o,stsTokenManager:T,createdAt:c,lastLoginAt:h});return _&&Array.isArray(_)&&(E.providerData=_.map(C=>({...C}))),l&&(E._redirectEventId=l),E}static async _fromIdTokenResponse(e,t,s=!1){const r=new em;r.updateFromServerResponse(t);const i=new jo({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await b0(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];St(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?JF(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!i?.length,o=new em;o.updateFromIdToken(s);const l=new jo({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new LN(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LO=new Map;function Mc(n){Hc(n instanceof Function,"Expected a class definition");let e=LO.get(n);return e?(Hc(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,LO.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ej.type="NONE";const OO=ej;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ux(n,e,t){return`firebase:${n}:${e}:${t}`}class tm{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=Ux(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ux("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await v0(this.auth,{idToken:e}).catch(()=>{});return t?jo._fromGetAccountInfoResponse(this.auth,t,e):null}return jo._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new tm(Mc(OO),e,s);const r=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=r[0]||Mc(OO);const a=Ux(s,e.config.apiKey,e.name);let o=null;for(const c of t)try{const h=await c._get(a);if(h){let p;if(typeof h=="string"){const m=await v0(e,{idToken:h}).catch(()=>{});if(!m)break;p=await jo._fromGetAccountInfoResponse(e,m,h)}else p=jo._fromJSON(e,h);c!==i&&(o=p),i=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new tm(i,e,s):(i=l[0],o&&await i._set(a,o.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(a)}catch{}})),new tm(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PO(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rj(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(tj(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(aj(e))return"Blackberry";if(oj(e))return"Webos";if(nj(e))return"Safari";if((e.includes("chrome/")||sj(e))&&!e.includes("edge/"))return"Chrome";if(ij(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function tj(n=gi()){return/firefox\//i.test(n)}function nj(n=gi()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function sj(n=gi()){return/crios\//i.test(n)}function rj(n=gi()){return/iemobile/i.test(n)}function ij(n=gi()){return/android/i.test(n)}function aj(n=gi()){return/blackberry/i.test(n)}function oj(n=gi()){return/webos/i.test(n)}function DC(n=gi()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function IJ(n=gi()){return DC(n)&&!!window.navigator?.standalone}function CJ(){return BY()&&document.documentMode===10}function lj(n=gi()){return DC(n)||ij(n)||oj(n)||aj(n)||/windows phone/i.test(n)||rj(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cj(n,e=[]){let t;switch(n){case"Browser":t=PO(gi());break;case"Worker":t=`${PO(gi())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Bf}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kJ{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((a,o)=>{try{const l=e(i);a(l)}catch(l){o(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $J(n,e={}){return Hh(n,"GET","/v2/passwordPolicy",Wh(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AJ=6;class RJ{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??AJ,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DJ{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new MO(this),this.idTokenSubscription=new MO(this),this.beforeStateQueue=new kJ(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=KF,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Mc(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await tm.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await v0(this,{idToken:e}),s=await jo._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(wa(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=s?._redirectEventId,o=await this.tryRedirectSignIn(e);(!i||i===a)&&o?.user&&(s=o.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return St(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await b0(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=hJ()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(wa(this.app))return Promise.reject(Bc(this));const t=e?Fs(e):null;return t&&St(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&St(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return wa(this.app)?Promise.reject(Bc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return wa(this.app)?Promise.reject(Bc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mc(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $J(this),t=new RJ(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Tv("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await NJ(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Mc(e)||this._popupRedirectResolver;St(t,this,"argument-error"),this.redirectPersistenceManager=await tm.create(this,[Mc(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(St(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return St(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cj(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(wa(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&lJ(`Error while retrieving App Check token: ${e.error}`),e?.token}}function zf(n){return Fs(n)}class MO{constructor(e){this.auth=e,this.observer=null,this.addObserver=KY(t=>this.observer=t)}get next(){return St(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let A1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function LJ(n){A1=n}function uj(n){return A1.loadJS(n)}function OJ(){return A1.recaptchaEnterpriseScript}function PJ(){return A1.gapiScript}function MJ(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class FJ{constructor(){this.enterprise=new jJ}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class jJ{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const BJ="recaptcha-enterprise",hj="NO_RECAPTCHA";class zJ{constructor(e){this.type=BJ,this.auth=zf(e)}async verify(e="verify",t=!1){async function s(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,o)=>{vJ(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const c=new yJ(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,a(c.siteKey)}}).catch(l=>{o(l)})})}function r(i,a,o){const l=window.grecaptcha;RO(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{a(c)}).catch(()=>{a(hj)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new FJ().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{s(this.auth).then(o=>{if(!t&&RO(window.grecaptcha))r(o,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=OJ();l.length!==0&&(l+=o),uj(l).then(()=>{r(o,i,a)}).catch(c=>{a(c)})}}).catch(o=>{a(o)})})}}async function FO(n,e,t,s=!1,r=!1){const i=new zJ(n);let a;if(r)a=hj;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,c=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return s?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function ON(n,e,t,s,r){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await FO(n,e,t,t==="getOobCode");return s(n,i)}else return s(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await FO(n,e,t,t==="getOobCode");return s(n,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VJ(n,e){const t=$1(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(hf(i,e??{}))return r;Ho(r,"already-initialized")}return t.initialize({options:e})}function UJ(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Mc);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function GJ(n,e,t){const s=zf(n);St(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=dj(e),{host:a,port:o}=WJ(e),l=o===null?"":`:${o}`,c={url:`${i}//${a}${l}/`},h=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){St(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),St(hf(c,s.config.emulator)&&hf(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=c,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,Gh(a)?(EC(`${i}//${a}${l}`),NC("Auth",!0)):HJ()}function dj(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function WJ(n){const e=dj(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:jO(s.substr(i.length+1))}}else{const[i,a]=s.split(":");return{host:i,port:jO(a)}}}function jO(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function HJ(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Pc("not implemented")}_getIdTokenResponse(e){return Pc("not implemented")}_linkToIdToken(e,t){return Pc("not implemented")}_getReauthenticationResolver(e){return Pc("not implemented")}}async function qJ(n,e){return Hh(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KJ(n,e){return Nv(n,"POST","/v1/accounts:signInWithPassword",Wh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XJ(n,e){return Nv(n,"POST","/v1/accounts:signInWithEmailLink",Wh(n,e))}async function ZJ(n,e){return Nv(n,"POST","/v1/accounts:signInWithEmailLink",Wh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy extends LC{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Vy(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new Vy(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ON(e,t,"signInWithPassword",KJ);case"emailLink":return XJ(e,{email:this._email,oobCode:this._password});default:Ho(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ON(e,s,"signUpPassword",qJ);case"emailLink":return ZJ(e,{idToken:t,email:this._email,oobCode:this._password});default:Ho(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nm(n,e){return Nv(n,"POST","/v1/accounts:signInWithIdp",Wh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YJ="http://localhost";class ff extends LC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ff(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ho("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const a=new ff(s,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return nm(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,nm(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,nm(e,t)}buildRequest(){const e={requestUri:YJ,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Sv(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QJ(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function JJ(n){const e=fy(py(n)).link,t=e?fy(py(e)).deep_link_id:null,s=fy(py(n)).deep_link_id;return(s?fy(py(s)).link:null)||s||t||e||n}class OC{constructor(e){const t=fy(py(e)),s=t.apiKey??null,r=t.oobCode??null,i=QJ(t.mode??null);St(s&&r&&i,"argument-error"),this.apiKey=s,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=JJ(e);try{return new OC(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm{constructor(){this.providerId=Bm.PROVIDER_ID}static credential(e,t){return Vy._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=OC.parseLink(t);return St(s,"argument-error"),Vy._fromEmailAndCode(e,s.code,s.tenantId)}}Bm.PROVIDER_ID="password";Bm.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bm.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv extends fj{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh extends Iv{constructor(){super("facebook.com")}static credential(e){return ff._fromParams({providerId:sh.PROVIDER_ID,signInMethod:sh.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sh.credentialFromTaggedObject(e)}static credentialFromError(e){return sh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sh.credential(e.oauthAccessToken)}catch{return null}}}sh.FACEBOOK_SIGN_IN_METHOD="facebook.com";sh.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh extends Iv{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ff._fromParams({providerId:rh.PROVIDER_ID,signInMethod:rh.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rh.credentialFromTaggedObject(e)}static credentialFromError(e){return rh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return rh.credential(t,s)}catch{return null}}}rh.GOOGLE_SIGN_IN_METHOD="google.com";rh.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih extends Iv{constructor(){super("github.com")}static credential(e){return ff._fromParams({providerId:ih.PROVIDER_ID,signInMethod:ih.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ih.credentialFromTaggedObject(e)}static credentialFromError(e){return ih.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ih.credential(e.oauthAccessToken)}catch{return null}}}ih.GITHUB_SIGN_IN_METHOD="github.com";ih.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah extends Iv{constructor(){super("twitter.com")}static credential(e,t){return ff._fromParams({providerId:ah.PROVIDER_ID,signInMethod:ah.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ah.credentialFromTaggedObject(e)}static credentialFromError(e){return ah.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return ah.credential(t,s)}catch{return null}}}ah.TWITTER_SIGN_IN_METHOD="twitter.com";ah.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eee(n,e){return Nv(n,"POST","/v1/accounts:signUp",Wh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await jo._fromIdTokenResponse(e,s,r),a=BO(s);return new pf({user:i,providerId:a,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=BO(s);return new pf({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function BO(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0 extends ic{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,_0.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new _0(e,t,s,r)}}function pj(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?_0._fromErrorAndOperation(n,i,e,s):i})}async function tee(n,e,t=!1){const s=await zy(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return pf._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nee(n,e,t=!1){const{auth:s}=n;if(wa(s.app))return Promise.reject(Bc(s));const r="reauthenticate";try{const i=await zy(n,pj(s,r,e,n),t);St(i.idToken,s,"internal-error");const a=RC(i.idToken);St(a,s,"internal-error");const{sub:o}=a;return St(n.uid===o,s,"user-mismatch"),pf._forOperation(n,r,i)}catch(i){throw i?.code==="auth/user-not-found"&&Ho(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mj(n,e,t=!1){if(wa(n.app))return Promise.reject(Bc(n));const s="signIn",r=await pj(n,s,e),i=await pf._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}async function see(n,e){return mj(zf(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gj(n){const e=zf(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function ree(n,e,t){if(wa(n.app))return Promise.reject(Bc(n));const s=zf(n),a=await ON(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eee).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&gj(n),l}),o=await pf._fromIdTokenResponse(s,"signIn",a);return await s._updateCurrentUser(o.user),o}function iee(n,e,t){return wa(n.app)?Promise.reject(Bc(n)):see(Fs(n),Bm.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&gj(n),s})}function aee(n,e,t,s){return Fs(n).onIdTokenChanged(e,t,s)}function oee(n,e,t){return Fs(n).beforeAuthStateChanged(e,t)}function PC(n,e,t,s){return Fs(n).onAuthStateChanged(e,t,s)}const x0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yj{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(x0,"1"),this.storage.removeItem(x0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lee=1e3,cee=10;class vj extends yj{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=lj(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(s);!t&&this.localCache[s]===a||this.notifyListeners(s,a)},i=this.storage.getItem(s);CJ()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,cee):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},lee)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}vj.type="LOCAL";const uee=vj;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj extends yj{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}bj.type="SESSION";const _j=bj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hee(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new R1(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const o=Array.from(a).map(async c=>c(t.origin,i)),l=await hee(o);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}R1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MC(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dee{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,a;return new Promise((o,l)=>{const c=MC("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);a={messageChannel:r,onMessage(p){const m=p;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(m.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dl(){return window}function fee(n){Dl().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xj(){return typeof Dl().WorkerGlobalScope<"u"&&typeof Dl().importScripts=="function"}async function pee(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mee(){return navigator?.serviceWorker?.controller||null}function gee(){return xj()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj="firebaseLocalStorageDb",yee=1,w0="firebaseLocalStorage",Tj="fbase_key";class Cv{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function D1(n,e){return n.transaction([w0],e?"readwrite":"readonly").objectStore(w0)}function vee(){const n=indexedDB.deleteDatabase(wj);return new Cv(n).toPromise()}function PN(){const n=indexedDB.open(wj,yee);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(w0,{keyPath:Tj})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(w0)?e(s):(s.close(),await vee(),e(await PN()))})})}async function zO(n,e,t){const s=D1(n,!0).put({[Tj]:e,value:t});return new Cv(s).toPromise()}async function bee(n,e){const t=D1(n,!1).get(e),s=await new Cv(t).toPromise();return s===void 0?null:s.value}function VO(n,e){const t=D1(n,!0).delete(e);return new Cv(t).toPromise()}const _ee=800,xee=3;class Sj{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await PN(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>xee)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xj()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=R1._getInstance(gee()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await pee(),!this.activeServiceWorker)return;this.sender=new dee(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mee()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await PN();return await zO(e,x0,"1"),await VO(e,x0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>zO(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>bee(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>VO(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=D1(r,!1).getAll();return new Cv(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_ee)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Sj.type="LOCAL";const wee=Sj;new Ev(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tee(n,e){return e?Mc(e):(St(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC extends LC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nm(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nm(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nm(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function See(n){return mj(n.auth,new FC(n),n.bypassAuthState)}function Eee(n){const{auth:e,user:t}=n;return St(t,e,"internal-error"),nee(t,new FC(n),n.bypassAuthState)}async function Nee(n){const{auth:e,user:t}=n;return St(t,e,"internal-error"),tee(t,new FC(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return See;case"linkViaPopup":case"linkViaRedirect":return Nee;case"reauthViaPopup":case"reauthViaRedirect":return Eee;default:Ho(this.auth,"internal-error")}}resolve(e){Hc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Hc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iee=new Ev(2e3,1e4);class Yp extends Ej{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Yp.currentPopupAction&&Yp.currentPopupAction.cancel(),Yp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return St(e,this.auth,"internal-error"),e}async onExecution(){Hc(this.filter.length===1,"Popup operations only handle one event");const e=MC();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Rl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Rl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yp.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Rl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Iee.get())};e()}}Yp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cee="pendingRedirect",Gx=new Map;class kee extends Ej{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Gx.get(this.auth._key());if(!e){try{const s=await $ee(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Gx.set(this.auth._key(),e)}return this.bypassAuthState||Gx.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $ee(n,e){const t=Dee(e),s=Ree(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function Aee(n,e){Gx.set(n._key(),e)}function Ree(n){return Mc(n._redirectPersistence)}function Dee(n){return Ux(Cee,n.config.apiKey,n.name)}async function Lee(n,e,t=!1){if(wa(n.app))return Promise.reject(Bc(n));const s=zf(n),r=Tee(s,e),a=await new kee(s,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oee=600*1e3;class Pee{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Mee(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Nj(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Rl(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Oee&&this.cachedEventUids.clear(),this.cachedEventUids.has(UO(e))}saveEventToCache(e){this.cachedEventUids.add(UO(e)),this.lastProcessedEventTime=Date.now()}}function UO(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Nj({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Mee(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Nj(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fee(n,e={}){return Hh(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jee=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Bee=/^https?/;async function zee(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Fee(n);for(const t of e)try{if(Vee(t))return}catch{}Ho(n,"unauthorized-domain")}function Vee(n){const e=DN(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===s}if(!Bee.test(t))return!1;if(jee.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uee=new Ev(3e4,6e4);function GO(){const n=Dl().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Gee(n){return new Promise((e,t)=>{function s(){GO(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{GO(),t(Rl(n,"network-request-failed"))},timeout:Uee.get()})}if(Dl().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Dl().gapi?.load)s();else{const r=MJ("iframefcb");return Dl()[r]=()=>{gapi.load?s():t(Rl(n,"network-request-failed"))},uj(`${PJ()}?onload=${r}`).catch(i=>t(i))}}).catch(e=>{throw Wx=null,e})}let Wx=null;function Wee(n){return Wx=Wx||Gee(n),Wx}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hee=new Ev(5e3,15e3),qee="__/auth/iframe",Kee="emulator/auth/iframe",Xee={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Zee=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Yee(n){const e=n.config;St(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?AC(e,Kee):`https://${n.config.authDomain}/${qee}`,s={apiKey:e.apiKey,appName:n.name,v:Bf},r=Zee.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${Sv(s).slice(1)}`}async function Qee(n){const e=await Wee(n),t=Dl().gapi;return St(t,n,"internal-error"),e.open({where:document.body,url:Yee(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Xee,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const a=Rl(n,"network-request-failed"),o=Dl().setTimeout(()=>{i(a)},Hee.get());function l(){Dl().clearTimeout(o),r(s)}s.ping(l).then(l,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jee={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ete=500,tte=600,nte="_blank",ste="http://localhost";class WO{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rte(n,e,t,s=ete,r=tte){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let o="";const l={...Jee,width:s.toString(),height:r.toString(),top:i,left:a},c=gi().toLowerCase();t&&(o=sj(c)?nte:t),tj(c)&&(e=e||ste,l.scrollbars="yes");const h=Object.entries(l).reduce((m,[v,_])=>`${m}${v}=${_},`,"");if(IJ(c)&&o!=="_self")return ite(e||"",o),new WO(null);const p=window.open(e||"",o,h);St(p,n,"popup-blocked");try{p.focus()}catch{}return new WO(p)}function ite(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ate="__/auth/handler",ote="emulator/auth/handler",lte=encodeURIComponent("fac");async function HO(n,e,t,s,r,i){St(n.config.authDomain,n,"auth-domain-config-required"),St(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:Bf,eventId:r};if(e instanceof fj){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",qY(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,p]of Object.entries({}))a[h]=p}if(e instanceof Iv){const h=e.getScopes().filter(p=>p!=="");h.length>0&&(a.scopes=h.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const h of Object.keys(o))o[h]===void 0&&delete o[h];const l=await n._getAppCheckToken(),c=l?`#${lte}=${encodeURIComponent(l)}`:"";return`${cte(n)}?${Sv(o).slice(1)}${c}`}function cte({config:n}){return n.emulator?AC(n,ote):`https://${n.authDomain}/${ate}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE="webStorageSupport";class ute{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_j,this._completeRedirectFn=Lee,this._overrideRedirectResult=Aee}async _openPopup(e,t,s,r){Hc(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await HO(e,t,s,DN(),r);return rte(e,i,MC())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await HO(e,t,s,DN(),r);return fee(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Hc(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await Qee(e),s=new Pee(e);return t.register("authEvent",r=>(St(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jE,{type:jE},r=>{const i=r?.[0]?.[jE];i!==void 0&&t(!!i),Ho(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=zee(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return lj()||nj()||DC()}}const hte=ute;var qO="@firebase/auth",KO="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dte{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){St(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fte(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pte(n){df(new Eh("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=s.options;St(a&&!a.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cj(n)},c=new DJ(s,r,i,l);return UJ(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),df(new Eh("auth-internal",e=>{const t=zf(e.getProvider("auth").getImmediate());return(s=>new dte(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Al(qO,KO,fte(n)),Al(qO,KO,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mte=300,gte=BF("authIdTokenMaxAge")||mte;let XO=null;const yte=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>gte)return;const r=t?.token;XO!==r&&(XO=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function vte(n=kC()){const e=$1(n,"auth");if(e.isInitialized())return e.getImmediate();const t=VJ(n,{popupRedirectResolver:hte,persistence:[wee,uee,_j]}),s=BF("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const a=yte(i.toString());oee(t,a,()=>a(t.currentUser)),aee(t,o=>a(o))}}const r=MF("auth");return r&&GJ(t,`http://${r}`),t}function bte(){return document.getElementsByTagName("head")?.[0]??document}LJ({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=Rl("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",bte().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pte("Browser");var ZO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var vh,Ij;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(B,P){function O(){}O.prototype=P.prototype,B.D=P.prototype,B.prototype=new O,B.prototype.constructor=B,B.C=function(M,k,V){for(var G=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)G[ae-2]=arguments[ae];return P.prototype[k].apply(M,G)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(B,P,O){O||(O=0);var M=Array(16);if(typeof P=="string")for(var k=0;16>k;++k)M[k]=P.charCodeAt(O++)|P.charCodeAt(O++)<<8|P.charCodeAt(O++)<<16|P.charCodeAt(O++)<<24;else for(k=0;16>k;++k)M[k]=P[O++]|P[O++]<<8|P[O++]<<16|P[O++]<<24;P=B.g[0],O=B.g[1],k=B.g[2];var V=B.g[3],G=P+(V^O&(k^V))+M[0]+3614090360&4294967295;P=O+(G<<7&4294967295|G>>>25),G=V+(k^P&(O^k))+M[1]+3905402710&4294967295,V=P+(G<<12&4294967295|G>>>20),G=k+(O^V&(P^O))+M[2]+606105819&4294967295,k=V+(G<<17&4294967295|G>>>15),G=O+(P^k&(V^P))+M[3]+3250441966&4294967295,O=k+(G<<22&4294967295|G>>>10),G=P+(V^O&(k^V))+M[4]+4118548399&4294967295,P=O+(G<<7&4294967295|G>>>25),G=V+(k^P&(O^k))+M[5]+1200080426&4294967295,V=P+(G<<12&4294967295|G>>>20),G=k+(O^V&(P^O))+M[6]+2821735955&4294967295,k=V+(G<<17&4294967295|G>>>15),G=O+(P^k&(V^P))+M[7]+4249261313&4294967295,O=k+(G<<22&4294967295|G>>>10),G=P+(V^O&(k^V))+M[8]+1770035416&4294967295,P=O+(G<<7&4294967295|G>>>25),G=V+(k^P&(O^k))+M[9]+2336552879&4294967295,V=P+(G<<12&4294967295|G>>>20),G=k+(O^V&(P^O))+M[10]+4294925233&4294967295,k=V+(G<<17&4294967295|G>>>15),G=O+(P^k&(V^P))+M[11]+2304563134&4294967295,O=k+(G<<22&4294967295|G>>>10),G=P+(V^O&(k^V))+M[12]+1804603682&4294967295,P=O+(G<<7&4294967295|G>>>25),G=V+(k^P&(O^k))+M[13]+4254626195&4294967295,V=P+(G<<12&4294967295|G>>>20),G=k+(O^V&(P^O))+M[14]+2792965006&4294967295,k=V+(G<<17&4294967295|G>>>15),G=O+(P^k&(V^P))+M[15]+1236535329&4294967295,O=k+(G<<22&4294967295|G>>>10),G=P+(k^V&(O^k))+M[1]+4129170786&4294967295,P=O+(G<<5&4294967295|G>>>27),G=V+(O^k&(P^O))+M[6]+3225465664&4294967295,V=P+(G<<9&4294967295|G>>>23),G=k+(P^O&(V^P))+M[11]+643717713&4294967295,k=V+(G<<14&4294967295|G>>>18),G=O+(V^P&(k^V))+M[0]+3921069994&4294967295,O=k+(G<<20&4294967295|G>>>12),G=P+(k^V&(O^k))+M[5]+3593408605&4294967295,P=O+(G<<5&4294967295|G>>>27),G=V+(O^k&(P^O))+M[10]+38016083&4294967295,V=P+(G<<9&4294967295|G>>>23),G=k+(P^O&(V^P))+M[15]+3634488961&4294967295,k=V+(G<<14&4294967295|G>>>18),G=O+(V^P&(k^V))+M[4]+3889429448&4294967295,O=k+(G<<20&4294967295|G>>>12),G=P+(k^V&(O^k))+M[9]+568446438&4294967295,P=O+(G<<5&4294967295|G>>>27),G=V+(O^k&(P^O))+M[14]+3275163606&4294967295,V=P+(G<<9&4294967295|G>>>23),G=k+(P^O&(V^P))+M[3]+4107603335&4294967295,k=V+(G<<14&4294967295|G>>>18),G=O+(V^P&(k^V))+M[8]+1163531501&4294967295,O=k+(G<<20&4294967295|G>>>12),G=P+(k^V&(O^k))+M[13]+2850285829&4294967295,P=O+(G<<5&4294967295|G>>>27),G=V+(O^k&(P^O))+M[2]+4243563512&4294967295,V=P+(G<<9&4294967295|G>>>23),G=k+(P^O&(V^P))+M[7]+1735328473&4294967295,k=V+(G<<14&4294967295|G>>>18),G=O+(V^P&(k^V))+M[12]+2368359562&4294967295,O=k+(G<<20&4294967295|G>>>12),G=P+(O^k^V)+M[5]+4294588738&4294967295,P=O+(G<<4&4294967295|G>>>28),G=V+(P^O^k)+M[8]+2272392833&4294967295,V=P+(G<<11&4294967295|G>>>21),G=k+(V^P^O)+M[11]+1839030562&4294967295,k=V+(G<<16&4294967295|G>>>16),G=O+(k^V^P)+M[14]+4259657740&4294967295,O=k+(G<<23&4294967295|G>>>9),G=P+(O^k^V)+M[1]+2763975236&4294967295,P=O+(G<<4&4294967295|G>>>28),G=V+(P^O^k)+M[4]+1272893353&4294967295,V=P+(G<<11&4294967295|G>>>21),G=k+(V^P^O)+M[7]+4139469664&4294967295,k=V+(G<<16&4294967295|G>>>16),G=O+(k^V^P)+M[10]+3200236656&4294967295,O=k+(G<<23&4294967295|G>>>9),G=P+(O^k^V)+M[13]+681279174&4294967295,P=O+(G<<4&4294967295|G>>>28),G=V+(P^O^k)+M[0]+3936430074&4294967295,V=P+(G<<11&4294967295|G>>>21),G=k+(V^P^O)+M[3]+3572445317&4294967295,k=V+(G<<16&4294967295|G>>>16),G=O+(k^V^P)+M[6]+76029189&4294967295,O=k+(G<<23&4294967295|G>>>9),G=P+(O^k^V)+M[9]+3654602809&4294967295,P=O+(G<<4&4294967295|G>>>28),G=V+(P^O^k)+M[12]+3873151461&4294967295,V=P+(G<<11&4294967295|G>>>21),G=k+(V^P^O)+M[15]+530742520&4294967295,k=V+(G<<16&4294967295|G>>>16),G=O+(k^V^P)+M[2]+3299628645&4294967295,O=k+(G<<23&4294967295|G>>>9),G=P+(k^(O|~V))+M[0]+4096336452&4294967295,P=O+(G<<6&4294967295|G>>>26),G=V+(O^(P|~k))+M[7]+1126891415&4294967295,V=P+(G<<10&4294967295|G>>>22),G=k+(P^(V|~O))+M[14]+2878612391&4294967295,k=V+(G<<15&4294967295|G>>>17),G=O+(V^(k|~P))+M[5]+4237533241&4294967295,O=k+(G<<21&4294967295|G>>>11),G=P+(k^(O|~V))+M[12]+1700485571&4294967295,P=O+(G<<6&4294967295|G>>>26),G=V+(O^(P|~k))+M[3]+2399980690&4294967295,V=P+(G<<10&4294967295|G>>>22),G=k+(P^(V|~O))+M[10]+4293915773&4294967295,k=V+(G<<15&4294967295|G>>>17),G=O+(V^(k|~P))+M[1]+2240044497&4294967295,O=k+(G<<21&4294967295|G>>>11),G=P+(k^(O|~V))+M[8]+1873313359&4294967295,P=O+(G<<6&4294967295|G>>>26),G=V+(O^(P|~k))+M[15]+4264355552&4294967295,V=P+(G<<10&4294967295|G>>>22),G=k+(P^(V|~O))+M[6]+2734768916&4294967295,k=V+(G<<15&4294967295|G>>>17),G=O+(V^(k|~P))+M[13]+1309151649&4294967295,O=k+(G<<21&4294967295|G>>>11),G=P+(k^(O|~V))+M[4]+4149444226&4294967295,P=O+(G<<6&4294967295|G>>>26),G=V+(O^(P|~k))+M[11]+3174756917&4294967295,V=P+(G<<10&4294967295|G>>>22),G=k+(P^(V|~O))+M[2]+718787259&4294967295,k=V+(G<<15&4294967295|G>>>17),G=O+(V^(k|~P))+M[9]+3951481745&4294967295,B.g[0]=B.g[0]+P&4294967295,B.g[1]=B.g[1]+(k+(G<<21&4294967295|G>>>11))&4294967295,B.g[2]=B.g[2]+k&4294967295,B.g[3]=B.g[3]+V&4294967295}s.prototype.u=function(B,P){P===void 0&&(P=B.length);for(var O=P-this.blockSize,M=this.B,k=this.h,V=0;V<P;){if(k==0)for(;V<=O;)r(this,B,V),V+=this.blockSize;if(typeof B=="string"){for(;V<P;)if(M[k++]=B.charCodeAt(V++),k==this.blockSize){r(this,M),k=0;break}}else for(;V<P;)if(M[k++]=B[V++],k==this.blockSize){r(this,M),k=0;break}}this.h=k,this.o+=P},s.prototype.v=function(){var B=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);B[0]=128;for(var P=1;P<B.length-8;++P)B[P]=0;var O=8*this.o;for(P=B.length-8;P<B.length;++P)B[P]=O&255,O/=256;for(this.u(B),B=Array(16),P=O=0;4>P;++P)for(var M=0;32>M;M+=8)B[O++]=this.g[P]>>>M&255;return B};function i(B,P){var O=o;return Object.prototype.hasOwnProperty.call(O,B)?O[B]:O[B]=P(B)}function a(B,P){this.h=P;for(var O=[],M=!0,k=B.length-1;0<=k;k--){var V=B[k]|0;M&&V==P||(O[k]=V,M=!1)}this.g=O}var o={};function l(B){return-128<=B&&128>B?i(B,function(P){return new a([P|0],0>P?-1:0)}):new a([B|0],0>B?-1:0)}function c(B){if(isNaN(B)||!isFinite(B))return p;if(0>B)return T(c(-B));for(var P=[],O=1,M=0;B>=O;M++)P[M]=B/O|0,O*=4294967296;return new a(P,0)}function h(B,P){if(B.length==0)throw Error("number format error: empty string");if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(B.charAt(0)=="-")return T(h(B.substring(1),P));if(0<=B.indexOf("-"))throw Error('number format error: interior "-" character');for(var O=c(Math.pow(P,8)),M=p,k=0;k<B.length;k+=8){var V=Math.min(8,B.length-k),G=parseInt(B.substring(k,k+V),P);8>V?(V=c(Math.pow(P,V)),M=M.j(V).add(c(G))):(M=M.j(O),M=M.add(c(G)))}return M}var p=l(0),m=l(1),v=l(16777216);n=a.prototype,n.m=function(){if(w(this))return-T(this).m();for(var B=0,P=1,O=0;O<this.g.length;O++){var M=this.i(O);B+=(0<=M?M:4294967296+M)*P,P*=4294967296}return B},n.toString=function(B){if(B=B||10,2>B||36<B)throw Error("radix out of range: "+B);if(_(this))return"0";if(w(this))return"-"+T(this).toString(B);for(var P=c(Math.pow(B,6)),O=this,M="";;){var k=D(O,P).g;O=E(O,k.j(P));var V=((0<O.g.length?O.g[0]:O.h)>>>0).toString(B);if(O=k,_(O))return V+M;for(;6>V.length;)V="0"+V;M=V+M}},n.i=function(B){return 0>B?0:B<this.g.length?this.g[B]:this.h};function _(B){if(B.h!=0)return!1;for(var P=0;P<B.g.length;P++)if(B.g[P]!=0)return!1;return!0}function w(B){return B.h==-1}n.l=function(B){return B=E(this,B),w(B)?-1:_(B)?0:1};function T(B){for(var P=B.g.length,O=[],M=0;M<P;M++)O[M]=~B.g[M];return new a(O,~B.h).add(m)}n.abs=function(){return w(this)?T(this):this},n.add=function(B){for(var P=Math.max(this.g.length,B.g.length),O=[],M=0,k=0;k<=P;k++){var V=M+(this.i(k)&65535)+(B.i(k)&65535),G=(V>>>16)+(this.i(k)>>>16)+(B.i(k)>>>16);M=G>>>16,V&=65535,G&=65535,O[k]=G<<16|V}return new a(O,O[O.length-1]&-2147483648?-1:0)};function E(B,P){return B.add(T(P))}n.j=function(B){if(_(this)||_(B))return p;if(w(this))return w(B)?T(this).j(T(B)):T(T(this).j(B));if(w(B))return T(this.j(T(B)));if(0>this.l(v)&&0>B.l(v))return c(this.m()*B.m());for(var P=this.g.length+B.g.length,O=[],M=0;M<2*P;M++)O[M]=0;for(M=0;M<this.g.length;M++)for(var k=0;k<B.g.length;k++){var V=this.i(M)>>>16,G=this.i(M)&65535,ae=B.i(k)>>>16,J=B.i(k)&65535;O[2*M+2*k]+=G*J,C(O,2*M+2*k),O[2*M+2*k+1]+=V*J,C(O,2*M+2*k+1),O[2*M+2*k+1]+=G*ae,C(O,2*M+2*k+1),O[2*M+2*k+2]+=V*ae,C(O,2*M+2*k+2)}for(M=0;M<P;M++)O[M]=O[2*M+1]<<16|O[2*M];for(M=P;M<2*P;M++)O[M]=0;return new a(O,0)};function C(B,P){for(;(B[P]&65535)!=B[P];)B[P+1]+=B[P]>>>16,B[P]&=65535,P++}function A(B,P){this.g=B,this.h=P}function D(B,P){if(_(P))throw Error("division by zero");if(_(B))return new A(p,p);if(w(B))return P=D(T(B),P),new A(T(P.g),T(P.h));if(w(P))return P=D(B,T(P)),new A(T(P.g),P.h);if(30<B.g.length){if(w(B)||w(P))throw Error("slowDivide_ only works with positive integers.");for(var O=m,M=P;0>=M.l(B);)O=F(O),M=F(M);var k=W(O,1),V=W(M,1);for(M=W(M,2),O=W(O,2);!_(M);){var G=V.add(M);0>=G.l(B)&&(k=k.add(O),V=G),M=W(M,1),O=W(O,1)}return P=E(B,k.j(P)),new A(k,P)}for(k=p;0<=B.l(P);){for(O=Math.max(1,Math.floor(B.m()/P.m())),M=Math.ceil(Math.log(O)/Math.LN2),M=48>=M?1:Math.pow(2,M-48),V=c(O),G=V.j(P);w(G)||0<G.l(B);)O-=M,V=c(O),G=V.j(P);_(V)&&(V=m),k=k.add(V),B=E(B,G)}return new A(k,B)}n.A=function(B){return D(this,B).h},n.and=function(B){for(var P=Math.max(this.g.length,B.g.length),O=[],M=0;M<P;M++)O[M]=this.i(M)&B.i(M);return new a(O,this.h&B.h)},n.or=function(B){for(var P=Math.max(this.g.length,B.g.length),O=[],M=0;M<P;M++)O[M]=this.i(M)|B.i(M);return new a(O,this.h|B.h)},n.xor=function(B){for(var P=Math.max(this.g.length,B.g.length),O=[],M=0;M<P;M++)O[M]=this.i(M)^B.i(M);return new a(O,this.h^B.h)};function F(B){for(var P=B.g.length+1,O=[],M=0;M<P;M++)O[M]=B.i(M)<<1|B.i(M-1)>>>31;return new a(O,B.h)}function W(B,P){var O=P>>5;P%=32;for(var M=B.g.length-O,k=[],V=0;V<M;V++)k[V]=0<P?B.i(V+O)>>>P|B.i(V+O+1)<<32-P:B.i(V+O);return new a(k,B.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,Ij=s,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=h,vh=a}).apply(typeof ZO<"u"?ZO:typeof self<"u"?self:typeof window<"u"?window:{});var vx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Cj,my,kj,Hx,MN,$j,Aj,Rj;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(S,j,H){return S==Array.prototype||S==Object.prototype||(S[j]=H.value),S};function t(S){S=[typeof globalThis=="object"&&globalThis,S,typeof window=="object"&&window,typeof self=="object"&&self,typeof vx=="object"&&vx];for(var j=0;j<S.length;++j){var H=S[j];if(H&&H.Math==Math)return H}throw Error("Cannot find global object")}var s=t(this);function r(S,j){if(j)e:{var H=s;S=S.split(".");for(var ee=0;ee<S.length-1;ee++){var Ee=S[ee];if(!(Ee in H))break e;H=H[Ee]}S=S[S.length-1],ee=H[S],j=j(ee),j!=ee&&j!=null&&e(H,S,{configurable:!0,writable:!0,value:j})}}function i(S,j){S instanceof String&&(S+="");var H=0,ee=!1,Ee={next:function(){if(!ee&&H<S.length){var Oe=H++;return{value:j(Oe,S[Oe]),done:!1}}return ee=!0,{done:!0,value:void 0}}};return Ee[Symbol.iterator]=function(){return Ee},Ee}r("Array.prototype.values",function(S){return S||function(){return i(this,function(j,H){return H})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function l(S){var j=typeof S;return j=j!="object"?j:S?Array.isArray(S)?"array":j:"null",j=="array"||j=="object"&&typeof S.length=="number"}function c(S){var j=typeof S;return j=="object"&&S!=null||j=="function"}function h(S,j,H){return S.call.apply(S.bind,arguments)}function p(S,j,H){if(!S)throw Error();if(2<arguments.length){var ee=Array.prototype.slice.call(arguments,2);return function(){var Ee=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ee,ee),S.apply(j,Ee)}}return function(){return S.apply(j,arguments)}}function m(S,j,H){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:p,m.apply(null,arguments)}function v(S,j){var H=Array.prototype.slice.call(arguments,1);return function(){var ee=H.slice();return ee.push.apply(ee,arguments),S.apply(this,ee)}}function _(S,j){function H(){}H.prototype=j.prototype,S.aa=j.prototype,S.prototype=new H,S.prototype.constructor=S,S.Qb=function(ee,Ee,Oe){for(var Xe=Array(arguments.length-2),en=2;en<arguments.length;en++)Xe[en-2]=arguments[en];return j.prototype[Ee].apply(ee,Xe)}}function w(S){const j=S.length;if(0<j){const H=Array(j);for(let ee=0;ee<j;ee++)H[ee]=S[ee];return H}return[]}function T(S,j){for(let H=1;H<arguments.length;H++){const ee=arguments[H];if(l(ee)){const Ee=S.length||0,Oe=ee.length||0;S.length=Ee+Oe;for(let Xe=0;Xe<Oe;Xe++)S[Ee+Xe]=ee[Xe]}else S.push(ee)}}class E{constructor(j,H){this.i=j,this.j=H,this.h=0,this.g=null}get(){let j;return 0<this.h?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function C(S){return/^[\s\xa0]*$/.test(S)}function A(){var S=o.navigator;return S&&(S=S.userAgent)?S:""}function D(S){return D[" "](S),S}D[" "]=function(){};var F=A().indexOf("Gecko")!=-1&&!(A().toLowerCase().indexOf("webkit")!=-1&&A().indexOf("Edge")==-1)&&!(A().indexOf("Trident")!=-1||A().indexOf("MSIE")!=-1)&&A().indexOf("Edge")==-1;function W(S,j,H){for(const ee in S)j.call(H,S[ee],ee,S)}function B(S,j){for(const H in S)j.call(void 0,S[H],H,S)}function P(S){const j={};for(const H in S)j[H]=S[H];return j}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(S,j){let H,ee;for(let Ee=1;Ee<arguments.length;Ee++){ee=arguments[Ee];for(H in ee)S[H]=ee[H];for(let Oe=0;Oe<O.length;Oe++)H=O[Oe],Object.prototype.hasOwnProperty.call(ee,H)&&(S[H]=ee[H])}}function k(S){var j=1;S=S.split(":");const H=[];for(;0<j&&S.length;)H.push(S.shift()),j--;return S.length&&H.push(S.join(":")),H}function V(S){o.setTimeout(()=>{throw S},0)}function G(){var S=le;let j=null;return S.g&&(j=S.g,S.g=S.g.next,S.g||(S.h=null),j.next=null),j}class ae{constructor(){this.h=this.g=null}add(j,H){const ee=J.get();ee.set(j,H),this.h?this.h.next=ee:this.g=ee,this.h=ee}}var J=new E(()=>new X,S=>S.reset());class X{constructor(){this.next=this.g=this.h=null}set(j,H){this.h=j,this.g=H,this.next=null}reset(){this.next=this.g=this.h=null}}let se,ne=!1,le=new ae,K=()=>{const S=o.Promise.resolve(void 0);se=()=>{S.then(ie)}};var ie=()=>{for(var S;S=G();){try{S.h.call(S.g)}catch(H){V(H)}var j=J;j.j(S),100>j.h&&(j.h++,S.next=j.g,j.g=S)}ne=!1};function de(){this.s=this.s,this.C=this.C}de.prototype.s=!1,de.prototype.ma=function(){this.s||(this.s=!0,this.N())},de.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ce(S,j){this.type=S,this.g=this.target=j,this.defaultPrevented=!1}ce.prototype.h=function(){this.defaultPrevented=!0};var Se=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var S=!1,j=Object.defineProperty({},"passive",{get:function(){S=!0}});try{const H=()=>{};o.addEventListener("test",H,j),o.removeEventListener("test",H,j)}catch{}return S})();function Te(S,j){if(ce.call(this,S?S.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,S){var H=this.type=S.type,ee=S.changedTouches&&S.changedTouches.length?S.changedTouches[0]:null;if(this.target=S.target||S.srcElement,this.g=j,j=S.relatedTarget){if(F){e:{try{D(j.nodeName);var Ee=!0;break e}catch{}Ee=!1}Ee||(j=null)}}else H=="mouseover"?j=S.fromElement:H=="mouseout"&&(j=S.toElement);this.relatedTarget=j,ee?(this.clientX=ee.clientX!==void 0?ee.clientX:ee.pageX,this.clientY=ee.clientY!==void 0?ee.clientY:ee.pageY,this.screenX=ee.screenX||0,this.screenY=ee.screenY||0):(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0),this.button=S.button,this.key=S.key||"",this.ctrlKey=S.ctrlKey,this.altKey=S.altKey,this.shiftKey=S.shiftKey,this.metaKey=S.metaKey,this.pointerId=S.pointerId||0,this.pointerType=typeof S.pointerType=="string"?S.pointerType:Ie[S.pointerType]||"",this.state=S.state,this.i=S,S.defaultPrevented&&Te.aa.h.call(this)}}_(Te,ce);var Ie={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.aa.h.call(this);var S=this.i;S.preventDefault?S.preventDefault():S.returnValue=!1};var He="closure_listenable_"+(1e6*Math.random()|0),qe=0;function Qe(S,j,H,ee,Ee){this.listener=S,this.proxy=null,this.src=j,this.type=H,this.capture=!!ee,this.ha=Ee,this.key=++qe,this.da=this.fa=!1}function ut(S){S.da=!0,S.listener=null,S.proxy=null,S.src=null,S.ha=null}function mt(S){this.src=S,this.g={},this.h=0}mt.prototype.add=function(S,j,H,ee,Ee){var Oe=S.toString();S=this.g[Oe],S||(S=this.g[Oe]=[],this.h++);var Xe=Gt(S,j,ee,Ee);return-1<Xe?(j=S[Xe],H||(j.fa=!1)):(j=new Qe(j,this.src,Oe,!!ee,Ee),j.fa=H,S.push(j)),j};function At(S,j){var H=j.type;if(H in S.g){var ee=S.g[H],Ee=Array.prototype.indexOf.call(ee,j,void 0),Oe;(Oe=0<=Ee)&&Array.prototype.splice.call(ee,Ee,1),Oe&&(ut(j),S.g[H].length==0&&(delete S.g[H],S.h--))}}function Gt(S,j,H,ee){for(var Ee=0;Ee<S.length;++Ee){var Oe=S[Ee];if(!Oe.da&&Oe.listener==j&&Oe.capture==!!H&&Oe.ha==ee)return Ee}return-1}var gn="closure_lm_"+(1e6*Math.random()|0),Jt={};function Zt(S,j,H,ee,Ee){if(Array.isArray(j)){for(var Oe=0;Oe<j.length;Oe++)Zt(S,j[Oe],H,ee,Ee);return null}return H=Zr(H),S&&S[He]?S.K(j,H,c(ee)?!!ee.capture:!1,Ee):Pt(S,j,H,!1,ee,Ee)}function Pt(S,j,H,ee,Ee,Oe){if(!j)throw Error("Invalid event type");var Xe=c(Ee)?!!Ee.capture:!!Ee,en=kr(S);if(en||(S[gn]=en=new mt(S)),H=en.add(j,H,ee,Xe,Oe),H.proxy)return H;if(ee=un(),H.proxy=ee,ee.src=S,ee.listener=H,S.addEventListener)Se||(Ee=Xe),Ee===void 0&&(Ee=!1),S.addEventListener(j.toString(),ee,Ee);else if(S.attachEvent)S.attachEvent(zs(j.toString()),ee);else if(S.addListener&&S.removeListener)S.addListener(ee);else throw Error("addEventListener and attachEvent are unavailable.");return H}function un(){function S(H){return j.call(S.src,S.listener,H)}const j=Vs;return S}function Cr(S,j,H,ee,Ee){if(Array.isArray(j))for(var Oe=0;Oe<j.length;Oe++)Cr(S,j[Oe],H,ee,Ee);else ee=c(ee)?!!ee.capture:!!ee,H=Zr(H),S&&S[He]?(S=S.i,j=String(j).toString(),j in S.g&&(Oe=S.g[j],H=Gt(Oe,H,ee,Ee),-1<H&&(ut(Oe[H]),Array.prototype.splice.call(Oe,H,1),Oe.length==0&&(delete S.g[j],S.h--)))):S&&(S=kr(S))&&(j=S.g[j.toString()],S=-1,j&&(S=Gt(j,H,ee,Ee)),(H=-1<S?j[S]:null)&&Rn(H))}function Rn(S){if(typeof S!="number"&&S&&!S.da){var j=S.src;if(j&&j[He])At(j.i,S);else{var H=S.type,ee=S.proxy;j.removeEventListener?j.removeEventListener(H,ee,S.capture):j.detachEvent?j.detachEvent(zs(H),ee):j.addListener&&j.removeListener&&j.removeListener(ee),(H=kr(j))?(At(H,S),H.h==0&&(H.src=null,j[gn]=null)):ut(S)}}}function zs(S){return S in Jt?Jt[S]:Jt[S]="on"+S}function Vs(S,j){if(S.da)S=!0;else{j=new Te(j,this);var H=S.listener,ee=S.ha||S.src;S.fa&&Rn(S),S=H.call(ee,j)}return S}function kr(S){return S=S[gn],S instanceof mt?S:null}var sr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zr(S){return typeof S=="function"?S:(S[sr]||(S[sr]=function(j){return S.handleEvent(j)}),S[sr])}function an(){de.call(this),this.i=new mt(this),this.M=this,this.F=null}_(an,de),an.prototype[He]=!0,an.prototype.removeEventListener=function(S,j,H,ee){Cr(this,S,j,H,ee)};function Mt(S,j){var H,ee=S.F;if(ee)for(H=[];ee;ee=ee.F)H.push(ee);if(S=S.M,ee=j.type||j,typeof j=="string")j=new ce(j,S);else if(j instanceof ce)j.target=j.target||S;else{var Ee=j;j=new ce(ee,S),M(j,Ee)}if(Ee=!0,H)for(var Oe=H.length-1;0<=Oe;Oe--){var Xe=j.g=H[Oe];Ee=ts(Xe,ee,!0,j)&&Ee}if(Xe=j.g=S,Ee=ts(Xe,ee,!0,j)&&Ee,Ee=ts(Xe,ee,!1,j)&&Ee,H)for(Oe=0;Oe<H.length;Oe++)Xe=j.g=H[Oe],Ee=ts(Xe,ee,!1,j)&&Ee}an.prototype.N=function(){if(an.aa.N.call(this),this.i){var S=this.i,j;for(j in S.g){for(var H=S.g[j],ee=0;ee<H.length;ee++)ut(H[ee]);delete S.g[j],S.h--}}this.F=null},an.prototype.K=function(S,j,H,ee){return this.i.add(String(S),j,!1,H,ee)},an.prototype.L=function(S,j,H,ee){return this.i.add(String(S),j,!0,H,ee)};function ts(S,j,H,ee){if(j=S.i.g[String(j)],!j)return!0;j=j.concat();for(var Ee=!0,Oe=0;Oe<j.length;++Oe){var Xe=j[Oe];if(Xe&&!Xe.da&&Xe.capture==H){var en=Xe.listener,_s=Xe.ha||Xe.src;Xe.fa&&At(S.i,Xe),Ee=en.call(_s,ee)!==!1&&Ee}}return Ee&&!ee.defaultPrevented}function os(S,j,H){if(typeof S=="function")H&&(S=m(S,H));else if(S&&typeof S.handleEvent=="function")S=m(S.handleEvent,S);else throw Error("Invalid listener argument");return 2147483647<Number(j)?-1:o.setTimeout(S,j||0)}function mo(S){S.g=os(()=>{S.g=null,S.i&&(S.i=!1,mo(S))},S.l);const j=S.h;S.h=null,S.m.apply(null,j)}class el extends de{constructor(j,H){super(),this.m=j,this.l=H,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:mo(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function go(S){de.call(this),this.h=S,this.g={}}_(go,de);var _i=[];function ta(S){W(S.g,function(j,H){this.g.hasOwnProperty(H)&&Rn(j)},S),S.g={}}go.prototype.N=function(){go.aa.N.call(this),ta(this)},go.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Yr=o.JSON.stringify,ou=o.JSON.parse,na=class{stringify(S){return o.JSON.stringify(S,void 0)}parse(S){return o.JSON.parse(S,void 0)}};function cd(){}cd.prototype.h=null;function ud(S){return S.h||(S.h=S.i())}function lu(){}var Ra={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Da(){ce.call(this,"d")}_(Da,ce);function hd(){ce.call(this,"c")}_(hd,ce);var La={},dd=null;function tl(){return dd=dd||new an}La.La="serverreachability";function cu(S){ce.call(this,La.La,S)}_(cu,ce);function nl(S){const j=tl();Mt(j,new cu(j))}La.STAT_EVENT="statevent";function uu(S,j){ce.call(this,La.STAT_EVENT,S),this.stat=j}_(uu,ce);function qn(S){const j=tl();Mt(j,new uu(j,S))}La.Ma="timingevent";function $s(S,j){ce.call(this,La.Ma,S),this.size=j}_($s,ce);function bs(S,j){if(typeof S!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){S()},j)}function Pi(){this.g=!0}Pi.prototype.xa=function(){this.g=!1};function Qr(S,j,H,ee,Ee,Oe){S.info(function(){if(S.g)if(Oe)for(var Xe="",en=Oe.split("&"),_s=0;_s<en.length;_s++){var tn=en[_s].split("=");if(1<tn.length){var Sn=tn[0];tn=tn[1];var Xn=Sn.split("_");Xe=2<=Xn.length&&Xn[1]=="type"?Xe+(Sn+"="+tn+"&"):Xe+(Sn+"=redacted&")}}else Xe=null;else Xe=Oe;return"XMLHTTP REQ ("+ee+") [attempt "+Ee+"]: "+j+`
`+H+`
`+Xe})}function ct(S,j,H,ee,Ee,Oe,Xe){S.info(function(){return"XMLHTTP RESP ("+ee+") [ attempt "+Ee+"]: "+j+`
`+H+`
`+Oe+" "+Xe})}function yo(S,j,H,ee){S.info(function(){return"XMLHTTP TEXT ("+j+"): "+sl(S,H)+(ee?" "+ee:"")})}function fd(S,j){S.info(function(){return"TIMEOUT: "+j})}Pi.prototype.info=function(){};function sl(S,j){if(!S.g)return j;if(!j)return null;try{var H=JSON.parse(j);if(H){for(S=0;S<H.length;S++)if(Array.isArray(H[S])){var ee=H[S];if(!(2>ee.length)){var Ee=ee[1];if(Array.isArray(Ee)&&!(1>Ee.length)){var Oe=Ee[0];if(Oe!="noop"&&Oe!="stop"&&Oe!="close")for(var Xe=1;Xe<Ee.length;Xe++)Ee[Xe]=""}}}}return Yr(H)}catch{return j}}var vo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sa={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ra;function $r(){}_($r,cd),$r.prototype.g=function(){return new XMLHttpRequest},$r.prototype.i=function(){return{}},ra=new $r;function pr(S,j,H,ee){this.j=S,this.i=j,this.l=H,this.R=ee||1,this.U=new go(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ps}function ps(){this.i=null,this.g="",this.h=!1}var pd={},hu={};function ia(S,j,H){S.L=1,S.v=xi(Kn(j)),S.m=H,S.P=!0,Oa(S,null)}function Oa(S,j){S.F=Date.now(),lc(S),S.A=Kn(S.v);var H=S.A,ee=S.R;Array.isArray(ee)||(ee=[String(ee)]),yd(H.i,"t",ee),S.C=0,H=S.j.J,S.h=new ps,S.g=ap(S.j,H?j:null,!S.m),0<S.O&&(S.M=new el(m(S.Y,S,S.g),S.O)),j=S.U,H=S.g,ee=S.ca;var Ee="readystatechange";Array.isArray(Ee)||(Ee&&(_i[0]=Ee.toString()),Ee=_i);for(var Oe=0;Oe<Ee.length;Oe++){var Xe=Zt(H,Ee[Oe],ee||j.handleEvent,!1,j.h||j);if(!Xe)break;j.g[Xe.key]=Xe}j=S.H?P(S.H):{},S.m?(S.u||(S.u="POST"),j["Content-Type"]="application/x-www-form-urlencoded",S.g.ea(S.A,S.u,S.m,j)):(S.u="GET",S.g.ea(S.A,S.u,null,j)),nl(),Qr(S.i,S.u,S.A,S.l,S.R,S.m)}pr.prototype.ca=function(S){S=S.target;const j=this.M;j&&yr(S)==3?j.j():this.Y(S)},pr.prototype.Y=function(S){try{if(S==this.g)e:{const Xn=yr(this.g);var j=this.g.Ba();const No=this.g.Z();if(!(3>Xn)&&(Xn!=3||this.g&&(this.h.h||this.g.oa()||vd(this.g)))){this.J||Xn!=4||j==7||(j==8||0>=No?nl(3):nl(2)),rl(this);var H=this.g.Z();this.X=H;t:if(tp(this)){var ee=vd(this.g);S="";var Ee=ee.length,Oe=yr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){rr(this),Pa(this);var Xe="";break t}this.h.i=new o.TextDecoder}for(j=0;j<Ee;j++)this.h.h=!0,S+=this.h.i.decode(ee[j],{stream:!(Oe&&j==Ee-1)});ee.length=0,this.h.g+=S,this.C=0,Xe=this.h.g}else Xe=this.g.oa();if(this.o=H==200,ct(this.i,this.u,this.A,this.l,this.R,Xn,H),this.o){if(this.T&&!this.K){t:{if(this.g){var en,_s=this.g;if((en=_s.g?_s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(en)){var tn=en;break t}}tn=null}if(H=tn)yo(this.i,this.l,H,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bo(this,H);else{this.o=!1,this.s=3,qn(12),rr(this),Pa(this);break e}}if(this.P){H=!0;let jn;for(;!this.J&&this.C<Xe.length;)if(jn=oc(this,Xe),jn==hu){Xn==4&&(this.s=4,qn(14),H=!1),yo(this.i,this.l,null,"[Incomplete Response]");break}else if(jn==pd){this.s=4,qn(15),yo(this.i,this.l,Xe,"[Invalid Chunk]"),H=!1;break}else yo(this.i,this.l,jn,null),bo(this,jn);if(tp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xn!=4||Xe.length!=0||this.h.h||(this.s=1,qn(16),H=!1),this.o=this.o&&H,!H)yo(this.i,this.l,Xe,"[Invalid Chunked Response]"),rr(this),Pa(this);else if(0<Xe.length&&!this.W){this.W=!0;var Sn=this.j;Sn.g==this&&Sn.ba&&!Sn.M&&(Sn.j.info("Great, no buffering proxy detected. Bytes received: "+Xe.length),ul(Sn),Sn.M=!0,qn(11))}}else yo(this.i,this.l,Xe,null),bo(this,Xe);Xn==4&&rr(this),this.o&&!this.J&&(Xn==4?_d(this.j,this):(this.o=!1,lc(this)))}else mg(this.g),H==400&&0<Xe.indexOf("Unknown SID")?(this.s=3,qn(12)):(this.s=0,qn(13)),rr(this),Pa(this)}}}catch{}finally{}};function tp(S){return S.g?S.u=="GET"&&S.L!=2&&S.j.Ca:!1}function oc(S,j){var H=S.C,ee=j.indexOf(`
`,H);return ee==-1?hu:(H=Number(j.substring(H,ee)),isNaN(H)?pd:(ee+=1,ee+H>j.length?hu:(j=j.slice(ee,ee+H),S.C=ee+H,j)))}pr.prototype.cancel=function(){this.J=!0,rr(this)};function lc(S){S.S=Date.now()+S.I,np(S,S.I)}function np(S,j){if(S.B!=null)throw Error("WatchDog timer not null");S.B=bs(m(S.ba,S),j)}function rl(S){S.B&&(o.clearTimeout(S.B),S.B=null)}pr.prototype.ba=function(){this.B=null;const S=Date.now();0<=S-this.S?(fd(this.i,this.A),this.L!=2&&(nl(),qn(17)),rr(this),this.s=2,Pa(this)):np(this,this.S-S)};function Pa(S){S.j.G==0||S.J||_d(S.j,S)}function rr(S){rl(S);var j=S.M;j&&typeof j.ma=="function"&&j.ma(),S.M=null,ta(S.U),S.g&&(j=S.g,S.g=null,j.abort(),j.ma())}function bo(S,j){try{var H=S.j;if(H.G!=0&&(H.g==S||qt(H.h,S))){if(!S.K&&qt(H.h,S)&&H.G==3){try{var ee=H.Da.g.parse(j)}catch{ee=null}if(Array.isArray(ee)&&ee.length==3){var Ee=ee;if(Ee[0]==0){e:if(!H.u){if(H.g)if(H.g.F+3e3<S.F)_u(H),yu(H);else break e;vu(H),qn(18)}}else H.za=Ee[1],0<H.za-H.T&&37500>Ee[2]&&H.F&&H.v==0&&!H.C&&(H.C=bs(m(H.Za,H),6e3));if(1>=Fa(H.h)&&H.ca){try{H.ca()}catch{}H.ca=void 0}}else Eo(H,11)}else if((S.K||H.g==S)&&_u(H),!C(j))for(Ee=H.Da.g.parse(j),j=0;j<Ee.length;j++){let tn=Ee[j];if(H.T=tn[0],tn=tn[1],H.G==2)if(tn[0]=="c"){H.K=tn[1],H.ia=tn[2];const Sn=tn[3];Sn!=null&&(H.la=Sn,H.j.info("VER="+H.la));const Xn=tn[4];Xn!=null&&(H.Aa=Xn,H.j.info("SVER="+H.Aa));const No=tn[5];No!=null&&typeof No=="number"&&0<No&&(ee=1.5*No,H.L=ee,H.j.info("backChannelRequestTimeoutMs_="+ee)),ee=H;const jn=S.g;if(jn){const Ua=jn.g?jn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ua){var Oe=ee.h;Oe.g||Ua.indexOf("spdy")==-1&&Ua.indexOf("quic")==-1&&Ua.indexOf("h2")==-1||(Oe.j=Oe.l,Oe.g=new Set,Oe.h&&(Tn(Oe,Oe.h),Oe.h=null))}if(ee.D){const Ga=jn.g?jn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ga&&(ee.ya=Ga,Tt(ee.I,ee.D,Ga))}}H.G=3,H.l&&H.l.ua(),H.ba&&(H.R=Date.now()-S.F,H.j.info("Handshake RTT: "+H.R+"ms")),ee=H;var Xe=S;if(ee.qa=wu(ee,ee.J?ee.ia:null,ee.W),Xe.K){Us(ee.h,Xe);var en=Xe,_s=ee.L;_s&&(en.I=_s),en.B&&(rl(en),lc(en)),ee.g=Xe}else ha(ee);0<H.i.length&&cl(H)}else tn[0]!="stop"&&tn[0]!="close"||Eo(H,7);else H.G==3&&(tn[0]=="stop"||tn[0]=="close"?tn[0]=="stop"?Eo(H,7):gu(H):tn[0]!="noop"&&H.l&&H.l.ta(tn),H.v=0)}}nl(4)}catch{}}var il=class{constructor(S,j){this.g=S,this.map=j}};function Ma(S){this.l=S||10,o.PerformanceNavigationTiming?(S=o.performance.getEntriesByType("navigation"),S=0<S.length&&(S[0].nextHopProtocol=="hq"||S[0].nextHopProtocol=="h2")):S=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=S?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function cc(S){return S.h?!0:S.g?S.g.size>=S.j:!1}function Fa(S){return S.h?1:S.g?S.g.size:0}function qt(S,j){return S.h?S.h==j:S.g?S.g.has(j):!1}function Tn(S,j){S.g?S.g.add(j):S.h=j}function Us(S,j){S.h&&S.h==j?S.h=null:S.g&&S.g.has(j)&&S.g.delete(j)}Ma.prototype.cancel=function(){if(this.i=ja(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const S of this.g.values())S.cancel();this.g.clear()}};function ja(S){if(S.h!=null)return S.i.concat(S.h.D);if(S.g!=null&&S.g.size!==0){let j=S.i;for(const H of S.g.values())j=j.concat(H.D);return j}return w(S.i)}function al(S){if(S.V&&typeof S.V=="function")return S.V();if(typeof Map<"u"&&S instanceof Map||typeof Set<"u"&&S instanceof Set)return Array.from(S.values());if(typeof S=="string")return S.split("");if(l(S)){for(var j=[],H=S.length,ee=0;ee<H;ee++)j.push(S[ee]);return j}j=[],H=0;for(ee in S)j[H++]=S[ee];return j}function ol(S){if(S.na&&typeof S.na=="function")return S.na();if(!S.V||typeof S.V!="function"){if(typeof Map<"u"&&S instanceof Map)return Array.from(S.keys());if(!(typeof Set<"u"&&S instanceof Set)){if(l(S)||typeof S=="string"){var j=[];S=S.length;for(var H=0;H<S;H++)j.push(H);return j}j=[],H=0;for(const ee in S)j[H++]=ee;return j}}}function kt(S,j){if(S.forEach&&typeof S.forEach=="function")S.forEach(j,void 0);else if(l(S)||typeof S=="string")Array.prototype.forEach.call(S,j,void 0);else for(var H=ol(S),ee=al(S),Ee=ee.length,Oe=0;Oe<Ee;Oe++)j.call(void 0,ee[Oe],H&&H[Oe],S)}var Cn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function md(S,j){if(S){S=S.split("&");for(var H=0;H<S.length;H++){var ee=S[H].indexOf("="),Ee=null;if(0<=ee){var Oe=S[H].substring(0,ee);Ee=S[H].substring(ee+1)}else Oe=S[H];j(Oe,Ee?decodeURIComponent(Ee.replace(/\+/g," ")):"")}}}function ns(S){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,S instanceof ns){this.h=S.h,uc(this,S.j),this.o=S.o,this.g=S.g,aa(this,S.s),this.l=S.l;var j=S.i,H=new la;H.i=j.i,j.g&&(H.g=new Map(j.g),H.h=j.h),Ar(this,H),this.m=S.m}else S&&(j=String(S).match(Cn))?(this.h=!1,uc(this,j[1]||"",!0),this.o=mr(j[2]||""),this.g=mr(j[3]||"",!0),aa(this,j[4]),this.l=mr(j[5]||"",!0),Ar(this,j[6]||"",!0),this.m=mr(j[7]||"")):(this.h=!1,this.i=new la(null,this.h))}ns.prototype.toString=function(){var S=[],j=this.j;j&&S.push(oa(j,_o,!0),":");var H=this.g;return(H||j=="file")&&(S.push("//"),(j=this.o)&&S.push(oa(j,_o,!0),"@"),S.push(encodeURIComponent(String(H)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),H=this.s,H!=null&&S.push(":",String(H))),(H=this.l)&&(this.g&&H.charAt(0)!="/"&&S.push("/"),S.push(oa(H,H.charAt(0)=="/"?gd:hc,!0))),(H=this.i.toString())&&S.push("?",H),(H=this.m)&&S.push("#",oa(H,ll)),S.join("")};function Kn(S){return new ns(S)}function uc(S,j,H){S.j=H?mr(j,!0):j,S.j&&(S.j=S.j.replace(/:$/,""))}function aa(S,j){if(j){if(j=Number(j),isNaN(j)||0>j)throw Error("Bad port number "+j);S.s=j}else S.s=null}function Ar(S,j,H){j instanceof la?(S.i=j,wi(S.i,S.h)):(H||(j=oa(j,fu)),S.i=new la(j,S.h))}function Tt(S,j,H){S.i.set(j,H)}function xi(S){return Tt(S,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),S}function mr(S,j){return S?j?decodeURI(S.replace(/%25/g,"%2525")):decodeURIComponent(S):""}function oa(S,j,H){return typeof S=="string"?(S=encodeURI(S).replace(j,du),H&&(S=S.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S):null}function du(S){return S=S.charCodeAt(0),"%"+(S>>4&15).toString(16)+(S&15).toString(16)}var _o=/[#\/\?@]/g,hc=/[#\?:]/g,gd=/[#\?]/g,fu=/[#\?@]/g,ll=/#/g;function la(S,j){this.h=this.g=null,this.i=S||null,this.j=!!j}function Rr(S){S.g||(S.g=new Map,S.h=0,S.i&&md(S.i,function(j,H){S.add(decodeURIComponent(j.replace(/\+/g," ")),H)}))}n=la.prototype,n.add=function(S,j){Rr(this),this.i=null,S=vt(this,S);var H=this.g.get(S);return H||this.g.set(S,H=[]),H.push(j),this.h+=1,this};function Ba(S,j){Rr(S),j=vt(S,j),S.g.has(j)&&(S.i=null,S.h-=S.g.get(j).length,S.g.delete(j))}function ca(S,j){return Rr(S),j=vt(S,j),S.g.has(j)}n.forEach=function(S,j){Rr(this),this.g.forEach(function(H,ee){H.forEach(function(Ee){S.call(j,Ee,ee,this)},this)},this)},n.na=function(){Rr(this);const S=Array.from(this.g.values()),j=Array.from(this.g.keys()),H=[];for(let ee=0;ee<j.length;ee++){const Ee=S[ee];for(let Oe=0;Oe<Ee.length;Oe++)H.push(j[ee])}return H},n.V=function(S){Rr(this);let j=[];if(typeof S=="string")ca(this,S)&&(j=j.concat(this.g.get(vt(this,S))));else{S=Array.from(this.g.values());for(let H=0;H<S.length;H++)j=j.concat(S[H])}return j},n.set=function(S,j){return Rr(this),this.i=null,S=vt(this,S),ca(this,S)&&(this.h-=this.g.get(S).length),this.g.set(S,[j]),this.h+=1,this},n.get=function(S,j){return S?(S=this.V(S),0<S.length?String(S[0]):j):j};function yd(S,j,H){Ba(S,j),0<H.length&&(S.i=null,S.g.set(vt(S,j),w(H)),S.h+=H.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const S=[],j=Array.from(this.g.keys());for(var H=0;H<j.length;H++){var ee=j[H];const Oe=encodeURIComponent(String(ee)),Xe=this.V(ee);for(ee=0;ee<Xe.length;ee++){var Ee=Oe;Xe[ee]!==""&&(Ee+="="+encodeURIComponent(String(Xe[ee]))),S.push(Ee)}}return this.i=S.join("&")};function vt(S,j){return j=String(j),S.j&&(j=j.toLowerCase()),j}function wi(S,j){j&&!S.j&&(Rr(S),S.i=null,S.g.forEach(function(H,ee){var Ee=ee.toLowerCase();ee!=Ee&&(Ba(this,ee),yd(this,Ee,H))},S)),S.j=j}function hn(S,j){const H=new Pi;if(o.Image){const ee=new Image;ee.onload=v(Jr,H,"TestLoadImage: loaded",!0,j,ee),ee.onerror=v(Jr,H,"TestLoadImage: error",!1,j,ee),ee.onabort=v(Jr,H,"TestLoadImage: abort",!1,j,ee),ee.ontimeout=v(Jr,H,"TestLoadImage: timeout",!1,j,ee),o.setTimeout(function(){ee.ontimeout&&ee.ontimeout()},1e4),ee.src=S}else j(!1)}function Mi(S,j){const H=new Pi,ee=new AbortController,Ee=setTimeout(()=>{ee.abort(),Jr(H,"TestPingServer: timeout",!1,j)},1e4);fetch(S,{signal:ee.signal}).then(Oe=>{clearTimeout(Ee),Oe.ok?Jr(H,"TestPingServer: ok",!0,j):Jr(H,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(Ee),Jr(H,"TestPingServer: error",!1,j)})}function Jr(S,j,H,ee,Ee){try{Ee&&(Ee.onload=null,Ee.onerror=null,Ee.onabort=null,Ee.ontimeout=null),ee(H)}catch{}}function xo(){this.g=new na}function Fi(S,j,H){const ee=H||"";try{kt(S,function(Ee,Oe){let Xe=Ee;c(Ee)&&(Xe=Yr(Ee)),j.push(ee+Oe+"="+encodeURIComponent(Xe))})}catch(Ee){throw j.push(ee+"type="+encodeURIComponent("_badmap")),Ee}}function ei(S){this.l=S.Ub||null,this.j=S.eb||!1}_(ei,cd),ei.prototype.g=function(){return new ua(this.l,this.j)},ei.prototype.i=(function(S){return function(){return S}})({});function ua(S,j){an.call(this),this.D=S,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(ua,an),n=ua.prototype,n.open=function(S,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=S,this.A=j,this.readyState=1,gr(this)},n.send=function(S){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const j={headers:this.u,method:this.B,credentials:this.m,cache:void 0};S&&(j.body=S),(this.D||o).fetch(new Request(this.A,j)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Dn(this)),this.readyState=0},n.Sa=function(S){if(this.g&&(this.l=S,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=S.headers,this.readyState=2,gr(this)),this.g&&(this.readyState=3,gr(this),this.g)))if(this.responseType==="arraybuffer")S.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in S){if(this.j=S.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wo(this)}else S.text().then(this.Ra.bind(this),this.ga.bind(this))};function wo(S){S.j.read().then(S.Pa.bind(S)).catch(S.ga.bind(S))}n.Pa=function(S){if(this.g){if(this.o&&S.value)this.response.push(S.value);else if(!this.o){var j=S.value?S.value:new Uint8Array(0);(j=this.v.decode(j,{stream:!S.done}))&&(this.response=this.responseText+=j)}S.done?Dn(this):gr(this),this.readyState==3&&wo(this)}},n.Ra=function(S){this.g&&(this.response=this.responseText=S,Dn(this))},n.Qa=function(S){this.g&&(this.response=S,Dn(this))},n.ga=function(){this.g&&Dn(this)};function Dn(S){S.readyState=4,S.l=null,S.j=null,S.v=null,gr(S)}n.setRequestHeader=function(S,j){this.u.append(S,j)},n.getResponseHeader=function(S){return this.h&&this.h.get(S.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const S=[],j=this.h.entries();for(var H=j.next();!H.done;)H=H.value,S.push(H[0]+": "+H[1]),H=j.next();return S.join(`\r
`)};function gr(S){S.onreadystatechange&&S.onreadystatechange.call(S)}Object.defineProperty(ua.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(S){this.m=S?"include":"same-origin"}});function pu(S){let j="";return W(S,function(H,ee){j+=ee,j+=":",j+=H,j+=`\r
`}),j}function As(S,j,H){e:{for(ee in H){var ee=!1;break e}ee=!0}ee||(H=pu(H),typeof S=="string"?H!=null&&encodeURIComponent(String(H)):Tt(S,j,H))}function yn(S){an.call(this),this.headers=new Map,this.o=S||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(yn,an);var dc=/^https?$/i,To=["POST","PUT"];n=yn.prototype,n.Ha=function(S){this.J=S},n.ea=function(S,j,H,ee){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+S);j=j?j.toUpperCase():"GET",this.D=S,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ra.g(),this.v=this.o?ud(this.o):ud(ra),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(j,String(S),!0),this.B=!1}catch(Oe){sp(this,Oe);return}if(S=H||"",H=new Map(this.headers),ee)if(Object.getPrototypeOf(ee)===Object.prototype)for(var Ee in ee)H.set(Ee,ee[Ee]);else if(typeof ee.keys=="function"&&typeof ee.get=="function")for(const Oe of ee.keys())H.set(Oe,ee.get(Oe));else throw Error("Unknown input type for opt_headers: "+String(ee));ee=Array.from(H.keys()).find(Oe=>Oe.toLowerCase()=="content-type"),Ee=o.FormData&&S instanceof o.FormData,!(0<=Array.prototype.indexOf.call(To,j,void 0))||ee||Ee||H.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Oe,Xe]of H)this.g.setRequestHeader(Oe,Xe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ir(this),this.u=!0,this.g.send(S),this.u=!1}catch(Oe){sp(this,Oe)}};function sp(S,j){S.h=!1,S.g&&(S.j=!0,S.g.abort(),S.j=!1),S.l=j,S.m=5,fc(S),za(S)}function fc(S){S.A||(S.A=!0,Mt(S,"complete"),Mt(S,"error"))}n.abort=function(S){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=S||7,Mt(this,"complete"),Mt(this,"abort"),za(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),za(this,!0)),yn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ft(this):this.bb())},n.bb=function(){Ft(this)};function Ft(S){if(S.h&&typeof a<"u"&&(!S.v[1]||yr(S)!=4||S.Z()!=2)){if(S.u&&yr(S)==4)os(S.Ea,0,S);else if(Mt(S,"readystatechange"),yr(S)==4){S.h=!1;try{const Xe=S.Z();e:switch(Xe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var H;if(!(H=j)){var ee;if(ee=Xe===0){var Ee=String(S.D).match(Cn)[1]||null;!Ee&&o.self&&o.self.location&&(Ee=o.self.location.protocol.slice(0,-1)),ee=!dc.test(Ee?Ee.toLowerCase():"")}H=ee}if(H)Mt(S,"complete"),Mt(S,"success");else{S.m=6;try{var Oe=2<yr(S)?S.g.statusText:""}catch{Oe=""}S.l=Oe+" ["+S.Z()+"]",fc(S)}}finally{za(S)}}}}function za(S,j){if(S.g){ir(S);const H=S.g,ee=S.v[0]?()=>{}:null;S.g=null,S.v=null,j||Mt(S,"ready");try{H.onreadystatechange=ee}catch{}}}function ir(S){S.I&&(o.clearTimeout(S.I),S.I=null)}n.isActive=function(){return!!this.g};function yr(S){return S.g?S.g.readyState:0}n.Z=function(){try{return 2<yr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(S){if(this.g){var j=this.g.responseText;return S&&j.indexOf(S)==0&&(j=j.substring(S.length)),ou(j)}};function vd(S){try{if(!S.g)return null;if("response"in S.g)return S.g.response;switch(S.H){case"":case"text":return S.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in S.g)return S.g.mozResponseArrayBuffer}return null}catch{return null}}function mg(S){const j={};S=(S.g&&2<=yr(S)&&S.g.getAllResponseHeaders()||"").split(`\r
`);for(let ee=0;ee<S.length;ee++){if(C(S[ee]))continue;var H=k(S[ee]);const Ee=H[0];if(H=H[1],typeof H!="string")continue;H=H.trim();const Oe=j[Ee]||[];j[Ee]=Oe,Oe.push(H)}B(j,function(ee){return ee.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function So(S,j,H){return H&&H.internalChannelParams&&H.internalChannelParams[S]||j}function mu(S){this.Aa=0,this.i=[],this.j=new Pi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=So("failFast",!1,S),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=So("baseRetryDelayMs",5e3,S),this.cb=So("retryDelaySeedMs",1e4,S),this.Wa=So("forwardChannelMaxRetries",2,S),this.wa=So("forwardChannelRequestTimeoutMs",2e4,S),this.pa=S&&S.xmlHttpFactory||void 0,this.Xa=S&&S.Tb||void 0,this.Ca=S&&S.useFetchStreams||!1,this.L=void 0,this.J=S&&S.supportsCrossDomainXhr||!1,this.K="",this.h=new Ma(S&&S.concurrentRequestLimit),this.Da=new xo,this.P=S&&S.fastHandshake||!1,this.O=S&&S.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=S&&S.Rb||!1,S&&S.xa&&this.j.xa(),S&&S.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&S&&S.detectBufferingProxy||!1,this.ja=void 0,S&&S.longPollingTimeout&&0<S.longPollingTimeout&&(this.ja=S.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=mu.prototype,n.la=8,n.G=1,n.connect=function(S,j,H,ee){qn(0),this.W=S,this.H=j||{},H&&ee!==void 0&&(this.H.OSID=H,this.H.OAID=ee),this.F=this.X,this.I=wu(this,null,this.W),cl(this)};function gu(S){if(rp(S),S.G==3){var j=S.U++,H=Kn(S.I);if(Tt(H,"SID",S.K),Tt(H,"RID",j),Tt(H,"TYPE","terminate"),pc(S,H),j=new pr(S,S.j,j),j.L=2,j.v=xi(Kn(H)),H=!1,o.navigator&&o.navigator.sendBeacon)try{H=o.navigator.sendBeacon(j.v.toString(),"")}catch{}!H&&o.Image&&(new Image().src=j.v,H=!0),H||(j.g=ap(j.j,null),j.g.ea(j.v)),j.F=Date.now(),lc(j)}ip(S)}function yu(S){S.g&&(ul(S),S.g.cancel(),S.g=null)}function rp(S){yu(S),S.u&&(o.clearTimeout(S.u),S.u=null),_u(S),S.h.cancel(),S.s&&(typeof S.s=="number"&&o.clearTimeout(S.s),S.s=null)}function cl(S){if(!cc(S.h)&&!S.s){S.s=!0;var j=S.Ga;se||K(),ne||(se(),ne=!0),le.add(j,S),S.B=0}}function gg(S,j){return Fa(S.h)>=S.h.j-(S.s?1:0)?!1:S.s?(S.i=j.D.concat(S.i),!0):S.G==1||S.G==2||S.B>=(S.Va?0:S.Wa)?!1:(S.s=bs(m(S.Ga,S,j),xu(S,S.B)),S.B++,!0)}n.Ga=function(S){if(this.s)if(this.s=null,this.G==1){if(!S){this.U=Math.floor(1e5*Math.random()),S=this.U++;const Ee=new pr(this,this.j,S);let Oe=this.o;if(this.S&&(Oe?(Oe=P(Oe),M(Oe,this.S)):Oe=this.S),this.m!==null||this.O||(Ee.H=Oe,Oe=null),this.P)e:{for(var j=0,H=0;H<this.i.length;H++){t:{var ee=this.i[H];if("__data__"in ee.map&&(ee=ee.map.__data__,typeof ee=="string")){ee=ee.length;break t}ee=void 0}if(ee===void 0)break;if(j+=ee,4096<j){j=H;break e}if(j===4096||H===this.i.length-1){j=H+1;break e}}j=1e3}else j=1e3;j=bd(this,Ee,j),H=Kn(this.I),Tt(H,"RID",S),Tt(H,"CVER",22),this.D&&Tt(H,"X-HTTP-Session-Id",this.D),pc(this,H),Oe&&(this.O?j="headers="+encodeURIComponent(String(pu(Oe)))+"&"+j:this.m&&As(H,this.m,Oe)),Tn(this.h,Ee),this.Ua&&Tt(H,"TYPE","init"),this.P?(Tt(H,"$req",j),Tt(H,"SID","null"),Ee.T=!0,ia(Ee,H,null)):ia(Ee,H,j),this.G=2}}else this.G==3&&(S?ti(this,S):this.i.length==0||cc(this.h)||ti(this))};function ti(S,j){var H;j?H=j.l:H=S.U++;const ee=Kn(S.I);Tt(ee,"SID",S.K),Tt(ee,"RID",H),Tt(ee,"AID",S.T),pc(S,ee),S.m&&S.o&&As(ee,S.m,S.o),H=new pr(S,S.j,H,S.B+1),S.m===null&&(H.H=S.o),j&&(S.i=j.D.concat(S.i)),j=bd(S,H,1e3),H.I=Math.round(.5*S.wa)+Math.round(.5*S.wa*Math.random()),Tn(S.h,H),ia(H,ee,j)}function pc(S,j){S.H&&W(S.H,function(H,ee){Tt(j,ee,H)}),S.l&&kt({},function(H,ee){Tt(j,ee,H)})}function bd(S,j,H){H=Math.min(S.i.length,H);var ee=S.l?m(S.l.Na,S.l,S):null;e:{var Ee=S.i;let Oe=-1;for(;;){const Xe=["count="+H];Oe==-1?0<H?(Oe=Ee[0].g,Xe.push("ofs="+Oe)):Oe=0:Xe.push("ofs="+Oe);let en=!0;for(let _s=0;_s<H;_s++){let tn=Ee[_s].g;const Sn=Ee[_s].map;if(tn-=Oe,0>tn)Oe=Math.max(0,Ee[_s].g-100),en=!1;else try{Fi(Sn,Xe,"req"+tn+"_")}catch{ee&&ee(Sn)}}if(en){ee=Xe.join("&");break e}}}return S=S.i.splice(0,H),j.D=S,ee}function ha(S){if(!S.g&&!S.u){S.Y=1;var j=S.Fa;se||K(),ne||(se(),ne=!0),le.add(j,S),S.v=0}}function vu(S){return S.g||S.u||3<=S.v?!1:(S.Y++,S.u=bs(m(S.Fa,S),xu(S,S.v)),S.v++,!0)}n.Fa=function(){if(this.u=null,bu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var S=2*this.R;this.j.info("BP detection timer enabled: "+S),this.A=bs(m(this.ab,this),S)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qn(10),yu(this),bu(this))};function ul(S){S.A!=null&&(o.clearTimeout(S.A),S.A=null)}function bu(S){S.g=new pr(S,S.j,"rpc",S.Y),S.m===null&&(S.g.H=S.o),S.g.O=0;var j=Kn(S.qa);Tt(j,"RID","rpc"),Tt(j,"SID",S.K),Tt(j,"AID",S.T),Tt(j,"CI",S.F?"0":"1"),!S.F&&S.ja&&Tt(j,"TO",S.ja),Tt(j,"TYPE","xmlhttp"),pc(S,j),S.m&&S.o&&As(j,S.m,S.o),S.L&&(S.g.I=S.L);var H=S.g;S=S.ia,H.L=1,H.v=xi(Kn(j)),H.m=null,H.P=!0,Oa(H,S)}n.Za=function(){this.C!=null&&(this.C=null,yu(this),vu(this),qn(19))};function _u(S){S.C!=null&&(o.clearTimeout(S.C),S.C=null)}function _d(S,j){var H=null;if(S.g==j){_u(S),ul(S),S.g=null;var ee=2}else if(qt(S.h,j))H=j.D,Us(S.h,j),ee=1;else return;if(S.G!=0){if(j.o)if(ee==1){H=j.m?j.m.length:0,j=Date.now()-j.F;var Ee=S.B;ee=tl(),Mt(ee,new $s(ee,H)),cl(S)}else ha(S);else if(Ee=j.s,Ee==3||Ee==0&&0<j.X||!(ee==1&&gg(S,j)||ee==2&&vu(S)))switch(H&&0<H.length&&(j=S.h,j.i=j.i.concat(H)),Ee){case 1:Eo(S,5);break;case 4:Eo(S,10);break;case 3:Eo(S,6);break;default:Eo(S,2)}}}function xu(S,j){let H=S.Ta+Math.floor(Math.random()*S.cb);return S.isActive()||(H*=2),H*j}function Eo(S,j){if(S.j.info("Error code "+j),j==2){var H=m(S.fb,S),ee=S.Xa;const Ee=!ee;ee=new ns(ee||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||uc(ee,"https"),xi(ee),Ee?hn(ee.toString(),H):Mi(ee.toString(),H)}else qn(2);S.G=0,S.l&&S.l.sa(j),ip(S),rp(S)}n.fb=function(S){S?(this.j.info("Successfully pinged google.com"),qn(2)):(this.j.info("Failed to ping google.com"),qn(1))};function ip(S){if(S.G=0,S.ka=[],S.l){const j=ja(S.h);(j.length!=0||S.i.length!=0)&&(T(S.ka,j),T(S.ka,S.i),S.h.i.length=0,w(S.i),S.i.length=0),S.l.ra()}}function wu(S,j,H){var ee=H instanceof ns?Kn(H):new ns(H);if(ee.g!="")j&&(ee.g=j+"."+ee.g),aa(ee,ee.s);else{var Ee=o.location;ee=Ee.protocol,j=j?j+"."+Ee.hostname:Ee.hostname,Ee=+Ee.port;var Oe=new ns(null);ee&&uc(Oe,ee),j&&(Oe.g=j),Ee&&aa(Oe,Ee),H&&(Oe.l=H),ee=Oe}return H=S.D,j=S.ya,H&&j&&Tt(ee,H,j),Tt(ee,"VER",S.la),pc(S,ee),ee}function ap(S,j,H){if(j&&!S.J)throw Error("Can't create secondary domain capable XhrIo object.");return j=S.Ca&&!S.pa?new yn(new ei({eb:H})):new yn(S.pa),j.Ha(S.J),j}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function xd(){}n=xd.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function mc(){}mc.prototype.g=function(S,j){return new Gs(S,j)};function Gs(S,j){an.call(this),this.g=new mu(j),this.l=S,this.h=j&&j.messageUrlParams||null,S=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(S?S["X-Client-Protocol"]="webchannel":S={"X-Client-Protocol":"webchannel"}),this.g.o=S,S=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(S?S["X-WebChannel-Content-Type"]=j.messageContentType:S={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.va&&(S?S["X-WebChannel-Client-Profile"]=j.va:S={"X-WebChannel-Client-Profile":j.va}),this.g.S=S,(S=j&&j.Sb)&&!C(S)&&(this.g.m=S),this.v=j&&j.supportsCrossDomainXhr||!1,this.u=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!C(j)&&(this.g.D=j,S=this.h,S!==null&&j in S&&(S=this.h,j in S&&delete S[j])),this.j=new ni(this)}_(Gs,an),Gs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Gs.prototype.close=function(){gu(this.g)},Gs.prototype.o=function(S){var j=this.g;if(typeof S=="string"){var H={};H.__data__=S,S=H}else this.u&&(H={},H.__data__=Yr(S),S=H);j.i.push(new il(j.Ya++,S)),j.G==3&&cl(j)},Gs.prototype.N=function(){this.g.l=null,delete this.j,gu(this.g),delete this.g,Gs.aa.N.call(this)};function Va(S){Da.call(this),S.__headers__&&(this.headers=S.__headers__,this.statusCode=S.__status__,delete S.__headers__,delete S.__status__);var j=S.__sm__;if(j){e:{for(const H in j){S=H;break e}S=void 0}(this.i=S)&&(S=this.i,j=j!==null&&S in j?j[S]:void 0),this.data=j}else this.data=S}_(Va,Da);function op(){hd.call(this),this.status=1}_(op,hd);function ni(S){this.g=S}_(ni,xd),ni.prototype.ua=function(){Mt(this.g,"a")},ni.prototype.ta=function(S){Mt(this.g,new Va(S))},ni.prototype.sa=function(S){Mt(this.g,new op)},ni.prototype.ra=function(){Mt(this.g,"b")},mc.prototype.createWebChannel=mc.prototype.g,Gs.prototype.send=Gs.prototype.o,Gs.prototype.open=Gs.prototype.m,Gs.prototype.close=Gs.prototype.close,Rj=function(){return new mc},Aj=function(){return tl()},$j=La,MN={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},vo.NO_ERROR=0,vo.TIMEOUT=8,vo.HTTP_ERROR=6,Hx=vo,sa.COMPLETE="complete",kj=sa,lu.EventType=Ra,Ra.OPEN="a",Ra.CLOSE="b",Ra.ERROR="c",Ra.MESSAGE="d",an.prototype.listen=an.prototype.K,my=lu,yn.prototype.listenOnce=yn.prototype.L,yn.prototype.getLastError=yn.prototype.Ka,yn.prototype.getLastErrorCode=yn.prototype.Ba,yn.prototype.getStatus=yn.prototype.Z,yn.prototype.getResponseJson=yn.prototype.Oa,yn.prototype.getResponseText=yn.prototype.oa,yn.prototype.send=yn.prototype.ea,yn.prototype.setWithCredentials=yn.prototype.Ha,Cj=yn}).apply(typeof vx<"u"?vx:typeof self<"u"?self:typeof window<"u"?window:{});const YO="@firebase/firestore",QO="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}oi.UNAUTHENTICATED=new oi(null),oi.GOOGLE_CREDENTIALS=new oi("google-credentials-uid"),oi.FIRST_PARTY=new oi("first-party-uid"),oi.MOCK_USER=new oi("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zm="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mf=new IC("@firebase/firestore");function zp(){return mf.logLevel}function st(n,...e){if(mf.logLevel<=nn.DEBUG){const t=e.map(jC);mf.debug(`Firestore (${zm}): ${n}`,...t)}}function qc(n,...e){if(mf.logLevel<=nn.ERROR){const t=e.map(jC);mf.error(`Firestore (${zm}): ${n}`,...t)}}function pm(n,...e){if(mf.logLevel<=nn.WARN){const t=e.map(jC);mf.warn(`Firestore (${zm}): ${n}`,...t)}}function jC(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nt(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Dj(n,s,t)}function Dj(n,e,t){let s=`FIRESTORE (${zm}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw qc(s),new Error(s)}function Nn(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||Dj(e,r,s)}function Lt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Be={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nt extends ic{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lj{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _te{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(oi.UNAUTHENTICATED)))}shutdown(){}}class xte{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class wte{constructor(e){this.t=e,this.currentUser=oi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Nn(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new zc;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new zc,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await r(this.currentUser)}))},o=l=>{st("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>o(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(st("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new zc)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(st("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Nn(typeof s.accessToken=="string",31837,{l:s}),new Lj(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Nn(e===null||typeof e=="string",2055,{h:e}),new oi(e)}}class Tte{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=oi.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ste{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new Tte(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(oi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class JO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ete{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,wa(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Nn(this.o===void 0,3512);const s=i=>{i.error!=null&&st("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,st("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{st("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):st("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new JO(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Nn(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new JO(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nte(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=Nte(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function sn(n,e){return n<e?-1:n>e?1:0}function FN(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return BE(r)===BE(i)?sn(r,i):BE(r)?1:-1}return sn(n.length,e.length)}const Ite=55296,Cte=57343;function BE(n){const e=n.charCodeAt(0);return e>=Ite&&e<=Cte}function mm(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP="__name__";class xl{constructor(e,t,s){t===void 0?t=0:t>e.length&&Nt(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&Nt(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return xl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof xl?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=xl.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return sn(e.length,t.length)}static compareSegments(e,t){const s=xl.isNumericId(e),r=xl.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?xl.extractNumericId(e).compare(xl.extractNumericId(t)):FN(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return vh.fromString(e.substring(4,e.length-2))}}class Qn extends xl{construct(e,t,s){return new Qn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new nt(Be.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new Qn(t)}static emptyPath(){return new Qn([])}}const kte=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fr extends xl{construct(e,t,s){return new Fr(e,t,s)}static isValidIdentifier(e){return kte.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===eP}static keyField(){return new Fr([eP])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new nt(Be.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new nt(Be.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new nt(Be.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(s+=o,r++):(i(),r++)}if(i(),a)throw new nt(Be.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fr(t)}static emptyPath(){return new Fr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e){this.path=e}static fromPath(e){return new gt(Qn.fromString(e))}static fromName(e){return new gt(Qn.fromString(e).popFirst(5))}static empty(){return new gt(Qn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Qn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Qn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new gt(new Qn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oj(n,e,t){if(!t)throw new nt(Be.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $te(n,e,t,s){if(e===!0&&s===!0)throw new nt(Be.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function tP(n){if(!gt.isDocumentKey(n))throw new nt(Be.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nP(n){if(gt.isDocumentKey(n))throw new nt(Be.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Pj(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function L1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Nt(12329,{type:typeof n})}function Wl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new nt(Be.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=L1(n);throw new nt(Be.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zs(n,e){const t={typeString:n};return e&&(t.value=e),t}function kv(n,e){if(!Pj(n))throw new nt(Be.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const a=n[s];if(r&&typeof a!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new nt(Be.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sP=-62135596800,rP=1e6;class ss{static now(){return ss.fromMillis(Date.now())}static fromDate(e){return ss.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*rP);return new ss(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new nt(Be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new nt(Be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<sP)throw new nt(Be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new nt(Be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rP}_compareTo(e){return this.seconds===e.seconds?sn(this.nanoseconds,e.nanoseconds):sn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ss._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(kv(e,ss._jsonSchema))return new ss(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-sP;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ss._jsonSchemaVersion="firestore/timestamp/1.0",ss._jsonSchema={type:Zs("string",ss._jsonSchemaVersion),seconds:Zs("number"),nanoseconds:Zs("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{static fromTimestamp(e){return new $t(e)}static min(){return new $t(new ss(0,0))}static max(){return new $t(new ss(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uy=-1;function Ate(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=$t.fromTimestamp(s===1e9?new ss(t+1,0):new ss(t,s));return new Nh(r,gt.empty(),e)}function Rte(n){return new Nh(n.readTime,n.key,Uy)}class Nh{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Nh($t.min(),gt.empty(),Uy)}static max(){return new Nh($t.max(),gt.empty(),Uy)}}function Dte(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=gt.comparator(n.documentKey,e.documentKey),t!==0?t:sn(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lte="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ote{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vm(n){if(n.code!==Be.FAILED_PRECONDITION||n.message!==Lte)throw n;st("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Nt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ue(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ue?t:Ue.resolve(t)}catch(t){return Ue.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ue.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ue.reject(t)}static resolve(e){return new Ue(((t,s)=>{t(e)}))}static reject(e){return new Ue(((t,s)=>{s(e)}))}static waitFor(e){return new Ue(((t,s)=>{let r=0,i=0,a=!1;e.forEach((o=>{++r,o.next((()=>{++i,a&&i===r&&t()}),(l=>s(l)))})),a=!0,i===r&&t()}))}static or(e){let t=Ue.resolve(!1);for(const s of e)t=t.next((r=>r?Ue.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new Ue(((s,r)=>{const i=e.length,a=new Array(i);let o=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next((h=>{a[c]=h,++o,o===i&&s(a)}),(h=>r(h)))}}))}static doWhile(e,t){return new Ue(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}function Pte(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Um(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}O1.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zC=-1;function P1(n){return n==null}function T0(n){return n===0&&1/n==-1/0}function Mte(n){return typeof n=="number"&&Number.isInteger(n)&&!T0(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mj="";function Fte(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=iP(e)),e=jte(n.get(t),e);return iP(e)}function jte(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case Mj:t+="";break;default:t+=i}}return t}function iP(n){return n+Mj+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aP(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function qh(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Fj(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(e,t){this.comparator=e,this.root=t||Pr.EMPTY}insert(e,t){return new vs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pr.BLACK,null,null))}remove(e){return new vs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bx(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bx(this.root,e,this.comparator,!1)}getReverseIterator(){return new bx(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bx(this.root,e,this.comparator,!0)}}class bx{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pr{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Pr.RED,this.left=r??Pr.EMPTY,this.right=i??Pr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Pr(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Pr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Pr.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Nt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Nt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Nt(27949);return e+(this.isRed()?0:1)}}Pr.EMPTY=null,Pr.RED=!0,Pr.BLACK=!1;Pr.EMPTY=new class{constructor(){this.size=0}get key(){throw Nt(57766)}get value(){throw Nt(16141)}get color(){throw Nt(16727)}get left(){throw Nt(29726)}get right(){throw Nt(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Pr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this.comparator=e,this.data=new vs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new oP(this.data.getIterator())}getIteratorFrom(e){return new oP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof dr)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new dr(this.comparator);return t.data=e,t}}class oP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this.fields=e,e.sort(Fr.comparator)}static empty(){return new Sa([])}unionWith(e){let t=new dr(Fr.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Sa(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return mm(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new jj("Invalid base64 string: "+i):i}})(e);return new Vr(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let a=0;a<r.length;++a)i+=String.fromCharCode(r[a]);return i})(e);return new Vr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return sn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Vr.EMPTY_BYTE_STRING=new Vr("");const Bte=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ih(n){if(Nn(!!n,39018),typeof n=="string"){let e=0;const t=Bte.exec(n);if(Nn(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Os(n.seconds),nanos:Os(n.nanos)}}function Os(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ch(n){return typeof n=="string"?Vr.fromBase64String(n):Vr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bj="server_timestamp",zj="__type__",Vj="__previous_value__",Uj="__local_write_time__";function VC(n){return(n?.mapValue?.fields||{})[zj]?.stringValue===Bj}function M1(n){const e=n.mapValue.fields[Vj];return VC(e)?M1(e):e}function Gy(n){const e=Ih(n.mapValue.fields[Uj].timestampValue);return new ss(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zte{constructor(e,t,s,r,i,a,o,l,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=h}}const S0="(default)";class Wy{constructor(e,t){this.projectId=e,this.database=t||S0}static empty(){return new Wy("","")}get isDefaultDatabase(){return this.database===S0}isEqual(e){return e instanceof Wy&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gj="__type__",Vte="__max__",_x={mapValue:{}},Wj="__vector__",E0="value";function kh(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?VC(n)?4:Gte(n)?9007199254740991:Ute(n)?10:11:Nt(28295,{value:n})}function Hl(n,e){if(n===e)return!0;const t=kh(n);if(t!==kh(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Gy(n).isEqual(Gy(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const a=Ih(r.timestampValue),o=Ih(i.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return Ch(r.bytesValue).isEqual(Ch(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return Os(r.geoPointValue.latitude)===Os(i.geoPointValue.latitude)&&Os(r.geoPointValue.longitude)===Os(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return Os(r.integerValue)===Os(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const a=Os(r.doubleValue),o=Os(i.doubleValue);return a===o?T0(a)===T0(o):isNaN(a)&&isNaN(o)}return!1})(n,e);case 9:return mm(n.arrayValue.values||[],e.arrayValue.values||[],Hl);case 10:case 11:return(function(r,i){const a=r.mapValue.fields||{},o=i.mapValue.fields||{};if(aP(a)!==aP(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!Hl(a[l],o[l])))return!1;return!0})(n,e);default:return Nt(52216,{left:n})}}function Hy(n,e){return(n.values||[]).find((t=>Hl(t,e)))!==void 0}function gm(n,e){if(n===e)return 0;const t=kh(n),s=kh(e);if(t!==s)return sn(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return sn(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const o=Os(i.integerValue||i.doubleValue),l=Os(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1})(n,e);case 3:return lP(n.timestampValue,e.timestampValue);case 4:return lP(Gy(n),Gy(e));case 5:return FN(n.stringValue,e.stringValue);case 6:return(function(i,a){const o=Ch(i),l=Ch(a);return o.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const o=i.split("/"),l=a.split("/");for(let c=0;c<o.length&&c<l.length;c++){const h=sn(o[c],l[c]);if(h!==0)return h}return sn(o.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const o=sn(Os(i.latitude),Os(a.latitude));return o!==0?o:sn(Os(i.longitude),Os(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return cP(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const o=i.fields||{},l=a.fields||{},c=o[E0]?.arrayValue,h=l[E0]?.arrayValue,p=sn(c?.values?.length||0,h?.values?.length||0);return p!==0?p:cP(c,h)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===_x.mapValue&&a===_x.mapValue)return 0;if(i===_x.mapValue)return 1;if(a===_x.mapValue)return-1;const o=i.fields||{},l=Object.keys(o),c=a.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let p=0;p<l.length&&p<h.length;++p){const m=FN(l[p],h[p]);if(m!==0)return m;const v=gm(o[l[p]],c[h[p]]);if(v!==0)return v}return sn(l.length,h.length)})(n.mapValue,e.mapValue);default:throw Nt(23264,{he:t})}}function lP(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return sn(n,e);const t=Ih(n),s=Ih(e),r=sn(t.seconds,s.seconds);return r!==0?r:sn(t.nanos,s.nanos)}function cP(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=gm(t[r],s[r]);if(i)return i}return sn(t.length,s.length)}function ym(n){return jN(n)}function jN(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Ih(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ch(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return gt.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=jN(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const a of s)i?i=!1:r+=",",r+=`${a}:${jN(t.fields[a])}`;return r+"}"})(n.mapValue):Nt(61005,{value:n})}function qx(n){switch(kh(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=M1(n);return e?16+qx(e):16;case 5:return 2*n.stringValue.length;case 6:return Ch(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+qx(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return qh(s.fields,((i,a)=>{r+=i.length+qx(a)})),r})(n.mapValue);default:throw Nt(13486,{value:n})}}function uP(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function BN(n){return!!n&&"integerValue"in n}function UC(n){return!!n&&"arrayValue"in n}function hP(n){return!!n&&"nullValue"in n}function dP(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Kx(n){return!!n&&"mapValue"in n}function Ute(n){return(n?.mapValue?.fields||{})[Gj]?.stringValue===Wj}function $y(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return qh(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=$y(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=$y(n.arrayValue.values[t]);return e}return{...n}}function Gte(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Vte}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e){this.value=e}static empty(){return new qi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Kx(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=$y(t)}setAll(e){let t=Fr.emptyPath(),s={},r=[];e.forEach(((a,o)=>{if(!t.isImmediateParentOf(o)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=o.popLast()}a?s[o.lastSegment()]=$y(a):r.push(o.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());Kx(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Hl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Kx(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){qh(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new qi($y(this.value))}}function Hj(n){const e=[];return qh(n.fields,((t,s)=>{const r=new Fr([t]);if(Kx(s)){const i=Hj(s.mapValue).fields;if(i.length===0)e.push(r);else for(const a of i)e.push(r.child(a))}else e.push(r)})),new Sa(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,t,s,r,i,a,o){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(e){return new ci(e,0,$t.min(),$t.min(),$t.min(),qi.empty(),0)}static newFoundDocument(e,t,s,r){return new ci(e,1,t,$t.min(),s,r,0)}static newNoDocument(e,t){return new ci(e,2,t,$t.min(),$t.min(),qi.empty(),0)}static newUnknownDocument(e,t){return new ci(e,3,t,$t.min(),$t.min(),qi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($t.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$t.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ci&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ci(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e,t){this.position=e,this.inclusive=t}}function fP(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],a=n.position[r];if(i.field.isKeyField()?s=gt.comparator(gt.fromName(a.referenceValue),t.key):s=gm(a,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function pP(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Hl(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e,t="asc"){this.field=e,this.dir=t}}function Wte(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj{}class Xs extends qj{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new qte(e,t,s):t==="array-contains"?new Zte(e,s):t==="in"?new Yte(e,s):t==="not-in"?new Qte(e,s):t==="array-contains-any"?new Jte(e,s):new Xs(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new Kte(e,s):new Xte(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(gm(t,this.value)):t!==null&&kh(this.value)===kh(t)&&this.matchesComparison(gm(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Nt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class qo extends qj{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new qo(e,t)}matches(e){return Kj(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Kj(n){return n.op==="and"}function Xj(n){return Hte(n)&&Kj(n)}function Hte(n){for(const e of n.filters)if(e instanceof qo)return!1;return!0}function zN(n){if(n instanceof Xs)return n.field.canonicalString()+n.op.toString()+ym(n.value);if(Xj(n))return n.filters.map((e=>zN(e))).join(",");{const e=n.filters.map((t=>zN(t))).join(",");return`${n.op}(${e})`}}function Zj(n,e){return n instanceof Xs?(function(s,r){return r instanceof Xs&&s.op===r.op&&s.field.isEqual(r.field)&&Hl(s.value,r.value)})(n,e):n instanceof qo?(function(s,r){return r instanceof qo&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,a,o)=>i&&Zj(a,r.filters[o])),!0):!1})(n,e):void Nt(19439)}function Yj(n){return n instanceof Xs?(function(t){return`${t.field.canonicalString()} ${t.op} ${ym(t.value)}`})(n):n instanceof qo?(function(t){return t.op.toString()+" {"+t.getFilters().map(Yj).join(" ,")+"}"})(n):"Filter"}class qte extends Xs{constructor(e,t,s){super(e,t,s),this.key=gt.fromName(s.referenceValue)}matches(e){const t=gt.comparator(e.key,this.key);return this.matchesComparison(t)}}class Kte extends Xs{constructor(e,t){super(e,"in",t),this.keys=Qj("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Xte extends Xs{constructor(e,t){super(e,"not-in",t),this.keys=Qj("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Qj(n,e){return(e.arrayValue?.values||[]).map((t=>gt.fromName(t.referenceValue)))}class Zte extends Xs{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return UC(t)&&Hy(t.arrayValue,this.value)}}class Yte extends Xs{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Hy(this.value.arrayValue,t)}}class Qte extends Xs{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Hy(this.value.arrayValue,t)}}class Jte extends Xs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!UC(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Hy(this.value.arrayValue,s)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ene{constructor(e,t=null,s=[],r=[],i=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=a,this.endAt=o,this.Te=null}}function mP(n,e=null,t=[],s=[],r=null,i=null,a=null){return new ene(n,e,t,s,r,i,a)}function GC(n){const e=Lt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>zN(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),P1(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>ym(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>ym(s))).join(",")),e.Te=t}return e.Te}function WC(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Wte(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Zj(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!pP(n.startAt,e.startAt)&&pP(n.endAt,e.endAt)}function VN(n){return gt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e,t=null,s=[],r=[],i=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tne(n,e,t,s,r,i,a,o){return new $v(n,e,t,s,r,i,a,o)}function HC(n){return new $v(n)}function gP(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Jj(n){return n.collectionGroup!==null}function Ay(n){const e=Lt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new dr(Fr.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((c=>{c.isInequality()&&(o=o.add(c.field))}))})),o})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new I0(i,s))})),t.has(Fr.keyField().canonicalString())||e.Ie.push(new I0(Fr.keyField(),s))}return e.Ie}function Ll(n){const e=Lt(n);return e.Ee||(e.Ee=nne(e,Ay(n))),e.Ee}function nne(n,e){if(n.limitType==="F")return mP(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new I0(r.field,i)}));const t=n.endAt?new N0(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new N0(n.startAt.position,n.startAt.inclusive):null;return mP(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function UN(n,e){const t=n.filters.concat([e]);return new $v(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function GN(n,e,t){return new $v(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function F1(n,e){return WC(Ll(n),Ll(e))&&n.limitType===e.limitType}function e4(n){return`${GC(Ll(n))}|lt:${n.limitType}`}function Vp(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>Yj(r))).join(", ")}]`),P1(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>ym(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>ym(r))).join(",")),`Target(${s})`})(Ll(n))}; limitType=${n.limitType})`}function j1(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):gt.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of Ay(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(a,o,l){const c=fP(a,o,l);return a.inclusive?c<=0:c<0})(s.startAt,Ay(s),r)||s.endAt&&!(function(a,o,l){const c=fP(a,o,l);return a.inclusive?c>=0:c>0})(s.endAt,Ay(s),r))})(n,e)}function sne(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function t4(n){return(e,t)=>{let s=!1;for(const r of Ay(n)){const i=rne(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function rne(n,e,t){const s=n.field.isKeyField()?gt.comparator(e.key,t.key):(function(i,a,o){const l=a.data.field(i),c=o.data.field(i);return l!==null&&c!==null?gm(l,c):Nt(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Nt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){qh(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return Fj(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ine=new vs(gt.comparator);function Kc(){return ine}const n4=new vs(gt.comparator);function gy(...n){let e=n4;for(const t of n)e=e.insert(t.key,t);return e}function s4(n){let e=n4;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function Yd(){return Ry()}function r4(){return Ry()}function Ry(){return new Vf((n=>n.toString()),((n,e)=>n.isEqual(e)))}const ane=new vs(gt.comparator),one=new dr(gt.comparator);function rn(...n){let e=one;for(const t of n)e=e.add(t);return e}const lne=new dr(sn);function cne(){return lne}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qC(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:T0(e)?"-0":e}}function i4(n){return{integerValue:""+n}}function une(n,e){return Mte(e)?i4(e):qC(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(){this._=void 0}}function hne(n,e,t){return n instanceof qy?(function(r,i){const a={fields:{[zj]:{stringValue:Bj},[Uj]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&VC(i)&&(i=M1(i)),i&&(a.fields[Vj]=i),{mapValue:a}})(t,e):n instanceof Ky?o4(n,e):n instanceof Xy?l4(n,e):(function(r,i){const a=a4(r,i),o=yP(a)+yP(r.Ae);return BN(a)&&BN(r.Ae)?i4(o):qC(r.serializer,o)})(n,e)}function dne(n,e,t){return n instanceof Ky?o4(n,e):n instanceof Xy?l4(n,e):t}function a4(n,e){return n instanceof C0?(function(s){return BN(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class qy extends B1{}class Ky extends B1{constructor(e){super(),this.elements=e}}function o4(n,e){const t=c4(e);for(const s of n.elements)t.some((r=>Hl(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Xy extends B1{constructor(e){super(),this.elements=e}}function l4(n,e){let t=c4(e);for(const s of n.elements)t=t.filter((r=>!Hl(r,s)));return{arrayValue:{values:t}}}class C0 extends B1{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function yP(n){return Os(n.integerValue||n.doubleValue)}function c4(n){return UC(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fne{constructor(e,t){this.field=e,this.transform=t}}function pne(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Ky&&r instanceof Ky||s instanceof Xy&&r instanceof Xy?mm(s.elements,r.elements,Hl):s instanceof C0&&r instanceof C0?Hl(s.Ae,r.Ae):s instanceof qy&&r instanceof qy})(n.transform,e.transform)}class mne{constructor(e,t){this.version=e,this.transformResults=t}}class zo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new zo}static exists(e){return new zo(void 0,e)}static updateTime(e){return new zo(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xx(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class z1{}function u4(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new d4(n.key,zo.none()):new Av(n.key,n.data,zo.none());{const t=n.data,s=qi.empty();let r=new dr(Fr.comparator);for(let i of e.fields)if(!r.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?s.delete(i):s.set(i,a),r=r.add(i)}return new Kh(n.key,s,new Sa(r.toArray()),zo.none())}}function gne(n,e,t){n instanceof Av?(function(r,i,a){const o=r.value.clone(),l=bP(r.fieldTransforms,i,a.transformResults);o.setAll(l),i.convertToFoundDocument(a.version,o).setHasCommittedMutations()})(n,e,t):n instanceof Kh?(function(r,i,a){if(!Xx(r.precondition,i))return void i.convertToUnknownDocument(a.version);const o=bP(r.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(h4(r)),l.setAll(o),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(r,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Dy(n,e,t,s){return n instanceof Av?(function(i,a,o,l){if(!Xx(i.precondition,a))return o;const c=i.value.clone(),h=_P(i.fieldTransforms,l,a);return c.setAll(h),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),null})(n,e,t,s):n instanceof Kh?(function(i,a,o,l){if(!Xx(i.precondition,a))return o;const c=_P(i.fieldTransforms,l,a),h=a.data;return h.setAll(h4(i)),h.setAll(c),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((p=>p.field)))})(n,e,t,s):(function(i,a,o){return Xx(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o})(n,e,t)}function yne(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=a4(s.transform,r||null);i!=null&&(t===null&&(t=qi.empty()),t.set(s.field,i))}return t||null}function vP(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&mm(s,r,((i,a)=>pne(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Av extends z1{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Kh extends z1{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function h4(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function bP(n,e,t){const s=new Map;Nn(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],a=i.transform,o=e.data.field(i.field);s.set(i.field,dne(a,o,t[r]))}return s}function _P(n,e,t){const s=new Map;for(const r of n){const i=r.transform,a=t.data.field(r.field);s.set(r.field,hne(i,a,e))}return s}class d4 extends z1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vne extends z1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bne{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&gne(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Dy(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Dy(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=r4();return this.mutations.forEach((r=>{const i=e.get(r.key),a=i.overlayedDocument;let o=this.applyToLocalView(a,i.mutatedFields);o=t.has(r.key)?null:o;const l=u4(a,o);l!==null&&s.set(r.key,l),a.isValidDocument()||a.convertToNoDocument($t.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),rn())}isEqual(e){return this.batchId===e.batchId&&mm(this.mutations,e.mutations,((t,s)=>vP(t,s)))&&mm(this.baseMutations,e.baseMutations,((t,s)=>vP(t,s)))}}class KC{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){Nn(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return ane})();const i=e.mutations;for(let a=0;a<i.length;a++)r=r.insert(i[a].key,s[a].version);return new KC(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ne{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xne{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qs,fn;function wne(n){switch(n){case Be.OK:return Nt(64938);case Be.CANCELLED:case Be.UNKNOWN:case Be.DEADLINE_EXCEEDED:case Be.RESOURCE_EXHAUSTED:case Be.INTERNAL:case Be.UNAVAILABLE:case Be.UNAUTHENTICATED:return!1;case Be.INVALID_ARGUMENT:case Be.NOT_FOUND:case Be.ALREADY_EXISTS:case Be.PERMISSION_DENIED:case Be.FAILED_PRECONDITION:case Be.ABORTED:case Be.OUT_OF_RANGE:case Be.UNIMPLEMENTED:case Be.DATA_LOSS:return!0;default:return Nt(15467,{code:n})}}function f4(n){if(n===void 0)return qc("GRPC error has no .code"),Be.UNKNOWN;switch(n){case qs.OK:return Be.OK;case qs.CANCELLED:return Be.CANCELLED;case qs.UNKNOWN:return Be.UNKNOWN;case qs.DEADLINE_EXCEEDED:return Be.DEADLINE_EXCEEDED;case qs.RESOURCE_EXHAUSTED:return Be.RESOURCE_EXHAUSTED;case qs.INTERNAL:return Be.INTERNAL;case qs.UNAVAILABLE:return Be.UNAVAILABLE;case qs.UNAUTHENTICATED:return Be.UNAUTHENTICATED;case qs.INVALID_ARGUMENT:return Be.INVALID_ARGUMENT;case qs.NOT_FOUND:return Be.NOT_FOUND;case qs.ALREADY_EXISTS:return Be.ALREADY_EXISTS;case qs.PERMISSION_DENIED:return Be.PERMISSION_DENIED;case qs.FAILED_PRECONDITION:return Be.FAILED_PRECONDITION;case qs.ABORTED:return Be.ABORTED;case qs.OUT_OF_RANGE:return Be.OUT_OF_RANGE;case qs.UNIMPLEMENTED:return Be.UNIMPLEMENTED;case qs.DATA_LOSS:return Be.DATA_LOSS;default:return Nt(39323,{code:n})}}(fn=qs||(qs={}))[fn.OK=0]="OK",fn[fn.CANCELLED=1]="CANCELLED",fn[fn.UNKNOWN=2]="UNKNOWN",fn[fn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fn[fn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fn[fn.NOT_FOUND=5]="NOT_FOUND",fn[fn.ALREADY_EXISTS=6]="ALREADY_EXISTS",fn[fn.PERMISSION_DENIED=7]="PERMISSION_DENIED",fn[fn.UNAUTHENTICATED=16]="UNAUTHENTICATED",fn[fn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fn[fn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fn[fn.ABORTED=10]="ABORTED",fn[fn.OUT_OF_RANGE=11]="OUT_OF_RANGE",fn[fn.UNIMPLEMENTED=12]="UNIMPLEMENTED",fn[fn.INTERNAL=13]="INTERNAL",fn[fn.UNAVAILABLE=14]="UNAVAILABLE",fn[fn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tne(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sne=new vh([4294967295,4294967295],0);function xP(n){const e=Tne().encode(n),t=new Ij;return t.update(e),new Uint8Array(t.digest())}function wP(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new vh([t,s],0),new vh([r,i],0)]}class XC{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new yy(`Invalid padding: ${t}`);if(s<0)throw new yy(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new yy(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new yy(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=vh.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(vh.fromNumber(s)));return r.compare(Sne)===1&&(r=new vh([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=xP(e),[s,r]=wP(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(s,r,i);if(!this.we(a))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new XC(i,r,t);return s.forEach((o=>a.insert(o))),a}insert(e){if(this.ge===0)return;const t=xP(e),[s,r]=wP(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(s,r,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class yy extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V1{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,Rv.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new V1($t.min(),r,new vs(sn),Kc(),rn())}}class Rv{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Rv(s,t,rn(),rn(),rn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zx{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class p4{constructor(e,t){this.targetId=e,this.Ce=t}}class m4{constructor(e,t,s=Vr.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class TP{constructor(){this.ve=0,this.Fe=SP(),this.Me=Vr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rn(),t=rn(),s=rn();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:Nt(38017,{changeType:i})}})),new Rv(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=SP()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Nn(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Ene{constructor(e){this.Ge=e,this.ze=new Map,this.je=Kc(),this.Je=xx(),this.He=xx(),this.Ye=new vs(sn)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:Nt(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(VN(i))if(s===0){const a=new gt(i.path);this.et(t,a,ci.newNoDocument(a,$t.min()))}else Nn(s===1,20013,{expectedCount:s});else{const a=this._t(t);if(a!==s){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,c)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let a,o;try{a=Ch(s).toUint8Array()}catch(l){if(l instanceof jj)return pm("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new XC(a,r,i)}catch(l){return pm(l instanceof yy?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(o)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const o=this.ot(a);if(o){if(i.current&&VN(o.target)){const l=new gt(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,ci.newNoDocument(l,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let s=rn();this.He.forEach(((i,a)=>{let o=!0;a.forEachWhile((l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)})),o&&(s=s.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const r=new V1(e,t,this.Ye,this.je,s);return this.je=Kc(),this.Je=xx(),this.He=xx(),this.Ye=new vs(sn),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new TP,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new dr(sn),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new dr(sn),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||st("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new TP),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function xx(){return new vs(gt.comparator)}function SP(){return new vs(gt.comparator)}const Nne={asc:"ASCENDING",desc:"DESCENDING"},Ine={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cne={and:"AND",or:"OR"};class kne{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function WN(n,e){return n.useProto3Json||P1(e)?e:{value:e}}function k0(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function g4(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function $ne(n,e){return k0(n,e.toTimestamp())}function Ol(n){return Nn(!!n,49232),$t.fromTimestamp((function(t){const s=Ih(t);return new ss(s.seconds,s.nanos)})(n))}function ZC(n,e){return HN(n,e).canonicalString()}function HN(n,e){const t=(function(r){return new Qn(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function y4(n){const e=Qn.fromString(n);return Nn(w4(e),10190,{key:e.toString()}),e}function qN(n,e){return ZC(n.databaseId,e.path)}function zE(n,e){const t=y4(e);if(t.get(1)!==n.databaseId.projectId)throw new nt(Be.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new nt(Be.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new gt(b4(t))}function v4(n,e){return ZC(n.databaseId,e)}function Ane(n){const e=y4(n);return e.length===4?Qn.emptyPath():b4(e)}function KN(n){return new Qn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function b4(n){return Nn(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function EP(n,e,t){return{name:qN(n,e),fields:t.value.mapValue.fields}}function Rne(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Nt(39313,{state:c})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(c,h){return c.useProto3Json?(Nn(h===void 0||typeof h=="string",58123),Vr.fromBase64String(h||"")):(Nn(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Vr.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&(function(c){const h=c.code===void 0?Be.UNKNOWN:f4(c.code);return new nt(h,c.message||"")})(a);t=new m4(s,r,i,o||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=zE(n,s.document.name),i=Ol(s.document.updateTime),a=s.document.createTime?Ol(s.document.createTime):$t.min(),o=new qi({mapValue:{fields:s.document.fields}}),l=ci.newFoundDocument(r,i,a,o),c=s.targetIds||[],h=s.removedTargetIds||[];t=new Zx(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=zE(n,s.document),i=s.readTime?Ol(s.readTime):$t.min(),a=ci.newNoDocument(r,i),o=s.removedTargetIds||[];t=new Zx([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=zE(n,s.document),i=s.removedTargetIds||[];t=new Zx([],i,r,null)}else{if(!("filter"in e))return Nt(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,a=new xne(r,i),o=s.targetId;t=new p4(o,a)}}return t}function Dne(n,e){let t;if(e instanceof Av)t={update:EP(n,e.key,e.value)};else if(e instanceof d4)t={delete:qN(n,e.key)};else if(e instanceof Kh)t={update:EP(n,e.key,e.data),updateMask:Vne(e.fieldMask)};else{if(!(e instanceof vne))return Nt(16599,{Vt:e.type});t={verify:qN(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,a){const o=a.transform;if(o instanceof qy)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Ky)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Xy)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof C0)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw Nt(20930,{transform:a.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:$ne(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Nt(27497)})(n,e.precondition)),t}function Lne(n,e){return n&&n.length>0?(Nn(e!==void 0,14353),n.map((t=>(function(r,i){let a=r.updateTime?Ol(r.updateTime):Ol(i);return a.isEqual($t.min())&&(a=Ol(i)),new mne(a,r.transformResults||[])})(t,e)))):[]}function One(n,e){return{documents:[v4(n,e.path)]}}function Pne(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=v4(n,r);const i=(function(c){if(c.length!==0)return x4(qo.create(c,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(c){if(c.length!==0)return c.map((h=>(function(m){return{field:Up(m.field),direction:jne(m.dir)}})(h)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=WN(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=(function(c){return{before:c.inclusive,values:c.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(c){return{before:!c.inclusive,values:c.position}})(e.endAt)),{ft:t,parent:r}}function Mne(n){let e=Ane(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){Nn(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(p){const m=_4(p);return m instanceof qo&&Xj(m)?m.getFilters():[m]})(t.where));let a=[];t.orderBy&&(a=(function(p){return p.map((m=>(function(_){return new I0(Gp(_.field),(function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(_.direction))})(m)))})(t.orderBy));let o=null;t.limit&&(o=(function(p){let m;return m=typeof p=="object"?p.value:p,P1(m)?null:m})(t.limit));let l=null;t.startAt&&(l=(function(p){const m=!!p.before,v=p.values||[];return new N0(v,m)})(t.startAt));let c=null;return t.endAt&&(c=(function(p){const m=!p.before,v=p.values||[];return new N0(v,m)})(t.endAt)),tne(e,r,a,i,o,"F",l,c)}function Fne(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Nt(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function _4(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Gp(t.unaryFilter.field);return Xs.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Gp(t.unaryFilter.field);return Xs.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Gp(t.unaryFilter.field);return Xs.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Gp(t.unaryFilter.field);return Xs.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Nt(61313);default:return Nt(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Xs.create(Gp(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Nt(58110);default:return Nt(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return qo.create(t.compositeFilter.filters.map((s=>_4(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Nt(1026)}})(t.compositeFilter.op))})(n):Nt(30097,{filter:n})}function jne(n){return Nne[n]}function Bne(n){return Ine[n]}function zne(n){return Cne[n]}function Up(n){return{fieldPath:n.canonicalString()}}function Gp(n){return Fr.fromServerFormat(n.fieldPath)}function x4(n){return n instanceof Xs?(function(t){if(t.op==="=="){if(dP(t.value))return{unaryFilter:{field:Up(t.field),op:"IS_NAN"}};if(hP(t.value))return{unaryFilter:{field:Up(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dP(t.value))return{unaryFilter:{field:Up(t.field),op:"IS_NOT_NAN"}};if(hP(t.value))return{unaryFilter:{field:Up(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Up(t.field),op:Bne(t.op),value:t.value}}})(n):n instanceof qo?(function(t){const s=t.getFilters().map((r=>x4(r)));return s.length===1?s[0]:{compositeFilter:{op:zne(t.op),filters:s}}})(n):Nt(54877,{filter:n})}function Vne(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function w4(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e,t,s,r,i=$t.min(),a=$t.min(),o=Vr.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new ch(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ch(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ch(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ch(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Une{constructor(e){this.yt=e}}function Gne(n){const e=Mne({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?GN(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wne{constructor(){this.Cn=new Hne}addToCollectionParentIndex(e,t){return this.Cn.add(t),Ue.resolve()}getCollectionParents(e,t){return Ue.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Ue.resolve()}deleteFieldIndex(e,t){return Ue.resolve()}deleteAllFieldIndexes(e){return Ue.resolve()}createTargetIndexes(e,t){return Ue.resolve()}getDocumentsMatchingTarget(e,t){return Ue.resolve(null)}getIndexType(e,t){return Ue.resolve(0)}getFieldIndexes(e,t){return Ue.resolve([])}getNextCollectionGroupToUpdate(e){return Ue.resolve(null)}getMinOffset(e,t){return Ue.resolve(Nh.min())}getMinOffsetFromCollectionGroup(e,t){return Ue.resolve(Nh.min())}updateCollectionGroup(e,t,s){return Ue.resolve()}updateIndexEntries(e,t){return Ue.resolve()}}class Hne{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new dr(Qn.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new dr(Qn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NP={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},T4=41943040;class Wi{static withCacheSize(e){return new Wi(e,Wi.DEFAULT_COLLECTION_PERCENTILE,Wi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Wi.DEFAULT_COLLECTION_PERCENTILE=10,Wi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Wi.DEFAULT=new Wi(T4,Wi.DEFAULT_COLLECTION_PERCENTILE,Wi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Wi.DISABLED=new Wi(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new vm(0)}static cr(){return new vm(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP="LruGarbageCollector",qne=1048576;function CP([n,e],[t,s]){const r=sn(n,t);return r===0?sn(e,s):r}class Kne{constructor(e){this.Ir=e,this.buffer=new dr(CP),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();CP(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xne{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){st(IP,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Um(t)?st(IP,"Ignoring IndexedDB error during garbage collection: ",t):await Vm(t)}await this.Vr(3e5)}))}}class Zne{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return Ue.resolve(O1.ce);const s=new Kne(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(st("LruGarbageCollector","Garbage collection skipped; disabled"),Ue.resolve(NP)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(st("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),NP):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,a,o,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(st("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,a=Date.now(),this.nthSequenceNumber(e,r)))).next((p=>(s=p,o=Date.now(),this.removeTargets(e,s,t)))).next((p=>(i=p,l=Date.now(),this.removeOrphanedDocuments(e,s)))).next((p=>(c=Date.now(),zp()<=nn.DEBUG&&st("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${r} in `+(o-a)+`ms
	Removed ${i} targets in `+(l-o)+`ms
	Removed ${p} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),Ue.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:p}))))}}function Yne(n,e){return new Zne(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qne{constructor(){this.changes=new Vf((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ci.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?Ue.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jne{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&Dy(s.mutation,r,Sa.empty(),ss.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,rn()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=rn()){const r=Yd();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let a=gy();return i.forEach(((o,l)=>{a=a.insert(o,l.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const s=Yd();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,rn())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((a,o)=>{t.set(a,o)}))}))}computeViews(e,t,s,r){let i=Kc();const a=Ry(),o=(function(){return Ry()})();return t.forEach(((l,c)=>{const h=s.get(c.key);r.has(c.key)&&(h===void 0||h.mutation instanceof Kh)?i=i.insert(c.key,c):h!==void 0?(a.set(c.key,h.mutation.getFieldMask()),Dy(h.mutation,c,h.mutation.getFieldMask(),ss.now())):a.set(c.key,Sa.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((c,h)=>a.set(c,h))),t.forEach(((c,h)=>o.set(c,new Jne(h,a.get(c)??null)))),o)))}recalculateAndSaveOverlays(e,t){const s=Ry();let r=new vs(((a,o)=>a-o)),i=rn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const o of a)o.keys().forEach((l=>{const c=t.get(l);if(c===null)return;let h=s.get(l)||Sa.empty();h=o.applyToLocalView(c,h),s.set(l,h);const p=(r.get(o.batchId)||rn()).add(l);r=r.insert(o.batchId,p)}))})).next((()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),c=l.key,h=l.value,p=r4();h.forEach((m=>{if(!i.has(m)){const v=u4(t.get(m),s.get(m));v!==null&&p.set(m,v),i=i.add(m)}})),a.push(this.documentOverlayCache.saveOverlays(e,c,p))}return Ue.waitFor(a)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(a){return gt.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jj(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):Ue.resolve(Yd());let o=Uy,l=i;return a.next((c=>Ue.forEach(c,((h,p)=>(o<p.largestBatchId&&(o=p.largestBatchId),i.get(h)?Ue.resolve():this.remoteDocumentCache.getEntry(e,h).next((m=>{l=l.insert(h,m)}))))).next((()=>this.populateOverlays(e,c,i))).next((()=>this.computeViews(e,l,c,rn()))).next((h=>({batchId:o,changes:s4(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new gt(t)).next((s=>{let r=gy();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let a=gy();return this.indexManager.getCollectionParents(e,i).next((o=>Ue.forEach(o,(l=>{const c=(function(p,m){return new $v(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,s,r).next((h=>{h.forEach(((p,m)=>{a=a.insert(p,m)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((a=>{i.forEach(((l,c)=>{const h=c.getKey();a.get(h)===null&&(a=a.insert(h,ci.newInvalidDocument(h)))}));let o=gy();return a.forEach(((l,c)=>{const h=i.get(l);h!==void 0&&Dy(h.mutation,c,Sa.empty(),ss.now()),j1(t,c)&&(o=o.insert(l,c))})),o}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tse{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Ue.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:Ol(r.createTime)}})(t)),Ue.resolve()}getNamedQuery(e,t){return Ue.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:Gne(r.bundledQuery),readTime:Ol(r.readTime)}})(t)),Ue.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nse{constructor(){this.overlays=new vs(gt.comparator),this.qr=new Map}getOverlay(e,t){return Ue.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Yd();return Ue.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),Ue.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),Ue.resolve()}getOverlaysForCollection(e,t,s){const r=Yd(),i=t.length+1,a=new gt(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return Ue.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new vs(((c,h)=>c-h));const a=this.overlays.getIterator();for(;a.hasNext();){const c=a.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>s){let h=i.get(c.largestBatchId);h===null&&(h=Yd(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const o=Yd(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((c,h)=>o.set(c,h))),!(o.size()>=r)););return Ue.resolve(o)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const a=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(s.key,new _ne(t,s));let i=this.qr.get(t);i===void 0&&(i=rn(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sse{constructor(){this.sessionToken=Vr.EMPTY_BYTE_STRING}getSessionToken(e){return Ue.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ue.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(){this.Qr=new dr(wr.$r),this.Ur=new dr(wr.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new wr(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new wr(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new gt(new Qn([])),s=new wr(t,e),r=new wr(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new gt(new Qn([])),s=new wr(t,e),r=new wr(t,e+1);let i=rn();return this.Ur.forEachInRange([s,r],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new wr(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class wr{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return gt.comparator(e.key,t.key)||sn(e.Yr,t.Yr)}static Kr(e,t){return sn(e.Yr,t.Yr)||gt.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rse{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new dr(wr.$r)}checkEmpty(e){return Ue.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new bne(i,t,s,r);this.mutationQueue.push(a);for(const o of r)this.Zr=this.Zr.add(new wr(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Ue.resolve(a)}lookupMutationBatch(e,t){return Ue.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return Ue.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ue.resolve(this.mutationQueue.length===0?zC:this.tr-1)}getAllMutationBatches(e){return Ue.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new wr(t,0),r=new wr(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(a=>{const o=this.Xr(a.Yr);i.push(o)})),Ue.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new dr(sn);return t.forEach((r=>{const i=new wr(r,0),a=new wr(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(o=>{s=s.add(o.Yr)}))})),Ue.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;gt.isDocumentKey(i)||(i=i.child(""));const a=new wr(new gt(i),0);let o=new dr(sn);return this.Zr.forEachWhile((l=>{const c=l.key.path;return!!s.isPrefixOf(c)&&(c.length===r&&(o=o.add(l.Yr)),!0)}),a),Ue.resolve(this.ti(o))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){Nn(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return Ue.forEach(t.mutations,(r=>{const i=new wr(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new wr(t,0),r=this.Zr.firstAfterOrEqual(s);return Ue.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ue.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ise{constructor(e){this.ri=e,this.docs=(function(){return new vs(gt.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,a=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return Ue.resolve(s?s.document.mutableCopy():ci.newInvalidDocument(t))}getEntries(e,t){let s=Kc();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():ci.newInvalidDocument(r))})),Ue.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=Kc();const a=t.path,o=new gt(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||Dte(Rte(h),s)<=0||(r.has(h.key)||j1(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return Ue.resolve(i)}getAllFromCollectionGroup(e,t,s,r){Nt(9500)}ii(e,t){return Ue.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new ase(this)}getSize(e){return Ue.resolve(this.size)}}class ase extends Qne{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),Ue.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ose{constructor(e){this.persistence=e,this.si=new Vf((t=>GC(t)),WC),this.lastRemoteSnapshotVersion=$t.min(),this.highestTargetId=0,this.oi=0,this._i=new YC,this.targetCount=0,this.ai=vm.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),Ue.resolve()}getLastRemoteSnapshotVersion(e){return Ue.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ue.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Ue.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),Ue.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new vm(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Ue.resolve()}updateTargetData(e,t){return this.Pr(t),Ue.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Ue.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((a,o)=>{o.sequenceNumber<=t&&s.get(o.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Ue.waitFor(i).next((()=>r))}getTargetCount(e){return Ue.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return Ue.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),Ue.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((a=>{i.push(r.markPotentiallyOrphaned(e,a))})),Ue.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Ue.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return Ue.resolve(s)}containsKey(e,t){return Ue.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4{constructor(e,t){this.ui={},this.overlays={},this.ci=new O1(0),this.li=!1,this.li=!0,this.hi=new sse,this.referenceDelegate=e(this),this.Pi=new ose(this),this.indexManager=new Wne,this.remoteDocumentCache=(function(r){return new ise(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new Une(t),this.Ii=new tse(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nse,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new rse(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){st("MemoryPersistence","Starting transaction:",e);const r=new lse(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return Ue.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class lse extends Ote{constructor(e){super(),this.currentSequenceNumber=e}}class QC{constructor(e){this.persistence=e,this.Ri=new YC,this.Vi=null}static mi(e){return new QC(e)}get fi(){if(this.Vi)return this.Vi;throw Nt(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),Ue.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),Ue.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Ue.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ue.forEach(this.fi,(s=>{const r=gt.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,$t.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return Ue.or([()=>Ue.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class $0{constructor(e,t){this.persistence=e,this.pi=new Vf((s=>Fte(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=Yne(this,t)}static mi(e,t){return new $0(e,t)}Ei(){}di(e){return Ue.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return Ue.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?Ue.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(a=>this.br(e,a,t).next((o=>{o||(s++,i.removeEntry(a,$t.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Ue.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Ue.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Ue.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Ue.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=qx(e.data.value)),t}br(e,t,s){return Ue.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return Ue.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=rn(),r=rn();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new JC(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cse{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class use{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return zY()?8:Pte(gi())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new cse;return this.Ss(e,t,a).next((o=>{if(i.result=o,this.Vs)return this.bs(e,t,a,o.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(zp()<=nn.DEBUG&&st("QueryEngine","SDK will not create cache indexes for query:",Vp(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ue.resolve()):(zp()<=nn.DEBUG&&st("QueryEngine","Query:",Vp(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(zp()<=nn.DEBUG&&st("QueryEngine","The SDK decides to create cache indexes for query:",Vp(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ll(t))):Ue.resolve())}ys(e,t){if(gP(t))return Ue.resolve(null);let s=Ll(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=GN(t,null,"F"),s=Ll(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const a=rn(...i);return this.ps.getDocuments(e,a).next((o=>this.indexManager.getMinOffset(e,s).next((l=>{const c=this.Ds(t,o);return this.Cs(t,c,a,l.readTime)?this.ys(e,GN(t,null,"F")):this.vs(e,c,t,l)}))))})))))}ws(e,t,s,r){return gP(t)||r.isEqual($t.min())?Ue.resolve(null):this.ps.getDocuments(e,s).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,s,r)?Ue.resolve(null):(zp()<=nn.DEBUG&&st("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Vp(t)),this.vs(e,a,t,Ate(r,Uy)).next((o=>o)))}))}Ds(e,t){let s=new dr(t4(e));return t.forEach(((r,i)=>{j1(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return zp()<=nn.DEBUG&&st("QueryEngine","Using full collection scan to execute query:",Vp(t)),this.ps.getDocumentsMatchingQuery(e,t,Nh.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek="LocalStore",hse=3e8;class dse{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new vs(sn),this.xs=new Vf((i=>GC(i)),WC),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ese(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function fse(n,e,t,s){return new dse(n,e,t,s)}async function E4(n,e){const t=Lt(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const a=[],o=[];let l=rn();for(const c of r){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(s,l).next((c=>({Ls:c,removedBatchIds:a,addedBatchIds:o})))}))}))}function pse(n,e){const t=Lt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(o,l,c,h){const p=c.batch,m=p.keys();let v=Ue.resolve();return m.forEach((_=>{v=v.next((()=>h.getEntry(l,_))).next((w=>{const T=c.docVersions.get(_);Nn(T!==null,48541),w.version.compareTo(T)<0&&(p.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),h.addEntry(w)))}))})),v.next((()=>o.mutationQueue.removeMutationBatch(l,p)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(o){let l=rn();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(l=l.add(o.batch.mutations[c].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function N4(n){const e=Lt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function mse(n,e){const t=Lt(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const o=[];e.targetChanges.forEach(((h,p)=>{const m=r.get(p);if(!m)return;o.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,p).next((()=>t.Pi.addMatchingKeys(i,h.addedDocuments,p))));let v=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(p)!==null?v=v.withResumeToken(Vr.EMPTY_BYTE_STRING,$t.min()).withLastLimboFreeSnapshotVersion($t.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,s)),r=r.insert(p,v),(function(w,T,E){return w.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=hse?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(m,v,h)&&o.push(t.Pi.updateTargetData(i,v))}));let l=Kc(),c=rn();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),o.push(gse(i,a,e.documentUpdates).next((h=>{l=h.ks,c=h.qs}))),!s.isEqual($t.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next((p=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));o.push(h)}return Ue.waitFor(o).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,c))).next((()=>l))})).then((i=>(t.Ms=r,i)))}function gse(n,e,t){let s=rn(),r=rn();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let a=Kc();return t.forEach(((o,l)=>{const c=i.get(o);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(o)),l.isNoDocument()&&l.version.isEqual($t.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):st(ek,"Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",l.version)})),{ks:a,qs:r}}))}function yse(n,e){const t=Lt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=zC),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function vse(n,e){const t=Lt(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,Ue.resolve(r)):t.Pi.allocateTargetId(s).next((a=>(r=new ch(e,a,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function XN(n,e,t){const s=Lt(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(a=>s.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(!Um(a))throw a;st(ek,`Failed to update sequence numbers for target ${e}: ${a}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function kP(n,e,t){const s=Lt(n);let r=$t.min(),i=rn();return s.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,c,h){const p=Lt(l),m=p.xs.get(h);return m!==void 0?Ue.resolve(p.Ms.get(m)):p.Pi.getTargetData(c,h)})(s,a,Ll(e)).next((o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(a,o.targetId).next((l=>{i=l}))})).next((()=>s.Fs.getDocumentsMatchingQuery(a,e,t?r:$t.min(),t?i:rn()))).next((o=>(bse(s,sne(e),o),{documents:o,Qs:i})))))}function bse(n,e,t){let s=n.Os.get(e)||$t.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}class $P{constructor(){this.activeTargetIds=cne()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _se{constructor(){this.Mo=new $P,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new $P,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xse{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AP="ConnectivityMonitor";class RP{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){st(AP,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){st(AP,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wx=null;function ZN(){return wx===null?wx=(function(){return 268435456+Math.round(2147483648*Math.random())})():wx++,"0x"+wx.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VE="RestConnection",wse={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Tse{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===S0?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const a=ZN(),o=this.zo(e,t.toUriEncodedString());st(VE,`Sending RPC '${e}' ${a}:`,o,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:c}=new URL(o),h=Gh(c);return this.Jo(e,o,l,s,h).then((p=>(st(VE,`Received RPC '${e}' ${a}: `,p),p)),(p=>{throw pm(VE,`RPC '${e}' ${a} failed with error: `,p,"url: ",o,"request:",s),p}))}Ho(e,t,s,r,i,a){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+zm})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=wse[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sse{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="WebChannelConnection";class Ese extends Tse{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const a=ZN();return new Promise(((o,l)=>{const c=new Cj;c.setWithCredentials(!0),c.listenOnce(kj.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case Hx.NO_ERROR:const p=c.getResponseJson();st(ii,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(p)),o(p);break;case Hx.TIMEOUT:st(ii,`RPC '${e}' ${a} timed out`),l(new nt(Be.DEADLINE_EXCEEDED,"Request time out"));break;case Hx.HTTP_ERROR:const m=c.getStatus();if(st(ii,`RPC '${e}' ${a} failed with status:`,m,"response text:",c.getResponseText()),m>0){let v=c.getResponseJson();Array.isArray(v)&&(v=v[0]);const _=v?.error;if(_&&_.status&&_.message){const w=(function(E){const C=E.toLowerCase().replace(/_/g,"-");return Object.values(Be).indexOf(C)>=0?C:Be.UNKNOWN})(_.status);l(new nt(w,_.message))}else l(new nt(Be.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new nt(Be.UNAVAILABLE,"Connection failed."));break;default:Nt(9055,{l_:e,streamId:a,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{st(ii,`RPC '${e}' ${a} completed.`)}}));const h=JSON.stringify(r);st(ii,`RPC '${e}' ${a} sending request:`,r),c.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=ZN(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Rj(),o=Aj(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=i.join("");st(ii,`Creating RPC '${e}' stream ${r}: ${h}`,l);const p=a.createWebChannel(h,l);this.I_(p);let m=!1,v=!1;const _=new Sse({Yo:T=>{v?st(ii,`Not sending because RPC '${e}' stream ${r} is closed:`,T):(m||(st(ii,`Opening RPC '${e}' stream ${r} transport.`),p.open(),m=!0),st(ii,`RPC '${e}' stream ${r} sending:`,T),p.send(T))},Zo:()=>p.close()}),w=(T,E,C)=>{T.listen(E,(A=>{try{C(A)}catch(D){setTimeout((()=>{throw D}),0)}}))};return w(p,my.EventType.OPEN,(()=>{v||(st(ii,`RPC '${e}' stream ${r} transport opened.`),_.o_())})),w(p,my.EventType.CLOSE,(()=>{v||(v=!0,st(ii,`RPC '${e}' stream ${r} transport closed`),_.a_(),this.E_(p))})),w(p,my.EventType.ERROR,(T=>{v||(v=!0,pm(ii,`RPC '${e}' stream ${r} transport errored. Name:`,T.name,"Message:",T.message),_.a_(new nt(Be.UNAVAILABLE,"The operation could not be completed")))})),w(p,my.EventType.MESSAGE,(T=>{if(!v){const E=T.data[0];Nn(!!E,16349);const C=E,A=C?.error||C[0]?.error;if(A){st(ii,`RPC '${e}' stream ${r} received error:`,A);const D=A.status;let F=(function(P){const O=qs[P];if(O!==void 0)return f4(O)})(D),W=A.message;F===void 0&&(F=Be.INTERNAL,W="Unknown error status: "+D+" with message "+A.message),v=!0,_.a_(new nt(F,W)),p.close()}else st(ii,`RPC '${e}' stream ${r} received:`,E),_.u_(E)}})),w(o,$j.STAT_EVENT,(T=>{T.stat===MN.PROXY?st(ii,`RPC '${e}' stream ${r} detected buffering proxy`):T.stat===MN.NOPROXY&&st(ii,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{_.__()}),0),_}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function UE(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U1(n){return new kne(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&st("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DP="PersistentStream";class C4{constructor(e,t,s,r,i,a,o,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new I4(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Be.RESOURCE_EXHAUSTED?(qc(t.toString()),qc("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Be.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new nt(Be.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return st(DP,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(st(DP,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Nse extends C4{constructor(e,t,s,r,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Rne(this.serializer,e),s=(function(i){if(!("targetChange"in i))return $t.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?$t.min():a.readTime?Ol(a.readTime):$t.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=KN(this.serializer),t.addTarget=(function(i,a){let o;const l=a.target;if(o=VN(l)?{documents:One(i,l)}:{query:Pne(i,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=g4(i,a.resumeToken);const c=WN(i,a.expectedCount);c!==null&&(o.expectedCount=c)}else if(a.snapshotVersion.compareTo($t.min())>0){o.readTime=k0(i,a.snapshotVersion.toTimestamp());const c=WN(i,a.expectedCount);c!==null&&(o.expectedCount=c)}return o})(this.serializer,e);const s=Fne(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=KN(this.serializer),t.removeTarget=e,this.q_(t)}}class Ise extends C4{constructor(e,t,s,r,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Nn(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Nn(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Nn(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Lne(e.writeResults,e.commitTime),s=Ol(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=KN(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>Dne(this.serializer,s)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cse{}class kse extends Cse{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new nt(Be.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,HN(t,s),r,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===Be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new nt(Be.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,o])=>this.connection.Ho(e,HN(t,s),r,a,o,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===Be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new nt(Be.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class $se{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(qc(t),this.aa=!1):st("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gf="RemoteStore";class Ase{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{s.enqueueAndForget((async()=>{Uf(this)&&(st(gf,"Restarting streams for network reachability change."),await(async function(l){const c=Lt(l);c.Ea.add(4),await Dv(c),c.Ra.set("Unknown"),c.Ea.delete(4),await G1(c)})(this))}))})),this.Ra=new $se(s,r)}}async function G1(n){if(Uf(n))for(const e of n.da)await e(!0)}async function Dv(n){for(const e of n.da)await e(!1)}function k4(n,e){const t=Lt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),rk(t)?sk(t):Gm(t).O_()&&nk(t,e))}function tk(n,e){const t=Lt(n),s=Gm(t);t.Ia.delete(e),s.O_()&&$4(t,e),t.Ia.size===0&&(s.O_()?s.L_():Uf(t)&&t.Ra.set("Unknown"))}function nk(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($t.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Gm(n).Y_(e)}function $4(n,e){n.Va.Ue(e),Gm(n).Z_(e)}function sk(n){n.Va=new Ene({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Gm(n).start(),n.Ra.ua()}function rk(n){return Uf(n)&&!Gm(n).x_()&&n.Ia.size>0}function Uf(n){return Lt(n).Ea.size===0}function A4(n){n.Va=void 0}async function Rse(n){n.Ra.set("Online")}async function Dse(n){n.Ia.forEach(((e,t)=>{nk(n,e)}))}async function Lse(n,e){A4(n),rk(n)?(n.Ra.ha(e),sk(n)):n.Ra.set("Unknown")}async function Ose(n,e,t){if(n.Ra.set("Online"),e instanceof m4&&e.state===2&&e.cause)try{await(async function(r,i){const a=i.cause;for(const o of i.targetIds)r.Ia.has(o)&&(await r.remoteSyncer.rejectListen(o,a),r.Ia.delete(o),r.Va.removeTarget(o))})(n,e)}catch(s){st(gf,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await A0(n,s)}else if(e instanceof Zx?n.Va.Ze(e):e instanceof p4?n.Va.st(e):n.Va.tt(e),!t.isEqual($t.min()))try{const s=await N4(n.localStore);t.compareTo(s)>=0&&await(function(i,a){const o=i.Va.Tt(a);return o.targetChanges.forEach(((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(c);h&&i.Ia.set(c,h.withResumeToken(l.resumeToken,a))}})),o.targetMismatches.forEach(((l,c)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(Vr.EMPTY_BYTE_STRING,h.snapshotVersion)),$4(i,l);const p=new ch(h.target,l,c,h.sequenceNumber);nk(i,p)})),i.remoteSyncer.applyRemoteEvent(o)})(n,t)}catch(s){st(gf,"Failed to raise snapshot:",s),await A0(n,s)}}async function A0(n,e,t){if(!Um(e))throw e;n.Ea.add(1),await Dv(n),n.Ra.set("Offline"),t||(t=()=>N4(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{st(gf,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await G1(n)}))}function R4(n,e){return e().catch((t=>A0(n,t,e)))}async function W1(n){const e=Lt(n),t=$h(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:zC;for(;Pse(e);)try{const r=await yse(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,Mse(e,r)}catch(r){await A0(e,r)}D4(e)&&L4(e)}function Pse(n){return Uf(n)&&n.Ta.length<10}function Mse(n,e){n.Ta.push(e);const t=$h(n);t.O_()&&t.X_&&t.ea(e.mutations)}function D4(n){return Uf(n)&&!$h(n).x_()&&n.Ta.length>0}function L4(n){$h(n).start()}async function Fse(n){$h(n).ra()}async function jse(n){const e=$h(n);for(const t of n.Ta)e.ea(t.mutations)}async function Bse(n,e,t){const s=n.Ta.shift(),r=KC.from(s,e,t);await R4(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await W1(n)}async function zse(n,e){e&&$h(n).X_&&await(async function(s,r){if((function(a){return wne(a)&&a!==Be.ABORTED})(r.code)){const i=s.Ta.shift();$h(s).B_(),await R4(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await W1(s)}})(n,e),D4(n)&&L4(n)}async function LP(n,e){const t=Lt(n);t.asyncQueue.verifyOperationInProgress(),st(gf,"RemoteStore received new credentials");const s=Uf(t);t.Ea.add(3),await Dv(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await G1(t)}async function Vse(n,e){const t=Lt(n);e?(t.Ea.delete(2),await G1(t)):e||(t.Ea.add(2),await Dv(t),t.Ra.set("Unknown"))}function Gm(n){return n.ma||(n.ma=(function(t,s,r){const i=Lt(t);return i.sa(),new Nse(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:Rse.bind(null,n),t_:Dse.bind(null,n),r_:Lse.bind(null,n),H_:Ose.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),rk(n)?sk(n):n.Ra.set("Unknown")):(await n.ma.stop(),A4(n))}))),n.ma}function $h(n){return n.fa||(n.fa=(function(t,s,r){const i=Lt(t);return i.sa(),new Ise(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Fse.bind(null,n),r_:zse.bind(null,n),ta:jse.bind(null,n),na:Bse.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await W1(n)):(await n.fa.stop(),n.Ta.length>0&&(st(gf,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new zc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const a=Date.now()+s,o=new ik(e,t,a,r,i);return o.start(s),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new nt(Be.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ak(n,e){if(qc("AsyncQueue",`${e}: ${n}`),Um(n))return new nt(Be.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm{static emptySet(e){return new sm(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||gt.comparator(t.key,s.key):(t,s)=>gt.comparator(t.key,s.key),this.keyedMap=gy(),this.sortedSet=new vs(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sm)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new sm;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(){this.ga=new vs(gt.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Nt(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class bm{constructor(e,t,s,r,i,a,o,l,c){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,s,r,i){const a=[];return t.forEach((o=>{a.push({type:0,doc:o})})),new bm(e,t,sm.emptySet(t),a,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&F1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Use{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Gse{constructor(){this.queries=PP(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=Lt(t),i=r.queries;r.queries=PP(),i.forEach(((a,o)=>{for(const l of o.Sa)l.onError(s)}))})(this,new nt(Be.ABORTED,"Firestore shutting down"))}}function PP(){return new Vf((n=>e4(n)),F1)}async function O4(n,e){const t=Lt(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new Use,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const o=ak(a,`Initialization of query '${Vp(e.query)}' failed`);return void e.onError(o)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&ok(t)}async function P4(n,e){const t=Lt(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function Wse(n,e){const t=Lt(n);let s=!1;for(const r of e){const i=r.query,a=t.queries.get(i);if(a){for(const o of a.Sa)o.Fa(r)&&(s=!0);a.wa=r}}s&&ok(t)}function Hse(n,e,t){const s=Lt(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function ok(n){n.Ca.forEach((e=>{e.next()}))}var YN,MP;(MP=YN||(YN={})).Ma="default",MP.Cache="cache";class M4{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new bm(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=bm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==YN.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(e){this.key=e}}class j4{constructor(e){this.key=e}}class qse{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=rn(),this.mutatedKeys=rn(),this.eu=t4(e),this.tu=new sm(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new OP,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,p)=>{const m=r.get(h),v=j1(this.query,p)?p:null,_=!!m&&this.mutatedKeys.has(m.key),w=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let T=!1;m&&v?m.data.isEqual(v.data)?_!==w&&(s.track({type:3,doc:v}),T=!0):this.su(m,v)||(s.track({type:2,doc:v}),T=!0,(l&&this.eu(v,l)>0||c&&this.eu(v,c)<0)&&(o=!0)):!m&&v?(s.track({type:0,doc:v}),T=!0):m&&!v&&(s.track({type:1,doc:m}),T=!0,(l||c)&&(o=!0)),T&&(v?(a=a.add(v),i=w?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{tu:a,iu:s,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((h,p)=>(function(v,_){const w=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nt(20277,{Rt:T})}};return w(v)-w(_)})(h.type,p.type)||this.eu(h.doc,p.doc))),this.ou(s),r=r??!1;const o=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,c=l!==this.Za;return this.Za=l,a.length!==0||c?{snapshot:new bm(this.query,e.tu,i,a,e.mutatedKeys,l===0,c,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new OP,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=rn(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new j4(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new F4(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=rn();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return bm.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const lk="SyncEngine";class Kse{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Xse{constructor(e){this.key=e,this.hu=!1}}class Zse{constructor(e,t,s,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Vf((o=>e4(o)),F1),this.Iu=new Map,this.Eu=new Set,this.du=new vs(gt.comparator),this.Au=new Map,this.Ru=new YC,this.Vu={},this.mu=new Map,this.fu=vm.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Yse(n,e,t=!0){const s=W4(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await B4(s,e,t,!0),r}async function Qse(n,e){const t=W4(n);await B4(t,e,!0,!1)}async function B4(n,e,t,s){const r=await vse(n.localStore,Ll(e)),i=r.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let o;return s&&(o=await Jse(n,e,i,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&k4(n.remoteStore,r),o}async function Jse(n,e,t,s,r){n.pu=(p,m,v)=>(async function(w,T,E,C){let A=T.view.ru(E);A.Cs&&(A=await kP(w.localStore,T.query,!1).then((({documents:B})=>T.view.ru(B,A))));const D=C&&C.targetChanges.get(T.targetId),F=C&&C.targetMismatches.get(T.targetId)!=null,W=T.view.applyChanges(A,w.isPrimaryClient,D,F);return jP(w,T.targetId,W.au),W.snapshot})(n,p,m,v);const i=await kP(n.localStore,e,!0),a=new qse(e,i.Qs),o=a.ru(i.documents),l=Rv.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),c=a.applyChanges(o,n.isPrimaryClient,l);jP(n,t,c.au);const h=new Kse(e,t,a);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),c.snapshot}async function ere(n,e,t){const s=Lt(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((a=>!F1(a,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await XN(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&tk(s.remoteStore,r.targetId),QN(s,r.targetId)})).catch(Vm)):(QN(s,r.targetId),await XN(s.localStore,r.targetId,!0))}async function tre(n,e){const t=Lt(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),tk(t.remoteStore,s.targetId))}async function nre(n,e,t){const s=cre(n);try{const r=await(function(a,o){const l=Lt(a),c=ss.now(),h=o.reduce(((v,_)=>v.add(_.key)),rn());let p,m;return l.persistence.runTransaction("Locally write mutations","readwrite",(v=>{let _=Kc(),w=rn();return l.Ns.getEntries(v,h).next((T=>{_=T,_.forEach(((E,C)=>{C.isValidDocument()||(w=w.add(E))}))})).next((()=>l.localDocuments.getOverlayedDocuments(v,_))).next((T=>{p=T;const E=[];for(const C of o){const A=yne(C,p.get(C.key).overlayedDocument);A!=null&&E.push(new Kh(C.key,A,Hj(A.value.mapValue),zo.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,E,o)})).next((T=>{m=T;const E=T.applyToLocalDocumentSet(p,w);return l.documentOverlayCache.saveOverlays(v,T.batchId,E)}))})).then((()=>({batchId:m.batchId,changes:s4(p)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(a,o,l){let c=a.Vu[a.currentUser.toKey()];c||(c=new vs(sn)),c=c.insert(o,l),a.Vu[a.currentUser.toKey()]=c})(s,r.batchId,t),await Lv(s,r.changes),await W1(s.remoteStore)}catch(r){const i=ak(r,"Failed to persist write");t.reject(i)}}async function z4(n,e){const t=Lt(n);try{const s=await mse(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const a=t.Au.get(i);a&&(Nn(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?Nn(a.hu,14607):r.removedDocuments.size>0&&(Nn(a.hu,42227),a.hu=!1))})),await Lv(t,s,e)}catch(s){await Vm(s)}}function FP(n,e,t){const s=Lt(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,a)=>{const o=a.view.va(e);o.snapshot&&r.push(o.snapshot)})),(function(a,o){const l=Lt(a);l.onlineState=o;let c=!1;l.queries.forEach(((h,p)=>{for(const m of p.Sa)m.va(o)&&(c=!0)})),c&&ok(l)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function sre(n,e,t){const s=Lt(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let a=new vs(gt.comparator);a=a.insert(i,ci.newNoDocument(i,$t.min()));const o=rn().add(i),l=new V1($t.min(),new Map,new vs(sn),a,o);await z4(s,l),s.du=s.du.remove(i),s.Au.delete(e),ck(s)}else await XN(s.localStore,e,!1).then((()=>QN(s,e,t))).catch(Vm)}async function rre(n,e){const t=Lt(n),s=e.batch.batchId;try{const r=await pse(t.localStore,e);U4(t,s,null),V4(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await Lv(t,r)}catch(r){await Vm(r)}}async function ire(n,e,t){const s=Lt(n);try{const r=await(function(a,o){const l=Lt(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(c=>{let h;return l.mutationQueue.lookupMutationBatch(c,o).next((p=>(Nn(p!==null,37113),h=p.keys(),l.mutationQueue.removeMutationBatch(c,p)))).next((()=>l.mutationQueue.performConsistencyCheck(c))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,o))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h))).next((()=>l.localDocuments.getDocuments(c,h)))}))})(s.localStore,e);U4(s,e,t),V4(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await Lv(s,r)}catch(r){await Vm(r)}}function V4(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function U4(n,e,t){const s=Lt(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function QN(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||G4(n,s)}))}function G4(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(tk(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),ck(n))}function jP(n,e,t){for(const s of t)s instanceof F4?(n.Ru.addReference(s.key,e),are(n,s)):s instanceof j4?(st(lk,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||G4(n,s.key)):Nt(19791,{wu:s})}function are(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(st(lk,"New document in limbo: "+t),n.Eu.add(s),ck(n))}function ck(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new gt(Qn.fromString(e)),s=n.fu.next();n.Au.set(s,new Xse(t)),n.du=n.du.insert(t,s),k4(n.remoteStore,new ch(Ll(HC(t.path)),s,"TargetPurposeLimboResolution",O1.ce))}}async function Lv(n,e,t){const s=Lt(n),r=[],i=[],a=[];s.Tu.isEmpty()||(s.Tu.forEach(((o,l)=>{a.push(s.pu(l,e,t).then((c=>{if((c||t)&&s.isPrimaryClient){const h=c?!c.fromCache:t?.targetChanges.get(l.targetId)?.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){r.push(c);const h=JC.As(l.targetId,c);i.push(h)}})))})),await Promise.all(a),s.Pu.H_(r),await(async function(l,c){const h=Lt(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>Ue.forEach(c,(m=>Ue.forEach(m.Es,(v=>h.persistence.referenceDelegate.addReference(p,m.targetId,v))).next((()=>Ue.forEach(m.ds,(v=>h.persistence.referenceDelegate.removeReference(p,m.targetId,v)))))))))}catch(p){if(!Um(p))throw p;st(ek,"Failed to update sequence numbers: "+p)}for(const p of c){const m=p.targetId;if(!p.fromCache){const v=h.Ms.get(m),_=v.snapshotVersion,w=v.withLastLimboFreeSnapshotVersion(_);h.Ms=h.Ms.insert(m,w)}}})(s.localStore,i))}async function ore(n,e){const t=Lt(n);if(!t.currentUser.isEqual(e)){st(lk,"User change. New user:",e.toKey());const s=await E4(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((o=>{o.forEach((l=>{l.reject(new nt(Be.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Lv(t,s.Ls)}}function lre(n,e){const t=Lt(n),s=t.Au.get(e);if(s&&s.hu)return rn().add(s.key);{let r=rn();const i=t.Iu.get(e);if(!i)return r;for(const a of i){const o=t.Tu.get(a);r=r.unionWith(o.view.nu)}return r}}function W4(n){const e=Lt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=z4.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lre.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sre.bind(null,e),e.Pu.H_=Wse.bind(null,e.eventManager),e.Pu.yu=Hse.bind(null,e.eventManager),e}function cre(n){const e=Lt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rre.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ire.bind(null,e),e}class R0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=U1(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return fse(this.persistence,new use,e.initialUser,this.serializer)}Cu(e){return new S4(QC.mi,this.serializer)}Du(e){return new _se}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}R0.provider={build:()=>new R0};class ure extends R0{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Nn(this.persistence.referenceDelegate instanceof $0,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new Xne(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Wi.withCacheSize(this.cacheSizeBytes):Wi.DEFAULT;return new S4((s=>$0.mi(s,t)),this.serializer)}}class JN{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>FP(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=ore.bind(null,this.syncEngine),await Vse(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Gse})()}createDatastore(e){const t=U1(e.databaseInfo.databaseId),s=(function(i){return new Ese(i)})(e.databaseInfo);return(function(i,a,o,l){return new kse(i,a,o,l)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,a,o){return new Ase(s,r,i,a,o)})(this.localStore,this.datastore,e.asyncQueue,(t=>FP(this.syncEngine,t,0)),(function(){return RP.v()?new RP:new xse})())}createSyncEngine(e,t){return(function(r,i,a,o,l,c,h){const p=new Zse(r,i,a,o,l,c);return h&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=Lt(t);st(gf,"RemoteStore shutting down."),s.Ea.add(5),await Dv(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}JN.provider={build:()=>new JN};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):qc("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah="FirestoreClient";class hre{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=oi.UNAUTHENTICATED,this.clientId=BC.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async a=>{st(Ah,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(s,(a=>(st(Ah,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=ak(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function GE(n,e){n.asyncQueue.verifyOperationInProgress(),st(Ah,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await E4(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function BP(n,e){n.asyncQueue.verifyOperationInProgress();const t=await dre(n);st(Ah,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>LP(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>LP(e.remoteStore,r))),n._onlineComponents=e}async function dre(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){st(Ah,"Using user provided OfflineComponentProvider");try{await GE(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===Be.FAILED_PRECONDITION||r.code===Be.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;pm("Error using user provided cache. Falling back to memory cache: "+t),await GE(n,new R0)}}else st(Ah,"Using default OfflineComponentProvider"),await GE(n,new ure(void 0));return n._offlineComponents}async function q4(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(st(Ah,"Using user provided OnlineComponentProvider"),await BP(n,n._uninitializedComponentsProvider._online)):(st(Ah,"Using default OnlineComponentProvider"),await BP(n,new JN))),n._onlineComponents}function fre(n){return q4(n).then((e=>e.syncEngine))}async function K4(n){const e=await q4(n),t=e.eventManager;return t.onListen=Yse.bind(null,e.syncEngine),t.onUnlisten=ere.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Qse.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=tre.bind(null,e.syncEngine),t}function pre(n,e,t={}){const s=new zc;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,o,l,c){const h=new H4({next:m=>{h.Nu(),a.enqueueAndForget((()=>P4(i,p)));const v=m.docs.has(o);!v&&m.fromCache?c.reject(new nt(Be.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&l&&l.source==="server"?c.reject(new nt(Be.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),p=new M4(HC(o.path),h,{includeMetadataChanges:!0,qa:!0});return O4(i,p)})(await K4(n),n.asyncQueue,e,t,s))),s.promise}function mre(n,e,t={}){const s=new zc;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,o,l,c){const h=new H4({next:m=>{h.Nu(),a.enqueueAndForget((()=>P4(i,p))),m.fromCache&&l.source==="server"?c.reject(new nt(Be.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),p=new M4(o,h,{includeMetadataChanges:!0,qa:!0});return O4(i,p)})(await K4(n),n.asyncQueue,e,t,s))),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zP=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z4="firestore.googleapis.com",VP=!0;class UP{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new nt(Be.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Z4,this.ssl=VP}else this.host=e.host,this.ssl=e.ssl??VP;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=T4;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qne)throw new nt(Be.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$te("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=X4(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new nt(Be.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new nt(Be.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new nt(Be.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class H1{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new UP({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new nt(Be.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new nt(Be.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new UP(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new _te;switch(s.type){case"firstParty":return new Ste(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new nt(Be.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=zP.get(t);s&&(st("ComponentProvider","Removing Datastore"),zP.delete(t),s.terminate())})(this),Promise.resolve()}}function gre(n,e,t,s={}){n=Wl(n,H1);const r=Gh(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},o=`${e}:${t}`;r&&(EC(`https://${o}`),NC("Firestore",!0)),i.host!==Z4&&i.host!==o&&pm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:o,ssl:r,emulatorOptions:s};if(!hf(l,a)&&(n._setSettings(l),s.mockUserToken)){let c,h;if(typeof s.mockUserToken=="string")c=s.mockUserToken,h=oi.MOCK_USER;else{c=zF(s.mockUserToken,n._app?.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new nt(Be.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new oi(p)}n._authCredentials=new xte(new Lj(c,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Wm(this.firestore,e,this._query)}}class Ms{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ms(this.firestore,e,this._key)}toJSON(){return{type:Ms._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(kv(t,Ms._jsonSchema))return new Ms(e,s||null,new gt(Qn.fromString(t.referencePath)))}}Ms._jsonSchemaVersion="firestore/documentReference/1.0",Ms._jsonSchema={type:Zs("string",Ms._jsonSchemaVersion),referencePath:Zs("string")};class bh extends Wm{constructor(e,t,s){super(e,t,HC(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ms(this.firestore,null,new gt(e))}withConverter(e){return new bh(this.firestore,e,this._path)}}function Rh(n,e,...t){if(n=Fs(n),Oj("collection","path",e),n instanceof H1){const s=Qn.fromString(e,...t);return nP(s),new bh(n,null,s)}{if(!(n instanceof Ms||n instanceof bh))throw new nt(Be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Qn.fromString(e,...t));return nP(s),new bh(n.firestore,null,s)}}function ql(n,e,...t){if(n=Fs(n),arguments.length===1&&(e=BC.newId()),Oj("doc","path",e),n instanceof H1){const s=Qn.fromString(e,...t);return tP(s),new Ms(n,null,new gt(s))}{if(!(n instanceof Ms||n instanceof bh))throw new nt(Be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Qn.fromString(e,...t));return tP(s),new Ms(n.firestore,n instanceof bh?n.converter:null,new gt(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP="AsyncQueue";class WP{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new I4(this,"async_queue_retry"),this._c=()=>{const s=UE();s&&st(GP,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=UE();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=UE();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new zc;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Um(e))throw e;st(GP,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,qc("INTERNAL UNHANDLED ERROR: ",HP(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=ik.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&Nt(47125,{Pc:HP(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function HP(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Hm extends H1{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new WP,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new WP(e),this._firestoreClient=void 0,await e}}}function yre(n,e){const t=typeof n=="object"?n:kC(),s=typeof n=="string"?n:S0,r=$1(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=FF("firestore");i&&gre(r,...i)}return r}function uk(n){if(n._terminated)throw new nt(Be.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||vre(n),n._firestoreClient}function vre(n){const e=n._freezeSettings(),t=(function(r,i,a,o){return new zte(r,i,a,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,X4(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new hre(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e){this._byteString=e}static fromBase64String(e){try{return new no(Vr.fromBase64String(e))}catch(t){throw new nt(Be.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new no(Vr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:no._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(kv(e,no._jsonSchema))return no.fromBase64String(e.bytes)}}no._jsonSchemaVersion="firestore/bytes/1.0",no._jsonSchema={type:Zs("string",no._jsonSchemaVersion),bytes:Zs("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new nt(Be.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nt(Be.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nt(Be.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return sn(this._lat,e._lat)||sn(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Pl._jsonSchemaVersion}}static fromJSON(e){if(kv(e,Pl._jsonSchema))return new Pl(e.latitude,e.longitude)}}Pl._jsonSchemaVersion="firestore/geoPoint/1.0",Pl._jsonSchema={type:Zs("string",Pl._jsonSchemaVersion),latitude:Zs("number"),longitude:Zs("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ml._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(kv(e,Ml._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ml(e.vectorValues);throw new nt(Be.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ml._jsonSchemaVersion="firestore/vectorValue/1.0",Ml._jsonSchema={type:Zs("string",Ml._jsonSchemaVersion),vectorValues:Zs("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bre=/^__.*__$/;class _re{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Kh(e,this.data,this.fieldMask,t,this.fieldTransforms):new Av(e,this.data,t,this.fieldTransforms)}}class Y4{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new Kh(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Q4(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Nt(40011,{Ac:n})}}class hk{constructor(e,t,s,r,i,a){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new hk({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return D0(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Q4(this.Ac)&&bre.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class xre{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||U1(e)}Cc(e,t,s,r=!1){return new hk({Ac:e,methodName:t,Dc:s,path:Fr.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function X1(n){const e=n._freezeSettings(),t=U1(n._databaseId);return new xre(n._databaseId,!!e.ignoreUndefinedProperties,t)}function J4(n,e,t,s,r,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);fk("Data must be an object, but it was:",a,s);const o=eB(s,a);let l,c;if(i.merge)l=new Sa(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const p of i.mergeFields){const m=eI(e,p,t);if(!a.contains(m))throw new nt(Be.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);nB(h,m)||h.push(m)}l=new Sa(h),c=a.fieldTransforms.filter((p=>l.covers(p.field)))}else l=null,c=a.fieldTransforms;return new _re(new qi(o),l,c)}class Z1 extends K1{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Z1}}class dk extends K1{_toFieldTransform(e){return new fne(e.path,new qy)}isEqual(e){return e instanceof dk}}function wre(n,e,t,s){const r=n.Cc(1,e,t);fk("Data must be an object, but it was:",r,s);const i=[],a=qi.empty();qh(s,((l,c)=>{const h=pk(e,l,t);c=Fs(c);const p=r.yc(h);if(c instanceof Z1)i.push(h);else{const m=Ov(c,p);m!=null&&(i.push(h),a.set(h,m))}}));const o=new Sa(i);return new Y4(a,o,r.fieldTransforms)}function Tre(n,e,t,s,r,i){const a=n.Cc(1,e,t),o=[eI(e,s,t)],l=[r];if(i.length%2!=0)throw new nt(Be.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)o.push(eI(e,i[m])),l.push(i[m+1]);const c=[],h=qi.empty();for(let m=o.length-1;m>=0;--m)if(!nB(c,o[m])){const v=o[m];let _=l[m];_=Fs(_);const w=a.yc(v);if(_ instanceof Z1)c.push(v);else{const T=Ov(_,w);T!=null&&(c.push(v),h.set(v,T))}}const p=new Sa(c);return new Y4(h,p,a.fieldTransforms)}function Sre(n,e,t,s=!1){return Ov(t,n.Cc(s?4:3,e))}function Ov(n,e){if(tB(n=Fs(n)))return fk("Unsupported field value:",e,n),eB(n,e);if(n instanceof K1)return(function(s,r){if(!Q4(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let a=0;for(const o of s){let l=Ov(o,r.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=Fs(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return une(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=ss.fromDate(s);return{timestampValue:k0(r.serializer,i)}}if(s instanceof ss){const i=new ss(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:k0(r.serializer,i)}}if(s instanceof Pl)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof no)return{bytesValue:g4(r.serializer,s._byteString)};if(s instanceof Ms){const i=r.databaseId,a=s.firestore._databaseId;if(!a.isEqual(i))throw r.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ZC(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Ml)return(function(a,o){return{mapValue:{fields:{[Gj]:{stringValue:Wj},[E0]:{arrayValue:{values:a.toArray().map((c=>{if(typeof c!="number")throw o.Sc("VectorValues must only contain numeric values.");return qC(o.serializer,c)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${L1(s)}`)})(n,e)}function eB(n,e){const t={};return Fj(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qh(n,((s,r)=>{const i=Ov(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function tB(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ss||n instanceof Pl||n instanceof no||n instanceof Ms||n instanceof K1||n instanceof Ml)}function fk(n,e,t){if(!tB(t)||!Pj(t)){const s=L1(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function eI(n,e,t){if((e=Fs(e))instanceof q1)return e._internalPath;if(typeof e=="string")return pk(n,e);throw D0("Field path arguments must be of type string or ",n,!1,void 0,t)}const Ere=new RegExp("[~\\*/\\[\\]]");function pk(n,e,t){if(e.search(Ere)>=0)throw D0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new q1(...e.split("."))._internalPath}catch{throw D0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function D0(n,e,t,s,r){const i=s&&!s.isEmpty(),a=r!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${s}`),a&&(l+=` in document ${r}`),l+=")"),new nt(Be.INVALID_ARGUMENT,o+n+l)}function nB(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sB{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ms(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Nre(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(mk("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Nre extends sB{data(){return super.data()}}function mk(n,e){return typeof e=="string"?pk(n,e):e instanceof q1?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ire(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new nt(Be.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class gk{}class Cre extends gk{}function Qp(n,e,...t){let s=[];e instanceof gk&&s.push(e),s=s.concat(t),(function(i){const a=i.filter((l=>l instanceof yk)).length,o=i.filter((l=>l instanceof Y1)).length;if(a>1||a>0&&o>0)throw new nt(Be.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class Y1 extends Cre{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Y1(e,t,s)}_apply(e){const t=this._parse(e);return rB(e._query,t),new Wm(e.firestore,e.converter,UN(e._query,t))}_parse(e){const t=X1(e.firestore);return(function(i,a,o,l,c,h,p){let m;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new nt(Be.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){KP(p,h);const _=[];for(const w of p)_.push(qP(l,i,w));m={arrayValue:{values:_}}}else m=qP(l,i,p)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||KP(p,h),m=Sre(o,a,p,h==="in"||h==="not-in");return Xs.create(c,h,m)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Jp(n,e,t){const s=e,r=mk("where",n);return Y1._create(r,s,t)}class yk extends gk{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new yk(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:qo.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,i){let a=r;const o=i.getFlattenedFilters();for(const l of o)rB(a,l),a=UN(a,l)})(e._query,t),new Wm(e.firestore,e.converter,UN(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function qP(n,e,t){if(typeof(t=Fs(t))=="string"){if(t==="")throw new nt(Be.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jj(e)&&t.indexOf("/")!==-1)throw new nt(Be.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Qn.fromString(t));if(!gt.isDocumentKey(s))throw new nt(Be.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return uP(n,new gt(s))}if(t instanceof Ms)return uP(n,t._key);throw new nt(Be.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${L1(t)}.`)}function KP(n,e){if(!Array.isArray(n)||n.length===0)throw new nt(Be.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function rB(n,e){const t=(function(r,i){for(const a of r)for(const o of a.getFlattenedFilters())if(i.indexOf(o.op)>=0)return o.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new nt(Be.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new nt(Be.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class kre{convertValue(e,t="none"){switch(kh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Os(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ch(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Nt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return qh(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){const t=e.fields?.[E0].arrayValue?.values?.map((s=>Os(s.doubleValue)));return new Ml(t)}convertGeoPoint(e){return new Pl(Os(e.latitude),Os(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=M1(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Gy(e));default:return null}}convertTimestamp(e){const t=Ih(e);return new ss(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Qn.fromString(e);Nn(w4(s),9688,{name:e});const r=new Wy(s.get(1),s.get(3)),i=new gt(s.popFirst(5));return r.isEqual(t)||qc(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class vy{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class tf extends sB{constructor(e,t,s,r,i,a){super(e,t,s,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yx(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(mk("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new nt(Be.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=tf._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}tf._jsonSchemaVersion="firestore/documentSnapshot/1.0",tf._jsonSchema={type:Zs("string",tf._jsonSchemaVersion),bundleSource:Zs("string","DocumentSnapshot"),bundleName:Zs("string"),bundle:Zs("string")};class Yx extends tf{data(e={}){return super.data(e)}}class rm{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new vy(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Yx(this._firestore,this._userDataWriter,s.key,s,new vy(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nt(Be.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map((o=>{const l=new Yx(r._firestore,r._userDataWriter,o.doc.key,o.doc,new vy(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((o=>i||o.type!==3)).map((o=>{const l=new Yx(r._firestore,r._userDataWriter,o.doc.key,o.doc,new vy(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,h=-1;return o.type!==0&&(c=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),h=a.indexOf(o.doc.key)),{type:$re(o.type),doc:l,oldIndex:c,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new nt(Be.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=rm._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=BC.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function $re(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nt(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vk(n){n=Wl(n,Ms);const e=Wl(n.firestore,Hm);return pre(uk(e),n._key).then((t=>Are(e,n,t)))}rm._jsonSchemaVersion="firestore/querySnapshot/1.0",rm._jsonSchema={type:Zs("string",rm._jsonSchemaVersion),bundleSource:Zs("string","QuerySnapshot"),bundleName:Zs("string"),bundle:Zs("string")};class aB extends kre{constructor(e){super(),this.firestore=e}convertBytes(e){return new no(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ms(this.firestore,null,t)}}function Dc(n){n=Wl(n,Wm);const e=Wl(n.firestore,Hm),t=uk(e),s=new aB(e);return Ire(n._query),mre(t,n._query).then((r=>new rm(e,s,n,r)))}function oB(n,e,t){n=Wl(n,Ms);const s=Wl(n.firestore,Hm),r=iB(n.converter,e,t);return bk(s,[J4(X1(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,zo.none())])}function L0(n,e,t,...s){n=Wl(n,Ms);const r=Wl(n.firestore,Hm),i=X1(r);let a;return a=typeof(e=Fs(e))=="string"||e instanceof q1?Tre(i,"updateDoc",n._key,e,t,s):wre(i,"updateDoc",n._key,e),bk(r,[a.toMutation(n._key,zo.exists(!0))])}function lB(n,e){const t=Wl(n.firestore,Hm),s=ql(n),r=iB(n.converter,e);return bk(t,[J4(X1(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,zo.exists(!1))]).then((()=>s))}function bk(n,e){return(function(s,r){const i=new zc;return s.asyncQueue.enqueueAndForget((async()=>nre(await fre(s),r,i))),i.promise})(uk(n),e)}function Are(n,e,t){const s=t.docs.get(e._key),r=new aB(n);return new tf(n,r,e._key,s,new vy(t.hasPendingWrites,t.fromCache),e.converter)}function cB(){return new dk("serverTimestamp")}(function(e,t=!0){(function(r){zm=r})(Bf),df(new Eh("firestore",((s,{instanceIdentifier:r,options:i})=>{const a=s.getProvider("app").getImmediate(),o=new Hm(new wte(s.getProvider("auth-internal")),new Ete(a,s.getProvider("app-check-internal")),(function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new nt(Be.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wy(c.options.projectId,h)})(a,r),a);return i={useFetchStreams:t,...i},o._setSettings(i),o}),"PUBLIC").setMultipleInstances(!0)),Al(YO,QO,e),Al(YO,QO,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uB="firebasestorage.googleapis.com",hB="storageBucket",Rre=120*1e3,Dre=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns extends ic{constructor(e,t,s=0){super(WE(e),`Firebase Storage: ${t} (${WE(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ns.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return WE(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ss;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ss||(Ss={}));function WE(n){return"storage/"+n}function _k(){const n="An unknown error occurred, please check the error payload for server response.";return new Ns(Ss.UNKNOWN,n)}function Lre(n){return new Ns(Ss.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Ore(n){return new Ns(Ss.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Pre(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ns(Ss.UNAUTHENTICATED,n)}function Mre(){return new Ns(Ss.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Fre(n){return new Ns(Ss.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function jre(){return new Ns(Ss.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Bre(){return new Ns(Ss.CANCELED,"User canceled the upload/download.")}function zre(n){return new Ns(Ss.INVALID_URL,"Invalid URL '"+n+"'.")}function Vre(n){return new Ns(Ss.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Ure(){return new Ns(Ss.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+hB+"' property when initializing the app?")}function Gre(){return new Ns(Ss.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Wre(){return new Ns(Ss.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Hre(n){return new Ns(Ss.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function tI(n){return new Ns(Ss.INVALID_ARGUMENT,n)}function dB(){return new Ns(Ss.APP_DELETED,"The Firebase app was deleted.")}function qre(n){return new Ns(Ss.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ly(n,e){return new Ns(Ss.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function ay(n){throw new Ns(Ss.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Ea.makeFromUrl(e,t)}catch{return new Ea(e,"")}if(s.path==="")return s;throw Vre(e)}static makeFromUrl(e,t){let s=null;const r="([A-Za-z0-9.\\-_]+)";function i(D){D.path.charAt(D.path.length-1)==="/"&&(D.path_=D.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+r+a,"i"),l={bucket:1,path:3};function c(D){D.path_=decodeURIComponent(D.path)}const h="v[A-Za-z0-9_]+",p=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",v=new RegExp(`^https?://${p}/${h}/b/${r}/o${m}`,"i"),_={bucket:1,path:3},w=t===uB?"(?:storage.googleapis.com|storage.cloud.google.com)":t,T="([^?#]*)",E=new RegExp(`^https?://${w}/${r}/${T}`,"i"),A=[{regex:o,indices:l,postModify:i},{regex:v,indices:_,postModify:c},{regex:E,indices:{bucket:1,path:2},postModify:c}];for(let D=0;D<A.length;D++){const F=A[D],W=F.regex.exec(e);if(W){const B=W[F.indices.bucket];let P=W[F.indices.path];P||(P=""),s=new Ea(B,P),F.postModify(s);break}}if(s==null)throw zre(e);return s}}class Kre{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xre(n,e,t){let s=1,r=null,i=null,a=!1,o=0;function l(){return o===2}let c=!1;function h(...T){c||(c=!0,e.apply(null,T))}function p(T){r=setTimeout(()=>{r=null,n(v,l())},T)}function m(){i&&clearTimeout(i)}function v(T,...E){if(c){m();return}if(T){m(),h.call(null,T,...E);return}if(l()||a){m(),h.call(null,T,...E);return}s<64&&(s*=2);let A;o===1?(o=2,A=0):A=(s+Math.random())*1e3,p(A)}let _=!1;function w(T){_||(_=!0,m(),!c&&(r!==null?(T||(o=2),clearTimeout(r),p(0)):T||(o=1)))}return p(0),i=setTimeout(()=>{a=!0,w(!0)},t),w}function Zre(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yre(n){return n!==void 0}function Qre(n){return typeof n=="object"&&!Array.isArray(n)}function xk(n){return typeof n=="string"||n instanceof String}function XP(n){return wk()&&n instanceof Blob}function wk(){return typeof Blob<"u"}function ZP(n,e,t,s){if(s<e)throw tI(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>t)throw tI(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tk(n,e,t){let s=e;return t==null&&(s=`https://${e}`),`${t}://${s}/v0${n}`}function fB(n){const e=encodeURIComponent;let t="?";for(const s in n)if(n.hasOwnProperty(s)){const r=e(s)+"="+e(n[s]);t=t+r+"&"}return t=t.slice(0,-1),t}var nf;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(nf||(nf={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jre(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||r||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eie{constructor(e,t,s,r,i,a,o,l,c,h,p,m=!0,v=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=p,this.retry=m,this.isUsingEmulator=v,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,w)=>{this.resolve_=_,this.reject_=w,this.start_()})}start_(){const e=(s,r)=>{if(r){s(!1,new Tx(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=o=>{const l=o.loaded,c=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const o=i.getErrorCode()===nf.NO_ERROR,l=i.getStatus();if(!o||Jre(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===nf.ABORT;s(!1,new Tx(!1,null,h));return}const c=this.successCodes_.indexOf(l)!==-1;s(!0,new Tx(c,i))})},t=(s,r)=>{const i=this.resolve_,a=this.reject_,o=r.connection;if(r.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());Yre(l)?i(l):i()}catch(l){a(l)}else if(o!==null){const l=_k();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(r.canceled){const l=this.appDelete_?dB():Bre();a(l)}else{const l=jre();a(l)}};this.canceled_?t(!1,new Tx(!1,null,!0)):this.backoffId_=Xre(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Zre(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Tx{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function tie(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function nie(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function sie(n,e){e&&(n["X-Firebase-GMPID"]=e)}function rie(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function iie(n,e,t,s,r,i,a=!0,o=!1){const l=fB(n.urlParams),c=n.url+l,h=Object.assign({},n.headers);return sie(h,e),tie(h,t),nie(h,i),rie(h,s),new eie(c,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aie(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function oie(...n){const e=aie();if(e!==void 0){const t=new e;for(let s=0;s<n.length;s++)t.append(n[s]);return t.getBlob()}else{if(wk())return new Blob(n);throw new Ns(Ss.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function lie(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cie(n){if(typeof atob>"u")throw Hre("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class HE{constructor(e,t){this.data=e,this.contentType=t||null}}function uie(n,e){switch(n){case Cl.RAW:return new HE(pB(e));case Cl.BASE64:case Cl.BASE64URL:return new HE(mB(n,e));case Cl.DATA_URL:return new HE(die(e),fie(e))}throw _k()}function pB(n){const e=[];for(let t=0;t<n.length;t++){let s=n.charCodeAt(t);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=s,a=n.charCodeAt(++t);s=65536|(i&1023)<<10|a&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function hie(n){let e;try{e=decodeURIComponent(n)}catch{throw Ly(Cl.DATA_URL,"Malformed data URL.")}return pB(e)}function mB(n,e){switch(n){case Cl.BASE64:{const r=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(r||i)throw Ly(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Cl.BASE64URL:{const r=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(r||i)throw Ly(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=cie(e)}catch(r){throw r.message.includes("polyfill")?r:Ly(n,"Invalid character found")}const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}class gB{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ly(Cl.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;s!=null&&(this.base64=pie(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function die(n){const e=new gB(n);return e.base64?mB(Cl.BASE64,e.rest):hie(e.rest)}function fie(n){return new gB(n).contentType}function pie(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e,t){let s=0,r="";XP(e)?(this.data_=e,s=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(XP(this.data_)){const s=this.data_,r=lie(s,e,t);return r===null?null:new oh(r)}else{const s=new Uint8Array(this.data_.buffer,e,t-e);return new oh(s,!0)}}static getBlob(...e){if(wk()){const t=e.map(s=>s instanceof oh?s.data_:s);return new oh(oie.apply(null,t))}else{const t=e.map(a=>xk(a)?uie(Cl.RAW,a).data:a.data_);let s=0;t.forEach(a=>{s+=a.byteLength});const r=new Uint8Array(s);let i=0;return t.forEach(a=>{for(let o=0;o<a.length;o++)r[i++]=a[o]}),new oh(r,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yB(n){let e;try{e=JSON.parse(n)}catch{return null}return Qre(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mie(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function gie(n,e){const t=e.split("/").filter(s=>s.length>0).join("/");return n.length===0?t:n+"/"+t}function vB(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yie(n,e){return e}class Ci{constructor(e,t,s,r){this.server=e,this.local=t||e,this.writable=!!s,this.xform=r||yie}}let Sx=null;function vie(n){return!xk(n)||n.length<2?n:vB(n)}function bB(){if(Sx)return Sx;const n=[];n.push(new Ci("bucket")),n.push(new Ci("generation")),n.push(new Ci("metageneration")),n.push(new Ci("name","fullPath",!0));function e(i,a){return vie(a)}const t=new Ci("name");t.xform=e,n.push(t);function s(i,a){return a!==void 0?Number(a):a}const r=new Ci("size");return r.xform=s,n.push(r),n.push(new Ci("timeCreated")),n.push(new Ci("updated")),n.push(new Ci("md5Hash",null,!0)),n.push(new Ci("cacheControl",null,!0)),n.push(new Ci("contentDisposition",null,!0)),n.push(new Ci("contentEncoding",null,!0)),n.push(new Ci("contentLanguage",null,!0)),n.push(new Ci("contentType",null,!0)),n.push(new Ci("metadata","customMetadata",!0)),Sx=n,Sx}function bie(n,e){function t(){const s=n.bucket,r=n.fullPath,i=new Ea(s,r);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function _ie(n,e,t){const s={};s.type="file";const r=t.length;for(let i=0;i<r;i++){const a=t[i];s[a.local]=a.xform(s,e[a.server])}return bie(s,n),s}function _B(n,e,t){const s=yB(e);return s===null?null:_ie(n,s,t)}function xie(n,e,t,s){const r=yB(e);if(r===null||!xk(r.downloadTokens))return null;const i=r.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(c=>{const h=n.bucket,p=n.fullPath,m="/b/"+a(h)+"/o/"+a(p),v=Tk(m,t,s),_=fB({alt:"media",token:c});return v+_})[0]}function wie(n,e){const t={},s=e.length;for(let r=0;r<s;r++){const i=e[r];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class xB{constructor(e,t,s,r){this.url=e,this.method=t,this.handler=s,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wB(n){if(!n)throw _k()}function Tie(n,e){function t(s,r){const i=_B(n,r,e);return wB(i!==null),i}return t}function Sie(n,e){function t(s,r){const i=_B(n,r,e);return wB(i!==null),xie(i,r,n.host,n._protocol)}return t}function TB(n){function e(t,s){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=Mre():r=Pre():t.getStatus()===402?r=Ore(n.bucket):t.getStatus()===403?r=Fre(n.path):r=s,r.status=t.getStatus(),r.serverResponse=s.serverResponse,r}return e}function Eie(n){const e=TB(n);function t(s,r){let i=e(s,r);return s.getStatus()===404&&(i=Lre(n.path)),i.serverResponse=r.serverResponse,i}return t}function Nie(n,e,t){const s=e.fullServerUrl(),r=Tk(s,n.host,n._protocol),i="GET",a=n.maxOperationRetryTime,o=new xB(r,i,Sie(n,t),a);return o.errorHandler=Eie(e),o}function Iie(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function Cie(n,e,t){const s=Object.assign({},t);return s.fullPath=n.path,s.size=e.size(),s.contentType||(s.contentType=Iie(null,e)),s}function kie(n,e,t,s,r){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function o(){let A="";for(let D=0;D<2;D++)A=A+Math.random().toString().slice(2);return A}const l=o();a["Content-Type"]="multipart/related; boundary="+l;const c=Cie(e,s,r),h=wie(c,t),p="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,m=`\r
--`+l+"--",v=oh.getBlob(p,s,m);if(v===null)throw Gre();const _={name:c.fullPath},w=Tk(i,n.host,n._protocol),T="POST",E=n.maxUploadRetryTime,C=new xB(w,T,Tie(n,t),E);return C.urlParams=_,C.headers=a,C.body=v.uploadData(),C.errorHandler=TB(e),C}class $ie{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=nf.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=nf.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=nf.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,r,i){if(this.sent_)throw ay("cannot .send() more than once");if(Gh(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(const a in i)i.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,i[a].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ay("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ay("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ay("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ay("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class Aie extends $ie{initXhr(){this.xhr_.responseType="text"}}function SB(){return new Aie}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e,t){this._service=e,t instanceof Ea?this._location=t:this._location=Ea.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new yf(e,t)}get root(){const e=new Ea(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return vB(this._location.path)}get storage(){return this._service}get parent(){const e=mie(this._location.path);if(e===null)return null;const t=new Ea(this._location.bucket,e);return new yf(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw qre(e)}}function Rie(n,e,t){n._throwIfRoot("uploadBytes");const s=kie(n.storage,n._location,bB(),new oh(e,!0),t);return n.storage.makeRequestWithTokens(s,SB).then(r=>({metadata:r,ref:n}))}function Die(n){n._throwIfRoot("getDownloadURL");const e=Nie(n.storage,n._location,bB());return n.storage.makeRequestWithTokens(e,SB).then(t=>{if(t===null)throw Wre();return t})}function Lie(n,e){const t=gie(n._location.path,e),s=new Ea(n._location.bucket,t);return new yf(n.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oie(n){return/^[A-Za-z]+:\/\//.test(n)}function Pie(n,e){return new yf(n,e)}function EB(n,e){if(n instanceof Sk){const t=n;if(t._bucket==null)throw Ure();const s=new yf(t,t._bucket);return e!=null?EB(s,e):s}else return e!==void 0?Lie(n,e):n}function Mie(n,e){if(e&&Oie(e)){if(n instanceof Sk)return Pie(n,e);throw tI("To use ref(service, url), the first argument must be a Storage instance.")}else return EB(n,e)}function YP(n,e){const t=e?.[hB];return t==null?null:Ea.makeFromBucketSpec(t,n)}function Fie(n,e,t,s={}){n.host=`${e}:${t}`;const r=Gh(e);r&&(EC(`https://${n.host}/b`),NC("Storage",!0)),n._isUsingEmulator=!0,n._protocol=r?"https":"http";const{mockUserToken:i}=s;i&&(n._overrideAuthToken=typeof i=="string"?i:zF(i,n.app.options.projectId))}class Sk{constructor(e,t,s,r,i,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=uB,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Rre,this._maxUploadRetryTime=Dre,this._requests=new Set,r!=null?this._bucket=Ea.makeFromBucketSpec(r,this._host):this._bucket=YP(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ea.makeFromBucketSpec(this._url,e):this._bucket=YP(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ZP("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ZP("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(wa(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new yf(this,e)}_makeRequest(e,t,s,r,i=!0){if(this._deleted)return new Kre(dB());{const a=iie(e,this._appId,s,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[s,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,r).getPromise()}}const QP="@firebase/storage",JP="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NB="storage";function Qx(n,e,t){return n=Fs(n),Rie(n,e,t)}function Jx(n){return n=Fs(n),Die(n)}function e0(n,e){return n=Fs(n),Mie(n,e)}function IB(n=kC(),e){n=Fs(n);const s=$1(n,NB).getImmediate({identifier:e}),r=FF("storage");return r&&jie(s,...r),s}function jie(n,e,t,s={}){Fie(n,e,t,s)}function Bie(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new Sk(t,s,r,e,Bf)}function zie(){df(new Eh(NB,Bie,"PUBLIC").setMultipleInstances(!0)),Al(QP,JP,""),Al(QP,JP,"esm2020")}zie();const Vie={apiKey:"AIzaSyDkc9f6Sr4Kq8s9MtwWK9k3i217Gjk9PBg",authDomain:"blue-3b61a.firebaseapp.com",projectId:"blue-3b61a",storageBucket:"blue-3b61a.firebasestorage.app",messagingSenderId:"55986917972",appId:"1:55986917972:web:70e7efc4452a1aab7393c1",measurementId:"G-22BEHR5BE0"},Ek=GF(Vie),Dh=vte(Ek),jr=yre(Ek),qE=IB(Ek);function Uie(){const[n,e]=ve.useState(""),[t,s]=ve.useState(""),[r,i]=ve.useState(!1),a=xv(),o=async()=>{try{i(!0);const c=(await iee(Dh,n,t)).user.uid,h=await vk(ql(jr,"users",c));if(h.exists()){const{role:p}=h.data();localStorage.setItem("userRole",p),localStorage.setItem("userEmail",n),a(`/${p}`)}else alert("No role found for this user!")}catch(l){alert("Login failed: "+l.message)}finally{i(!1)}};return y.jsxs("div",{className:"login-container",children:[y.jsxs("div",{className:"login-card",children:[y.jsx("div",{className:"profile-icon",children:"👨🏻‍💼"}),y.jsx("h2",{className:"login-title",children:"Login"}),y.jsx("input",{type:"email",placeholder:"Email ID",className:"login-input",value:n,onChange:l=>e(l.target.value)}),y.jsx("input",{type:"password",placeholder:"Password",className:"login-input",value:t,onChange:l=>s(l.target.value)}),y.jsx("button",{onClick:o,className:"login-btn",disabled:r,children:r?"Logging in...":"LOGIN"}),r&&y.jsx("div",{className:"spinner"})," ",y.jsxs("div",{className:"auth-link",children:["Don't have an account? ",y.jsx(ft,{to:"/signup",children:"Sign Up"})]})]}),y.jsx("div",{className:"back",children:y.jsx("a",{href:"./",children:y.jsx("button",{children:"❮ Back to Home"})})})]})}function Gie(){const[n,e]=ve.useState(""),[t,s]=ve.useState(""),[r,i]=ve.useState(""),[a,o]=ve.useState(""),[l,c]=ve.useState(""),[h,p]=ve.useState(!1),m=xv(),v=async()=>{if(!l){alert("Please select a role!");return}if(r!==a){alert("Passwords don't match!");return}if(!n||!t||!r){alert("Please fill all fields!");return}try{p(!0);const w=(await ree(Dh,t,r)).user.uid;await oB(ql(jr,"users",w),{name:n,email:t,role:l,createdAt:new Date}),alert("Account created successfully!"),m("/login")}catch(_){alert("Signup failed: "+_.message)}finally{p(!1)}};return y.jsxs("div",{className:"login-container",children:[y.jsxs("div",{className:"login-card",children:[y.jsx("div",{className:"profile-icon",children:"👨🏻‍💼"}),y.jsx("h2",{className:"login-title",children:"Create Account"}),y.jsx("input",{type:"text",placeholder:"Full Name",className:"login-input",value:n,onChange:_=>e(_.target.value)}),y.jsx("input",{type:"email",placeholder:"Email ID",className:"login-input",value:t,onChange:_=>s(_.target.value)}),y.jsx("input",{type:"password",placeholder:"Password",className:"login-input",value:r,onChange:_=>i(_.target.value)}),y.jsx("input",{type:"password",placeholder:"Confirm Password",className:"login-input",value:a,onChange:_=>o(_.target.value)}),y.jsxs("div",{className:"role-buttons",children:[y.jsx("button",{onClick:()=>c("farmer"),className:l==="farmer"?"active":"",children:"🌾 Farmer"}),y.jsx("button",{onClick:()=>c("buyer"),className:l==="buyer"?"active":"",children:"🛒 Buyer"}),y.jsx("button",{onClick:()=>c("admin"),className:l==="admin"?"active":"",children:"🛡️ Admin"})]}),y.jsx("button",{onClick:v,className:"login-btn",disabled:h,children:h?"Creating Account...":"CREATE ACCOUNT"}),h&&y.jsx("div",{className:"spinner"})," ",y.jsxs("div",{className:"auth-link",children:["Already have an account? ",y.jsx(ft,{to:"/login",children:"Sign In"})]})]}),y.jsx("div",{className:"back",children:y.jsx("a",{href:"./",children:y.jsx("button",{children:" ❮ Back to Home "})})})]})}const Wie="/assets/farmer-vBGYqOLb.jpg";function Hie(){return y.jsxs("div",{className:"home-container",children:[y.jsxs("div",{className:"hero-section hero-farmer",children:[y.jsx("div",{className:"hero-background",children:y.jsx("img",{src:Wie,alt:"farmer.jpg"})}),y.jsxs("div",{className:"hero-content",children:[y.jsx("div",{className:"hero-badge",children:"🌾 Farmer Portal"}),y.jsx("h1",{className:"hero-title",children:"Protecting Blue Carbon Ecosystems"}),y.jsx("p",{className:"hero-subtitle",children:"Monitor, report, and verify  carbon projects with transparent blockchain technology and community-driven impact tracking."}),y.jsxs("div",{className:"hero-actions",children:[y.jsx(ft,{to:"/add-project",className:"btn-hero-primary",children:"Start New Project"}),y.jsx(ft,{to:"/mrv-dashboard",className:"btn-hero-secondary",children:"View Dashboard"})]})]})]}),y.jsxs("div",{className:"dashboard-grid",children:[y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"🌱"}),y.jsx("h3",{children:"My Projects"}),y.jsx("p",{children:"View and manage your carbon sequestration projects"}),y.jsx(ft,{to:"/add-project",className:"card-button",children:"Add New Project"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"📊"}),y.jsx("h3",{children:"MRV Dashboard"}),y.jsx("p",{children:"Monitor, Report, and Verify your carbon credits"}),y.jsx(ft,{to:"/mrv-dashboard",className:"card-button",children:"View Dashboard"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"💰"}),y.jsx("h3",{children:"Marketplace"}),y.jsx("p",{children:"Sell your verified carbon credits"}),y.jsx(ft,{to:"/marketplace",className:"card-button",children:"Go to Market"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"📈"}),y.jsx("h3",{children:"Analytics"}),y.jsx("p",{children:"Track your environmental and financial impact"}),y.jsx(ft,{to:"/analytics",className:"card-button",children:"View Analytics"})]})]}),y.jsxs("div",{className:"recent-activity",children:[y.jsx("h2",{children:"Recent Activity"}),y.jsxs("div",{className:"activity-list",children:[y.jsxs("div",{className:"activity-item",children:[y.jsx("span",{className:"activity-icon",children:"✅"}),y.jsx("span",{children:'Project "Mangrove Restoration" verified'}),y.jsx("span",{className:"activity-time",children:"2 hours ago"})]}),y.jsxs("div",{className:"activity-item",children:[y.jsx("span",{className:"activity-icon",children:"💰"}),y.jsx("span",{children:"Sold 150 carbon credits"}),y.jsx("span",{className:"activity-time",children:"1 day ago"})]}),y.jsxs("div",{className:"activity-item",children:[y.jsx("span",{className:"activity-icon",children:"📊"}),y.jsx("span",{children:"Monthly MRV report submitted"}),y.jsx("span",{className:"activity-time",children:"3 days ago"})]})]})]}),y.jsxs("footer",{className:"footer",children:[y.jsxs("p",{children:["© ",new Date().getFullYear()," BlueCarbon Farmers. All rights reserved."]}),y.jsxs("div",{className:"footer-links",children:[y.jsx(ft,{to:"/about",children:"About"}),y.jsx(ft,{to:"/contact",children:"Contact"}),y.jsx(ft,{to:"/privacy",children:"Privacy Policy"})]})]})]})}const qie="/assets/admin-DCDuZu97.png";function Kie(){const[n,e]=ve.useState({activeProjects:0,pendingProjects:0,totalCreditsGenerated:0,totalFarmers:0,totalBuyers:0});return ve.useEffect(()=>{(async()=>{try{const s=Rh(jr,"projects"),r=Rh(jr,"users"),i=await Dc(Qp(s,Jp("status","==","verified"))),a=await Dc(Qp(s,Jp("status","==","pending")));let o=0;(await Dc(s)).forEach(p=>{const m=p.data();o+=parseFloat(m.creditsGenerated||0)});const c=await Dc(Qp(r,Jp("role","==","farmer"))),h=await Dc(Qp(r,Jp("role","==","buyer")));e({activeProjects:i.size,pendingProjects:a.size,totalCreditsGenerated:o,totalFarmers:c.size,totalBuyers:h.size})}catch(s){console.error("Error fetching stats:",s)}})()},[]),y.jsxs("div",{className:"home-container",children:[y.jsxs("div",{className:"hero-section hero-admin",style:{height:"50vh",minHeight:"50vh",maxHeight:"50vh",backgroundImage:`url(${qie})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[y.jsx("div",{className:"admin-admin",children:y.jsx("h1",{children:"Welcome to the Admin Site."})}),y.jsx("div",{className:"hero-content",children:y.jsx("div",{className:"hero-actions",children:y.jsx(ft,{to:"/project-verification",className:"btn-hero-primary",children:"Review Projects"})})})]}),y.jsxs("div",{className:"dashboard-grid",children:[y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"✅"}),y.jsx("h3",{children:"Project Verification"}),y.jsx("p",{children:"Review and approve carbon credit projects"}),y.jsx(ft,{to:"/project-verification",className:"card-button",children:"Review Projects"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"📊"}),y.jsx("h3",{children:"Platform Analytics"}),y.jsx("p",{children:"Monitor platform performance and transactions"}),y.jsx(ft,{to:"/platform-analytics",className:"card-button",children:"View Analytics"})]}),y.jsxs("div",{className:"dashboard-card",children:[y.jsx("div",{className:"card-icon",children:"⚙️"}),y.jsx("h3",{children:"System Settings"}),y.jsx("p",{children:"Configure platform settings and parameters"}),y.jsx(ft,{to:"/system-settings",className:"card-button",children:"Settings"})]})]}),y.jsxs("div",{className:"admin-stats",children:[y.jsx("h2",{children:"Platform Overview"}),y.jsxs("div",{className:"stats-grid",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:n.activeProjects}),y.jsx("div",{className:"stat-label",children:"Verified Projects"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:n.totalFarmers}),y.jsx("div",{className:"stat-label",children:"Registered Farmers"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:n.totalBuyers}),y.jsx("div",{className:"stat-label",children:"Active Buyers"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:n.totalCreditsGenerated}),y.jsx("div",{className:"stat-label",children:"Credits Generated"})]})]})]}),y.jsxs("div",{className:"pending-actions",children:[y.jsx("h2",{children:"Pending Actions"}),y.jsx("div",{className:"action-list",children:y.jsxs("div",{className:`action-item ${n.pendingProjects>0?"urgent":""}`,children:[y.jsx("span",{className:"action-icon",children:"⚠️"}),y.jsxs("span",{children:[n.pendingProjects," projects awaiting verification"]}),y.jsx(ft,{to:"/project-verification",className:"action-link",children:"Review"})]})})]})]})}function Xie(){const[n,e]=ve.useState({firstName:"",lastName:"",email:"",phone:"",organization:"",role:"",location:"",bio:"",profileImage:null}),[t,s]=ve.useState(!0),r=xv();ve.useEffect(()=>{const l=PC(Dh,async c=>{if(c){const h=ql(jr,"users",c.uid),p=await vk(h);p.exists()?e({...p.data(),profileImage:null}):e(m=>({...m,email:c.email}))}s(!1)});return()=>l()},[]);const i=l=>{const{name:c,value:h}=l.target;e(p=>({...p,[c]:h}))},a=l=>{const c=l.target.files[0];c&&e(h=>({...h,profileImage:c}))},o=async l=>{l.preventDefault();try{const c=Dh.currentUser;if(!c)return alert("You must be signed in to save profile.");let h=n.profileImageUrl||"";const p=n.profileImage;if(p instanceof File){const m=IB(),v=e0(m,`profiles/${c.uid}_${Date.now()}`);await Qx(v,p),h=await Jx(v)}await oB(ql(jr,"users",c.uid),{...n,profileImageUrl:h,profileImage:null,updatedAt:cB(),email:c.email},{merge:!0}),alert("Profile saved successfully!"),r(`/${n.role||"dashboard"}`)}catch(c){console.error("Profile save error:",c),alert("Error saving profile: "+c.message)}};return t?y.jsx("p",{children:"Loading..."}):y.jsxs("div",{className:"profile-container",children:[y.jsxs("div",{className:"profile-header",children:[y.jsx("h1",{className:"profile-title",children:"🔧 Build Your Profile"}),y.jsx("p",{className:"profile-subtitle",children:"Complete your profile to get the most out of the platform"})]}),y.jsxs("form",{className:"profile-form",onSubmit:o,children:[y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Personal Information"}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"firstName",children:"First Name *"}),y.jsx("input",{type:"text",id:"firstName",name:"firstName",value:n.firstName,onChange:i,required:!0,placeholder:"Enter your first name"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"lastName",children:"Last Name *"}),y.jsx("input",{type:"text",id:"lastName",name:"lastName",value:n.lastName,onChange:i,required:!0,placeholder:"Enter your last name"})]})]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"email",children:"Email Address *"}),y.jsx("input",{type:"email",id:"email",name:"email",value:n.email,onChange:i,required:!0,placeholder:"Enter your email"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"phone",children:"Phone Number"}),y.jsx("input",{type:"tel",id:"phone",name:"phone",value:n.phone,onChange:i,placeholder:"Enter your phone number"})]})]})]}),y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Professional Information"}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"organization",children:"Organization"}),y.jsx("input",{type:"text",id:"organization",name:"organization",value:n.organization,onChange:i,placeholder:"Company/Organization name"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"role",children:"Role *"}),y.jsxs("select",{id:"role",name:"role",value:n.role,onChange:i,required:!0,children:[y.jsx("option",{value:"",children:"Select your role"}),y.jsx("option",{value:"farmer",children:"Farmer"}),y.jsx("option",{value:"buyer",children:"Buyer"}),y.jsx("option",{value:"admin",children:"Admin"}),y.jsx("option",{value:"verifier",children:"Verifier"})]})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"location",children:"Location"}),y.jsx("input",{type:"text",id:"location",name:"location",value:n.location,onChange:i,placeholder:"City, Country"})]})]}),y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Additional Information"}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"profileImage",children:"Profile Image"}),y.jsx("input",{type:"file",id:"profileImage",name:"profileImage",accept:"image/*",onChange:a,className:"file-input"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"bio",children:"Bio"}),y.jsx("textarea",{id:"bio",name:"bio",value:n.bio,onChange:i,placeholder:"Tell us about yourself...",rows:"4"})]})]}),y.jsxs("div",{className:"form-actions",children:[y.jsx("button",{type:"submit",className:"btn-primary",children:"Save Profile"}),y.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>r(`/${n.role||"dashboard"}`),children:"Skip for Now"})]})]})]})}function eM(){const[n,e]=ve.useState(null),[t,s]=ve.useState(!0),r=xv();ve.useEffect(()=>{const a=PC(Dh,async o=>{if(o){const l=ql(jr,"users",o.uid),c=await vk(l);c.exists()&&e(c.data())}s(!1)});return()=>a()},[]);const i=()=>r("/profile-form");return t?y.jsx("p",{children:"Loading..."}):n?y.jsxs("div",{className:"profile-display-container",children:[y.jsxs("div",{className:"profile-header-section",children:[y.jsx("div",{className:"profile-cover",children:y.jsx("div",{className:"profile-avatar",children:n.profileImageUrl?y.jsx("img",{src:n.profileImageUrl,alt:"Profile"}):y.jsxs("div",{className:"avatar-placeholder",children:[n.firstName?.charAt(0),n.lastName?.charAt(0)]})})}),y.jsxs("div",{className:"profile-info",children:[y.jsxs("div",{className:"profile-name-section",children:[y.jsxs("h1",{children:[n.firstName," ",n.lastName]}),y.jsx("p",{children:n.role}),y.jsxs("p",{children:["📍 ",n.location]})]}),y.jsxs("div",{className:"profile-actions",children:[y.jsx("button",{onClick:i,className:"btn-edit",children:"✏️ Edit Profile"}),y.jsx("button",{className:"btn-connect",children:"🤝 Connect"}),y.jsx("button",{className:"btn-message",children:"💬 Message"})]})]})]}),y.jsxs("div",{className:"profile-content",children:[y.jsxs("div",{className:"profile-card",children:[y.jsx("h3",{children:"About"}),y.jsx("p",{children:n.bio||"No bio available"})]}),y.jsxs("div",{className:"profile-card",children:[y.jsx("h3",{children:"Contact Information"}),y.jsxs("p",{children:["📧 ",n.email]}),n.phone&&y.jsxs("p",{children:["📱 ",n.phone]})]}),y.jsxs("div",{className:"profile-card",children:[y.jsx("h3",{children:"Professional Information"}),y.jsxs("p",{children:["🏢 ",n.organization]}),y.jsxs("p",{children:["Role: ",n.role]})]})]})]}):y.jsx("div",{className:"profile-display-container",children:y.jsxs("div",{className:"no-profile",children:[y.jsx("h2",{children:"No Profile Found"}),y.jsx("p",{children:"Please complete your profile first."}),y.jsx("button",{onClick:()=>r("/profile-form"),className:"btn-primary",children:"Create Profile"})]})})}var by={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var Zie=by.exports,tM;function Yie(){return tM||(tM=1,(function(n,e){(function(t,s){s(e)})(Zie,(function(t){var s="1.9.4";function r(f){var b,N,R,z;for(N=1,R=arguments.length;N<R;N++){z=arguments[N];for(b in z)f[b]=z[b]}return f}var i=Object.create||(function(){function f(){}return function(b){return f.prototype=b,new f}})();function a(f,b){var N=Array.prototype.slice;if(f.bind)return f.bind.apply(f,N.call(arguments,1));var R=N.call(arguments,2);return function(){return f.apply(b,R.length?R.concat(N.call(arguments)):arguments)}}var o=0;function l(f){return"_leaflet_id"in f||(f._leaflet_id=++o),f._leaflet_id}function c(f,b,N){var R,z,Z,ue;return ue=function(){R=!1,z&&(Z.apply(N,z),z=!1)},Z=function(){R?z=arguments:(f.apply(N,arguments),setTimeout(ue,b),R=!0)},Z}function h(f,b,N){var R=b[1],z=b[0],Z=R-z;return f===R&&N?f:((f-z)%Z+Z)%Z+z}function p(){return!1}function m(f,b){if(b===!1)return f;var N=Math.pow(10,b===void 0?6:b);return Math.round(f*N)/N}function v(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function _(f){return v(f).split(/\s+/)}function w(f,b){Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?i(f.options):{});for(var N in b)f.options[N]=b[N];return f.options}function T(f,b,N){var R=[];for(var z in f)R.push(encodeURIComponent(N?z.toUpperCase():z)+"="+encodeURIComponent(f[z]));return(!b||b.indexOf("?")===-1?"?":"&")+R.join("&")}var E=/\{ *([\w_ -]+) *\}/g;function C(f,b){return f.replace(E,function(N,R){var z=b[R];if(z===void 0)throw new Error("No value provided for variable "+N);return typeof z=="function"&&(z=z(b)),z})}var A=Array.isArray||function(f){return Object.prototype.toString.call(f)==="[object Array]"};function D(f,b){for(var N=0;N<f.length;N++)if(f[N]===b)return N;return-1}var F="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function W(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var B=0;function P(f){var b=+new Date,N=Math.max(0,16-(b-B));return B=b+N,window.setTimeout(f,N)}var O=window.requestAnimationFrame||W("RequestAnimationFrame")||P,M=window.cancelAnimationFrame||W("CancelAnimationFrame")||W("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function k(f,b,N){if(N&&O===P)f.call(b);else return O.call(window,a(f,b))}function V(f){f&&M.call(window,f)}var G={__proto__:null,extend:r,create:i,bind:a,get lastId(){return o},stamp:l,throttle:c,wrapNum:h,falseFn:p,formatNum:m,trim:v,splitWords:_,setOptions:w,getParamString:T,template:C,isArray:A,indexOf:D,emptyImageUrl:F,requestFn:O,cancelFn:M,requestAnimFrame:k,cancelAnimFrame:V};function ae(){}ae.extend=function(f){var b=function(){w(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},N=b.__super__=this.prototype,R=i(N);R.constructor=b,b.prototype=R;for(var z in this)Object.prototype.hasOwnProperty.call(this,z)&&z!=="prototype"&&z!=="__super__"&&(b[z]=this[z]);return f.statics&&r(b,f.statics),f.includes&&(J(f.includes),r.apply(null,[R].concat(f.includes))),r(R,f),delete R.statics,delete R.includes,R.options&&(R.options=N.options?i(N.options):{},r(R.options,f.options)),R._initHooks=[],R.callInitHooks=function(){if(!this._initHooksCalled){N.callInitHooks&&N.callInitHooks.call(this),this._initHooksCalled=!0;for(var Z=0,ue=R._initHooks.length;Z<ue;Z++)R._initHooks[Z].call(this)}},b},ae.include=function(f){var b=this.prototype.options;return r(this.prototype,f),f.options&&(this.prototype.options=b,this.mergeOptions(f.options)),this},ae.mergeOptions=function(f){return r(this.prototype.options,f),this},ae.addInitHook=function(f){var b=Array.prototype.slice.call(arguments,1),N=typeof f=="function"?f:function(){this[f].apply(this,b)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(N),this};function J(f){if(!(typeof L>"u"||!L||!L.Mixin)){f=A(f)?f:[f];for(var b=0;b<f.length;b++)f[b]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var X={on:function(f,b,N){if(typeof f=="object")for(var R in f)this._on(R,f[R],b);else{f=_(f);for(var z=0,Z=f.length;z<Z;z++)this._on(f[z],b,N)}return this},off:function(f,b,N){if(!arguments.length)delete this._events;else if(typeof f=="object")for(var R in f)this._off(R,f[R],b);else{f=_(f);for(var z=arguments.length===1,Z=0,ue=f.length;Z<ue;Z++)z?this._off(f[Z]):this._off(f[Z],b,N)}return this},_on:function(f,b,N,R){if(typeof b!="function"){console.warn("wrong listener type: "+typeof b);return}if(this._listens(f,b,N)===!1){N===this&&(N=void 0);var z={fn:b,ctx:N};R&&(z.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(z)}},_off:function(f,b,N){var R,z,Z;if(this._events&&(R=this._events[f],!!R)){if(arguments.length===1){if(this._firingCount)for(z=0,Z=R.length;z<Z;z++)R[z].fn=p;delete this._events[f];return}if(typeof b!="function"){console.warn("wrong listener type: "+typeof b);return}var ue=this._listens(f,b,N);if(ue!==!1){var Ne=R[ue];this._firingCount&&(Ne.fn=p,this._events[f]=R=R.slice()),R.splice(ue,1)}}},fire:function(f,b,N){if(!this.listens(f,N))return this;var R=r({},b,{type:f,target:this,sourceTarget:b&&b.sourceTarget||this});if(this._events){var z=this._events[f];if(z){this._firingCount=this._firingCount+1||1;for(var Z=0,ue=z.length;Z<ue;Z++){var Ne=z[Z],Le=Ne.fn;Ne.once&&this.off(f,Le,Ne.ctx),Le.call(Ne.ctx||this,R)}this._firingCount--}}return N&&this._propagateEvent(R),this},listens:function(f,b,N,R){typeof f!="string"&&console.warn('"string" type argument expected');var z=b;typeof b!="function"&&(R=!!b,z=void 0,N=void 0);var Z=this._events&&this._events[f];if(Z&&Z.length&&this._listens(f,z,N)!==!1)return!0;if(R){for(var ue in this._eventParents)if(this._eventParents[ue].listens(f,b,N,R))return!0}return!1},_listens:function(f,b,N){if(!this._events)return!1;var R=this._events[f]||[];if(!b)return!!R.length;N===this&&(N=void 0);for(var z=0,Z=R.length;z<Z;z++)if(R[z].fn===b&&R[z].ctx===N)return z;return!1},once:function(f,b,N){if(typeof f=="object")for(var R in f)this._on(R,f[R],b,!0);else{f=_(f);for(var z=0,Z=f.length;z<Z;z++)this._on(f[z],b,N,!0)}return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[l(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[l(f)],this},_propagateEvent:function(f){for(var b in this._eventParents)this._eventParents[b].fire(f.type,r({layer:f.target,propagatedFrom:f.target},f),!0)}};X.addEventListener=X.on,X.removeEventListener=X.clearAllEventListeners=X.off,X.addOneTimeEventListener=X.once,X.fireEvent=X.fire,X.hasEventListeners=X.listens;var se=ae.extend(X);function ne(f,b,N){this.x=N?Math.round(f):f,this.y=N?Math.round(b):b}var le=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(f){return this.clone()._add(K(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(K(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new ne(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new ne(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=le(this.x),this.y=le(this.y),this},distanceTo:function(f){f=K(f);var b=f.x-this.x,N=f.y-this.y;return Math.sqrt(b*b+N*N)},equals:function(f){return f=K(f),f.x===this.x&&f.y===this.y},contains:function(f){return f=K(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+m(this.x)+", "+m(this.y)+")"}};function K(f,b,N){return f instanceof ne?f:A(f)?new ne(f[0],f[1]):f==null?f:typeof f=="object"&&"x"in f&&"y"in f?new ne(f.x,f.y):new ne(f,b,N)}function ie(f,b){if(f)for(var N=b?[f,b]:f,R=0,z=N.length;R<z;R++)this.extend(N[R])}ie.prototype={extend:function(f){var b,N;if(!f)return this;if(f instanceof ne||typeof f[0]=="number"||"x"in f)b=N=K(f);else if(f=de(f),b=f.min,N=f.max,!b||!N)return this;return!this.min&&!this.max?(this.min=b.clone(),this.max=N.clone()):(this.min.x=Math.min(b.x,this.min.x),this.max.x=Math.max(N.x,this.max.x),this.min.y=Math.min(b.y,this.min.y),this.max.y=Math.max(N.y,this.max.y)),this},getCenter:function(f){return K((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return K(this.min.x,this.max.y)},getTopRight:function(){return K(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var b,N;return typeof f[0]=="number"||f instanceof ne?f=K(f):f=de(f),f instanceof ie?(b=f.min,N=f.max):b=N=f,b.x>=this.min.x&&N.x<=this.max.x&&b.y>=this.min.y&&N.y<=this.max.y},intersects:function(f){f=de(f);var b=this.min,N=this.max,R=f.min,z=f.max,Z=z.x>=b.x&&R.x<=N.x,ue=z.y>=b.y&&R.y<=N.y;return Z&&ue},overlaps:function(f){f=de(f);var b=this.min,N=this.max,R=f.min,z=f.max,Z=z.x>b.x&&R.x<N.x,ue=z.y>b.y&&R.y<N.y;return Z&&ue},isValid:function(){return!!(this.min&&this.max)},pad:function(f){var b=this.min,N=this.max,R=Math.abs(b.x-N.x)*f,z=Math.abs(b.y-N.y)*f;return de(K(b.x-R,b.y-z),K(N.x+R,N.y+z))},equals:function(f){return f?(f=de(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight())):!1}};function de(f,b){return!f||f instanceof ie?f:new ie(f,b)}function ce(f,b){if(f)for(var N=b?[f,b]:f,R=0,z=N.length;R<z;R++)this.extend(N[R])}ce.prototype={extend:function(f){var b=this._southWest,N=this._northEast,R,z;if(f instanceof Te)R=f,z=f;else if(f instanceof ce){if(R=f._southWest,z=f._northEast,!R||!z)return this}else return f?this.extend(Ie(f)||Se(f)):this;return!b&&!N?(this._southWest=new Te(R.lat,R.lng),this._northEast=new Te(z.lat,z.lng)):(b.lat=Math.min(R.lat,b.lat),b.lng=Math.min(R.lng,b.lng),N.lat=Math.max(z.lat,N.lat),N.lng=Math.max(z.lng,N.lng)),this},pad:function(f){var b=this._southWest,N=this._northEast,R=Math.abs(b.lat-N.lat)*f,z=Math.abs(b.lng-N.lng)*f;return new ce(new Te(b.lat-R,b.lng-z),new Te(N.lat+R,N.lng+z))},getCenter:function(){return new Te((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Te(this.getNorth(),this.getWest())},getSouthEast:function(){return new Te(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){typeof f[0]=="number"||f instanceof Te||"lat"in f?f=Ie(f):f=Se(f);var b=this._southWest,N=this._northEast,R,z;return f instanceof ce?(R=f.getSouthWest(),z=f.getNorthEast()):R=z=f,R.lat>=b.lat&&z.lat<=N.lat&&R.lng>=b.lng&&z.lng<=N.lng},intersects:function(f){f=Se(f);var b=this._southWest,N=this._northEast,R=f.getSouthWest(),z=f.getNorthEast(),Z=z.lat>=b.lat&&R.lat<=N.lat,ue=z.lng>=b.lng&&R.lng<=N.lng;return Z&&ue},overlaps:function(f){f=Se(f);var b=this._southWest,N=this._northEast,R=f.getSouthWest(),z=f.getNorthEast(),Z=z.lat>b.lat&&R.lat<N.lat,ue=z.lng>b.lng&&R.lng<N.lng;return Z&&ue},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,b){return f?(f=Se(f),this._southWest.equals(f.getSouthWest(),b)&&this._northEast.equals(f.getNorthEast(),b)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Se(f,b){return f instanceof ce?f:new ce(f,b)}function Te(f,b,N){if(isNaN(f)||isNaN(b))throw new Error("Invalid LatLng object: ("+f+", "+b+")");this.lat=+f,this.lng=+b,N!==void 0&&(this.alt=+N)}Te.prototype={equals:function(f,b){if(!f)return!1;f=Ie(f);var N=Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng));return N<=(b===void 0?1e-9:b)},toString:function(f){return"LatLng("+m(this.lat,f)+", "+m(this.lng,f)+")"},distanceTo:function(f){return qe.distance(this,Ie(f))},wrap:function(){return qe.wrapLatLng(this)},toBounds:function(f){var b=180*f/40075017,N=b/Math.cos(Math.PI/180*this.lat);return Se([this.lat-b,this.lng-N],[this.lat+b,this.lng+N])},clone:function(){return new Te(this.lat,this.lng,this.alt)}};function Ie(f,b,N){return f instanceof Te?f:A(f)&&typeof f[0]!="object"?f.length===3?new Te(f[0],f[1],f[2]):f.length===2?new Te(f[0],f[1]):null:f==null?f:typeof f=="object"&&"lat"in f?new Te(f.lat,"lng"in f?f.lng:f.lon,f.alt):b===void 0?null:new Te(f,b,N)}var He={latLngToPoint:function(f,b){var N=this.projection.project(f),R=this.scale(b);return this.transformation._transform(N,R)},pointToLatLng:function(f,b){var N=this.scale(b),R=this.transformation.untransform(f,N);return this.projection.unproject(R)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var b=this.projection.bounds,N=this.scale(f),R=this.transformation.transform(b.min,N),z=this.transformation.transform(b.max,N);return new ie(R,z)},infinite:!1,wrapLatLng:function(f){var b=this.wrapLng?h(f.lng,this.wrapLng,!0):f.lng,N=this.wrapLat?h(f.lat,this.wrapLat,!0):f.lat,R=f.alt;return new Te(N,b,R)},wrapLatLngBounds:function(f){var b=f.getCenter(),N=this.wrapLatLng(b),R=b.lat-N.lat,z=b.lng-N.lng;if(R===0&&z===0)return f;var Z=f.getSouthWest(),ue=f.getNorthEast(),Ne=new Te(Z.lat-R,Z.lng-z),Le=new Te(ue.lat-R,ue.lng-z);return new ce(Ne,Le)}},qe=r({},He,{wrapLng:[-180,180],R:6371e3,distance:function(f,b){var N=Math.PI/180,R=f.lat*N,z=b.lat*N,Z=Math.sin((b.lat-f.lat)*N/2),ue=Math.sin((b.lng-f.lng)*N/2),Ne=Z*Z+Math.cos(R)*Math.cos(z)*ue*ue,Le=2*Math.atan2(Math.sqrt(Ne),Math.sqrt(1-Ne));return this.R*Le}}),Qe=6378137,ut={R:Qe,MAX_LATITUDE:85.0511287798,project:function(f){var b=Math.PI/180,N=this.MAX_LATITUDE,R=Math.max(Math.min(N,f.lat),-N),z=Math.sin(R*b);return new ne(this.R*f.lng*b,this.R*Math.log((1+z)/(1-z))/2)},unproject:function(f){var b=180/Math.PI;return new Te((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*b,f.x*b/this.R)},bounds:(function(){var f=Qe*Math.PI;return new ie([-f,-f],[f,f])})()};function mt(f,b,N,R){if(A(f)){this._a=f[0],this._b=f[1],this._c=f[2],this._d=f[3];return}this._a=f,this._b=b,this._c=N,this._d=R}mt.prototype={transform:function(f,b){return this._transform(f.clone(),b)},_transform:function(f,b){return b=b||1,f.x=b*(this._a*f.x+this._b),f.y=b*(this._c*f.y+this._d),f},untransform:function(f,b){return b=b||1,new ne((f.x/b-this._b)/this._a,(f.y/b-this._d)/this._c)}};function At(f,b,N,R){return new mt(f,b,N,R)}var Gt=r({},qe,{code:"EPSG:3857",projection:ut,transformation:(function(){var f=.5/(Math.PI*ut.R);return At(f,.5,-f,.5)})()}),gn=r({},Gt,{code:"EPSG:900913"});function Jt(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function Zt(f,b){var N="",R,z,Z,ue,Ne,Le;for(R=0,Z=f.length;R<Z;R++){for(Ne=f[R],z=0,ue=Ne.length;z<ue;z++)Le=Ne[z],N+=(z?"L":"M")+Le.x+" "+Le.y;N+=b?ct.svg?"z":"x":""}return N||"M0 0"}var Pt=document.documentElement.style,un="ActiveXObject"in window,Cr=un&&!document.addEventListener,Rn="msLaunchUri"in navigator&&!("documentMode"in document),zs=Qr("webkit"),Vs=Qr("android"),kr=Qr("android 2")||Qr("android 3"),sr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Zr=Vs&&Qr("Google")&&sr<537&&!("AudioNode"in window),an=!!window.opera,Mt=!Rn&&Qr("chrome"),ts=Qr("gecko")&&!zs&&!an&&!un,os=!Mt&&Qr("safari"),mo=Qr("phantom"),el="OTransition"in Pt,go=navigator.platform.indexOf("Win")===0,_i=un&&"transition"in Pt,ta="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!kr,Yr="MozPerspective"in Pt,ou=!window.L_DISABLE_3D&&(_i||ta||Yr)&&!el&&!mo,na=typeof orientation<"u"||Qr("mobile"),cd=na&&zs,ud=na&&ta,lu=!window.PointerEvent&&window.MSPointerEvent,Ra=!!(window.PointerEvent||lu),Da="ontouchstart"in window||!!window.TouchEvent,hd=!window.L_NO_TOUCH&&(Da||Ra),La=na&&an,dd=na&&ts,tl=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,cu=(function(){var f=!1;try{var b=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",p,b),window.removeEventListener("testPassiveEventSupport",p,b)}catch{}return f})(),nl=(function(){return!!document.createElement("canvas").getContext})(),uu=!!(document.createElementNS&&Jt("svg").createSVGRect),qn=!!uu&&(function(){var f=document.createElement("div");return f.innerHTML="<svg/>",(f.firstChild&&f.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),$s=!uu&&(function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var b=f.firstChild;return b.style.behavior="url(#default#VML)",b&&typeof b.adj=="object"}catch{return!1}})(),bs=navigator.platform.indexOf("Mac")===0,Pi=navigator.platform.indexOf("Linux")===0;function Qr(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var ct={ie:un,ielt9:Cr,edge:Rn,webkit:zs,android:Vs,android23:kr,androidStock:Zr,opera:an,chrome:Mt,gecko:ts,safari:os,phantom:mo,opera12:el,win:go,ie3d:_i,webkit3d:ta,gecko3d:Yr,any3d:ou,mobile:na,mobileWebkit:cd,mobileWebkit3d:ud,msPointer:lu,pointer:Ra,touch:hd,touchNative:Da,mobileOpera:La,mobileGecko:dd,retina:tl,passiveEvents:cu,canvas:nl,svg:uu,vml:$s,inlineSvg:qn,mac:bs,linux:Pi},yo=ct.msPointer?"MSPointerDown":"pointerdown",fd=ct.msPointer?"MSPointerMove":"pointermove",sl=ct.msPointer?"MSPointerUp":"pointerup",vo=ct.msPointer?"MSPointerCancel":"pointercancel",sa={touchstart:yo,touchmove:fd,touchend:sl,touchcancel:vo},ra={touchstart:lc,touchmove:oc,touchend:oc,touchcancel:oc},$r={},pr=!1;function ps(f,b,N){return b==="touchstart"&&tp(),ra[b]?(N=ra[b].bind(this,N),f.addEventListener(sa[b],N,!1),N):(console.warn("wrong event specified:",b),p)}function pd(f,b,N){if(!sa[b]){console.warn("wrong event specified:",b);return}f.removeEventListener(sa[b],N,!1)}function hu(f){$r[f.pointerId]=f}function ia(f){$r[f.pointerId]&&($r[f.pointerId]=f)}function Oa(f){delete $r[f.pointerId]}function tp(){pr||(document.addEventListener(yo,hu,!0),document.addEventListener(fd,ia,!0),document.addEventListener(sl,Oa,!0),document.addEventListener(vo,Oa,!0),pr=!0)}function oc(f,b){if(b.pointerType!==(b.MSPOINTER_TYPE_MOUSE||"mouse")){b.touches=[];for(var N in $r)b.touches.push($r[N]);b.changedTouches=[b],f(b)}}function lc(f,b){b.MSPOINTER_TYPE_TOUCH&&b.pointerType===b.MSPOINTER_TYPE_TOUCH&&Dn(b),oc(f,b)}function np(f){var b={},N,R;for(R in f)N=f[R],b[R]=N&&N.bind?N.bind(f):N;return f=b,b.type="dblclick",b.detail=2,b.isTrusted=!1,b._simulated=!0,b}var rl=200;function Pa(f,b){f.addEventListener("dblclick",b);var N=0,R;function z(Z){if(Z.detail!==1){R=Z.detail;return}if(!(Z.pointerType==="mouse"||Z.sourceCapabilities&&!Z.sourceCapabilities.firesTouchEvents)){var ue=pu(Z);if(!(ue.some(function(Le){return Le instanceof HTMLLabelElement&&Le.attributes.for})&&!ue.some(function(Le){return Le instanceof HTMLInputElement||Le instanceof HTMLSelectElement}))){var Ne=Date.now();Ne-N<=rl?(R++,R===2&&b(np(Z))):R=1,N=Ne}}}return f.addEventListener("click",z),{dblclick:b,simDblclick:z}}function rr(f,b){f.removeEventListener("dblclick",b.dblclick),f.removeEventListener("click",b.simDblclick)}var bo=aa(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),il=aa(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ma=il==="webkitTransition"||il==="OTransition"?il+"End":"transitionend";function cc(f){return typeof f=="string"?document.getElementById(f):f}function Fa(f,b){var N=f.style[b]||f.currentStyle&&f.currentStyle[b];if((!N||N==="auto")&&document.defaultView){var R=document.defaultView.getComputedStyle(f,null);N=R?R[b]:null}return N==="auto"?null:N}function qt(f,b,N){var R=document.createElement(f);return R.className=b||"",N&&N.appendChild(R),R}function Tn(f){var b=f.parentNode;b&&b.removeChild(f)}function Us(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function ja(f){var b=f.parentNode;b&&b.lastChild!==f&&b.appendChild(f)}function al(f){var b=f.parentNode;b&&b.firstChild!==f&&b.insertBefore(f,b.firstChild)}function ol(f,b){if(f.classList!==void 0)return f.classList.contains(b);var N=ns(f);return N.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(N)}function kt(f,b){if(f.classList!==void 0)for(var N=_(b),R=0,z=N.length;R<z;R++)f.classList.add(N[R]);else if(!ol(f,b)){var Z=ns(f);md(f,(Z?Z+" ":"")+b)}}function Cn(f,b){f.classList!==void 0?f.classList.remove(b):md(f,v((" "+ns(f)+" ").replace(" "+b+" "," ")))}function md(f,b){f.className.baseVal===void 0?f.className=b:f.className.baseVal=b}function ns(f){return f.correspondingElement&&(f=f.correspondingElement),f.className.baseVal===void 0?f.className:f.className.baseVal}function Kn(f,b){"opacity"in f.style?f.style.opacity=b:"filter"in f.style&&uc(f,b)}function uc(f,b){var N=!1,R="DXImageTransform.Microsoft.Alpha";try{N=f.filters.item(R)}catch{if(b===1)return}b=Math.round(b*100),N?(N.Enabled=b!==100,N.Opacity=b):f.style.filter+=" progid:"+R+"(opacity="+b+")"}function aa(f){for(var b=document.documentElement.style,N=0;N<f.length;N++)if(f[N]in b)return f[N];return!1}function Ar(f,b,N){var R=b||new ne(0,0);f.style[bo]=(ct.ie3d?"translate("+R.x+"px,"+R.y+"px)":"translate3d("+R.x+"px,"+R.y+"px,0)")+(N?" scale("+N+")":"")}function Tt(f,b){f._leaflet_pos=b,ct.any3d?Ar(f,b):(f.style.left=b.x+"px",f.style.top=b.y+"px")}function xi(f){return f._leaflet_pos||new ne(0,0)}var mr,oa,du;if("onselectstart"in document)mr=function(){vt(window,"selectstart",Dn)},oa=function(){hn(window,"selectstart",Dn)};else{var _o=aa(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);mr=function(){if(_o){var f=document.documentElement.style;du=f[_o],f[_o]="none"}},oa=function(){_o&&(document.documentElement.style[_o]=du,du=void 0)}}function hc(){vt(window,"dragstart",Dn)}function gd(){hn(window,"dragstart",Dn)}var fu,ll;function la(f){for(;f.tabIndex===-1;)f=f.parentNode;f.style&&(Rr(),fu=f,ll=f.style.outlineStyle,f.style.outlineStyle="none",vt(window,"keydown",Rr))}function Rr(){fu&&(fu.style.outlineStyle=ll,fu=void 0,ll=void 0,hn(window,"keydown",Rr))}function Ba(f){do f=f.parentNode;while((!f.offsetWidth||!f.offsetHeight)&&f!==document.body);return f}function ca(f){var b=f.getBoundingClientRect();return{x:b.width/f.offsetWidth||1,y:b.height/f.offsetHeight||1,boundingClientRect:b}}var yd={__proto__:null,TRANSFORM:bo,TRANSITION:il,TRANSITION_END:Ma,get:cc,getStyle:Fa,create:qt,remove:Tn,empty:Us,toFront:ja,toBack:al,hasClass:ol,addClass:kt,removeClass:Cn,setClass:md,getClass:ns,setOpacity:Kn,testProp:aa,setTransform:Ar,setPosition:Tt,getPosition:xi,get disableTextSelection(){return mr},get enableTextSelection(){return oa},disableImageDrag:hc,enableImageDrag:gd,preventOutline:la,restoreOutline:Rr,getSizedParentNode:Ba,getScale:ca};function vt(f,b,N,R){if(b&&typeof b=="object")for(var z in b)xo(f,z,b[z],N);else{b=_(b);for(var Z=0,ue=b.length;Z<ue;Z++)xo(f,b[Z],N,R)}return this}var wi="_leaflet_events";function hn(f,b,N,R){if(arguments.length===1)Mi(f),delete f[wi];else if(b&&typeof b=="object")for(var z in b)Fi(f,z,b[z],N);else if(b=_(b),arguments.length===2)Mi(f,function(Ne){return D(b,Ne)!==-1});else for(var Z=0,ue=b.length;Z<ue;Z++)Fi(f,b[Z],N,R);return this}function Mi(f,b){for(var N in f[wi]){var R=N.split(/\d/)[0];(!b||b(R))&&Fi(f,R,null,null,N)}}var Jr={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function xo(f,b,N,R){var z=b+l(N)+(R?"_"+l(R):"");if(f[wi]&&f[wi][z])return this;var Z=function(Ne){return N.call(R||f,Ne||window.event)},ue=Z;!ct.touchNative&&ct.pointer&&b.indexOf("touch")===0?Z=ps(f,b,Z):ct.touch&&b==="dblclick"?Z=Pa(f,Z):"addEventListener"in f?b==="touchstart"||b==="touchmove"||b==="wheel"||b==="mousewheel"?f.addEventListener(Jr[b]||b,Z,ct.passiveEvents?{passive:!1}:!1):b==="mouseenter"||b==="mouseleave"?(Z=function(Ne){Ne=Ne||window.event,To(f,Ne)&&ue(Ne)},f.addEventListener(Jr[b],Z,!1)):f.addEventListener(b,ue,!1):f.attachEvent("on"+b,Z),f[wi]=f[wi]||{},f[wi][z]=Z}function Fi(f,b,N,R,z){z=z||b+l(N)+(R?"_"+l(R):"");var Z=f[wi]&&f[wi][z];if(!Z)return this;!ct.touchNative&&ct.pointer&&b.indexOf("touch")===0?pd(f,b,Z):ct.touch&&b==="dblclick"?rr(f,Z):"removeEventListener"in f?f.removeEventListener(Jr[b]||b,Z,!1):f.detachEvent("on"+b,Z),f[wi][z]=null}function ei(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function ua(f){return xo(f,"wheel",ei),this}function wo(f){return vt(f,"mousedown touchstart dblclick contextmenu",ei),f._leaflet_disable_click=!0,this}function Dn(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function gr(f){return Dn(f),ei(f),this}function pu(f){if(f.composedPath)return f.composedPath();for(var b=[],N=f.target;N;)b.push(N),N=N.parentNode;return b}function As(f,b){if(!b)return new ne(f.clientX,f.clientY);var N=ca(b),R=N.boundingClientRect;return new ne((f.clientX-R.left)/N.x-b.clientLeft,(f.clientY-R.top)/N.y-b.clientTop)}var yn=ct.linux&&ct.chrome?window.devicePixelRatio:ct.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function dc(f){return ct.edge?f.wheelDeltaY/2:f.deltaY&&f.deltaMode===0?-f.deltaY/yn:f.deltaY&&f.deltaMode===1?-f.deltaY*20:f.deltaY&&f.deltaMode===2?-f.deltaY*60:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?-f.detail*20:f.detail?f.detail/-32765*60:0}function To(f,b){var N=b.relatedTarget;if(!N)return!0;try{for(;N&&N!==f;)N=N.parentNode}catch{return!1}return N!==f}var sp={__proto__:null,on:vt,off:hn,stopPropagation:ei,disableScrollPropagation:ua,disableClickPropagation:wo,preventDefault:Dn,stop:gr,getPropagationPath:pu,getMousePosition:As,getWheelDelta:dc,isExternalTarget:To,addListener:vt,removeListener:hn},fc=se.extend({run:function(f,b,N,R){this.stop(),this._el=f,this._inProgress=!0,this._duration=N||.25,this._easeOutPower=1/Math.max(R||.5,.2),this._startPos=xi(f),this._offset=b.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=k(this._animate,this),this._step()},_step:function(f){var b=+new Date-this._startTime,N=this._duration*1e3;b<N?this._runFrame(this._easeOut(b/N),f):(this._runFrame(1),this._complete())},_runFrame:function(f,b){var N=this._startPos.add(this._offset.multiplyBy(f));b&&N._round(),Tt(this._el,N),this.fire("step")},_complete:function(){V(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Ft=se.extend({options:{crs:Gt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,b){b=w(this,b),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),b.maxBounds&&this.setMaxBounds(b.maxBounds),b.zoom!==void 0&&(this._zoom=this._limitZoom(b.zoom)),b.center&&b.zoom!==void 0&&this.setView(Ie(b.center),b.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=il&&ct.any3d&&!ct.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),vt(this._proxy,Ma,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,b,N){if(b=b===void 0?this._zoom:this._limitZoom(b),f=this._limitCenter(Ie(f),b,this.options.maxBounds),N=N||{},this._stop(),this._loaded&&!N.reset&&N!==!0){N.animate!==void 0&&(N.zoom=r({animate:N.animate},N.zoom),N.pan=r({animate:N.animate,duration:N.duration},N.pan));var R=this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,b,N.zoom):this._tryAnimatedPan(f,N.pan);if(R)return clearTimeout(this._sizeTimer),this}return this._resetView(f,b,N.pan&&N.pan.noMoveStart),this},setZoom:function(f,b){return this._loaded?this.setView(this.getCenter(),f,{zoom:b}):(this._zoom=f,this)},zoomIn:function(f,b){return f=f||(ct.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+f,b)},zoomOut:function(f,b){return f=f||(ct.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-f,b)},setZoomAround:function(f,b,N){var R=this.getZoomScale(b),z=this.getSize().divideBy(2),Z=f instanceof ne?f:this.latLngToContainerPoint(f),ue=Z.subtract(z).multiplyBy(1-1/R),Ne=this.containerPointToLatLng(z.add(ue));return this.setView(Ne,b,{zoom:N})},_getBoundsCenterZoom:function(f,b){b=b||{},f=f.getBounds?f.getBounds():Se(f);var N=K(b.paddingTopLeft||b.padding||[0,0]),R=K(b.paddingBottomRight||b.padding||[0,0]),z=this.getBoundsZoom(f,!1,N.add(R));if(z=typeof b.maxZoom=="number"?Math.min(b.maxZoom,z):z,z===1/0)return{center:f.getCenter(),zoom:z};var Z=R.subtract(N).divideBy(2),ue=this.project(f.getSouthWest(),z),Ne=this.project(f.getNorthEast(),z),Le=this.unproject(ue.add(Ne).divideBy(2).add(Z),z);return{center:Le,zoom:z}},fitBounds:function(f,b){if(f=Se(f),!f.isValid())throw new Error("Bounds are not valid.");var N=this._getBoundsCenterZoom(f,b);return this.setView(N.center,N.zoom,b)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,b){return this.setView(f,this._zoom,{pan:b})},panBy:function(f,b){if(f=K(f).round(),b=b||{},!f.x&&!f.y)return this.fire("moveend");if(b.animate!==!0&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new fc,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),b.noMoveStart||this.fire("movestart"),b.animate!==!1){kt(this._mapPane,"leaflet-pan-anim");var N=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,N,b.duration||.25,b.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,b,N){if(N=N||{},N.animate===!1||!ct.any3d)return this.setView(f,b,N);this._stop();var R=this.project(this.getCenter()),z=this.project(f),Z=this.getSize(),ue=this._zoom;f=Ie(f),b=b===void 0?ue:b;var Ne=Math.max(Z.x,Z.y),Le=Ne*this.getZoomScale(ue,b),Ge=z.distanceTo(R)||1,Je=1.42,rt=Je*Je;function lt(ls){var qa=ls?-1:1,ko=ls?Le:Ne,pl=Le*Le-Ne*Ne+qa*rt*rt*Ge*Ge,$o=2*ko*rt*Ge,Rd=pl/$o,gp=Math.sqrt(Rd*Rd+1)-Rd,Dd=gp<1e-9?-18:Math.log(gp);return Dd}function Ct(ls){return(Math.exp(ls)-Math.exp(-ls))/2}function Zn(ls){return(Math.exp(ls)+Math.exp(-ls))/2}function ms(ls){return Ct(ls)/Zn(ls)}var vr=lt(0);function ji(ls){return Ne*(Zn(vr)/Zn(vr+Je*ls))}function __(ls){return Ne*(Zn(vr)*ms(vr+Je*ls)-Ct(vr))/rt}function x_(ls){return 1-Math.pow(1-ls,1.5)}var Ad=Date.now(),Au=(lt(1)-vr)/Je,w_=N.duration?1e3*N.duration:1e3*Au*.8;function Ru(){var ls=(Date.now()-Ad)/w_,qa=x_(ls)*Au;ls<=1?(this._flyToFrame=k(Ru,this),this._move(this.unproject(R.add(z.subtract(R).multiplyBy(__(qa)/Ge)),ue),this.getScaleZoom(Ne/ji(qa),ue),{flyTo:!0})):this._move(f,b)._moveEnd(!0)}return this._moveStart(!0,N.noMoveStart),Ru.call(this),this},flyToBounds:function(f,b){var N=this._getBoundsCenterZoom(f,b);return this.flyTo(N.center,N.zoom,b)},setMaxBounds:function(f){return f=Se(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var b=this.options.minZoom;return this.options.minZoom=f,this._loaded&&b!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var b=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&b!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,b){this._enforcingBounds=!0;var N=this.getCenter(),R=this._limitCenter(N,this._zoom,Se(f));return N.equals(R)||this.panTo(R,b),this._enforcingBounds=!1,this},panInside:function(f,b){b=b||{};var N=K(b.paddingTopLeft||b.padding||[0,0]),R=K(b.paddingBottomRight||b.padding||[0,0]),z=this.project(this.getCenter()),Z=this.project(f),ue=this.getPixelBounds(),Ne=de([ue.min.add(N),ue.max.subtract(R)]),Le=Ne.getSize();if(!Ne.contains(Z)){this._enforcingBounds=!0;var Ge=Z.subtract(Ne.getCenter()),Je=Ne.extend(Z).getSize().subtract(Le);z.x+=Ge.x<0?-Je.x:Je.x,z.y+=Ge.y<0?-Je.y:Je.y,this.panTo(this.unproject(z),b),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=r({animate:!1,pan:!0},f===!0?{animate:!0}:f);var b=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var N=this.getSize(),R=b.divideBy(2).round(),z=N.divideBy(2).round(),Z=R.subtract(z);return!Z.x&&!Z.y?this:(f.animate&&f.pan?this.panBy(Z):(f.pan&&this._rawPanBy(Z),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:b,newSize:N}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=r({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=a(this._handleGeolocationResponse,this),N=a(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,N,f):navigator.geolocation.getCurrentPosition(b,N,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var b=f.code,N=f.message||(b===1?"permission denied":b===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:b,message:"Geolocation error: "+N+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var b=f.coords.latitude,N=f.coords.longitude,R=new Te(b,N),z=R.toBounds(f.coords.accuracy*2),Z=this._locateOptions;if(Z.setView){var ue=this.getBoundsZoom(z);this.setView(R,Z.maxZoom?Math.min(ue,Z.maxZoom):ue)}var Ne={latlng:R,bounds:z,timestamp:f.timestamp};for(var Le in f.coords)typeof f.coords[Le]=="number"&&(Ne[Le]=f.coords[Le]);this.fire("locationfound",Ne)}},addHandler:function(f,b){if(!b)return this;var N=this[f]=new b(this);return this._handlers.push(N),this.options[f]&&N.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Tn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(V(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var f;for(f in this._layers)this._layers[f].remove();for(f in this._panes)Tn(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,b){var N="leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),R=qt("div",N,b||this._mapPane);return f&&(this._panes[f]=R),R},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds(),b=this.unproject(f.getBottomLeft()),N=this.unproject(f.getTopRight());return new ce(b,N)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,b,N){f=Se(f),N=K(N||[0,0]);var R=this.getZoom()||0,z=this.getMinZoom(),Z=this.getMaxZoom(),ue=f.getNorthWest(),Ne=f.getSouthEast(),Le=this.getSize().subtract(N),Ge=de(this.project(Ne,R),this.project(ue,R)).getSize(),Je=ct.any3d?this.options.zoomSnap:1,rt=Le.x/Ge.x,lt=Le.y/Ge.y,Ct=b?Math.max(rt,lt):Math.min(rt,lt);return R=this.getScaleZoom(Ct,R),Je&&(R=Math.round(R/(Je/100))*(Je/100),R=b?Math.ceil(R/Je)*Je:Math.floor(R/Je)*Je),Math.max(z,Math.min(Z,R))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ne(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,b){var N=this._getTopLeftPoint(f,b);return new ie(N,N.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(f===void 0?this.getZoom():f)},getPane:function(f){return typeof f=="string"?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,b){var N=this.options.crs;return b=b===void 0?this._zoom:b,N.scale(f)/N.scale(b)},getScaleZoom:function(f,b){var N=this.options.crs;b=b===void 0?this._zoom:b;var R=N.zoom(f*N.scale(b));return isNaN(R)?1/0:R},project:function(f,b){return b=b===void 0?this._zoom:b,this.options.crs.latLngToPoint(Ie(f),b)},unproject:function(f,b){return b=b===void 0?this._zoom:b,this.options.crs.pointToLatLng(K(f),b)},layerPointToLatLng:function(f){var b=K(f).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(f){var b=this.project(Ie(f))._round();return b._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(Ie(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(Se(f))},distance:function(f,b){return this.options.crs.distance(Ie(f),Ie(b))},containerPointToLayerPoint:function(f){return K(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return K(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var b=this.containerPointToLayerPoint(K(f));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Ie(f)))},mouseEventToContainerPoint:function(f){return As(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var b=this._container=cc(f);if(b){if(b._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");vt(b,"scroll",this._onScroll,this),this._containerId=l(b)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&ct.any3d,kt(f,"leaflet-container"+(ct.touch?" leaflet-touch":"")+(ct.retina?" leaflet-retina":"")+(ct.ielt9?" leaflet-oldie":"")+(ct.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var b=Fa(f,"position");b!=="absolute"&&b!=="relative"&&b!=="fixed"&&b!=="sticky"&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Tt(this._mapPane,new ne(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(kt(f.markerPane,"leaflet-zoom-hide"),kt(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,b,N){Tt(this._mapPane,new ne(0,0));var R=!this._loaded;this._loaded=!0,b=this._limitZoom(b),this.fire("viewprereset");var z=this._zoom!==b;this._moveStart(z,N)._move(f,b)._moveEnd(z),this.fire("viewreset"),R&&this.fire("load")},_moveStart:function(f,b){return f&&this.fire("zoomstart"),b||this.fire("movestart"),this},_move:function(f,b,N,R){b===void 0&&(b=this._zoom);var z=this._zoom!==b;return this._zoom=b,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),R?N&&N.pinch&&this.fire("zoom",N):((z||N&&N.pinch)&&this.fire("zoom",N),this.fire("move",N)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return V(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){Tt(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[l(this._container)]=this;var b=f?hn:vt;b(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&b(window,"resize",this._onResize,this),ct.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){V(this._resizeRequest),this._resizeRequest=k(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,b){for(var N=[],R,z=b==="mouseout"||b==="mouseover",Z=f.target||f.srcElement,ue=!1;Z;){if(R=this._targets[l(Z)],R&&(b==="click"||b==="preclick")&&this._draggableMoved(R)){ue=!0;break}if(R&&R.listens(b,!0)&&(z&&!To(Z,f)||(N.push(R),z))||Z===this._container)break;Z=Z.parentNode}return!N.length&&!ue&&!z&&this.listens(b,!0)&&(N=[this]),N},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var b=f.target||f.srcElement;if(!(!this._loaded||b._leaflet_disable_events||f.type==="click"&&this._isClickDisabled(b))){var N=f.type;N==="mousedown"&&la(b),this._fireDOMEvent(f,N)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,b,N){if(f.type==="click"){var R=r({},f);R.type="preclick",this._fireDOMEvent(R,R.type,N)}var z=this._findEventTargets(f,b);if(N){for(var Z=[],ue=0;ue<N.length;ue++)N[ue].listens(b,!0)&&Z.push(N[ue]);z=Z.concat(z)}if(z.length){b==="contextmenu"&&Dn(f);var Ne=z[0],Le={originalEvent:f};if(f.type!=="keypress"&&f.type!=="keydown"&&f.type!=="keyup"){var Ge=Ne.getLatLng&&(!Ne._radius||Ne._radius<=10);Le.containerPoint=Ge?this.latLngToContainerPoint(Ne.getLatLng()):this.mouseEventToContainerPoint(f),Le.layerPoint=this.containerPointToLayerPoint(Le.containerPoint),Le.latlng=Ge?Ne.getLatLng():this.layerPointToLatLng(Le.layerPoint)}for(ue=0;ue<z.length;ue++)if(z[ue].fire(b,Le,!0),Le.originalEvent._stopped||z[ue].options.bubblingMouseEvents===!1&&D(this._mouseEvents,b)!==-1)return}},_draggableMoved:function(f){return f=f.dragging&&f.dragging.enabled()?f:this,f.dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,b=this._handlers.length;f<b;f++)this._handlers[f].disable()},whenReady:function(f,b){return this._loaded?f.call(b||this,{target:this}):this.on("load",f,b),this},_getMapPanePos:function(){return xi(this._mapPane)||new ne(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,b){var N=f&&b!==void 0?this._getNewPixelOrigin(f,b):this.getPixelOrigin();return N.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,b){var N=this.getSize()._divideBy(2);return this.project(f,b)._subtract(N)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,b,N){var R=this._getNewPixelOrigin(N,b);return this.project(f,b)._subtract(R)},_latLngBoundsToNewLayerBounds:function(f,b,N){var R=this._getNewPixelOrigin(N,b);return de([this.project(f.getSouthWest(),b)._subtract(R),this.project(f.getNorthWest(),b)._subtract(R),this.project(f.getSouthEast(),b)._subtract(R),this.project(f.getNorthEast(),b)._subtract(R)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,b,N){if(!N)return f;var R=this.project(f,b),z=this.getSize().divideBy(2),Z=new ie(R.subtract(z),R.add(z)),ue=this._getBoundsOffset(Z,N,b);return Math.abs(ue.x)<=1&&Math.abs(ue.y)<=1?f:this.unproject(R.add(ue),b)},_limitOffset:function(f,b){if(!b)return f;var N=this.getPixelBounds(),R=new ie(N.min.add(f),N.max.add(f));return f.add(this._getBoundsOffset(R,b))},_getBoundsOffset:function(f,b,N){var R=de(this.project(b.getNorthEast(),N),this.project(b.getSouthWest(),N)),z=R.min.subtract(f.min),Z=R.max.subtract(f.max),ue=this._rebound(z.x,-Z.x),Ne=this._rebound(z.y,-Z.y);return new ne(ue,Ne)},_rebound:function(f,b){return f+b>0?Math.round(f-b)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(b))},_limitZoom:function(f){var b=this.getMinZoom(),N=this.getMaxZoom(),R=ct.any3d?this.options.zoomSnap:1;return R&&(f=Math.round(f/R)*R),Math.max(b,Math.min(N,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Cn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,b){var N=this._getCenterOffset(f)._trunc();return(b&&b.animate)!==!0&&!this.getSize().contains(N)?!1:(this.panBy(N,b),!0)},_createAnimProxy:function(){var f=this._proxy=qt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(b){var N=bo,R=this._proxy.style[N];Ar(this._proxy,this.project(b.center,b.zoom),this.getZoomScale(b.zoom,1)),R===this._proxy.style[N]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Tn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),b=this.getZoom();Ar(this._proxy,this.project(f,b),this.getZoomScale(b,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,b,N){if(this._animatingZoom)return!0;if(N=N||{},!this._zoomAnimated||N.animate===!1||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var R=this.getZoomScale(b),z=this._getCenterOffset(f)._divideBy(1-1/R);return N.animate!==!0&&!this.getSize().contains(z)?!1:(k(function(){this._moveStart(!0,N.noMoveStart||!1)._animateZoom(f,b,!0)},this),!0)},_animateZoom:function(f,b,N,R){this._mapPane&&(N&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=b,kt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:b,noUpdate:R}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Cn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function za(f,b){return new Ft(f,b)}var ir=ae.extend({options:{position:"topright"},initialize:function(f){w(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var b=this._map;return b&&b.removeControl(this),this.options.position=f,b&&b.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var b=this._container=this.onAdd(f),N=this.getPosition(),R=f._controlCorners[N];return kt(b,"leaflet-control"),N.indexOf("bottom")!==-1?R.insertBefore(b,R.firstChild):R.appendChild(b),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Tn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),yr=function(f){return new ir(f)};Ft.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},b="leaflet-",N=this._controlContainer=qt("div",b+"control-container",this._container);function R(z,Z){var ue=b+z+" "+b+Z;f[z+Z]=qt("div",ue,N)}R("top","left"),R("top","right"),R("bottom","left"),R("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)Tn(this._controlCorners[f]);Tn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var vd=ir.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,b,N,R){return N<R?-1:R<N?1:0}},initialize:function(f,b,N){w(this,N),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var R in f)this._addLayer(f[R],R);for(R in b)this._addLayer(b[R],R,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var b=0;b<this._layers.length;b++)this._layers[b].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return ir.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,b){return this._addLayer(f,b),this._map?this._update():this},addOverlay:function(f,b){return this._addLayer(f,b,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var b=this._getLayer(l(f));return b&&this._layers.splice(this._layers.indexOf(b),1),this._map?this._update():this},expand:function(){kt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(kt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):Cn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Cn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",b=this._container=qt("div",f),N=this.options.collapsed;b.setAttribute("aria-haspopup",!0),wo(b),ua(b);var R=this._section=qt("section",f+"-list");N&&(this._map.on("click",this.collapse,this),vt(b,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var z=this._layersLink=qt("a",f+"-toggle",b);z.href="#",z.title="Layers",z.setAttribute("role","button"),vt(z,{keydown:function(Z){Z.keyCode===13&&this._expandSafely()},click:function(Z){Dn(Z),this._expandSafely()}},this),N||this.expand(),this._baseLayersList=qt("div",f+"-base",R),this._separator=qt("div",f+"-separator",R),this._overlaysList=qt("div",f+"-overlays",R),b.appendChild(R)},_getLayer:function(f){for(var b=0;b<this._layers.length;b++)if(this._layers[b]&&l(this._layers[b].layer)===f)return this._layers[b]},_addLayer:function(f,b,N){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:b,overlay:N}),this.options.sortLayers&&this._layers.sort(a(function(R,z){return this.options.sortFunction(R.layer,z.layer,R.name,z.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Us(this._baseLayersList),Us(this._overlaysList),this._layerControlInputs=[];var f,b,N,R,z=0;for(N=0;N<this._layers.length;N++)R=this._layers[N],this._addItem(R),b=b||R.overlay,f=f||!R.overlay,z+=R.overlay?0:1;return this.options.hideSingleBase&&(f=f&&z>1,this._baseLayersList.style.display=f?"":"none"),this._separator.style.display=b&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var b=this._getLayer(l(f.target)),N=b.overlay?f.type==="add"?"overlayadd":"overlayremove":f.type==="add"?"baselayerchange":null;N&&this._map.fire(N,b)},_createRadioElement:function(f,b){var N='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(b?' checked="checked"':"")+"/>",R=document.createElement("div");return R.innerHTML=N,R.firstChild},_addItem:function(f){var b=document.createElement("label"),N=this._map.hasLayer(f.layer),R;f.overlay?(R=document.createElement("input"),R.type="checkbox",R.className="leaflet-control-layers-selector",R.defaultChecked=N):R=this._createRadioElement("leaflet-base-layers_"+l(this),N),this._layerControlInputs.push(R),R.layerId=l(f.layer),vt(R,"click",this._onInputClick,this);var z=document.createElement("span");z.innerHTML=" "+f.name;var Z=document.createElement("span");b.appendChild(Z),Z.appendChild(R),Z.appendChild(z);var ue=f.overlay?this._overlaysList:this._baseLayersList;return ue.appendChild(b),this._checkDisabledLayers(),b},_onInputClick:function(){if(!this._preventClick){var f=this._layerControlInputs,b,N,R=[],z=[];this._handlingClick=!0;for(var Z=f.length-1;Z>=0;Z--)b=f[Z],N=this._getLayer(b.layerId).layer,b.checked?R.push(N):b.checked||z.push(N);for(Z=0;Z<z.length;Z++)this._map.hasLayer(z[Z])&&this._map.removeLayer(z[Z]);for(Z=0;Z<R.length;Z++)this._map.hasLayer(R[Z])||this._map.addLayer(R[Z]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var f=this._layerControlInputs,b,N,R=this._map.getZoom(),z=f.length-1;z>=0;z--)b=f[z],N=this._getLayer(b.layerId).layer,b.disabled=N.options.minZoom!==void 0&&R<N.options.minZoom||N.options.maxZoom!==void 0&&R>N.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,vt(f,"click",Dn),this.expand();var b=this;setTimeout(function(){hn(f,"click",Dn),b._preventClick=!1})}}),mg=function(f,b,N){return new vd(f,b,N)},So=ir.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var b="leaflet-control-zoom",N=qt("div",b+" leaflet-bar"),R=this.options;return this._zoomInButton=this._createButton(R.zoomInText,R.zoomInTitle,b+"-in",N,this._zoomIn),this._zoomOutButton=this._createButton(R.zoomOutText,R.zoomOutTitle,b+"-out",N,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),N},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,b,N,R,z){var Z=qt("a",N,R);return Z.innerHTML=f,Z.href="#",Z.title=b,Z.setAttribute("role","button"),Z.setAttribute("aria-label",b),wo(Z),vt(Z,"click",gr),vt(Z,"click",z,this),vt(Z,"click",this._refocusOnMap,this),Z},_updateDisabled:function(){var f=this._map,b="leaflet-disabled";Cn(this._zoomInButton,b),Cn(this._zoomOutButton,b),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(kt(this._zoomOutButton,b),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(kt(this._zoomInButton,b),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ft.mergeOptions({zoomControl:!0}),Ft.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new So,this.addControl(this.zoomControl))});var mu=function(f){return new So(f)},gu=ir.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var b="leaflet-control-scale",N=qt("div",b),R=this.options;return this._addScales(R,b+"-line",N),f.on(R.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),N},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,b,N){f.metric&&(this._mScale=qt("div",b,N)),f.imperial&&(this._iScale=qt("div",b,N))},_update:function(){var f=this._map,b=f.getSize().y/2,N=f.distance(f.containerPointToLatLng([0,b]),f.containerPointToLatLng([this.options.maxWidth,b]));this._updateScales(N)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var b=this._getRoundNum(f),N=b<1e3?b+" m":b/1e3+" km";this._updateScale(this._mScale,N,b/f)},_updateImperial:function(f){var b=f*3.2808399,N,R,z;b>5280?(N=b/5280,R=this._getRoundNum(N),this._updateScale(this._iScale,R+" mi",R/N)):(z=this._getRoundNum(b),this._updateScale(this._iScale,z+" ft",z/b))},_updateScale:function(f,b,N){f.style.width=Math.round(this.options.maxWidth*N)+"px",f.innerHTML=b},_getRoundNum:function(f){var b=Math.pow(10,(Math.floor(f)+"").length-1),N=f/b;return N=N>=10?10:N>=5?5:N>=3?3:N>=2?2:1,b*N}}),yu=function(f){return new gu(f)},rp='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',cl=ir.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ct.inlineSvg?rp+" ":"")+"Leaflet</a>"},initialize:function(f){w(this,f),this._attributions={}},onAdd:function(f){f.attributionControl=this,this._container=qt("div","leaflet-control-attribution"),wo(this._container);for(var b in f._layers)f._layers[b].getAttribution&&this.addAttribution(f._layers[b].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var b in this._attributions)this._attributions[b]&&f.push(b);var N=[];this.options.prefix&&N.push(this.options.prefix),f.length&&N.push(f.join(", ")),this._container.innerHTML=N.join(' <span aria-hidden="true">|</span> ')}}});Ft.mergeOptions({attributionControl:!0}),Ft.addInitHook(function(){this.options.attributionControl&&new cl().addTo(this)});var gg=function(f){return new cl(f)};ir.Layers=vd,ir.Zoom=So,ir.Scale=gu,ir.Attribution=cl,yr.layers=mg,yr.zoom=mu,yr.scale=yu,yr.attribution=gg;var ti=ae.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ti.addTo=function(f,b){return f.addHandler(b,this),this};var pc={Events:X},bd=ct.touch?"touchstart mousedown":"mousedown",ha=se.extend({options:{clickTolerance:3},initialize:function(f,b,N,R){w(this,R),this._element=f,this._dragStartTarget=b||f,this._preventOutline=N},enable:function(){this._enabled||(vt(this._dragStartTarget,bd,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ha._dragging===this&&this.finishDrag(!0),hn(this._dragStartTarget,bd,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!ol(this._element,"leaflet-zoom-anim"))){if(f.touches&&f.touches.length!==1){ha._dragging===this&&this.finishDrag();return}if(!(ha._dragging||f.shiftKey||f.which!==1&&f.button!==1&&!f.touches)&&(ha._dragging=this,this._preventOutline&&la(this._element),hc(),mr(),!this._moving)){this.fire("down");var b=f.touches?f.touches[0]:f,N=Ba(this._element);this._startPoint=new ne(b.clientX,b.clientY),this._startPos=xi(this._element),this._parentScale=ca(N);var R=f.type==="mousedown";vt(document,R?"mousemove":"touchmove",this._onMove,this),vt(document,R?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1){this._moved=!0;return}var b=f.touches&&f.touches.length===1?f.touches[0]:f,N=new ne(b.clientX,b.clientY)._subtract(this._startPoint);!N.x&&!N.y||Math.abs(N.x)+Math.abs(N.y)<this.options.clickTolerance||(N.x/=this._parentScale.x,N.y/=this._parentScale.y,Dn(f),this._moved||(this.fire("dragstart"),this._moved=!0,kt(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),kt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(N),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),Tt(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){Cn(document.body,"leaflet-dragging"),this._lastTarget&&(Cn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),hn(document,"mousemove touchmove",this._onMove,this),hn(document,"mouseup touchend touchcancel",this._onUp,this),gd(),oa();var b=this._moved&&this._moving;this._moving=!1,ha._dragging=!1,b&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function vu(f,b,N){var R,z=[1,4,2,8],Z,ue,Ne,Le,Ge,Je,rt,lt;for(Z=0,Je=f.length;Z<Je;Z++)f[Z]._code=Va(f[Z],b);for(Ne=0;Ne<4;Ne++){for(rt=z[Ne],R=[],Z=0,Je=f.length,ue=Je-1;Z<Je;ue=Z++)Le=f[Z],Ge=f[ue],Le._code&rt?Ge._code&rt||(lt=Gs(Ge,Le,rt,b,N),lt._code=Va(lt,b),R.push(lt)):(Ge._code&rt&&(lt=Gs(Ge,Le,rt,b,N),lt._code=Va(lt,b),R.push(lt)),R.push(Le));f=R}return f}function ul(f,b){var N,R,z,Z,ue,Ne,Le,Ge,Je;if(!f||f.length===0)throw new Error("latlngs not passed");S(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var rt=Ie([0,0]),lt=Se(f),Ct=lt.getNorthWest().distanceTo(lt.getSouthWest())*lt.getNorthEast().distanceTo(lt.getNorthWest());Ct<1700&&(rt=bu(f));var Zn=f.length,ms=[];for(N=0;N<Zn;N++){var vr=Ie(f[N]);ms.push(b.project(Ie([vr.lat-rt.lat,vr.lng-rt.lng])))}for(Ne=Le=Ge=0,N=0,R=Zn-1;N<Zn;R=N++)z=ms[N],Z=ms[R],ue=z.y*Z.x-Z.y*z.x,Le+=(z.x+Z.x)*ue,Ge+=(z.y+Z.y)*ue,Ne+=ue*3;Ne===0?Je=ms[0]:Je=[Le/Ne,Ge/Ne];var ji=b.unproject(K(Je));return Ie([ji.lat+rt.lat,ji.lng+rt.lng])}function bu(f){for(var b=0,N=0,R=0,z=0;z<f.length;z++){var Z=Ie(f[z]);b+=Z.lat,N+=Z.lng,R++}return Ie([b/R,N/R])}var _u={__proto__:null,clipPolygon:vu,polygonCenter:ul,centroid:bu};function _d(f,b){if(!b||!f.length)return f.slice();var N=b*b;return f=ap(f,N),f=ip(f,N),f}function xu(f,b,N){return Math.sqrt(ni(f,b,N,!0))}function Eo(f,b,N){return ni(f,b,N)}function ip(f,b){var N=f.length,R=typeof Uint8Array<"u"?Uint8Array:Array,z=new R(N);z[0]=z[N-1]=1,wu(f,z,b,0,N-1);var Z,ue=[];for(Z=0;Z<N;Z++)z[Z]&&ue.push(f[Z]);return ue}function wu(f,b,N,R,z){var Z=0,ue,Ne,Le;for(Ne=R+1;Ne<=z-1;Ne++)Le=ni(f[Ne],f[R],f[z],!0),Le>Z&&(ue=Ne,Z=Le);Z>N&&(b[ue]=1,wu(f,b,N,R,ue),wu(f,b,N,ue,z))}function ap(f,b){for(var N=[f[0]],R=1,z=0,Z=f.length;R<Z;R++)op(f[R],f[z])>b&&(N.push(f[R]),z=R);return z<Z-1&&N.push(f[Z-1]),N}var xd;function mc(f,b,N,R,z){var Z=R?xd:Va(f,N),ue=Va(b,N),Ne,Le,Ge;for(xd=ue;;){if(!(Z|ue))return[f,b];if(Z&ue)return!1;Ne=Z||ue,Le=Gs(f,b,Ne,N,z),Ge=Va(Le,N),Ne===Z?(f=Le,Z=Ge):(b=Le,ue=Ge)}}function Gs(f,b,N,R,z){var Z=b.x-f.x,ue=b.y-f.y,Ne=R.min,Le=R.max,Ge,Je;return N&8?(Ge=f.x+Z*(Le.y-f.y)/ue,Je=Le.y):N&4?(Ge=f.x+Z*(Ne.y-f.y)/ue,Je=Ne.y):N&2?(Ge=Le.x,Je=f.y+ue*(Le.x-f.x)/Z):N&1&&(Ge=Ne.x,Je=f.y+ue*(Ne.x-f.x)/Z),new ne(Ge,Je,z)}function Va(f,b){var N=0;return f.x<b.min.x?N|=1:f.x>b.max.x&&(N|=2),f.y<b.min.y?N|=4:f.y>b.max.y&&(N|=8),N}function op(f,b){var N=b.x-f.x,R=b.y-f.y;return N*N+R*R}function ni(f,b,N,R){var z=b.x,Z=b.y,ue=N.x-z,Ne=N.y-Z,Le=ue*ue+Ne*Ne,Ge;return Le>0&&(Ge=((f.x-z)*ue+(f.y-Z)*Ne)/Le,Ge>1?(z=N.x,Z=N.y):Ge>0&&(z+=ue*Ge,Z+=Ne*Ge)),ue=f.x-z,Ne=f.y-Z,R?ue*ue+Ne*Ne:new ne(z,Z)}function S(f){return!A(f[0])||typeof f[0][0]!="object"&&typeof f[0][0]<"u"}function j(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),S(f)}function H(f,b){var N,R,z,Z,ue,Ne,Le,Ge;if(!f||f.length===0)throw new Error("latlngs not passed");S(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var Je=Ie([0,0]),rt=Se(f),lt=rt.getNorthWest().distanceTo(rt.getSouthWest())*rt.getNorthEast().distanceTo(rt.getNorthWest());lt<1700&&(Je=bu(f));var Ct=f.length,Zn=[];for(N=0;N<Ct;N++){var ms=Ie(f[N]);Zn.push(b.project(Ie([ms.lat-Je.lat,ms.lng-Je.lng])))}for(N=0,R=0;N<Ct-1;N++)R+=Zn[N].distanceTo(Zn[N+1])/2;if(R===0)Ge=Zn[0];else for(N=0,Z=0;N<Ct-1;N++)if(ue=Zn[N],Ne=Zn[N+1],z=ue.distanceTo(Ne),Z+=z,Z>R){Le=(Z-R)/z,Ge=[Ne.x-Le*(Ne.x-ue.x),Ne.y-Le*(Ne.y-ue.y)];break}var vr=b.unproject(K(Ge));return Ie([vr.lat+Je.lat,vr.lng+Je.lng])}var ee={__proto__:null,simplify:_d,pointToSegmentDistance:xu,closestPointOnSegment:Eo,clipSegment:mc,_getEdgeIntersection:Gs,_getBitCode:Va,_sqClosestPointOnSegment:ni,isFlat:S,_flat:j,polylineCenter:H},Ee={project:function(f){return new ne(f.lng,f.lat)},unproject:function(f){return new Te(f.y,f.x)},bounds:new ie([-180,-90],[180,90])},Oe={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ie([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(f){var b=Math.PI/180,N=this.R,R=f.lat*b,z=this.R_MINOR/N,Z=Math.sqrt(1-z*z),ue=Z*Math.sin(R),Ne=Math.tan(Math.PI/4-R/2)/Math.pow((1-ue)/(1+ue),Z/2);return R=-N*Math.log(Math.max(Ne,1e-10)),new ne(f.lng*b*N,R)},unproject:function(f){for(var b=180/Math.PI,N=this.R,R=this.R_MINOR/N,z=Math.sqrt(1-R*R),Z=Math.exp(-f.y/N),ue=Math.PI/2-2*Math.atan(Z),Ne=0,Le=.1,Ge;Ne<15&&Math.abs(Le)>1e-7;Ne++)Ge=z*Math.sin(ue),Ge=Math.pow((1-Ge)/(1+Ge),z/2),Le=Math.PI/2-2*Math.atan(Z*Ge)-ue,ue+=Le;return new Te(ue*b,f.x*b/N)}},Xe={__proto__:null,LonLat:Ee,Mercator:Oe,SphericalMercator:ut},en=r({},qe,{code:"EPSG:3395",projection:Oe,transformation:(function(){var f=.5/(Math.PI*Oe.R);return At(f,.5,-f,.5)})()}),_s=r({},qe,{code:"EPSG:4326",projection:Ee,transformation:At(1/180,1,-1/180,.5)}),tn=r({},He,{projection:Ee,transformation:At(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,b){var N=b.lng-f.lng,R=b.lat-f.lat;return Math.sqrt(N*N+R*R)},infinite:!0});He.Earth=qe,He.EPSG3395=en,He.EPSG3857=Gt,He.EPSG900913=gn,He.EPSG4326=_s,He.Simple=tn;var Sn=se.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[l(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[l(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var b=f.target;if(b.hasLayer(this)){if(this._map=b,this._zoomAnimated=b._zoomAnimated,this.getEvents){var N=this.getEvents();b.on(N,this),this.once("remove",function(){b.off(N,this)},this)}this.onAdd(b),this.fire("add"),b.fire("layeradd",{layer:this})}}});Ft.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var b=l(f);return this._layers[b]?this:(this._layers[b]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f),this)},removeLayer:function(f){var b=l(f);return this._layers[b]?(this._loaded&&f.onRemove(this),delete this._layers[b],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return l(f)in this._layers},eachLayer:function(f,b){for(var N in this._layers)f.call(b,this._layers[N]);return this},_addLayers:function(f){f=f?A(f)?f:[f]:[];for(var b=0,N=f.length;b<N;b++)this.addLayer(f[b])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[l(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var b=l(f);this._zoomBoundLayers[b]&&(delete this._zoomBoundLayers[b],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,b=-1/0,N=this._getZoomSpan();for(var R in this._zoomBoundLayers){var z=this._zoomBoundLayers[R].options;f=z.minZoom===void 0?f:Math.min(f,z.minZoom),b=z.maxZoom===void 0?b:Math.max(b,z.maxZoom)}this._layersMaxZoom=b===-1/0?void 0:b,this._layersMinZoom=f===1/0?void 0:f,N!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Xn=Sn.extend({initialize:function(f,b){w(this,b),this._layers={};var N,R;if(f)for(N=0,R=f.length;N<R;N++)this.addLayer(f[N])},addLayer:function(f){var b=this.getLayerId(f);return this._layers[b]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var b=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[b]&&this._map.removeLayer(this._layers[b]),delete this._layers[b],this},hasLayer:function(f){var b=typeof f=="number"?f:this.getLayerId(f);return b in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var b=Array.prototype.slice.call(arguments,1),N,R;for(N in this._layers)R=this._layers[N],R[f]&&R[f].apply(R,b);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,b){for(var N in this._layers)f.call(b,this._layers[N]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return l(f)}}),No=function(f,b){return new Xn(f,b)},jn=Xn.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),Xn.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),Xn.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new ce;for(var b in this._layers){var N=this._layers[b];f.extend(N.getBounds?N.getBounds():N.getLatLng())}return f}}),Ua=function(f,b){return new jn(f,b)},Ga=ae.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){w(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,b){var N=this._getIconUrl(f);if(!N){if(f==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var R=this._createImg(N,b&&b.tagName==="IMG"?b:null);return this._setIconStyles(R,f),(this.options.crossOrigin||this.options.crossOrigin==="")&&(R.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),R},_setIconStyles:function(f,b){var N=this.options,R=N[b+"Size"];typeof R=="number"&&(R=[R,R]);var z=K(R),Z=K(b==="shadow"&&N.shadowAnchor||N.iconAnchor||z&&z.divideBy(2,!0));f.className="leaflet-marker-"+b+" "+(N.className||""),Z&&(f.style.marginLeft=-Z.x+"px",f.style.marginTop=-Z.y+"px"),z&&(f.style.width=z.x+"px",f.style.height=z.y+"px")},_createImg:function(f,b){return b=b||document.createElement("img"),b.src=f,b},_getIconUrl:function(f){return ct.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});function lp(f){return new Ga(f)}var Tu=Ga.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return typeof Tu.imagePath!="string"&&(Tu.imagePath=this._detectIconPath()),(this.options.imagePath||Tu.imagePath)+Ga.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var b=function(N,R,z){var Z=R.exec(N);return Z&&Z[z]};return f=b(f,/^url\((['"])?(.+)\1\)$/,2),f&&b(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=qt("div","leaflet-default-icon-path",document.body),b=Fa(f,"background-image")||Fa(f,"backgroundImage");if(document.body.removeChild(f),b=this._stripUrl(b),b)return b;var N=document.querySelector('link[href$="leaflet.css"]');return N?N.href.substring(0,N.href.length-11-1):""}}),yg=ti.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new ha(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),kt(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Cn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var b=this._marker,N=b._map,R=this._marker.options.autoPanSpeed,z=this._marker.options.autoPanPadding,Z=xi(b._icon),ue=N.getPixelBounds(),Ne=N.getPixelOrigin(),Le=de(ue.min._subtract(Ne).add(z),ue.max._subtract(Ne).subtract(z));if(!Le.contains(Z)){var Ge=K((Math.max(Le.max.x,Z.x)-Le.max.x)/(ue.max.x-Le.max.x)-(Math.min(Le.min.x,Z.x)-Le.min.x)/(ue.min.x-Le.min.x),(Math.max(Le.max.y,Z.y)-Le.max.y)/(ue.max.y-Le.max.y)-(Math.min(Le.min.y,Z.y)-Le.min.y)/(ue.min.y-Le.min.y)).multiplyBy(R);N.panBy(Ge,{animate:!1}),this._draggable._newPos._add(Ge),this._draggable._startPos._add(Ge),Tt(b._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=k(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&(V(this._panRequest),this._panRequest=k(this._adjustPan.bind(this,f)))},_onDrag:function(f){var b=this._marker,N=b._shadow,R=xi(b._icon),z=b._map.layerPointToLatLng(R);N&&Tt(N,R),b._latlng=z,f.latlng=z,f.oldLatLng=this._oldLatLng,b.fire("move",f).fire("drag",f)},_onDragEnd:function(f){V(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),Su=Sn.extend({options:{icon:new Tu,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,b){w(this,b),this._latlng=Ie(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var b=this._latlng;return this._latlng=Ie(f),this.update(),this.fire("move",{oldLatLng:b,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,b="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),N=f.icon.createIcon(this._icon),R=!1;N!==this._icon&&(this._icon&&this._removeIcon(),R=!0,f.title&&(N.title=f.title),N.tagName==="IMG"&&(N.alt=f.alt||"")),kt(N,b),f.keyboard&&(N.tabIndex="0",N.setAttribute("role","button")),this._icon=N,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&vt(N,"focus",this._panOnFocus,this);var z=f.icon.createShadow(this._shadow),Z=!1;z!==this._shadow&&(this._removeShadow(),Z=!0),z&&(kt(z,b),z.alt=""),this._shadow=z,f.opacity<1&&this._updateOpacity(),R&&this.getPane().appendChild(this._icon),this._initInteraction(),z&&Z&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&hn(this._icon,"focus",this._panOnFocus,this),Tn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Tn(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&Tt(this._icon,f),this._shadow&&Tt(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var b=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(b)},_initInteraction:function(){if(this.options.interactive&&(kt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),yg)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new yg(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&Kn(this._icon,f),this._shadow&&Kn(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var b=this.options.icon.options,N=b.iconSize?K(b.iconSize):K(0,0),R=b.iconAnchor?K(b.iconAnchor):K(0,0);f.panInside(this._latlng,{paddingTopLeft:R,paddingBottomRight:N.subtract(R)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function vg(f,b){return new Su(f,b)}var Io=Sn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return w(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),wd=Io.extend({options:{fill:!0,radius:10},initialize:function(f,b){w(this,b),this._latlng=Ie(f),this._radius=this.options.radius},setLatLng:function(f){var b=this._latlng;return this._latlng=Ie(f),this.redraw(),this.fire("move",{oldLatLng:b,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var b=f&&f.radius||this._radius;return Io.prototype.setStyle.call(this,f),this.setRadius(b),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,b=this._radiusY||f,N=this._clickTolerance(),R=[f+N,b+N];this._pxBounds=new ie(this._point.subtract(R),this._point.add(R))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function p_(f,b){return new wd(f,b)}var bg=wd.extend({initialize:function(f,b,N){if(typeof b=="number"&&(b=r({},N,{radius:b})),w(this,b),this._latlng=Ie(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new ce(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:Io.prototype.setStyle,_project:function(){var f=this._latlng.lng,b=this._latlng.lat,N=this._map,R=N.options.crs;if(R.distance===qe.distance){var z=Math.PI/180,Z=this._mRadius/qe.R/z,ue=N.project([b+Z,f]),Ne=N.project([b-Z,f]),Le=ue.add(Ne).divideBy(2),Ge=N.unproject(Le).lat,Je=Math.acos((Math.cos(Z*z)-Math.sin(b*z)*Math.sin(Ge*z))/(Math.cos(b*z)*Math.cos(Ge*z)))/z;(isNaN(Je)||Je===0)&&(Je=Z/Math.cos(Math.PI/180*b)),this._point=Le.subtract(N.getPixelOrigin()),this._radius=isNaN(Je)?0:Le.x-N.project([Ge,f-Je]).x,this._radiusY=Le.y-ue.y}else{var rt=R.unproject(R.project(this._latlng).subtract([this._mRadius,0]));this._point=N.latLngToLayerPoint(this._latlng),this._radius=this._point.x-N.latLngToLayerPoint(rt).x}this._updateBounds()}});function XT(f,b,N){return new bg(f,b,N)}var Co=Io.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,b){w(this,b),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var b=1/0,N=null,R=ni,z,Z,ue=0,Ne=this._parts.length;ue<Ne;ue++)for(var Le=this._parts[ue],Ge=1,Je=Le.length;Ge<Je;Ge++){z=Le[Ge-1],Z=Le[Ge];var rt=R(f,z,Z,!0);rt<b&&(b=rt,N=R(f,z,Z))}return N&&(N.distance=Math.sqrt(b)),N},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return H(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,b){return b=b||this._defaultShape(),f=Ie(f),b.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new ce,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return S(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var b=[],N=S(f),R=0,z=f.length;R<z;R++)N?(b[R]=Ie(f[R]),this._bounds.extend(b[R])):b[R]=this._convertLatLngs(f[R]);return b},_project:function(){var f=new ie;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),b=new ne(f,f);this._rawPxBounds&&(this._pxBounds=new ie([this._rawPxBounds.min.subtract(b),this._rawPxBounds.max.add(b)]))},_projectLatlngs:function(f,b,N){var R=f[0]instanceof Te,z=f.length,Z,ue;if(R){for(ue=[],Z=0;Z<z;Z++)ue[Z]=this._map.latLngToLayerPoint(f[Z]),N.extend(ue[Z]);b.push(ue)}else for(Z=0;Z<z;Z++)this._projectLatlngs(f[Z],b,N)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}var b=this._parts,N,R,z,Z,ue,Ne,Le;for(N=0,z=0,Z=this._rings.length;N<Z;N++)for(Le=this._rings[N],R=0,ue=Le.length;R<ue-1;R++)Ne=mc(Le[R],Le[R+1],f,R,!0),Ne&&(b[z]=b[z]||[],b[z].push(Ne[0]),(Ne[1]!==Le[R+1]||R===ue-2)&&(b[z].push(Ne[1]),z++))}},_simplifyPoints:function(){for(var f=this._parts,b=this.options.smoothFactor,N=0,R=f.length;N<R;N++)f[N]=_d(f[N],b)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,b){var N,R,z,Z,ue,Ne,Le=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(N=0,Z=this._parts.length;N<Z;N++)for(Ne=this._parts[N],R=0,ue=Ne.length,z=ue-1;R<ue;z=R++)if(!(!b&&R===0)&&xu(f,Ne[z],Ne[R])<=Le)return!0;return!1}});function ZT(f,b){return new Co(f,b)}Co._flat=j;var Eu=Co.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ul(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var b=Co.prototype._convertLatLngs.call(this,f),N=b.length;return N>=2&&b[0]instanceof Te&&b[0].equals(b[N-1])&&b.pop(),b},_setLatLngs:function(f){Co.prototype._setLatLngs.call(this,f),S(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return S(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,b=this.options.weight,N=new ne(b,b);if(f=new ie(f.min.subtract(N),f.max.add(N)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}for(var R=0,z=this._rings.length,Z;R<z;R++)Z=vu(this._rings[R],f,!0),Z.length&&this._parts.push(Z)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var b=!1,N,R,z,Z,ue,Ne,Le,Ge;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(Z=0,Le=this._parts.length;Z<Le;Z++)for(N=this._parts[Z],ue=0,Ge=N.length,Ne=Ge-1;ue<Ge;Ne=ue++)R=N[ue],z=N[Ne],R.y>f.y!=z.y>f.y&&f.x<(z.x-R.x)*(f.y-R.y)/(z.y-R.y)+R.x&&(b=!b);return b||Co.prototype._containsPoint.call(this,f,!0)}});function Ti(f,b){return new Eu(f,b)}var Si=jn.extend({initialize:function(f,b){w(this,b),this._layers={},f&&this.addData(f)},addData:function(f){var b=A(f)?f:f.features,N,R,z;if(b){for(N=0,R=b.length;N<R;N++)z=b[N],(z.geometries||z.geometry||z.features||z.coordinates)&&this.addData(z);return this}var Z=this.options;if(Z.filter&&!Z.filter(f))return this;var ue=Td(f,Z);return ue?(ue.feature=Nu(f),ue.defaultOptions=ue.options,this.resetStyle(ue),Z.onEachFeature&&Z.onEachFeature(f,ue),this.addLayer(ue)):this},resetStyle:function(f){return f===void 0?this.eachLayer(this.resetStyle,this):(f.options=r({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(b){this._setLayerStyle(b,f)},this)},_setLayerStyle:function(f,b){f.setStyle&&(typeof b=="function"&&(b=b(f.feature)),f.setStyle(b))}});function Td(f,b){var N=f.type==="Feature"?f.geometry:f,R=N?N.coordinates:null,z=[],Z=b&&b.pointToLayer,ue=b&&b.coordsToLatLng||cp,Ne,Le,Ge,Je;if(!R&&!N)return null;switch(N.type){case"Point":return Ne=ue(R),_g(Z,f,Ne,b);case"MultiPoint":for(Ge=0,Je=R.length;Ge<Je;Ge++)Ne=ue(R[Ge]),z.push(_g(Z,f,Ne,b));return new jn(z);case"LineString":case"MultiLineString":return Le=Sd(R,N.type==="LineString"?0:1,ue),new Co(Le,b);case"Polygon":case"MultiPolygon":return Le=Sd(R,N.type==="Polygon"?1:2,ue),new Eu(Le,b);case"GeometryCollection":for(Ge=0,Je=N.geometries.length;Ge<Je;Ge++){var rt=Td({geometry:N.geometries[Ge],type:"Feature",properties:f.properties},b);rt&&z.push(rt)}return new jn(z);case"FeatureCollection":for(Ge=0,Je=N.features.length;Ge<Je;Ge++){var lt=Td(N.features[Ge],b);lt&&z.push(lt)}return new jn(z);default:throw new Error("Invalid GeoJSON object.")}}function _g(f,b,N,R){return f?f(b,N):new Su(N,R&&R.markersInheritOptions&&R)}function cp(f){return new Te(f[1],f[0],f[2])}function Sd(f,b,N){for(var R=[],z=0,Z=f.length,ue;z<Z;z++)ue=b?Sd(f[z],b-1,N):(N||cp)(f[z]),R.push(ue);return R}function Ed(f,b){return f=Ie(f),f.alt!==void 0?[m(f.lng,b),m(f.lat,b),m(f.alt,b)]:[m(f.lng,b),m(f.lat,b)]}function up(f,b,N,R){for(var z=[],Z=0,ue=f.length;Z<ue;Z++)z.push(b?up(f[Z],S(f[Z])?0:b-1,N,R):Ed(f[Z],R));return!b&&N&&z.length>0&&z.push(z[0].slice()),z}function da(f,b){return f.feature?r({},f.feature,{geometry:b}):Nu(b)}function Nu(f){return f.type==="Feature"||f.type==="FeatureCollection"?f:{type:"Feature",properties:{},geometry:f}}var gc={toGeoJSON:function(f){return da(this,{type:"Point",coordinates:Ed(this.getLatLng(),f)})}};Su.include(gc),bg.include(gc),wd.include(gc),Co.include({toGeoJSON:function(f){var b=!S(this._latlngs),N=up(this._latlngs,b?1:0,!1,f);return da(this,{type:(b?"Multi":"")+"LineString",coordinates:N})}}),Eu.include({toGeoJSON:function(f){var b=!S(this._latlngs),N=b&&!S(this._latlngs[0]),R=up(this._latlngs,N?2:b?1:0,!0,f);return b||(R=[R]),da(this,{type:(N?"Multi":"")+"Polygon",coordinates:R})}}),Xn.include({toMultiPoint:function(f){var b=[];return this.eachLayer(function(N){b.push(N.toGeoJSON(f).geometry.coordinates)}),da(this,{type:"MultiPoint",coordinates:b})},toGeoJSON:function(f){var b=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(b==="MultiPoint")return this.toMultiPoint(f);var N=b==="GeometryCollection",R=[];return this.eachLayer(function(z){if(z.toGeoJSON){var Z=z.toGeoJSON(f);if(N)R.push(Z.geometry);else{var ue=Nu(Z);ue.type==="FeatureCollection"?R.push.apply(R,ue.features):R.push(ue)}}}),N?da(this,{geometries:R,type:"GeometryCollection"}):{type:"FeatureCollection",features:R}}});function hp(f,b){return new Si(f,b)}var m_=hp,Wa=Sn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,b,N){this._url=f,this._bounds=Se(b),w(this,N)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(kt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Tn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&ja(this._image),this},bringToBack:function(){return this._map&&al(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=Se(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f=this._url.tagName==="IMG",b=this._image=f?this._url:qt("img");if(kt(b,"leaflet-image-layer"),this._zoomAnimated&&kt(b,"leaflet-zoom-animated"),this.options.className&&kt(b,this.options.className),b.onselectstart=p,b.onmousemove=p,b.onload=a(this.fire,this,"load"),b.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f){this._url=b.src;return}b.src=this._url,b.alt=this.options.alt},_animateZoom:function(f){var b=this._map.getZoomScale(f.zoom),N=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;Ar(this._image,N,b)},_reset:function(){var f=this._image,b=new ie(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),N=b.getSize();Tt(f,b.min),f.style.width=N.x+"px",f.style.height=N.y+"px"},_updateOpacity:function(){Kn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),Iu=function(f,b,N){return new Wa(f,b,N)},dp=Wa.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f=this._url.tagName==="VIDEO",b=this._image=f?this._url:qt("video");if(kt(b,"leaflet-image-layer"),this._zoomAnimated&&kt(b,"leaflet-zoom-animated"),this.options.className&&kt(b,this.options.className),b.onselectstart=p,b.onmousemove=p,b.onloadeddata=a(this.fire,this,"load"),f){for(var N=b.getElementsByTagName("source"),R=[],z=0;z<N.length;z++)R.push(N[z].src);this._url=N.length>0?R:[b.src];return}A(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(b.style,"objectFit")&&(b.style.objectFit="fill"),b.autoplay=!!this.options.autoplay,b.loop=!!this.options.loop,b.muted=!!this.options.muted,b.playsInline=!!this.options.playsInline;for(var Z=0;Z<this._url.length;Z++){var ue=qt("source");ue.src=this._url[Z],b.appendChild(ue)}}});function g_(f,b,N){return new dp(f,b,N)}var hl=Wa.extend({_initImage:function(){var f=this._image=this._url;kt(f,"leaflet-image-layer"),this._zoomAnimated&&kt(f,"leaflet-zoom-animated"),this.options.className&&kt(f,this.options.className),f.onselectstart=p,f.onmousemove=p}});function y_(f,b,N){return new hl(f,b,N)}var fa=Sn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,b){f&&(f instanceof Te||A(f))?(this._latlng=Ie(f),w(this,b)):(w(this,f),this._source=b),this.options.content&&(this._content=this.options.content)},openOn:function(f){return f=arguments.length?f:this._source._map,f.hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&Kn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&Kn(this._container,1),this.bringToFront(),this.options.interactive&&(kt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(Kn(this._container,0),this._removeTimeout=setTimeout(a(Tn,void 0,this._container),200)):Tn(this._container),this.options.interactive&&(Cn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=Ie(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ja(this._container),this},bringToBack:function(){return this._map&&al(this._container),this},_prepareOpen:function(f){var b=this._source;if(!b._map)return!1;if(b instanceof jn){b=null;var N=this._source._layers;for(var R in N)if(N[R]._map){b=N[R];break}if(!b)return!1;this._source=b}if(!f)if(b.getCenter)f=b.getCenter();else if(b.getLatLng)f=b.getLatLng();else if(b.getBounds)f=b.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,b=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof b=="string")f.innerHTML=b;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(b)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),b=K(this.options.offset),N=this._getAnchor();this._zoomAnimated?Tt(this._container,f.add(N)):b=b.add(f).add(N);var R=this._containerBottom=-b.y,z=this._containerLeft=-Math.round(this._containerWidth/2)+b.x;this._container.style.bottom=R+"px",this._container.style.left=z+"px"}},_getAnchor:function(){return[0,0]}});Ft.include({_initOverlay:function(f,b,N,R){var z=b;return z instanceof f||(z=new f(R).setContent(b)),N&&z.setLatLng(N),z}}),Sn.include({_initOverlay:function(f,b,N,R){var z=N;return z instanceof f?(w(z,R),z._source=this):(z=b&&!R?b:new f(R,this),z.setContent(N)),z}});var Nd=fa.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return f=arguments.length?f:this._source._map,!f.hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,fa.prototype.openOn.call(this,f)},onAdd:function(f){fa.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Io||this._source.on("preclick",ei))},onRemove:function(f){fa.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Io||this._source.off("preclick",ei))},getEvents:function(){var f=fa.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",b=this._container=qt("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),N=this._wrapper=qt("div",f+"-content-wrapper",b);if(this._contentNode=qt("div",f+"-content",N),wo(b),ua(this._contentNode),vt(b,"contextmenu",ei),this._tipContainer=qt("div",f+"-tip-container",b),this._tip=qt("div",f+"-tip",this._tipContainer),this.options.closeButton){var R=this._closeButton=qt("a",f+"-close-button",b);R.setAttribute("role","button"),R.setAttribute("aria-label","Close popup"),R.href="#close",R.innerHTML='<span aria-hidden="true">&#215;</span>',vt(R,"click",function(z){Dn(z),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,b=f.style;b.width="",b.whiteSpace="nowrap";var N=f.offsetWidth;N=Math.min(N,this.options.maxWidth),N=Math.max(N,this.options.minWidth),b.width=N+1+"px",b.whiteSpace="",b.height="";var R=f.offsetHeight,z=this.options.maxHeight,Z="leaflet-popup-scrolled";z&&R>z?(b.height=z+"px",kt(f,Z)):Cn(f,Z),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var b=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),N=this._getAnchor();Tt(this._container,b.add(N))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var f=this._map,b=parseInt(Fa(this._container,"marginBottom"),10)||0,N=this._container.offsetHeight+b,R=this._containerWidth,z=new ne(this._containerLeft,-N-this._containerBottom);z._add(xi(this._container));var Z=f.layerPointToContainerPoint(z),ue=K(this.options.autoPanPadding),Ne=K(this.options.autoPanPaddingTopLeft||ue),Le=K(this.options.autoPanPaddingBottomRight||ue),Ge=f.getSize(),Je=0,rt=0;Z.x+R+Le.x>Ge.x&&(Je=Z.x+R-Ge.x+Le.x),Z.x-Je-Ne.x<0&&(Je=Z.x-Ne.x),Z.y+N+Le.y>Ge.y&&(rt=Z.y+N-Ge.y+Le.y),Z.y-rt-Ne.y<0&&(rt=Z.y-Ne.y),(Je||rt)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([Je,rt]))}},_getAnchor:function(){return K(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),YT=function(f,b){return new Nd(f,b)};Ft.mergeOptions({closePopupOnClick:!0}),Ft.include({openPopup:function(f,b,N){return this._initOverlay(Nd,f,b,N).openOn(this),this},closePopup:function(f){return f=arguments.length?f:this._popup,f&&f.close(),this}}),Sn.include({bindPopup:function(f,b){return this._popup=this._initOverlay(Nd,this._popup,f,b),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof jn||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(!(!this._popup||!this._map)){gr(f);var b=f.layer||f.target;if(this._popup._source===b&&!(b instanceof Io)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng);return}this._popup._source=b,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){f.originalEvent.keyCode===13&&this._openPopup(f)}});var fp=fa.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){fa.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){fa.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=fa.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){var f="leaflet-tooltip",b=f+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=qt("div",b),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var b,N,R=this._map,z=this._container,Z=R.latLngToContainerPoint(R.getCenter()),ue=R.layerPointToContainerPoint(f),Ne=this.options.direction,Le=z.offsetWidth,Ge=z.offsetHeight,Je=K(this.options.offset),rt=this._getAnchor();Ne==="top"?(b=Le/2,N=Ge):Ne==="bottom"?(b=Le/2,N=0):Ne==="center"?(b=Le/2,N=Ge/2):Ne==="right"?(b=0,N=Ge/2):Ne==="left"?(b=Le,N=Ge/2):ue.x<Z.x?(Ne="right",b=0,N=Ge/2):(Ne="left",b=Le+(Je.x+rt.x)*2,N=Ge/2),f=f.subtract(K(b,N,!0)).add(Je).add(rt),Cn(z,"leaflet-tooltip-right"),Cn(z,"leaflet-tooltip-left"),Cn(z,"leaflet-tooltip-top"),Cn(z,"leaflet-tooltip-bottom"),kt(z,"leaflet-tooltip-"+Ne),Tt(z,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&Kn(this._container,f)},_animateZoom:function(f){var b=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(b)},_getAnchor:function(){return K(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),QT=function(f,b){return new fp(f,b)};Ft.include({openTooltip:function(f,b,N){return this._initOverlay(fp,f,b,N).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),Sn.include({bindTooltip:function(f,b){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(fp,this._tooltip,f,b),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(!(!f&&this._tooltipHandlersAdded)){var b=f?"off":"on",N={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?N.add=this._openTooltip:(N.mouseover=this._openTooltip,N.mouseout=this.closeTooltip,N.click=this._openTooltip,this._map?this._addFocusListeners():N.add=this._addFocusListeners),this._tooltip.options.sticky&&(N.mousemove=this._moveTooltip),this[b](N),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof jn||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var b=typeof f.getElement=="function"&&f.getElement();b&&(vt(b,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),vt(b,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var b=typeof f.getElement=="function"&&f.getElement();b&&b.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var b=this;this._map.once("moveend",function(){b._openOnceFlag=!1,b._openTooltip(f)});return}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var b=f.latlng,N,R;this._tooltip.options.sticky&&f.originalEvent&&(N=this._map.mouseEventToContainerPoint(f.originalEvent),R=this._map.containerPointToLayerPoint(N),b=this._map.layerPointToLatLng(R)),this._tooltip.setLatLng(b)}});var xg=Ga.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var b=f&&f.tagName==="DIV"?f:document.createElement("div"),N=this.options;if(N.html instanceof Element?(Us(b),b.appendChild(N.html)):b.innerHTML=N.html!==!1?N.html:"",N.bgPos){var R=K(N.bgPos);b.style.backgroundPosition=-R.x+"px "+-R.y+"px"}return this._setIconStyles(b,"icon"),b},createShadow:function(){return null}});function v_(f){return new xg(f)}Ga.Default=Tu;var yc=Sn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ct.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){w(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),Tn(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ja(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(al(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof ne?f:new ne(f,f)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var b=this.getPane().children,N=-f(-1/0,1/0),R=0,z=b.length,Z;R<z;R++)Z=b[R].style.zIndex,b[R]!==this._container&&Z&&(N=f(N,+Z));isFinite(N)&&(this.options.zIndex=N+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ct.ielt9){Kn(this._container,this.options.opacity);var f=+new Date,b=!1,N=!1;for(var R in this._tiles){var z=this._tiles[R];if(!(!z.current||!z.loaded)){var Z=Math.min(1,(f-z.loaded)/200);Kn(z.el,Z),Z<1?b=!0:(z.active?N=!0:this._onOpaqueTile(z),z.active=!0)}}N&&!this._noPrune&&this._pruneTiles(),b&&(V(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this))}},_onOpaqueTile:p,_initContainer:function(){this._container||(this._container=qt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,b=this.options.maxZoom;if(f!==void 0){for(var N in this._levels)N=Number(N),this._levels[N].el.children.length||N===f?(this._levels[N].el.style.zIndex=b-Math.abs(f-N),this._onUpdateLevel(N)):(Tn(this._levels[N].el),this._removeTilesAtZoom(N),this._onRemoveLevel(N),delete this._levels[N]);var R=this._levels[f],z=this._map;return R||(R=this._levels[f]={},R.el=qt("div","leaflet-tile-container leaflet-zoom-animated",this._container),R.el.style.zIndex=b,R.origin=z.project(z.unproject(z.getPixelOrigin()),f).round(),R.zoom=f,this._setZoomTransform(R,z.getCenter(),z.getZoom()),p(R.el.offsetWidth),this._onCreateLevel(R)),this._level=R,R}},_onUpdateLevel:p,_onRemoveLevel:p,_onCreateLevel:p,_pruneTiles:function(){if(this._map){var f,b,N=this._map.getZoom();if(N>this.options.maxZoom||N<this.options.minZoom){this._removeAllTiles();return}for(f in this._tiles)b=this._tiles[f],b.retain=b.current;for(f in this._tiles)if(b=this._tiles[f],b.current&&!b.active){var R=b.coords;this._retainParent(R.x,R.y,R.z,R.z-5)||this._retainChildren(R.x,R.y,R.z,R.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var b in this._tiles)this._tiles[b].coords.z===f&&this._removeTile(b)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)Tn(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,b,N,R){var z=Math.floor(f/2),Z=Math.floor(b/2),ue=N-1,Ne=new ne(+z,+Z);Ne.z=+ue;var Le=this._tileCoordsToKey(Ne),Ge=this._tiles[Le];return Ge&&Ge.active?(Ge.retain=!0,!0):(Ge&&Ge.loaded&&(Ge.retain=!0),ue>R?this._retainParent(z,Z,ue,R):!1)},_retainChildren:function(f,b,N,R){for(var z=2*f;z<2*f+2;z++)for(var Z=2*b;Z<2*b+2;Z++){var ue=new ne(z,Z);ue.z=N+1;var Ne=this._tileCoordsToKey(ue),Le=this._tiles[Ne];if(Le&&Le.active){Le.retain=!0;continue}else Le&&Le.loaded&&(Le.retain=!0);N+1<R&&this._retainChildren(z,Z,N+1,R)}},_resetView:function(f){var b=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),b,b)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var b=this.options;return b.minNativeZoom!==void 0&&f<b.minNativeZoom?b.minNativeZoom:b.maxNativeZoom!==void 0&&b.maxNativeZoom<f?b.maxNativeZoom:f},_setView:function(f,b,N,R){var z=Math.round(b);this.options.maxZoom!==void 0&&z>this.options.maxZoom||this.options.minZoom!==void 0&&z<this.options.minZoom?z=void 0:z=this._clampZoom(z);var Z=this.options.updateWhenZooming&&z!==this._tileZoom;(!R||Z)&&(this._tileZoom=z,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),z!==void 0&&this._update(f),N||this._pruneTiles(),this._noPrune=!!N),this._setZoomTransforms(f,b)},_setZoomTransforms:function(f,b){for(var N in this._levels)this._setZoomTransform(this._levels[N],f,b)},_setZoomTransform:function(f,b,N){var R=this._map.getZoomScale(N,f.zoom),z=f.origin.multiplyBy(R).subtract(this._map._getNewPixelOrigin(b,N)).round();ct.any3d?Ar(f.el,z,R):Tt(f.el,z)},_resetGrid:function(){var f=this._map,b=f.options.crs,N=this._tileSize=this.getTileSize(),R=this._tileZoom,z=this._map.getPixelWorldBounds(this._tileZoom);z&&(this._globalTileRange=this._pxBoundsToTileRange(z)),this._wrapX=b.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,b.wrapLng[0]],R).x/N.x),Math.ceil(f.project([0,b.wrapLng[1]],R).x/N.y)],this._wrapY=b.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([b.wrapLat[0],0],R).y/N.x),Math.ceil(f.project([b.wrapLat[1],0],R).y/N.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var b=this._map,N=b._animatingZoom?Math.max(b._animateToZoom,b.getZoom()):b.getZoom(),R=b.getZoomScale(N,this._tileZoom),z=b.project(f,this._tileZoom).floor(),Z=b.getSize().divideBy(R*2);return new ie(z.subtract(Z),z.add(Z))},_update:function(f){var b=this._map;if(b){var N=this._clampZoom(b.getZoom());if(f===void 0&&(f=b.getCenter()),this._tileZoom!==void 0){var R=this._getTiledPixelBounds(f),z=this._pxBoundsToTileRange(R),Z=z.getCenter(),ue=[],Ne=this.options.keepBuffer,Le=new ie(z.getBottomLeft().subtract([Ne,-Ne]),z.getTopRight().add([Ne,-Ne]));if(!(isFinite(z.min.x)&&isFinite(z.min.y)&&isFinite(z.max.x)&&isFinite(z.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ge in this._tiles){var Je=this._tiles[Ge].coords;(Je.z!==this._tileZoom||!Le.contains(new ne(Je.x,Je.y)))&&(this._tiles[Ge].current=!1)}if(Math.abs(N-this._tileZoom)>1){this._setView(f,N);return}for(var rt=z.min.y;rt<=z.max.y;rt++)for(var lt=z.min.x;lt<=z.max.x;lt++){var Ct=new ne(lt,rt);if(Ct.z=this._tileZoom,!!this._isValidTile(Ct)){var Zn=this._tiles[this._tileCoordsToKey(Ct)];Zn?Zn.current=!0:ue.push(Ct)}}if(ue.sort(function(vr,ji){return vr.distanceTo(Z)-ji.distanceTo(Z)}),ue.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ms=document.createDocumentFragment();for(lt=0;lt<ue.length;lt++)this._addTile(ue[lt],ms);this._level.el.appendChild(ms)}}}},_isValidTile:function(f){var b=this._map.options.crs;if(!b.infinite){var N=this._globalTileRange;if(!b.wrapLng&&(f.x<N.min.x||f.x>N.max.x)||!b.wrapLat&&(f.y<N.min.y||f.y>N.max.y))return!1}if(!this.options.bounds)return!0;var R=this._tileCoordsToBounds(f);return Se(this.options.bounds).overlaps(R)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var b=this._map,N=this.getTileSize(),R=f.scaleBy(N),z=R.add(N),Z=b.unproject(R,f.z),ue=b.unproject(z,f.z);return[Z,ue]},_tileCoordsToBounds:function(f){var b=this._tileCoordsToNwSe(f),N=new ce(b[0],b[1]);return this.options.noWrap||(N=this._map.wrapLatLngBounds(N)),N},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var b=f.split(":"),N=new ne(+b[0],+b[1]);return N.z=+b[2],N},_removeTile:function(f){var b=this._tiles[f];b&&(Tn(b.el),delete this._tiles[f],this.fire("tileunload",{tile:b.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){kt(f,"leaflet-tile");var b=this.getTileSize();f.style.width=b.x+"px",f.style.height=b.y+"px",f.onselectstart=p,f.onmousemove=p,ct.ielt9&&this.options.opacity<1&&Kn(f,this.options.opacity)},_addTile:function(f,b){var N=this._getTilePos(f),R=this._tileCoordsToKey(f),z=this.createTile(this._wrapCoords(f),a(this._tileReady,this,f));this._initTile(z),this.createTile.length<2&&k(a(this._tileReady,this,f,null,z)),Tt(z,N),this._tiles[R]={el:z,coords:f,current:!0},b.appendChild(z),this.fire("tileloadstart",{tile:z,coords:f})},_tileReady:function(f,b,N){b&&this.fire("tileerror",{error:b,tile:N,coords:f});var R=this._tileCoordsToKey(f);N=this._tiles[R],N&&(N.loaded=+new Date,this._map._fadeAnimated?(Kn(N.el,0),V(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this)):(N.active=!0,this._pruneTiles()),b||(kt(N.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:N.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ct.ielt9||!this._map._fadeAnimated?k(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var b=new ne(this._wrapX?h(f.x,this._wrapX):f.x,this._wrapY?h(f.y,this._wrapY):f.y);return b.z=f.z,b},_pxBoundsToTileRange:function(f){var b=this.getTileSize();return new ie(f.min.unscaleBy(b).floor(),f.max.unscaleBy(b).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});function pa(f){return new yc(f)}var vc=yc.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,b){this._url=f,b=w(this,b),b.detectRetina&&ct.retina&&b.maxZoom>0?(b.tileSize=Math.floor(b.tileSize/2),b.zoomReverse?(b.zoomOffset--,b.minZoom=Math.min(b.maxZoom,b.minZoom+1)):(b.zoomOffset++,b.maxZoom=Math.max(b.minZoom,b.maxZoom-1)),b.minZoom=Math.max(0,b.minZoom)):b.zoomReverse?b.minZoom=Math.min(b.maxZoom,b.minZoom):b.maxZoom=Math.max(b.minZoom,b.maxZoom),typeof b.subdomains=="string"&&(b.subdomains=b.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,b){return this._url===f&&b===void 0&&(b=!0),this._url=f,b||this.redraw(),this},createTile:function(f,b){var N=document.createElement("img");return vt(N,"load",a(this._tileOnLoad,this,b,N)),vt(N,"error",a(this._tileOnError,this,b,N)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(N.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(N.referrerPolicy=this.options.referrerPolicy),N.alt="",N.src=this.getTileUrl(f),N},getTileUrl:function(f){var b={r:ct.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var N=this._globalTileRange.max.y-f.y;this.options.tms&&(b.y=N),b["-y"]=N}return C(this._url,r(b,this.options))},_tileOnLoad:function(f,b){ct.ielt9?setTimeout(a(f,this,null,b),0):f(null,b)},_tileOnError:function(f,b,N){var R=this.options.errorTileUrl;R&&b.getAttribute("src")!==R&&(b.src=R),f(N,b)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom,b=this.options.maxZoom,N=this.options.zoomReverse,R=this.options.zoomOffset;return N&&(f=b-f),f+R},_getSubdomain:function(f){var b=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[b]},_abortLoading:function(){var f,b;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&(b=this._tiles[f].el,b.onload=p,b.onerror=p,!b.complete)){b.src=F;var N=this._tiles[f].coords;Tn(b),delete this._tiles[f],this.fire("tileabort",{tile:b,coords:N})}},_removeTile:function(f){var b=this._tiles[f];if(b)return b.el.setAttribute("src",F),yc.prototype._removeTile.call(this,f)},_tileReady:function(f,b,N){if(!(!this._map||N&&N.getAttribute("src")===F))return yc.prototype._tileReady.call(this,f,b,N)}});function Ei(f,b){return new vc(f,b)}var Ni=vc.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,b){this._url=f;var N=r({},this.defaultWmsParams);for(var R in b)R in this.options||(N[R]=b[R]);b=w(this,b);var z=b.detectRetina&&ct.retina?2:1,Z=this.getTileSize();N.width=Z.x*z,N.height=Z.y*z,this.wmsParams=N},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,vc.prototype.onAdd.call(this,f)},getTileUrl:function(f){var b=this._tileCoordsToNwSe(f),N=this._crs,R=de(N.project(b[0]),N.project(b[1])),z=R.min,Z=R.max,ue=(this._wmsVersion>=1.3&&this._crs===_s?[z.y,z.x,Z.y,Z.x]:[z.x,z.y,Z.x,Z.y]).join(","),Ne=vc.prototype.getTileUrl.call(this,f);return Ne+T(this.wmsParams,Ne,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ue},setParams:function(f,b){return r(this.wmsParams,f),b||this.redraw(),this}});function Cu(f,b){return new Ni(f,b)}vc.WMS=Ni,Ei.wms=Cu;var ma=Sn.extend({options:{padding:.1},initialize:function(f){w(this,f),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),kt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,b){var N=this._map.getZoomScale(b,this._zoom),R=this._map.getSize().multiplyBy(.5+this.options.padding),z=this._map.project(this._center,b),Z=R.multiplyBy(-N).add(z).subtract(this._map._getNewPixelOrigin(f,b));ct.any3d?Ar(this._container,Z,N):Tt(this._container,Z)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var f in this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,b=this._map.getSize(),N=this._map.containerPointToLayerPoint(b.multiplyBy(-f)).round();this._bounds=new ie(N,N.add(b.multiplyBy(1+f*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Id=ma.extend({options:{tolerance:0},getEvents:function(){var f=ma.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ma.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");vt(f,"mousemove",this._onMouseMove,this),vt(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),vt(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){V(this._redrawRequest),delete this._ctx,Tn(this._container),hn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var f;this._redrawBounds=null;for(var b in this._layers)f=this._layers[b],f._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ma.prototype._update.call(this);var f=this._bounds,b=this._container,N=f.getSize(),R=ct.retina?2:1;Tt(b,f.min),b.width=R*N.x,b.height=R*N.y,b.style.width=N.x+"px",b.style.height=N.y+"px",ct.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){ma.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[l(f)]=f;var b=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=b),this._drawLast=b,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var b=f._order,N=b.next,R=b.prev;N?N.prev=R:this._drawLast=R,R?R.next=N:this._drawFirst=N,delete f._order,delete this._layers[l(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if(typeof f.options.dashArray=="string"){var b=f.options.dashArray.split(/[, ]+/),N=[],R,z;for(z=0;z<b.length;z++){if(R=Number(b[z]),isNaN(R))return;N.push(R)}f.options._dashArray=N}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||k(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var b=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ie,this._redrawBounds.extend(f._pxBounds.min.subtract([b,b])),this._redrawBounds.extend(f._pxBounds.max.add([b,b]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var b=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,b.x,b.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,b=this._redrawBounds;if(this._ctx.save(),b){var N=b.getSize();this._ctx.beginPath(),this._ctx.rect(b.min.x,b.min.y,N.x,N.y),this._ctx.clip()}this._drawing=!0;for(var R=this._drawFirst;R;R=R.next)f=R.layer,(!b||f._pxBounds&&f._pxBounds.intersects(b))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,b){if(this._drawing){var N,R,z,Z,ue=f._parts,Ne=ue.length,Le=this._ctx;if(Ne){for(Le.beginPath(),N=0;N<Ne;N++){for(R=0,z=ue[N].length;R<z;R++)Z=ue[N][R],Le[R?"lineTo":"moveTo"](Z.x,Z.y);b&&Le.closePath()}this._fillStroke(Le,f)}}},_updateCircle:function(f){if(!(!this._drawing||f._empty())){var b=f._point,N=this._ctx,R=Math.max(Math.round(f._radius),1),z=(Math.max(Math.round(f._radiusY),1)||R)/R;z!==1&&(N.save(),N.scale(1,z)),N.beginPath(),N.arc(b.x,b.y/z,R,0,Math.PI*2,!1),z!==1&&N.restore(),this._fillStroke(N,f)}},_fillStroke:function(f,b){var N=b.options;N.fill&&(f.globalAlpha=N.fillOpacity,f.fillStyle=N.fillColor||N.color,f.fill(N.fillRule||"evenodd")),N.stroke&&N.weight!==0&&(f.setLineDash&&f.setLineDash(b.options&&b.options._dashArray||[]),f.globalAlpha=N.opacity,f.lineWidth=N.weight,f.strokeStyle=N.color,f.lineCap=N.lineCap,f.lineJoin=N.lineJoin,f.stroke())},_onClick:function(f){for(var b=this._map.mouseEventToLayerPoint(f),N,R,z=this._drawFirst;z;z=z.next)N=z.layer,N.options.interactive&&N._containsPoint(b)&&(!(f.type==="click"||f.type==="preclick")||!this._map._draggableMoved(N))&&(R=N);this._fireEvent(R?[R]:!1,f)},_onMouseMove:function(f){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var b=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,b)}},_handleMouseOut:function(f){var b=this._hoveredLayer;b&&(Cn(this._container,"leaflet-interactive"),this._fireEvent([b],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,b){if(!this._mouseHoverThrottled){for(var N,R,z=this._drawFirst;z;z=z.next)N=z.layer,N.options.interactive&&N._containsPoint(b)&&(R=N);R!==this._hoveredLayer&&(this._handleMouseOut(f),R&&(kt(this._container,"leaflet-interactive"),this._fireEvent([R],f,"mouseover"),this._hoveredLayer=R)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,f),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,b,N){this._map._fireDOMEvent(b,N||b.type,f)},_bringToFront:function(f){var b=f._order;if(b){var N=b.next,R=b.prev;if(N)N.prev=R;else return;R?R.next=N:N&&(this._drawFirst=N),b.prev=this._drawLast,this._drawLast.next=b,b.next=null,this._drawLast=b,this._requestRedraw(f)}},_bringToBack:function(f){var b=f._order;if(b){var N=b.next,R=b.prev;if(R)R.next=N;else return;N?N.prev=R:R&&(this._drawLast=R),b.prev=null,b.next=this._drawFirst,this._drawFirst.prev=b,this._drawFirst=b,this._requestRedraw(f)}}});function Cd(f){return ct.canvas?new Id(f):null}var bc=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),ku={_initContainer:function(){this._container=qt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ma.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var b=f._container=bc("shape");kt(b,"leaflet-vml-shape "+(this.options.className||"")),b.coordsize="1 1",f._path=bc("path"),b.appendChild(f._path),this._updateStyle(f),this._layers[l(f)]=f},_addPath:function(f){var b=f._container;this._container.appendChild(b),f.options.interactive&&f.addInteractiveTarget(b)},_removePath:function(f){var b=f._container;Tn(b),f.removeInteractiveTarget(b),delete this._layers[l(f)]},_updateStyle:function(f){var b=f._stroke,N=f._fill,R=f.options,z=f._container;z.stroked=!!R.stroke,z.filled=!!R.fill,R.stroke?(b||(b=f._stroke=bc("stroke")),z.appendChild(b),b.weight=R.weight+"px",b.color=R.color,b.opacity=R.opacity,R.dashArray?b.dashStyle=A(R.dashArray)?R.dashArray.join(" "):R.dashArray.replace(/( *, *)/g," "):b.dashStyle="",b.endcap=R.lineCap.replace("butt","flat"),b.joinstyle=R.lineJoin):b&&(z.removeChild(b),f._stroke=null),R.fill?(N||(N=f._fill=bc("fill")),z.appendChild(N),N.color=R.fillColor||R.color,N.opacity=R.fillOpacity):N&&(z.removeChild(N),f._fill=null)},_updateCircle:function(f){var b=f._point.round(),N=Math.round(f._radius),R=Math.round(f._radiusY||N);this._setPath(f,f._empty()?"M0 0":"AL "+b.x+","+b.y+" "+N+","+R+" 0,"+65535*360)},_setPath:function(f,b){f._path.v=b},_bringToFront:function(f){ja(f._container)},_bringToBack:function(f){al(f._container)}},kd=ct.vml?bc:Jt,dl=ma.extend({_initContainer:function(){this._container=kd("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=kd("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Tn(this._container),hn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ma.prototype._update.call(this);var f=this._bounds,b=f.getSize(),N=this._container;(!this._svgSize||!this._svgSize.equals(b))&&(this._svgSize=b,N.setAttribute("width",b.x),N.setAttribute("height",b.y)),Tt(N,f.min),N.setAttribute("viewBox",[f.min.x,f.min.y,b.x,b.y].join(" ")),this.fire("update")}},_initPath:function(f){var b=f._path=kd("path");f.options.className&&kt(b,f.options.className),f.options.interactive&&kt(b,"leaflet-interactive"),this._updateStyle(f),this._layers[l(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){Tn(f._path),f.removeInteractiveTarget(f._path),delete this._layers[l(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var b=f._path,N=f.options;b&&(N.stroke?(b.setAttribute("stroke",N.color),b.setAttribute("stroke-opacity",N.opacity),b.setAttribute("stroke-width",N.weight),b.setAttribute("stroke-linecap",N.lineCap),b.setAttribute("stroke-linejoin",N.lineJoin),N.dashArray?b.setAttribute("stroke-dasharray",N.dashArray):b.removeAttribute("stroke-dasharray"),N.dashOffset?b.setAttribute("stroke-dashoffset",N.dashOffset):b.removeAttribute("stroke-dashoffset")):b.setAttribute("stroke","none"),N.fill?(b.setAttribute("fill",N.fillColor||N.color),b.setAttribute("fill-opacity",N.fillOpacity),b.setAttribute("fill-rule",N.fillRule||"evenodd")):b.setAttribute("fill","none"))},_updatePoly:function(f,b){this._setPath(f,Zt(f._parts,b))},_updateCircle:function(f){var b=f._point,N=Math.max(Math.round(f._radius),1),R=Math.max(Math.round(f._radiusY),1)||N,z="a"+N+","+R+" 0 1,0 ",Z=f._empty()?"M0 0":"M"+(b.x-N)+","+b.y+z+N*2+",0 "+z+-N*2+",0 ";this._setPath(f,Z)},_setPath:function(f,b){f._path.setAttribute("d",b)},_bringToFront:function(f){ja(f._path)},_bringToBack:function(f){al(f._path)}});ct.vml&&dl.include(ku);function _c(f){return ct.svg||ct.vml?new dl(f):null}Ft.include({getRenderer:function(f){var b=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return b||(b=this._renderer=this._createRenderer()),this.hasLayer(b)||this.addLayer(b),b},_getPaneRenderer:function(f){if(f==="overlayPane"||f===void 0)return!1;var b=this._paneRenderers[f];return b===void 0&&(b=this._createRenderer({pane:f}),this._paneRenderers[f]=b),b},_createRenderer:function(f){return this.options.preferCanvas&&Cd(f)||_c(f)}});var b_=Eu.extend({initialize:function(f,b){Eu.prototype.initialize.call(this,this._boundsToLatLngs(f),b)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return f=Se(f),[f.getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});function Ii(f,b){return new b_(f,b)}dl.create=kd,dl.pointsToPath=Zt,Si.geometryToLayer=Td,Si.coordsToLatLng=cp,Si.coordsToLatLngs=Sd,Si.latLngToCoords=Ed,Si.latLngsToCoords=up,Si.getFeature=da,Si.asFeature=Nu,Ft.mergeOptions({boxZoom:!0});var pp=ti.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){vt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){hn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Tn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||f.which!==1&&f.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),mr(),hc(),this._startPoint=this._map.mouseEventToContainerPoint(f),vt(document,{contextmenu:gr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=qt("div","leaflet-zoom-box",this._container),kt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var b=new ie(this._point,this._startPoint),N=b.getSize();Tt(this._box,b.min),this._box.style.width=N.x+"px",this._box.style.height=N.y+"px"},_finish:function(){this._moved&&(Tn(this._box),Cn(this._container,"leaflet-crosshair")),oa(),gd(),hn(document,{contextmenu:gr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if(!(f.which!==1&&f.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var b=new ce(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(b).fire("boxzoomend",{boxZoomBounds:b})}},_onKeyDown:function(f){f.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ft.addInitHook("addHandler","boxZoom",pp),Ft.mergeOptions({doubleClickZoom:!0});var Ha=ti.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var b=this._map,N=b.getZoom(),R=b.options.zoomDelta,z=f.originalEvent.shiftKey?N-R:N+R;b.options.doubleClickZoom==="center"?b.setZoom(z):b.setZoomAround(f.containerPoint,z)}});Ft.addInitHook("addHandler","doubleClickZoom",Ha),Ft.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var wg=ti.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new ha(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}kt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Cn(this._map._container,"leaflet-grab"),Cn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var b=Se(this._map.options.maxBounds);this._offsetLimit=de(this._map.latLngToContainerPoint(b.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(b.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var b=this._lastTime=+new Date,N=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(N),this._times.push(b),this._prunePositions(b)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),b=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=b.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,b){return f-(f-b)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var f=this._draggable._newPos.subtract(this._draggable._startPos),b=this._offsetLimit;f.x<b.min.x&&(f.x=this._viscousLimit(f.x,b.min.x)),f.y<b.min.y&&(f.y=this._viscousLimit(f.y,b.min.y)),f.x>b.max.x&&(f.x=this._viscousLimit(f.x,b.max.x)),f.y>b.max.y&&(f.y=this._viscousLimit(f.y,b.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,b=Math.round(f/2),N=this._initialWorldOffset,R=this._draggable._newPos.x,z=(R-b+N)%f+b-N,Z=(R+b+N)%f-b-N,ue=Math.abs(z+N)<Math.abs(Z+N)?z:Z;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ue},_onDragEnd:function(f){var b=this._map,N=b.options,R=!N.inertia||f.noInertia||this._times.length<2;if(b.fire("dragend",f),R)b.fire("moveend");else{this._prunePositions(+new Date);var z=this._lastPos.subtract(this._positions[0]),Z=(this._lastTime-this._times[0])/1e3,ue=N.easeLinearity,Ne=z.multiplyBy(ue/Z),Le=Ne.distanceTo([0,0]),Ge=Math.min(N.inertiaMaxSpeed,Le),Je=Ne.multiplyBy(Ge/Le),rt=Ge/(N.inertiaDeceleration*ue),lt=Je.multiplyBy(-rt/2).round();!lt.x&&!lt.y?b.fire("moveend"):(lt=b._limitOffset(lt,b.options.maxBounds),k(function(){b.panBy(lt,{duration:rt,easeLinearity:ue,noMoveStart:!0,animate:!0})}))}}});Ft.addInitHook("addHandler","dragging",wg),Ft.mergeOptions({keyboard:!0,keyboardPanDelta:80});var $d=ti.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),vt(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),hn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,b=document.documentElement,N=f.scrollTop||b.scrollTop,R=f.scrollLeft||b.scrollLeft;this._map._container.focus(),window.scrollTo(R,N)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var b=this._panKeys={},N=this.keyCodes,R,z;for(R=0,z=N.left.length;R<z;R++)b[N.left[R]]=[-1*f,0];for(R=0,z=N.right.length;R<z;R++)b[N.right[R]]=[f,0];for(R=0,z=N.down.length;R<z;R++)b[N.down[R]]=[0,f];for(R=0,z=N.up.length;R<z;R++)b[N.up[R]]=[0,-1*f]},_setZoomDelta:function(f){var b=this._zoomKeys={},N=this.keyCodes,R,z;for(R=0,z=N.zoomIn.length;R<z;R++)b[N.zoomIn[R]]=f;for(R=0,z=N.zoomOut.length;R<z;R++)b[N.zoomOut[R]]=-f},_addHooks:function(){vt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){hn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var b=f.keyCode,N=this._map,R;if(b in this._panKeys){if(!N._panAnim||!N._panAnim._inProgress)if(R=this._panKeys[b],f.shiftKey&&(R=K(R).multiplyBy(3)),N.options.maxBounds&&(R=N._limitOffset(K(R),N.options.maxBounds)),N.options.worldCopyJump){var z=N.wrapLatLng(N.unproject(N.project(N.getCenter()).add(R)));N.panTo(z)}else N.panBy(R)}else if(b in this._zoomKeys)N.setZoom(N.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[b]);else if(b===27&&N._popup&&N._popup.options.closeOnEscapeKey)N.closePopup();else return;gr(f)}}});Ft.addInitHook("addHandler","keyboard",$d),Ft.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var fl=ti.extend({addHooks:function(){vt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){hn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var b=dc(f),N=this._map.options.wheelDebounceTime;this._delta+=b,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var R=Math.max(N-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),R),gr(f)},_performZoom:function(){var f=this._map,b=f.getZoom(),N=this._map.options.zoomSnap||0;f._stop();var R=this._delta/(this._map.options.wheelPxPerZoomLevel*4),z=4*Math.log(2/(1+Math.exp(-Math.abs(R))))/Math.LN2,Z=N?Math.ceil(z/N)*N:z,ue=f._limitZoom(b+(this._delta>0?Z:-Z))-b;this._delta=0,this._startTime=null,ue&&(f.options.scrollWheelZoom==="center"?f.setZoom(b+ue):f.setZoomAround(this._lastMousePos,b+ue))}});Ft.addInitHook("addHandler","scrollWheelZoom",fl);var Tg=600;Ft.mergeOptions({tapHold:ct.touchNative&&ct.safari&&ct.mobile,tapTolerance:15});var mp=ti.extend({addHooks:function(){vt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){hn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),f.touches.length===1){var b=f.touches[0];this._startPos=this._newPos=new ne(b.clientX,b.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(vt(document,"touchend",Dn),vt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",b))},this),Tg),vt(document,"touchend touchcancel contextmenu",this._cancel,this),vt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){hn(document,"touchend",Dn),hn(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),hn(document,"touchend touchcancel contextmenu",this._cancel,this),hn(document,"touchmove",this._onMove,this)},_onMove:function(f){var b=f.touches[0];this._newPos=new ne(b.clientX,b.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,b){var N=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:b.screenX,screenY:b.screenY,clientX:b.clientX,clientY:b.clientY});N._simulated=!0,b.target.dispatchEvent(N)}});Ft.addInitHook("addHandler","tapHold",mp),Ft.mergeOptions({touchZoom:ct.touch,bounceAtZoomLimits:!0});var xc=ti.extend({addHooks:function(){kt(this._map._container,"leaflet-touch-zoom"),vt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Cn(this._map._container,"leaflet-touch-zoom"),hn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var b=this._map;if(!(!f.touches||f.touches.length!==2||b._animatingZoom||this._zooming)){var N=b.mouseEventToContainerPoint(f.touches[0]),R=b.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=b.getSize()._divideBy(2),this._startLatLng=b.containerPointToLatLng(this._centerPoint),b.options.touchZoom!=="center"&&(this._pinchStartLatLng=b.containerPointToLatLng(N.add(R)._divideBy(2))),this._startDist=N.distanceTo(R),this._startZoom=b.getZoom(),this._moved=!1,this._zooming=!0,b._stop(),vt(document,"touchmove",this._onTouchMove,this),vt(document,"touchend touchcancel",this._onTouchEnd,this),Dn(f)}},_onTouchMove:function(f){if(!(!f.touches||f.touches.length!==2||!this._zooming)){var b=this._map,N=b.mouseEventToContainerPoint(f.touches[0]),R=b.mouseEventToContainerPoint(f.touches[1]),z=N.distanceTo(R)/this._startDist;if(this._zoom=b.getScaleZoom(z,this._startZoom),!b.options.bounceAtZoomLimits&&(this._zoom<b.getMinZoom()&&z<1||this._zoom>b.getMaxZoom()&&z>1)&&(this._zoom=b._limitZoom(this._zoom)),b.options.touchZoom==="center"){if(this._center=this._startLatLng,z===1)return}else{var Z=N._add(R)._divideBy(2)._subtract(this._centerPoint);if(z===1&&Z.x===0&&Z.y===0)return;this._center=b.unproject(b.project(this._pinchStartLatLng,this._zoom).subtract(Z),this._zoom)}this._moved||(b._moveStart(!0,!1),this._moved=!0),V(this._animRequest);var ue=a(b._move,b,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=k(ue,this,!0),Dn(f)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,V(this._animRequest),hn(document,"touchmove",this._onTouchMove,this),hn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ft.addInitHook("addHandler","touchZoom",xc),Ft.BoxZoom=pp,Ft.DoubleClickZoom=Ha,Ft.Drag=wg,Ft.Keyboard=$d,Ft.ScrollWheelZoom=fl,Ft.TapHold=mp,Ft.TouchZoom=xc,t.Bounds=ie,t.Browser=ct,t.CRS=He,t.Canvas=Id,t.Circle=bg,t.CircleMarker=wd,t.Class=ae,t.Control=ir,t.DivIcon=xg,t.DivOverlay=fa,t.DomEvent=sp,t.DomUtil=yd,t.Draggable=ha,t.Evented=se,t.FeatureGroup=jn,t.GeoJSON=Si,t.GridLayer=yc,t.Handler=ti,t.Icon=Ga,t.ImageOverlay=Wa,t.LatLng=Te,t.LatLngBounds=ce,t.Layer=Sn,t.LayerGroup=Xn,t.LineUtil=ee,t.Map=Ft,t.Marker=Su,t.Mixin=pc,t.Path=Io,t.Point=ne,t.PolyUtil=_u,t.Polygon=Eu,t.Polyline=Co,t.Popup=Nd,t.PosAnimation=fc,t.Projection=Xe,t.Rectangle=b_,t.Renderer=ma,t.SVG=dl,t.SVGOverlay=hl,t.TileLayer=vc,t.Tooltip=fp,t.Transformation=mt,t.Util=G,t.VideoOverlay=dp,t.bind=a,t.bounds=de,t.canvas=Cd,t.circle=XT,t.circleMarker=p_,t.control=yr,t.divIcon=v_,t.extend=r,t.featureGroup=Ua,t.geoJSON=hp,t.geoJson=m_,t.gridLayer=pa,t.icon=lp,t.imageOverlay=Iu,t.latLng=Ie,t.latLngBounds=Se,t.layerGroup=No,t.map=za,t.marker=vg,t.point=K,t.polygon=Ti,t.polyline=ZT,t.popup=YT,t.rectangle=Ii,t.setOptions=w,t.stamp=l,t.svg=_c,t.svgOverlay=y_,t.tileLayer=Ei,t.tooltip=QT,t.transformation=At,t.version=s,t.videoOverlay=g_;var $u=window.L;t.noConflict=function(){return window.L=$u,this},window.L=t}))})(by,by.exports)),by.exports}var Qie=Yie();const bl=E1(Qie);(function(n,e,t){function s(r,i){for(;(r=r.parentElement)&&!r.classList.contains(i););return r}L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(r,i){this._map=r,this._container=r._container,this._overlayPane=r._panes.overlayPane,this._popupPane=r._panes.popupPane,i&&i.shapeOptions&&(i.shapeOptions=L.Util.extend({},this.options.shapeOptions,i.shapeOptions)),L.setOptions(this,i);var a=L.version.split(".");parseInt(a[0],10)===1&&parseInt(a[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var r=this._map;r&&(L.DomUtil.disableTextSelection(),r.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(r){L.setOptions(this,r)},_fireCreatedEvent:function(r){this._map.fire(L.Draw.Event.CREATED,{layer:r,layerType:this.type})},_cancelDrawing:function(r){r.keyCode===27&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(r,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,r,i)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var r=this._markers.pop(),i=this._poly,a=i.getLatLngs(),o=a.splice(-1,1)[0];this._poly.setLatLngs(a),this._markerGroup.removeLayer(r),i.getLatLngs().length<2&&this._map.removeLayer(i),this._vertexChanged(o,!1)}},addVertex:function(r){if(this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(r))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(r)),this._poly.addLatLng(r),this._poly.getLatLngs().length===2&&this._map.addLayer(this._poly),this._vertexChanged(r,!0)},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var r=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),i=this._poly.newLatLngIntersects(r[r.length-1]);if(!this.options.allowIntersection&&i||!this._shapeIsValid())return void this._showErrorTooltip();this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._markers!==null&&this._updateGuide()},_onMouseMove:function(r){var i=this._map.mouseEventToLayerPoint(r.originalEvent),a=this._map.layerPointToLatLng(i);this._currentLatLng=a,this._updateTooltip(a),this._updateGuide(i),this._mouseMarker.setLatLng(a),L.DomEvent.preventDefault(r.originalEvent)},_vertexChanged:function(r,i){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(r,i),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(r){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(r),this._clickHandled=!0,this._disableNewMarkers();var i=r.originalEvent,a=i.clientX,o=i.clientY;this._startPoint.call(this,a,o)}},_startPoint:function(r,i){this._mouseDownOrigin=L.point(r,i)},_onMouseUp:function(r){var i=r.originalEvent,a=i.clientX,o=i.clientY;this._endPoint.call(this,a,o,r),this._clickHandled=null},_endPoint:function(r,i,a){if(this._mouseDownOrigin){var o=L.point(r,i).distanceTo(this._mouseDownOrigin),l=this._calculateFinishDistance(a.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(a.latlng),this._finishShape()):l<10&&L.Browser.touch?this._finishShape():Math.abs(o)<9*(n.devicePixelRatio||1)&&this.addVertex(a.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(r){var i,a,o=r.originalEvent;!o.touches||!o.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(i=o.touches[0].clientX,a=o.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,i,a),this._endPoint.call(this,i,a,r),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(r){var i;if(this._markers.length>0){var a;if(this.type===L.Draw.Polyline.TYPE)a=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;a=this._markers[0]}var o=this._map.latLngToContainerPoint(a.getLatLng()),l=new L.Marker(r,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),c=this._map.latLngToContainerPoint(l.getLatLng());i=o.distanceTo(c)}else i=1/0;return i},_updateFinishHandler:function(){var r=this._markers.length;r>1&&this._markers[r-1].on("click",this._finishShape,this),r>2&&this._markers[r-2].off("click",this._finishShape,this)},_createMarker:function(r){var i=new L.Marker(r,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(i),i},_updateGuide:function(r){var i=this._markers?this._markers.length:0;i>0&&(r=r||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[i-1].getLatLng()),r))},_updateTooltip:function(r){var i=this._getTooltipText();r&&this._tooltip.updatePosition(r),this._errorShown||this._tooltip.updateContent(i)},_drawGuide:function(r,i){var a,o,l,c=Math.floor(Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2))),h=this.options.guidelineDistance,p=this.options.maxGuideLineLength,m=c>p?c-p:h;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));m<c;m+=this.options.guidelineDistance)a=m/c,o={x:Math.floor(r.x*(1-a)+a*i.x),y:Math.floor(r.y*(1-a)+a*i.y)},l=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),l.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(l,o)},_updateGuideColor:function(r){if(this._guidesContainer)for(var i=0,a=this._guidesContainer.childNodes.length;i<a;i++)this._guidesContainer.childNodes[i].style.backgroundColor=r},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var r,i,a=this.options.showLength;return this._markers.length===0?r={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(i=a?this._getMeasurementString():"",r=this._markers.length===1?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:i}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:i}),r},_updateRunningMeasure:function(r,i){var a,o,l=this._markers.length;this._markers.length===1?this._measurementRunningTotal=0:(a=l-(i?2:1),o=L.GeometryUtil.isVersion07x()?r.distanceTo(this._markers[a].getLatLng())*(this.options.factor||1):this._map.distance(r,this._markers[a].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=o*(i?1:-1))},_getMeasurementString:function(){var r,i=this._currentLatLng,a=this._markers[this._markers.length-1].getLatLng();return r=L.GeometryUtil.isVersion07x()?a&&i&&i.distanceTo?this._measurementRunningTotal+i.distanceTo(a)*(this.options.factor||1):this._measurementRunningTotal||0:a&&i?this._measurementRunningTotal+this._map.distance(i,a)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(r,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout((function(){this._disableMarkers=!1}).bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var r=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,r)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(r,i){L.Draw.Polyline.prototype.initialize.call(this,r,i),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var r=this._markers.length;r===1&&this._markers[0].on("click",this._finishShape,this),r>2&&(this._markers[r-1].on("dblclick",this._finishShape,this),r>3&&this._markers[r-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var r,i;return this._markers.length===0?r=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(r=L.drawLocal.draw.handlers.polygon.tooltip.cont,i=this._getMeasurementString()):(r=L.drawLocal.draw.handlers.polygon.tooltip.end,i=this._getMeasurementString()),{text:r,subtext:i}},_getMeasurementString:function(){var r=this._area,i="";return r||this.options.showLength?(this.options.showLength&&(i=L.Draw.Polyline.prototype._getMeasurementString.call(this)),r&&(i+="<br>"+L.GeometryUtil.readableArea(r,this.options.metric,this.options.precision)),i):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(r,i){var a;!this.options.allowIntersection&&this.options.showArea&&(a=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(a)),L.Draw.Polyline.prototype._vertexChanged.call(this,r,i)},_cleanUpShape:function(){var r=this._markers.length;r>0&&(this._markers[0].off("click",this._finishShape,this),r>2&&this._markers[r-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(r,i){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,r,i)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),e.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),L.DomEvent.off(e,"touchend",this._onMouseUp,this),e.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(r){this._isDrawing=!0,this._startLatLng=r.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).on(e,"touchend",this._onMouseUp,this).preventDefault(r.originalEvent)},_onMouseMove:function(r){var i=r.latlng;this._tooltip.updatePosition(i),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(i))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(r,i){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,r,i)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(r){if(!this._shape&&!this._isCurrentlyTwoClickDrawing)return void(this._isCurrentlyTwoClickDrawing=!0);this._isCurrentlyTwoClickDrawing&&!s(r.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this)},_drawShape:function(r){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,r)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,r),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var r=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,r)},_getTooltipText:function(){var r,i,a,o=L.Draw.SimpleShape.prototype._getTooltipText.call(this),l=this._shape,c=this.options.showArea;return l&&(r=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),i=L.GeometryUtil.geodesicArea(r),a=c?L.GeometryUtil.readableArea(i,this.options.metric):""),{text:o.text,subtext:a}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(r,i){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,r,i)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(r){var i=r.latlng;this._tooltip.updatePosition(i),this._mouseMarker.setLatLng(i),this._marker?(i=this._mouseMarker.getLatLng(),this._marker.setLatLng(i)):(this._marker=this._createMarker(i),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(r){return new L.Marker(r,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(r){this._onMouseMove(r),this._onClick()},_fireCreatedEvent:function(){var r=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,r)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(r,i){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,r,i)},_fireCreatedEvent:function(){var r=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,r)},_createMarker:function(r){return new L.CircleMarker(r,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(r,i){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,r,i)},_drawShape:function(r){if(L.GeometryUtil.isVersion07x())var i=this._startLatLng.distanceTo(r);else var i=this._map.distance(this._startLatLng,r);this._shape?this._shape.setRadius(i):(this._shape=new L.Circle(this._startLatLng,i,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var r=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,r)},_onMouseMove:function(r){var i,a=r.latlng,o=this.options.showRadius,l=this.options.metric;if(this._tooltip.updatePosition(a),this._isDrawing){this._drawShape(a),i=this._shape.getRadius().toFixed(1);var c="";o&&(c=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(i,l,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:c})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(r,i){this._marker=r,L.setOptions(this,i)},addHooks:function(){var r=this._marker;r.dragging.enable(),r.on("dragend",this._onDragEnd,r),this._toggleMarkerHighlight()},removeHooks:function(){var r=this._marker;r.dragging.disable(),r.off("dragend",this._onDragEnd,r),this._toggleMarkerHighlight()},_onDragEnd:function(r){var i=r.target;i.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:i})},_toggleMarkerHighlight:function(){var r=this._marker._icon;r&&(r.style.display="none",L.DomUtil.hasClass(r,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(r,"leaflet-edit-marker-selected"),this._offsetMarker(r,-4)):(L.DomUtil.addClass(r,"leaflet-edit-marker-selected"),this._offsetMarker(r,4)),r.style.display="")},_offsetMarker:function(r,i){var a=parseInt(r.style.marginTop,10)-i,o=parseInt(r.style.marginLeft,10)-i;r.style.marginTop=a+"px",r.style.marginLeft=o+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(r){this.latlngs=[r._latlngs],r._holes&&(this.latlngs=this.latlngs.concat(r._holes)),this._poly=r,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(r){for(var i=0;i<this._verticesHandlers.length;i++)r(this._verticesHandlers[i])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(r){r.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(r){r.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(r){r.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var r=0;r<this.latlngs.length;r++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[r],this._poly.options.poly))},_updateLatLngs:function(r){this.latlngs=[r.layer._latlngs],r.layer._holes&&(this.latlngs=this.latlngs.concat(r.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(r,i,a){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=r,a&&a.drawError&&(a.drawError=L.Util.extend({},this.options.drawError,a.drawError)),this._latlngs=i,L.setOptions(this,a)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var r=this._poly,i=r._path;r instanceof L.Polygon||(r.options.fill=!1,r.options.editing&&(r.options.editing.fill=!1)),i&&r.options.editing&&r.options.editing.className&&(r.options.original.className&&r.options.original.className.split(" ").forEach(function(a){L.DomUtil.removeClass(i,a)}),r.options.editing.className.split(" ").forEach(function(a){L.DomUtil.addClass(i,a)})),r.setStyle(r.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var r=this._poly,i=r._path;i&&r.options.editing&&r.options.editing.className&&(r.options.editing.className.split(" ").forEach(function(a){L.DomUtil.removeClass(i,a)}),r.options.original.className&&r.options.original.className.split(" ").forEach(function(a){L.DomUtil.addClass(i,a)})),r.setStyle(r.options.original),r._map&&(r._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var r,i,a,o,l=this._defaultShape();for(r=0,a=l.length;r<a;r++)o=this._createMarker(l[r],r),o.on("click",this._onMarkerClick,this),o.on("contextmenu",this._onContextMenu,this),this._markers.push(o);var c,h;for(r=0,i=a-1;r<a;i=r++)(r!==0||L.Polygon&&this._poly instanceof L.Polygon)&&(c=this._markers[i],h=this._markers[r],this._createMiddleMarker(c,h),this._updatePrevNext(c,h))},_createMarker:function(r,i){var a=new L.Marker.Touch(r,{draggable:!0,icon:this.options.icon});return a._origLatLng=r,a._index=i,a.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(a),a},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var r=this._defaultShape(),i=[].splice.apply(r,arguments);return this._poly._convertLatLngs(r,!0),this._poly.redraw(),i},_removeMarker:function(r){var i=r._index;this._markerGroup.removeLayer(r),this._markers.splice(i,1),this._spliceLatLngs(i,1),this._updateIndexes(i,-1),r.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(r){var i=r.target,a=this._poly,o=L.LatLngUtil.cloneLatLng(i._origLatLng);if(L.extend(i._origLatLng,i._latlng),a.options.poly){var l=a._map._editTooltip;if(!a.options.poly.allowIntersection&&a.intersects()){L.extend(i._origLatLng,o),i.setLatLng(o);var c=a.options.color;a.setStyle({color:this.options.drawError.color}),l&&l.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){a.setStyle({color:c}),l&&l.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}i._middleLeft&&i._middleLeft.setLatLng(this._getMiddleLatLng(i._prev,i)),i._middleRight&&i._middleRight.setLatLng(this._getMiddleLatLng(i,i._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var h=this._poly.getLatLngs();this._poly._convertLatLngs(h,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(r){var i=L.Polygon&&this._poly instanceof L.Polygon?4:3,a=r.target;this._defaultShape().length<i||(this._removeMarker(a),this._updatePrevNext(a._prev,a._next),a._middleLeft&&this._markerGroup.removeLayer(a._middleLeft),a._middleRight&&this._markerGroup.removeLayer(a._middleRight),a._prev&&a._next?this._createMiddleMarker(a._prev,a._next):a._prev?a._next||(a._prev._middleRight=null):a._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(r){var i=r.target;this._poly,this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:i,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(r){var i=this._map.mouseEventToLayerPoint(r.originalEvent.touches[0]),a=this._map.layerPointToLatLng(i),o=r.target;L.extend(o._origLatLng,a),o._middleLeft&&o._middleLeft.setLatLng(this._getMiddleLatLng(o._prev,o)),o._middleRight&&o._middleRight.setLatLng(this._getMiddleLatLng(o,o._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(r,i){this._markerGroup.eachLayer(function(a){a._index>r&&(a._index+=i)})},_createMiddleMarker:function(r,i){var a,o,l,c=this._getMiddleLatLng(r,i),h=this._createMarker(c);h.setOpacity(.6),r._middleRight=i._middleLeft=h,o=function(){h.off("touchmove",o,this);var p=i._index;h._index=p,h.off("click",a,this).on("click",this._onMarkerClick,this),c.lat=h.getLatLng().lat,c.lng=h.getLatLng().lng,this._spliceLatLngs(p,0,c),this._markers.splice(p,0,h),h.setOpacity(1),this._updateIndexes(p,1),i._index++,this._updatePrevNext(r,h),this._updatePrevNext(h,i),this._poly.fire("editstart")},l=function(){h.off("dragstart",o,this),h.off("dragend",l,this),h.off("touchmove",o,this),this._createMiddleMarker(r,h),this._createMiddleMarker(h,i)},a=function(){o.call(this),l.call(this),this._fireEdit()},h.on("click",a,this).on("dragstart",o,this).on("dragend",l,this).on("touchmove",o,this),this._markerGroup.addLayer(h)},_updatePrevNext:function(r,i){r&&(r._next=i),i&&(i._prev=r)},_getMiddleLatLng:function(r,i){var a=this._poly._map,o=a.project(r.getLatLng()),l=a.project(i.getLatLng());return a.unproject(o._add(l)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(r,i){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=r,L.Util.setOptions(this,i)},addHooks:function(){var r=this._shape;this._shape._map&&(this._map=this._shape._map,r.setStyle(r.options.editing),r._map&&(this._map=r._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var r=this._shape;if(r.setStyle(r.options.original),r._map){this._unbindMarker(this._moveMarker);for(var i=0,a=this._resizeMarkers.length;i<a;i++)this._unbindMarker(this._resizeMarkers[i]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(r,i){var a=new L.Marker.Touch(r,{draggable:!0,icon:i,zIndexOffset:10});return this._bindMarker(a),this._markerGroup.addLayer(a),a},_bindMarker:function(r){r.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(r){r.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(r){r.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(r){var i=r.target,a=i.getLatLng();i===this._moveMarker?this._move(a):this._resize(a),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(r){r.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(r){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,r),typeof this._getCorners=="function"){var i=this._getCorners(),a=r.target,o=a._cornerIndex;a.setOpacity(0),this._oppositeCorner=i[(o+2)%4],this._toggleCornerMarkers(0,o)}this._shape.fire("editstart")},_onTouchMove:function(r){var i=this._map.mouseEventToLayerPoint(r.originalEvent.touches[0]),a=this._map.layerPointToLatLng(i);return r.target===this._moveMarker?this._move(a):this._resize(a),this._shape.redraw(),!1},_onTouchEnd:function(r){r.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var r=this._shape.getBounds(),i=r.getCenter();this._moveMarker=this._createMarker(i,this.options.moveIcon)},_createResizeMarker:function(){var r=this._getCorners();this._resizeMarkers=[];for(var i=0,a=r.length;i<a;i++)this._resizeMarkers.push(this._createMarker(r[i],this.options.resizeIcon)),this._resizeMarkers[i]._cornerIndex=i},_onMarkerDragStart:function(r){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,r);var i=this._getCorners(),a=r.target,o=a._cornerIndex;this._oppositeCorner=i[(o+2)%4],this._toggleCornerMarkers(0,o)},_onMarkerDragEnd:function(r){var i,a,o=r.target;o===this._moveMarker&&(i=this._shape.getBounds(),a=i.getCenter(),o.setLatLng(a)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,r)},_move:function(r){for(var i,a=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),o=this._shape.getBounds(),l=o.getCenter(),c=[],h=0,p=a.length;h<p;h++)i=[a[h].lat-l.lat,a[h].lng-l.lng],c.push([r.lat+i[0],r.lng+i[1]]);this._shape.setLatLngs(c),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(r){var i;this._shape.setBounds(L.latLngBounds(r,this._oppositeCorner)),i=this._shape.getBounds(),this._moveMarker.setLatLng(i.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var r=this._shape.getBounds();return[r.getNorthWest(),r.getNorthEast(),r.getSouthEast(),r.getSouthWest()]},_toggleCornerMarkers:function(r){for(var i=0,a=this._resizeMarkers.length;i<a;i++)this._resizeMarkers[i].setOpacity(r)},_repositionCornerMarkers:function(){for(var r=this._getCorners(),i=0,a=this._resizeMarkers.length;i<a;i++)this._resizeMarkers[i].setLatLng(r[i])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var r=this._shape.getLatLng();this._moveMarker=this._createMarker(r,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(r){if(this._resizeMarkers.length){var i=this._getResizeMarkerPoint(r);this._resizeMarkers[0].setLatLng(i)}this._shape.setLatLng(r),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook(function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var r=this._shape.getLatLng(),i=this._getResizeMarkerPoint(r);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(i,this.options.resizeIcon))},_getResizeMarkerPoint:function(r){var i=this._shape._radius*Math.cos(Math.PI/4),a=this._map.project(r);return this._map.unproject([a.x+i,a.y-i])},_resize:function(r){var i=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=i.distanceTo(r):radius=this._map.distance(i,r),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(r,i){var a={};if(r.touches!==void 0){if(!r.touches.length)return;a=r.touches[0]}else if(r.pointerType!=="touch"||(a=r,!this._filterClick(r)))return;var o=this._map.mouseEventToContainerPoint(a),l=this._map.mouseEventToLayerPoint(a),c=this._map.layerPointToLatLng(l);this._map.fire(i,{latlng:c,layerPoint:l,containerPoint:o,pageX:a.pageX,pageY:a.pageY,originalEvent:r})},_filterClick:function(r){var i=r.timeStamp||r.originalEvent.timeStamp,a=L.DomEvent._lastClick&&i-L.DomEvent._lastClick;return a&&a>100&&a<500||r.target._simulatedClick&&!r._simulated?(L.DomEvent.stop(r),!1):(L.DomEvent._lastClick=i,!0)},_onTouchStart:function(r){this._map._loaded&&this._touchEvent(r,"touchstart")},_onTouchEnd:function(r){this._map._loaded&&this._touchEvent(r,"touchend")},_onTouchCancel:function(r){if(this._map._loaded){var i="touchcancel";this._detectIE()&&(i="pointercancel"),this._touchEvent(r,i)}},_onTouchLeave:function(r){this._map._loaded&&this._touchEvent(r,"touchleave")},_onTouchMove:function(r){this._map._loaded&&this._touchEvent(r,"touchmove")},_detectIE:function(){var r=n.navigator.userAgent,i=r.indexOf("MSIE ");if(i>0)return parseInt(r.substring(i+5,r.indexOf(".",i)),10);if(r.indexOf("Trident/")>0){var a=r.indexOf("rv:");return parseInt(r.substring(a+3,r.indexOf(".",a)),10)}var o=r.indexOf("Edge/");return o>0&&parseInt(r.substring(o+5,r.indexOf(".",o)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var r=this._icon,i=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?i.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):i.concat(["touchcancel"]),L.DomUtil.addClass(r,"leaflet-clickable"),L.DomEvent.on(r,"click",this._onMouseClick,this),L.DomEvent.on(r,"keypress",this._onKeyPress,this);for(var a=0;a<i.length;a++)L.DomEvent.on(r,i[a],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var r=n.navigator.userAgent,i=r.indexOf("MSIE ");if(i>0)return parseInt(r.substring(i+5,r.indexOf(".",i)),10);if(r.indexOf("Trident/")>0){var a=r.indexOf("rv:");return parseInt(r.substring(a+3,r.indexOf(".",a)),10)}var o=r.indexOf("Edge/");return o>0&&parseInt(r.substring(o+5,r.indexOf(".",o)),10)}}),L.LatLngUtil={cloneLatLngs:function(r){for(var i=[],a=0,o=r.length;a<o;a++)Array.isArray(r[a])?i.push(L.LatLngUtil.cloneLatLngs(r[a])):i.push(this.cloneLatLng(r[a]));return i},cloneLatLng:function(r){return L.latLng(r.lat,r.lng)}},(function(){var r={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(i){var a,o,l=i.length,c=0,h=Math.PI/180;if(l>2){for(var p=0;p<l;p++)a=i[p],o=i[(p+1)%l],c+=(o.lng-a.lng)*h*(2+Math.sin(a.lat*h)+Math.sin(o.lat*h));c=6378137*c*6378137/2}return Math.abs(c)},formattedNumber:function(i,a){var o=parseFloat(i).toFixed(a),l=L.drawLocal.format&&L.drawLocal.format.numeric,c=l&&l.delimiters,h=c&&c.thousands,p=c&&c.decimal;if(h||p){var m=o.split(".");o=h?m[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+h):m[0],p=p||".",m.length>1&&(o=o+p+m[1])}return o},readableArea:function(i,a,h){var l,c,h=L.Util.extend({},r,h);return a?(c=["ha","m"],type=typeof a,type==="string"?c=[a]:type!=="boolean"&&(c=a),l=i>=1e6&&c.indexOf("km")!==-1?L.GeometryUtil.formattedNumber(1e-6*i,h.km)+" km²":i>=1e4&&c.indexOf("ha")!==-1?L.GeometryUtil.formattedNumber(1e-4*i,h.ha)+" ha":L.GeometryUtil.formattedNumber(i,h.m)+" m²"):(i/=.836127,l=i>=3097600?L.GeometryUtil.formattedNumber(i/3097600,h.mi)+" mi²":i>=4840?L.GeometryUtil.formattedNumber(i/4840,h.ac)+" acres":L.GeometryUtil.formattedNumber(i,h.yd)+" yd²"),l},readableDistance:function(i,a,o,l,p){var h,p=L.Util.extend({},r,p);switch(a?typeof a=="string"?a:"metric":o?"feet":l?"nauticalMile":"yards"){case"metric":h=i>1e3?L.GeometryUtil.formattedNumber(i/1e3,p.km)+" km":L.GeometryUtil.formattedNumber(i,p.m)+" m";break;case"feet":i*=3.28083,h=L.GeometryUtil.formattedNumber(i,p.ft)+" ft";break;case"nauticalMile":i*=.53996,h=L.GeometryUtil.formattedNumber(i/1e3,p.nm)+" nm";break;case"yards":default:i*=1.09361,h=i>1760?L.GeometryUtil.formattedNumber(i/1760,p.mi)+" miles":L.GeometryUtil.formattedNumber(i,p.yd)+" yd"}return h},isVersion07x:function(){var i=L.version.split(".");return parseInt(i[0],10)===0&&parseInt(i[1],10)===7}})})(),L.Util.extend(L.LineUtil,{segmentsIntersect:function(r,i,a,o){return this._checkCounterclockwise(r,a,o)!==this._checkCounterclockwise(i,a,o)&&this._checkCounterclockwise(r,i,a)!==this._checkCounterclockwise(r,i,o)},_checkCounterclockwise:function(r,i,a){return(a.y-r.y)*(i.x-r.x)>(i.y-r.y)*(a.x-r.x)}}),L.Polyline.include({intersects:function(){var r,i,a,o=this._getProjectedPoints(),l=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(r=l-1;r>=3;r--)if(i=o[r-1],a=o[r],this._lineSegmentsIntersectsRange(i,a,r-2))return!0;return!1},newLatLngIntersects:function(r,i){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(r),i)},newPointIntersects:function(r,i){var a=this._getProjectedPoints(),o=a?a.length:0,l=a?a[o-1]:null,c=o-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(l,r,c,i?1:0)},_tooFewPointsForIntersection:function(r){var i=this._getProjectedPoints(),a=i?i.length:0;return a+=r||0,!i||a<=3},_lineSegmentsIntersectsRange:function(r,i,a,o){var l,c,h=this._getProjectedPoints();o=o||0;for(var p=a;p>o;p--)if(l=h[p-1],c=h[p],L.LineUtil.segmentsIntersect(r,i,l,c))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var r=[],i=this._defaultShape(),a=0;a<i.length;a++)r.push(this._map.latLngToLayerPoint(i[a]));return r}}),L.Polygon.include({intersects:function(){var r,i,a,o,l=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(r=l.length,i=l[0],a=l[r-1],o=r-2,this._lineSegmentsIntersectsRange(a,i,o,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(r){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,r);var i;this._toolbars={},L.DrawToolbar&&this.options.draw&&(i=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=i,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(i=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=i,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(r){var i,a=L.DomUtil.create("div","leaflet-draw"),o=!1;for(var l in this._toolbars)this._toolbars.hasOwnProperty(l)&&(i=this._toolbars[l].addToolbar(r))&&(o||(L.DomUtil.hasClass(i,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(i.childNodes[0],"leaflet-draw-toolbar-top"),o=!0),a.appendChild(i));return a},onRemove:function(){for(var r in this._toolbars)this._toolbars.hasOwnProperty(r)&&this._toolbars[r].removeToolbar()},setDrawingOptions:function(r){for(var i in this._toolbars)this._toolbars[i]instanceof L.DrawToolbar&&this._toolbars[i].setOptions(r)},_toolbarEnabled:function(r){var i=r.target;for(var a in this._toolbars)this._toolbars[a]!==i&&this._toolbars[a].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({initialize:function(r){L.setOptions(this,r),this._modes={},this._actionButtons=[],this._activeMode=null;var i=L.version.split(".");parseInt(i[0],10)===1&&parseInt(i[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return this._activeMode!==null},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(r){var i,a=L.DomUtil.create("div","leaflet-draw-section"),o=0,l=this._toolbarClass||"",c=this.getModeHandlers(r);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=r,i=0;i<c.length;i++)c[i].enabled&&this._initModeHandler(c[i].handler,this._toolbarContainer,o++,l,c[i].title);if(o)return this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),a.appendChild(this._toolbarContainer),a.appendChild(this._actionsContainer),a},removeToolbar:function(){for(var r in this._modes)this._modes.hasOwnProperty(r)&&(this._disposeButton(this._modes[r].button,this._modes[r].handler.enable,this._modes[r].handler),this._modes[r].handler.disable(),this._modes[r].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var i=0,a=this._actionButtons.length;i<a;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(r,i,a,o,l){var c=r.type;this._modes[c]={},this._modes[c].handler=r,this._modes[c].button=this._createButton({type:c,title:l,className:o+"-"+c,container:i,callback:this._modes[c].handler.enable,context:this._modes[c].handler}),this._modes[c].buttonIndex=a,this._modes[c].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!n.MSStream},_createButton:function(r){var i=L.DomUtil.create("a",r.className||"",r.container),a=L.DomUtil.create("span","sr-only",r.container);i.href="#",i.appendChild(a),r.title&&(i.title=r.title,a.innerHTML=r.title),r.text&&(i.innerHTML=r.text,a.innerHTML=r.text);var o=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"mousedown",L.DomEvent.stopPropagation).on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"touchstart",L.DomEvent.stopPropagation).on(i,"click",L.DomEvent.preventDefault).on(i,o,r.callback,r.context),i},_disposeButton:function(r,i){var a=this._detectIOS()?"touchstart":"click";L.DomEvent.off(r,"click",L.DomEvent.stopPropagation).off(r,"mousedown",L.DomEvent.stopPropagation).off(r,"dblclick",L.DomEvent.stopPropagation).off(r,"touchstart",L.DomEvent.stopPropagation).off(r,"click",L.DomEvent.preventDefault).off(r,a,i)},_handlerActivated:function(r){this.disable(),this._activeMode=this._modes[r.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(r){var i,a,o,l,c=this._actionsContainer,h=this.getActions(r),p=h.length;for(a=0,o=this._actionButtons.length;a<o;a++)this._disposeButton(this._actionButtons[a].button,this._actionButtons[a].callback);for(this._actionButtons=[];c.firstChild;)c.removeChild(c.firstChild);for(var m=0;m<p;m++)"enabled"in h[m]&&!h[m].enabled||(i=L.DomUtil.create("li","",c),l=this._createButton({title:h[m].title,text:h[m].text,container:i,callback:h[m].callback,context:h[m].context}),this._actionButtons.push({button:l,callback:h[m].callback}))},_showActionsToolbar:function(){var r=this._activeMode.buttonIndex,i=this._lastButtonIndex,a=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=a+"px",r===0&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),r===i&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(r){this._map=r,this._popupPane=r._panes.popupPane,this._visible=!1,this._container=r.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(r){return this._container?(r.subtext=r.subtext||"",r.subtext.length!==0||this._singleLineLabel?r.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(r.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+r.subtext+"</span><br />":"")+"<span>"+r.text+"</span>",r.text||r.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(r){var i=this._map.latLngToLayerPoint(r),a=this._container;return this._container&&(this._visible&&(a.style.visibility="inherit"),L.DomUtil.setPosition(a,i)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(r){for(var i in this.options)this.options.hasOwnProperty(i)&&r[i]&&(r[i]=L.extend({},this.options[i],r[i]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,r)},getModeHandlers:function(r){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(r,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(r,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(r,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(r,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(r,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(r,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(r){return[{enabled:r.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:r.completeShape,context:r},{enabled:r.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:r.deleteLastVertex,context:r},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(r){L.setOptions(this,r);for(var i in this._modes)this._modes.hasOwnProperty(i)&&r.hasOwnProperty(i)&&this._modes[i].handler.setOptions(r[i])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(r){r.edit&&(r.edit.selectedPathOptions===void 0&&(r.edit.selectedPathOptions=this.options.edit.selectedPathOptions),r.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,r.edit.selectedPathOptions)),r.remove&&(r.remove=L.extend({},this.options.remove,r.remove)),r.poly&&(r.poly=L.extend({},this.options.poly,r.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,r),this._selectedFeatureCount=0},getModeHandlers:function(r){var i=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(r,{featureGroup:i,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(r,{featureGroup:i}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(r){var i=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return r.removeAllLayers&&i.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),i},addToolbar:function(r){var i=L.Toolbar.prototype.addToolbar.call(this,r);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),i},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var r,i=this.options.featureGroup,a=i.getLayers().length!==0;this.options.edit&&(r=this._modes[L.EditToolbar.Edit.TYPE].button,a?L.DomUtil.removeClass(r,"leaflet-disabled"):L.DomUtil.addClass(r,"leaflet-disabled"),r.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(r=this._modes[L.EditToolbar.Delete.TYPE].button,a?L.DomUtil.removeClass(r,"leaflet-disabled"):L.DomUtil.addClass(r,"leaflet-disabled"),r.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(r,i){if(L.Handler.prototype.initialize.call(this,r),L.setOptions(this,i),this._featureGroup=i.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var a=L.version.split(".");parseInt(a[0],10)===1&&parseInt(a[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var r=this._map;r&&(r.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),r._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(r){this._revertLayer(r)},this)},save:function(){var r=new L.LayerGroup;this._featureGroup.eachLayer(function(i){i.edited&&(r.addLayer(i),i.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:r})},_backupLayer:function(r){var i=L.Util.stamp(r);this._uneditedLayerProps[i]||(r instanceof L.Polyline||r instanceof L.Polygon||r instanceof L.Rectangle?this._uneditedLayerProps[i]={latlngs:L.LatLngUtil.cloneLatLngs(r.getLatLngs())}:r instanceof L.Circle?this._uneditedLayerProps[i]={latlng:L.LatLngUtil.cloneLatLng(r.getLatLng()),radius:r.getRadius()}:(r instanceof L.Marker||r instanceof L.CircleMarker)&&(this._uneditedLayerProps[i]={latlng:L.LatLngUtil.cloneLatLng(r.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(r){var i=L.Util.stamp(r);r.edited=!1,this._uneditedLayerProps.hasOwnProperty(i)&&(r instanceof L.Polyline||r instanceof L.Polygon||r instanceof L.Rectangle?r.setLatLngs(this._uneditedLayerProps[i].latlngs):r instanceof L.Circle?(r.setLatLng(this._uneditedLayerProps[i].latlng),r.setRadius(this._uneditedLayerProps[i].radius)):(r instanceof L.Marker||r instanceof L.CircleMarker)&&r.setLatLng(this._uneditedLayerProps[i].latlng),r.fire("revert-edited",{layer:r}))},_enableLayerEdit:function(r){var i,a,o=r.layer||r.target||r;this._backupLayer(o),this.options.poly&&(a=L.Util.extend({},this.options.poly),o.options.poly=a),this.options.selectedPathOptions&&(i=L.Util.extend({},this.options.selectedPathOptions),i.maintainColor&&(i.color=o.options.color,i.fillColor=o.options.fillColor),o.options.original=L.extend({},o.options),o.options.editing=i),o instanceof L.Marker?(o.editing&&o.editing.enable(),o.dragging.enable(),o.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):o.editing.enable()},_disableLayerEdit:function(r){var i=r.layer||r.target||r;i.edited=!1,i.editing&&i.editing.disable(),delete i.options.editing,delete i.options.original,this._selectedPathOptions&&(i instanceof L.Marker?this._toggleMarkerHighlight(i):(i.setStyle(i.options.previousOptions),delete i.options.previousOptions)),i instanceof L.Marker?(i.dragging.disable(),i.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):i.editing.disable()},_onMouseMove:function(r){this._tooltip.updatePosition(r.latlng)},_onMarkerDragEnd:function(r){var i=r.target;i.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:i})},_onTouchMove:function(r){var i=r.originalEvent.changedTouches[0],a=this._map.mouseEventToLayerPoint(i),o=this._map.layerPointToLatLng(a);r.target.setLatLng(o)},_hasAvailableLayers:function(){return this._featureGroup.getLayers().length!==0}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(r,i){if(L.Handler.prototype.initialize.call(this,r),L.Util.setOptions(this,i),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var a=L.version.split(".");parseInt(a[0],10)===1&&parseInt(a[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var r=this._map;r&&(r.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(r){this._deletableLayers.addLayer(r),r.fire("revert-deleted",{layer:r})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer(function(r){this._removeLayer({layer:r})},this),this.save()},_enableLayerDelete:function(r){(r.layer||r.target||r).on("click",this._removeLayer,this)},_disableLayerDelete:function(r){var i=r.layer||r.target||r;i.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(i)},_removeLayer:function(r){var i=r.layer||r.target||r;this._deletableLayers.removeLayer(i),this._deletedLayers.addLayer(i),i.fire("deleted")},_onMouseMove:function(r){this._tooltip.updatePosition(r.latlng)},_hasAvailableLayers:function(){return this._deletableLayers.getLayers().length!==0}})})(window,document);var nM=63710088e-1;function Jie(n,e){var t,s,r,i,a,o,l,c,h,p,m=0,v=n.type==="FeatureCollection",_=n.type==="Feature",w=v?n.features.length:1;for(t=0;t<w;t++){for(o=v?n.features[t].geometry:_?n.geometry:n,c=v?n.features[t].properties:_?n.properties:{},h=v?n.features[t].bbox:_?n.bbox:void 0,p=v?n.features[t].id:_?n.id:void 0,l=o?o.type==="GeometryCollection":!1,a=l?o.geometries.length:1,r=0;r<a;r++){if(i=l?o.geometries[r]:o,i===null){if(e(null,m,c,h,p)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,m,c,h,p)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<i.geometries.length;s++)if(e(i.geometries[s],m,c,h,p)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}m++}}function eae(n,e,t){var s=t;return Jie(n,function(r,i,a,o,l){i===0&&t===void 0?s=r:s=e(s,r,i,a,o,l)}),s}function tae(n){return eae(n,(e,t)=>e+nae(t),0)}function nae(n){let e=0,t;switch(n.type){case"Polygon":return sM(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=sM(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function sM(n){let e=0;if(n&&n.length>0){e+=Math.abs(rM(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(rM(n[t]))}return e}var sae=nM*nM/2,KE=Math.PI/180;function rM(n){const e=n.length-1;if(e<=2)return 0;let t=0,s=0;for(;s<e;){const r=n[s],i=n[s+1===e?0:s+1],a=n[s+2>=e?(s+2)%e:s+2],o=r[0]*KE,l=i[1]*KE,c=a[0]*KE;t+=(c-o)*Math.sin(l),s++}return t*sae}var rae="2.0.3",iae=[].slice,aae={};function nI(n){if(!(n>=1))throw new Error;this._size=n,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}nI.prototype=kB.prototype={constructor:nI,defer:function(n){if(typeof n!="function"||this._call)throw new Error;if(this._error!=null)return this;var e=iae.call(arguments,1);return e.push(n),++this._waiting,this._tasks.push(e),CB(this),this},abort:function(){return this._error==null&&Nk(this,new Error("abort")),this},await:function(n){if(typeof n!="function"||this._call)throw new Error;return this._call=function(e,t){n.apply(null,[e].concat(t))},O0(this),this},awaitAll:function(n){if(typeof n!="function"||this._call)throw new Error;return this._call=n,O0(this),this}};function CB(n){if(!n._start)try{oae(n)}catch(e){n._tasks[n._ended+n._active-1]&&Nk(n,e)}}function oae(n){for(;n._start=n._waiting&&n._active<n._size;){var e=n._ended+n._active,t=n._tasks[e],s=t.length-1,r=t[s];t[s]=lae(n,e),--n._waiting,++n._active,t=r.apply(null,t),n._tasks[e]&&(n._tasks[e]=t||aae)}}function lae(n,e){return function(t,s){n._tasks[e]&&(--n._active,++n._ended,n._tasks[e]=null,n._error==null&&(t!=null?Nk(n,t):(n._data[e]=s,n._waiting?CB(n):O0(n))))}}function Nk(n,e){var t=n._tasks.length,s;for(n._error=e,n._data=void 0,n._waiting=NaN;--t>=0;)if((s=n._tasks[t])&&(n._tasks[t]=null,s.abort))try{s.abort()}catch{}n._active=NaN,O0(n)}function O0(n){!n._active&&n._call&&n._call(n._error,n._data)}function kB(n){return new nI(arguments.length?+n:1/0)}const cae=Object.freeze(Object.defineProperty({__proto__:null,queue:kB,version:rae},Symbol.toStringTag,{value:"Module"})),uae=yF(cae);var XE,iM;function hae(){if(iM)return XE;iM=1;var n=uae.queue,e=+new Date;return XE=function(s,r){var i=!!L.mapbox,a=s.getSize(),o=new n(1),l=document.createElement("canvas");l.width=a.x,l.height=a.y;var c=l.getContext("2d"),h=document.createElement("canvas");h.width=1,h.height=1;var p=h.getContext("2d");if(p.fillStyle="rgba(0,0,0,0)",p.fillRect(0,0,1,1),s.eachLayer(v),s.eachLayer(w),s._pathRoot)o.defer(A,s._pathRoot);else if(s._panes){var m=s._panes.overlayPane.getElementsByTagName("canvas").item(0);m&&o.defer(A,m)}s.eachLayer(_),o.awaitAll(E);function v(P){P instanceof L.TileLayer?o.defer(C,P):P._heat&&o.defer(A,P._canvas)}function _(P){P instanceof L.Marker&&P.options.icon instanceof L.Icon&&o.defer(D,P)}function w(P){L.esri&&P instanceof L.esri.DynamicMapLayer&&o.defer(F,P)}function T(){r(null,l)}function E(P,O){if(P)throw P;O.forEach(function(M){M&&M.canvas&&c.drawImage(M.canvas,0,0)}),T()}function C(P,O){var M=L.TileLayer.Canvas&&P instanceof L.TileLayer.Canvas,k=document.createElement("canvas");k.width=a.x,k.height=a.y;var V=k.getContext("2d"),G=s.getPixelBounds(),ae=s.getZoom(),J=P.options.tileSize;if(ae>P.options.maxZoom||ae<P.options.minZoom||i&&P instanceof L.mapbox.tileLayer&&!P.options.tiles)return O();var X=L.bounds(G.min.divideBy(J)._floor(),G.max.divideBy(J)._floor()),se=[],ne,le,K=new n(1);for(ne=X.min.y;ne<=X.max.y;ne++)for(le=X.min.x;le<=X.max.x;le++)se.push(new L.Point(le,ne));se.forEach(function(Te){var Ie=Te.clone();P._adjustTilePoint&&P._adjustTilePoint(Te);var He=Ie.scaleBy(new L.Point(J,J)).subtract(G.min);if(Te.y>=0)if(M){var qe=P._tiles[Te.x+":"+Te.y];K.defer(ie,qe,He,J)}else{var Qe=W(P.getTileUrl(Te));K.defer(de,Qe,He,J)}}),K.awaitAll(ce);function ie(Te,Ie,He,qe){qe(null,{img:Te,pos:Ie,size:He})}function de(Te,Ie,He,qe){var Qe=new Image;Qe.crossOrigin="",Qe.onload=function(){qe(null,{img:this,pos:Ie,size:He})},Qe.onerror=function(ut){P.options.errorTileUrl!=""&&ut.target.errorCheck===void 0?(ut.target.errorCheck=!0,ut.target.src=P.options.errorTileUrl):qe(null,{img:h,pos:Ie,size:He})},Qe.src=Te}function ce(Te,Ie){Ie.forEach(Se),O(null,{canvas:k})}function Se(Te){V.drawImage(Te.img,Math.floor(Te.pos.x),Math.floor(Te.pos.y),Te.size,Te.size)}}function A(P,O){var M=s.getPixelBounds(),k=s.getPixelOrigin(),V=document.createElement("canvas");V.width=a.x,V.height=a.y;var G=V.getContext("2d"),ae=L.DomUtil.getPosition(P).subtract(M.min).add(k);try{G.drawImage(P,ae.x,ae.y,V.width-ae.x*2,V.height-ae.y*2),O(null,{canvas:V})}catch{console.error("Element could not be drawn on canvas",P)}}function D(P,O){var M=document.createElement("canvas"),k=M.getContext("2d"),V=s.getPixelBounds(),G=new L.Point(V.min.x,V.min.y),ae=s.project(P.getLatLng()),J=/^data\:/.test(P._icon.src),X=J?P._icon.src:W(P._icon.src),se=new Image,ne=P.options.icon.options,le=ne.iconSize,K=ae.subtract(G),ie=L.point(ne.iconAnchor||le&&le.divideBy(2,!0));le instanceof L.Point&&(le=[le.x,le.y]);var de=Math.round(K.x-le[0]+ie.x),ce=Math.round(K.y-ie.y);M.width=a.x,M.height=a.y,se.crossOrigin="",se.onload=function(){k.drawImage(this,de,ce,le[0],le[1]),O(null,{canvas:M})},se.src=X,J&&se.onload()}function F(P,O){var M=document.createElement("canvas");M.width=a.x,M.height=a.y;var k=M.getContext("2d"),V=new Image;V.crossOrigin="",V.src=W(P._currentImage._image.src),V.onload=function(){k.drawImage(V,0,0),O(null,{canvas:M})}}function W(P){return B(P)||P.indexOf("mapbox.com/styles/v1")!==-1?P:P+(P.match(/\?/)?"&":"?")+"cache="+e}function B(P){var O=/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;return!!P.match(O)}},XE}var dae=hae();const fae=E1(dae),pae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",mae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";bl.Icon.Default.mergeOptions({iconUrl:pae,shadowUrl:mae});function gae({onDataCapture:n}){const e=ve.useRef(null),t=ve.useRef(null),s=ve.useRef(null),r=ve.useRef(null),i=ve.useRef(null),a=ve.useRef(null),[o,l]=ve.useState(null),[c,h]=ve.useState(null),[p,m]=ve.useState(null),[v,_]=ve.useState(null),[w,T]=ve.useState(null);ve.useEffect(()=>{n&&n({gpsCoords:o,capturedImg:c,satImg:v,measuredArea:w})},[o,c,v,w]),ve.useEffect(()=>{if(e.current)return;const B="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",P=bl.map(t.current,{zoomControl:!0}).setView([20,0],2);bl.tileLayer(B,{maxZoom:19,attribution:"Tiles © Esri"}).addTo(P);const O=new bl.FeatureGroup().addTo(P);s.current=O;const M=new bl.Control.Draw({edit:{featureGroup:O},draw:{polygon:!0,rectangle:!0,circle:!0,marker:!1,polyline:!1}});P.addControl(M),P.on(bl.Draw.Event.CREATED,k=>{const V=k.layer;O.addLayer(V),F(V)}),e.current={map:P}},[]);async function E(){try{const B=await navigator.mediaDevices.getUserMedia({video:!0});r.current.srcObject=B}catch(B){alert("Camera access denied: "+B.message)}}function C(){if(!r.current)return;const B=i.current,P=B.getContext("2d");B.width=r.current.videoWidth,B.height=r.current.videoHeight,P.drawImage(r.current,0,0),navigator.geolocation&&navigator.geolocation.getCurrentPosition(O=>{const M=O.coords.latitude,k=O.coords.longitude;l({lat:M,lon:k}),P.fillStyle="red",P.font="24px Arial",P.fillText(`Lat: ${M.toFixed(6)}, Lon: ${k.toFixed(6)}`,20,40),h(B.toDataURL("image/png"));const{map:V}=e.current;V.setView([M,k],18),bl.marker([M,k]).addTo(V).bindPopup("Photo GPS point").openPopup()},()=>h(B.toDataURL("image/png")))}function A(B){const P=B.target.files[0];if(!P)return;const O=new FileReader;O.onload=M=>m(M.target.result),O.readAsDataURL(P)}function D(){const{map:B}=e.current;fae(B,(P,O)=>{if(P)return alert("Map capture failed: "+P.message);const M=[];if(s.current.eachLayer(G=>{if(G instanceof bl.Polygon||G instanceof bl.Rectangle){const ae=G.getLatLngs()[0];M.push(ae.map(J=>B.latLngToContainerPoint(J)))}}),M.length===0)return _(O.toDataURL("image/png"));const k=document.createElement("canvas");k.width=O.width,k.height=O.height;const V=k.getContext("2d");V.drawImage(O,0,0),V.globalCompositeOperation="destination-in",V.beginPath(),M.forEach(G=>{V.moveTo(G[0].x,G[0].y),G.forEach(ae=>V.lineTo(ae.x,ae.y)),V.closePath()}),V.fill(),_(k.toDataURL("image/png"))})}function F(B){const P=B.toGeoJSON();let O=0;P.geometry.type==="Polygon"?O=tae(P):B instanceof bl.Circle&&(O=Math.PI*B.getRadius()**2),T(O)}function W(B){return B?B>=1e6?(B/1e6).toFixed(4)+" km²":B>=1e4?(B/1e4).toFixed(2)+" ha":Math.round(B)+" m²":"-"}return y.jsxs("div",{className:"verifier-root",children:[y.jsx("header",{children:y.jsx("h1",{children:"📷 Map & Photo Capture"})}),y.jsxs("main",{className:"verifier-main",children:[y.jsxs("section",{className:"verifier-section",children:[y.jsx("h3",{children:"Camera Capture"}),y.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,className:"verifier-video"}),y.jsx("canvas",{ref:i,className:"hidden-canvas"}),y.jsxs("div",{className:"verifier-buttons",children:[y.jsx("button",{type:"button",onClick:E,children:"Start Camera"}),y.jsx("button",{type:"button",onClick:C,children:"Capture Photo"})]}),c&&y.jsxs("div",{children:[y.jsx("h4",{children:"Captured Image with Location:"}),y.jsx("img",{ref:a,src:c,alt:"Captured",className:"verifier-img"})]}),y.jsx("h3",{children:"Upload Image"}),y.jsx("input",{type:"file",accept:"image/*",onChange:A}),p&&y.jsx("img",{src:p,alt:"Uploaded",className:"verifier-img"}),y.jsx("h3",{children:"Satellite Map Capture"}),y.jsx("button",{type:"button",onClick:D,children:"Capture Map View"}),v&&y.jsx("img",{src:v,alt:"Satellite",className:"verifier-img"}),y.jsxs("h4",{children:["Measured Area: ",W(w)]})]}),y.jsxs("section",{className:"verifier-map-section",children:[y.jsx("h3",{children:"Map"}),y.jsx("div",{ref:t,className:"verifier-map"})]})]})]})}function yae(){const[n,e]=ve.useState({projectName:"",projectType:"",location:"",area:"",description:"",expectedCredits:"",timeline:"",methodology:"",coordinates:"",documents:null,capturedPhoto:null,satImage:null}),t=a=>{const{name:o,value:l}=a.target;e(c=>({...c,[o]:l}))},s=a=>{const o=a.target.files;e(l=>({...l,documents:o}))},r=a=>{e(o=>({...o,coordinates:a.gpsCoords?`${a.gpsCoords.lat}, ${a.gpsCoords.lon}`:o.coordinates,capturedPhoto:a.capturedImg||o.capturedPhoto,satImage:a.satImg||o.satImage,area:a.measuredArea?(a.measuredArea/1e4).toFixed(2):o.area}))},i=async a=>{a.preventDefault();try{const o=Dh.currentUser;if(!o){alert("You must be logged in to submit a project.");return}let l=[];if(n.documents)for(let p=0;p<n.documents.length;p++){const m=n.documents[p],v=e0(qE,`projects/${o.uid}/${Date.now()}_${m.name}`);await Qx(v,m),l.push(await Jx(v))}let c=null;if(n.capturedPhoto){const p=await fetch(n.capturedPhoto).then(v=>v.blob()),m=e0(qE,`projects/${o.uid}/photo_${Date.now()}.png`);await Qx(m,p),c=await Jx(m)}let h=null;if(n.satImage){const p=await fetch(n.satImage).then(v=>v.blob()),m=e0(qE,`projects/${o.uid}/satellite_${Date.now()}.png`);await Qx(m,p),h=await Jx(m)}await lB(Rh(jr,"projects"),{...n,documents:l,capturedPhoto:c,satImage:h,userId:o.uid,status:"pending",createdAt:cB()}),alert("Project submitted successfully!"),e({projectName:"",projectType:"",location:"",area:"",description:"",expectedCredits:"",timeline:"",methodology:"",coordinates:"",documents:null,capturedPhoto:null,satImage:null})}catch(o){console.error("Error adding project: ",o),alert("Failed to submit project. Check console for details.")}};return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"🌱 Add New Project"}),y.jsx("p",{className:"page-subtitle",children:"Submit your blue carbon project for verification and credit generation"})]}),y.jsxs("form",{className:"project-form",onSubmit:i,children:[y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Project Information"}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"projectName",children:"Project Name *"}),y.jsx("input",{type:"text",id:"projectName",name:"projectName",value:n.projectName,onChange:t,required:!0,placeholder:"Enter project name"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"projectType",children:"Project Type *"}),y.jsxs("select",{id:"projectType",name:"projectType",value:n.projectType,onChange:t,required:!0,children:[y.jsx("option",{value:"",children:"Select project type"}),y.jsx("option",{value:"mangrove",children:"Mangrove Restoration"}),y.jsx("option",{value:"seagrass",children:"Seagrass Conservation"}),y.jsx("option",{value:"saltmarsh",children:"Salt Marsh Restoration"}),y.jsx("option",{value:"oyster",children:"Oyster Reef Restoration"}),y.jsx("option",{value:"kelp",children:"Kelp Forest Conservation"})]})]})]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"location",children:"Location *"}),y.jsx("input",{type:"text",id:"location",name:"location",value:n.location,onChange:t,required:!0,placeholder:"City, State, Country"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"area",children:"Project Area (hectares) *"}),y.jsx("input",{type:"number",id:"area",name:"area",value:n.area,onChange:t,required:!0,placeholder:"Enter area in hectares"})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"coordinates",children:"GPS Coordinates"}),y.jsx("input",{type:"text",id:"coordinates",name:"coordinates",value:n.coordinates,onChange:t,placeholder:"Latitude, Longitude"})]})]}),y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Project Details"}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"description",children:"Project Description *"}),y.jsx("textarea",{id:"description",name:"description",value:n.description,onChange:t,required:!0,placeholder:"Describe your project objectives, methods, and expected environmental impact...",rows:"4"})]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"expectedCredits",children:"Expected Carbon Credits"}),y.jsx("input",{type:"number",id:"expectedCredits",name:"expectedCredits",value:n.expectedCredits,onChange:t,placeholder:"Estimated credits per year"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"timeline",children:"Project Timeline *"}),y.jsxs("select",{id:"timeline",name:"timeline",value:n.timeline,onChange:t,required:!0,children:[y.jsx("option",{value:"",children:"Select timeline"}),y.jsx("option",{value:"1-year",children:"1 Year"}),y.jsx("option",{value:"2-years",children:"2 Years"}),y.jsx("option",{value:"3-years",children:"3 Years"}),y.jsx("option",{value:"5-years",children:"5 Years"}),y.jsx("option",{value:"10-years",children:"10+ Years"})]})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"methodology",children:"Methodology *"}),y.jsxs("select",{id:"methodology",name:"methodology",value:n.methodology,onChange:t,required:!0,children:[y.jsx("option",{value:"",children:"Select methodology"}),y.jsx("option",{value:"vcs",children:"Verified Carbon Standard (VCS)"}),y.jsx("option",{value:"gold-standard",children:"Gold Standard"}),y.jsx("option",{value:"plan-vivo",children:"Plan Vivo"}),y.jsx("option",{value:"climate-action",children:"Climate Action Reserve"})]})]})]}),y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Supporting Documents"}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"documents",children:"Upload Documents"}),y.jsx("input",{type:"file",id:"documents",name:"documents",multiple:!0,accept:".pdf,.doc,.docx,.jpg,.png",onChange:s,className:"file-input"}),y.jsx("small",{className:"form-help",children:"Upload project plans, environmental assessments, permits, etc."})]})]}),y.jsxs("div",{className:"form-section",children:[y.jsx("h3",{children:"Satellite & AI Verification"}),y.jsx(gae,{onDataCapture:r})]}),y.jsx("div",{className:"form-section",children:y.jsx("button",{type:"submit",className:"submit-button",children:"Submit Project"})})]})]})}function vae(){const[n,e]=ve.useState([]),[t,s]=ve.useState(null),[r,i]=ve.useState({carbonSequestered:"",biomassGrowth:"",areaMonitored:"",monitoringDate:"",methodology:"",verificationStatus:"pending",notes:""});ve.useEffect(()=>{(async()=>{try{const _=Dh.currentUser;if(!_)return;const w=Rh(jr,"projects"),T=Qp(w,Jp("userId","==",_.uid)),C=(await Dc(T)).docs.map(A=>({id:A.id,...A.data()}));e(C)}catch(_){console.error("Error fetching projects:",_)}})()},[]);const a=v=>{const{name:_,value:w}=v.target;i(T=>({...T,[_]:w}))},o=v=>{if(v.preventDefault(),!t){alert("Please select a project first");return}const _=JSON.parse(localStorage.getItem("mrvReports")||"[]"),w={...r,id:Date.now(),projectId:t.id,projectName:t.projectName,submittedAt:new Date().toISOString()};_.push(w),localStorage.setItem("mrvReports",JSON.stringify(_)),alert("MRV Report submitted successfully!"),i({carbonSequestered:"",biomassGrowth:"",areaMonitored:"",monitoringDate:"",methodology:"",verificationStatus:"pending",notes:""}),s(null)},l=()=>JSON.parse(localStorage.getItem("mrvReports")||"[]"),c=()=>n.reduce((v,_)=>v+(_.creditsGenerated||0),0),h=()=>{const v={};return n.forEach(_=>{_.creditsGenerated&&(v[_.projectName]=_.creditsGenerated)}),v},p=()=>{const v=l();return n.map(_=>{const w=v.filter(E=>E.projectId===_.id),T=w[w.length-1];return{..._,totalCredits:_.creditsGenerated||0,reportsCount:w.length,lastReportDate:T?T.submittedAt:null,verificationStatus:T?T.verificationStatus:_.status||"no-reports"}})},m=()=>[{month:"Jan",price:45},{month:"Feb",price:48},{month:"Mar",price:52},{month:"Apr",price:49},{month:"May",price:55},{month:"Jun",price:58}];return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"📊 MRV Dashboard"}),y.jsx("p",{className:"page-subtitle",children:"Monitor, Report, and Verify your blue carbon projects"})]}),y.jsxs("div",{className:"mrv-content",children:[y.jsxs("div",{className:"dashboard-overview",children:[y.jsxs("div",{className:"mrv-section carbon-credits-section",children:[y.jsx("h3",{children:"💰 Generated Carbon Credits"}),y.jsxs("div",{className:"credits-summary",children:[y.jsxs("div",{className:"total-credits",children:[y.jsx("h4",{children:"Total Credits Generated"}),y.jsxs("span",{className:"credits-number",children:[c().toFixed(2)," tCO2"]})]}),y.jsxs("div",{className:"credits-by-project",children:[y.jsx("h4",{children:"Credits by Project"}),Object.entries(h()).map(([v,_])=>y.jsxs("div",{className:"project-credits",children:[y.jsx("span",{className:"project-name",children:v}),y.jsxs("span",{className:"credits-amount",children:[_.toFixed(2)," tCO2"]})]},v)),Object.keys(h()).length===0&&y.jsx("p",{className:"no-credits",children:"No carbon credits generated yet. Submit MRV reports to track credits."})]})]})]}),y.jsxs("div",{className:"mrv-section price-graph-section",children:[y.jsx("h3",{children:"📈 Carbon Credit Price Trends"}),y.jsxs("div",{className:"price-graph",children:[y.jsxs("div",{className:"current-price",children:[y.jsx("span",{className:"price-label",children:"Current Price"}),y.jsx("span",{className:"price-value",children:"$58.00 per tCO2"}),y.jsx("span",{className:"price-change positive",children:"+5.5% ↗"})]}),y.jsx("div",{className:"price-chart",children:m().map((v,_)=>y.jsxs("div",{className:"price-bar",children:[y.jsx("div",{className:"bar",style:{height:`${v.price/60*100}%`}}),y.jsx("span",{className:"month-label",children:v.month}),y.jsxs("span",{className:"price-label",children:["$",v.price]})]},v.month))})]})]})]}),y.jsxs("div",{className:"mrv-section projects-status-section",children:[y.jsx("h3",{children:"🌱 My Projects Status"}),y.jsxs("div",{className:"projects-status-grid",children:[p().map(v=>y.jsxs("div",{className:"project-status-card",children:[y.jsxs("div",{className:"project-header",children:[y.jsx("h4",{children:v.projectName}),y.jsx("span",{className:`status-badge ${v.verificationStatus}`,children:v.verificationStatus==="no-reports"?"No Reports":v.verificationStatus})]}),y.jsxs("div",{className:"project-stats",children:[y.jsxs("div",{className:"stat",children:[y.jsx("span",{className:"stat-label",children:"Total Credits"}),y.jsxs("span",{className:"stat-value",children:[v.totalCredits.toFixed(2)," tCO2"]})]}),y.jsxs("div",{className:"stat",children:[y.jsx("span",{className:"stat-label",children:"Reports Submitted"}),y.jsx("span",{className:"stat-value",children:v.reportsCount})]}),y.jsxs("div",{className:"stat",children:[y.jsx("span",{className:"stat-label",children:"Last Report"}),y.jsx("span",{className:"stat-value",children:v.lastReportDate?new Date(v.lastReportDate).toLocaleDateString():"Never"})]}),y.jsxs("div",{className:"stat",children:[y.jsx("span",{className:"stat-label",children:"Project Area"}),y.jsxs("span",{className:"stat-value",children:[v.area," hectares"]})]}),v.creditsGenerated>0&&y.jsxs("div",{className:"stat",children:[y.jsx("span",{className:"stat-label",children:"Blockchain Tx"}),y.jsxs("span",{className:"stat-value tx-id",children:[v.blockchainTx.substring(0,10),"..."]})]})]})]},v.id)),n.length===0&&y.jsx("div",{className:"no-projects-status",children:y.jsxs("p",{children:["No projects found. ",y.jsx(ft,{to:"/add-project",children:"Add your first project"})]})})]})]}),y.jsxs("div",{className:"mrv-section",children:[y.jsx("h3",{children:"Select Project for Monitoring"}),y.jsx("div",{className:"project-grid",children:n.length>0?n.map(v=>y.jsxs("div",{className:`project-card ${t?.id===v.id?"selected":""}`,onClick:()=>s(v),children:[y.jsx("h4",{children:v.projectName}),y.jsxs("p",{children:[y.jsx("strong",{children:"Type:"})," ",v.projectType]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Location:"})," ",v.location]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Area:"})," ",v.area," hectares"]}),y.jsx("span",{className:`status-badge ${v.status}`,children:v.status})]},v.id)):y.jsx("div",{className:"no-projects",children:y.jsxs("p",{children:["No projects found. ",y.jsx(ft,{to:"/add-project",children:"Add your first project"})]})})})]}),t&&y.jsxs("div",{className:"mrv-section",children:[y.jsxs("h3",{children:["Submit MRV Report for: ",t.projectName]}),y.jsxs("form",{className:"mrv-form",onSubmit:o,children:[y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"carbonSequestered",children:"Carbon Sequestered (tCO2) *"}),y.jsx("input",{type:"number",id:"carbonSequestered",name:"carbonSequestered",value:r.carbonSequestered,onChange:a,required:!0,placeholder:"Enter carbon sequestered"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"biomassGrowth",children:"Biomass Growth (%) *"}),y.jsx("input",{type:"number",id:"biomassGrowth",name:"biomassGrowth",value:r.biomassGrowth,onChange:a,required:!0,placeholder:"Enter biomass growth percentage"})]})]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"areaMonitored",children:"Area Monitored (hectares) *"}),y.jsx("input",{type:"number",id:"areaMonitored",name:"areaMonitored",value:r.areaMonitored,onChange:a,required:!0,placeholder:"Enter monitored area"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"monitoringDate",children:"Monitoring Date *"}),y.jsx("input",{type:"date",id:"monitoringDate",name:"monitoringDate",value:r.monitoringDate,onChange:a,required:!0})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"methodology",children:"Verification Methodology *"}),y.jsxs("select",{id:"methodology",name:"methodology",value:r.methodology,onChange:a,required:!0,children:[y.jsx("option",{value:"",children:"Select methodology"}),y.jsx("option",{value:"remote-sensing",children:"Remote Sensing"}),y.jsx("option",{value:"field-sampling",children:"Field Sampling"}),y.jsx("option",{value:"drone-survey",children:"Drone Survey"}),y.jsx("option",{value:"satellite-imagery",children:"Satellite Imagery"}),y.jsx("option",{value:"combined",children:"Combined Methods"})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"notes",children:"Additional Notes"}),y.jsx("textarea",{id:"notes",name:"notes",value:r.notes,onChange:a,placeholder:"Add any additional observations or notes...",rows:"3"})]}),y.jsx("button",{type:"submit",className:"btn-primary",children:"Submit MRV Report"})]})]}),y.jsxs("div",{className:"mrv-section",children:[y.jsx("h3",{children:"Recent MRV Reports"}),y.jsxs("div",{className:"reports-list",children:[l().slice(-5).map(v=>y.jsxs("div",{className:"report-item",children:[y.jsxs("div",{className:"report-header",children:[y.jsx("h4",{children:v.projectName}),y.jsx("span",{className:`status-badge ${v.verificationStatus}`,children:v.verificationStatus})]}),y.jsxs("div",{className:"report-details",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"Carbon Sequestered:"})," ",v.carbonSequestered," tCO2"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Monitoring Date:"})," ",new Date(v.monitoringDate).toLocaleDateString()]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Methodology:"})," ",v.methodology]})]})]},v.id)),l().length===0&&y.jsx("p",{className:"no-reports",children:"No MRV reports submitted yet."})]})]})]})]})}function bae(){const[n,e]=ve.useState([]),[t,s]=ve.useState([]),[r,i]=ve.useState([]),[a,o]=ve.useState("");ve.useEffect(()=>{const _=PC(Dh,async w=>{if(w)try{const T=Rh(jr,"projects"),E=Qp(T,Jp("userId","==",w.uid)),A=(await Dc(E)).docs.map(D=>({id:D.id,...D.data()}));setProjects(A)}catch(T){console.error("Error fetching projects:",T)}else setProjects([])});return()=>_()},[]),ve.useEffect(()=>{l();const _=JSON.parse(localStorage.getItem("purchaseHistory")||"[]");s(_)},[]);const l=()=>{const _=JSON.parse(localStorage.getItem("mrvReports")||"[]"),w=JSON.parse(localStorage.getItem("userProjects")||"[]"),T={};_.forEach(C=>{if(C.verificationStatus==="verified"){if(!T[C.projectId]){const A=w.find(D=>D.id===C.projectId);T[C.projectId]={projectId:C.projectId,projectName:C.projectName,projectType:A?.projectType||"Unknown",location:A?.location||"Unknown",totalCredits:0,availableCredits:0,pricePerCredit:58,reports:[]}}T[C.projectId].totalCredits+=parseFloat(C.carbonSequestered||0),T[C.projectId].availableCredits+=parseFloat(C.carbonSequestered||0),T[C.projectId].reports.push(C)}}),JSON.parse(localStorage.getItem("purchaseHistory")||"[]").forEach(C=>{T[C.projectId]&&(T[C.projectId].availableCredits-=C.amount)}),e(Object.values(T).filter(C=>C.availableCredits>0))},c=(_,w)=>{const T=n.find(A=>A.projectId===_);if(!T||w>T.availableCredits){alert("Insufficient credits available for purchase");return}const E={id:Date.now(),projectId:_,projectName:T.projectName,amount:parseFloat(w),pricePerCredit:T.pricePerCredit,totalCost:parseFloat(w)*T.pricePerCredit,purchaseDate:new Date().toISOString(),status:"completed"},C=JSON.parse(localStorage.getItem("purchaseHistory")||"[]");C.push(E),localStorage.setItem("purchaseHistory",JSON.stringify(C)),s(C),l(),alert(`Successfully purchased ${w} tCO2 credits for $${E.totalCost.toFixed(2)}`)},h=()=>t.reduce((_,w)=>_+w.amount,0),p=()=>t.reduce((_,w)=>_+w.totalCost,0),m=()=>[{month:"Jan",price:45},{month:"Feb",price:48},{month:"Mar",price:52},{month:"Apr",price:49},{month:"May",price:55},{month:"Jun",price:58}],v=()=>{const _=n.reduce((T,E)=>T+E.availableCredits,0),w=n.length>0?n.reduce((T,E)=>T+E.pricePerCredit,0)/n.length:58;return{totalAvailableCredits:_,averagePrice:w,totalProjects:n.length,marketValue:_*w}};return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"🛒 Carbon Credit Holdings"}),y.jsx("p",{className:"page-subtitle",children:"Manage your verified carbon credits from blue carbon projects"})]}),y.jsxs("div",{className:"mrv-content",children:[y.jsxs("div",{className:"dashboard-overview",children:[y.jsxs("div",{className:"mrv-section carbon-credits-section",children:[y.jsx("h3",{children:"💰 My Carbon Credit Portfolio"}),y.jsxs("div",{className:"credits-summary",children:[y.jsxs("div",{className:"total-credits",children:[y.jsx("h4",{children:"Total Credits Purchased"}),y.jsxs("span",{className:"credits-number",children:[h().toFixed(2)," tCO2"]})]}),y.jsxs("div",{className:"credits-by-project",children:[y.jsx("h4",{children:"Total Investment"}),y.jsxs("div",{className:"investment-summary",children:[y.jsxs("span",{className:"investment-amount",children:["$",p().toFixed(2)]}),y.jsx("span",{className:"investment-label",children:"Total Spent"})]}),y.jsxs("div",{className:"recent-purchases",children:[y.jsx("h5",{children:"Recent Purchases"}),t.slice(-3).map(_=>y.jsxs("div",{className:"project-credits",children:[y.jsx("span",{className:"project-name",children:_.projectName}),y.jsxs("span",{className:"credits-amount",children:[_.amount.toFixed(2)," tCO2"]})]},_.id)),t.length===0&&y.jsx("p",{className:"no-credits",children:"No purchases yet. Browse available credits below."})]})]})]})]}),y.jsxs("div",{className:"mrv-section price-graph-section",children:[y.jsx("h3",{children:"📈 Carbon Credit Price Trends"}),y.jsxs("div",{className:"price-graph",children:[y.jsxs("div",{className:"current-price",children:[y.jsx("span",{className:"price-label",children:"Current Price"}),y.jsx("span",{className:"price-value",children:"$58.00 per tCO2"}),y.jsx("span",{className:"price-change positive",children:"+5.5% ↗"})]}),y.jsx("div",{className:"price-chart",children:m().map((_,w)=>y.jsxs("div",{className:"price-bar",children:[y.jsx("div",{className:"bar",style:{height:`${_.price/60*100}%`}}),y.jsx("span",{className:"month-label",children:_.month}),y.jsxs("span",{className:"price-label",children:["$",_.price]})]},_.month))})]})]})]}),y.jsxs("div",{className:"mrv-section projects-status-section",children:[y.jsx("h3",{children:"📊 Market Overview"}),y.jsxs("div",{className:"market-stats-grid",children:[y.jsxs("div",{className:"market-stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🌍"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("span",{className:"stat-value",children:v().totalAvailableCredits.toFixed(0)}),y.jsx("span",{className:"stat-label",children:"Available Credits (tCO2)"})]})]}),y.jsxs("div",{className:"market-stat-card",children:[y.jsx("div",{className:"stat-icon",children:"💵"}),y.jsxs("div",{className:"stat-content",children:[y.jsxs("span",{className:"stat-value",children:["$",v().averagePrice.toFixed(2)]}),y.jsx("span",{className:"stat-label",children:"Average Price per tCO2"})]})]}),y.jsxs("div",{className:"market-stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🏗️"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("span",{className:"stat-value",children:v().totalProjects}),y.jsx("span",{className:"stat-label",children:"Active Projects"})]})]}),y.jsxs("div",{className:"market-stat-card",children:[y.jsx("div",{className:"stat-icon",children:"💰"}),y.jsxs("div",{className:"stat-content",children:[y.jsxs("span",{className:"stat-value",children:["$",v().marketValue.toFixed(0)]}),y.jsx("span",{className:"stat-label",children:"Total Market Value"})]})]})]})]}),y.jsxs("div",{className:"mrv-section",children:[y.jsx("h3",{children:"🛍️ Available Carbon Credits"}),y.jsx("div",{className:"credits-marketplace",children:n.length>0?n.map(_=>y.jsxs("div",{className:"credit-card",children:[y.jsxs("div",{className:"credit-header",children:[y.jsx("h4",{children:_.projectName}),y.jsx("span",{className:"project-type",children:_.projectType})]}),y.jsxs("div",{className:"credit-details",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"Location:"})," ",_.location]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Available Credits:"})," ",_.availableCredits.toFixed(2)," tCO2"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Price per Credit:"})," $",_.pricePerCredit]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Total Value:"})," $",(_.availableCredits*_.pricePerCredit).toFixed(2)]})]}),y.jsxs("div",{className:"purchase-section",children:[y.jsx("input",{type:"number",placeholder:"Amount to purchase",max:_.availableCredits,min:"0.1",step:"0.1",className:"purchase-input",id:`purchase-${_.projectId}`}),y.jsx("button",{className:"btn-primary purchase-btn",onClick:()=>{const w=document.getElementById(`purchase-${_.projectId}`).value;w&&parseFloat(w)>0?(c(_.projectId,parseFloat(w)),document.getElementById(`purchase-${_.projectId}`).value=""):alert("Please enter a valid amount")},children:"Purchase Credits"})]})]},_.projectId)):y.jsxs("div",{className:"no-credits-available",children:[y.jsx("p",{children:"No verified carbon credits available for purchase at the moment."}),y.jsx("p",{children:"Credits become available once farmer projects are verified."})]})})]}),y.jsxs("div",{className:"mrv-section",children:[y.jsx("h3",{children:"📋 Purchase History"}),y.jsx("div",{className:"purchase-history",children:t.length>0?y.jsxs("div",{className:"history-table",children:[y.jsxs("div",{className:"table-header",children:[y.jsx("span",{children:"Date"}),y.jsx("span",{children:"Project"}),y.jsx("span",{children:"Amount"}),y.jsx("span",{children:"Price"}),y.jsx("span",{children:"Total Cost"}),y.jsx("span",{children:"Status"})]}),t.slice().reverse().map(_=>y.jsxs("div",{className:"table-row",children:[y.jsx("span",{children:new Date(_.purchaseDate).toLocaleDateString()}),y.jsx("span",{children:_.projectName}),y.jsxs("span",{children:[_.amount.toFixed(2)," tCO2"]}),y.jsxs("span",{children:["$",_.pricePerCredit]}),y.jsxs("span",{children:["$",_.totalCost.toFixed(2)]}),y.jsx("span",{className:`status-badge ${_.status}`,children:_.status})]},_.id))]}):y.jsx("p",{className:"no-history",children:"No purchase history yet. Start buying carbon credits to see your transactions here."})})]})]})]})}function _ae(){const[n,e]=ve.useState([]),[t,s]=ve.useState([]),[r,i]=ve.useState(null),[a,o]=ve.useState({creditsToSell:"",pricePerCredit:"",description:"",availableFrom:"",expiryDate:""});ve.useEffect(()=>{const m=JSON.parse(localStorage.getItem("userProjects")||"[]"),v=JSON.parse(localStorage.getItem("marketListings")||"[]");e(m.filter(_=>_.status==="verified")),s(v)},[]);const l=m=>{const{name:v,value:_}=m.target;o(w=>({...w,[v]:_}))},c=m=>{if(m.preventDefault(),!r){alert("Please select a project first");return}const v={...a,id:Date.now(),projectId:r.id,projectName:r.projectName,projectType:r.projectType,location:r.location,sellerId:localStorage.getItem("userEmail"),status:"active",createdAt:new Date().toISOString()},_=JSON.parse(localStorage.getItem("marketListings")||"[]");_.push(v),localStorage.setItem("marketListings",JSON.stringify(_)),s(_),alert("Listing created successfully!"),o({creditsToSell:"",pricePerCredit:"",description:"",availableFrom:"",expiryDate:""}),i(null)},h=()=>{const m=localStorage.getItem("userEmail");return t.filter(v=>v.sellerId===m)},p=()=>{const m=localStorage.getItem("userEmail");return t.filter(v=>v.sellerId!==m&&v.status==="active")};return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"💰 Carbon Credit Marketplace"}),y.jsx("p",{className:"page-subtitle",children:"Sell your verified carbon credits and discover opportunities"})]}),y.jsxs("div",{className:"marketplace-content",children:[y.jsxs("div",{className:"marketplace-section",children:[y.jsx("h3",{children:"🏷️ Create New Listing"}),y.jsxs("div",{className:"project-selection",children:[y.jsx("h4",{children:"Select Verified Project"}),y.jsx("div",{className:"project-grid",children:n.length>0?n.map(m=>y.jsxs("div",{className:`project-card ${r?.id===m.id?"selected":""}`,onClick:()=>i(m),children:[y.jsx("h5",{children:m.projectName}),y.jsxs("p",{children:[y.jsx("strong",{children:"Type:"})," ",m.projectType]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Location:"})," ",m.location]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Expected Credits:"})," ",m.expectedCredits]}),y.jsx("span",{className:"status-badge verified",children:"Verified"})]},m.id)):y.jsx("div",{className:"no-projects",children:y.jsxs("p",{children:["No verified projects available. ",y.jsx(ft,{to:"/add-project",children:"Add a project"})," and complete verification first."]})})})]}),r&&y.jsxs("form",{className:"listing-form",onSubmit:c,children:[y.jsxs("h4",{children:["Create Listing for: ",r.projectName]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"creditsToSell",children:"Credits to Sell *"}),y.jsx("input",{type:"number",id:"creditsToSell",name:"creditsToSell",value:a.creditsToSell,onChange:l,required:!0,placeholder:"Number of credits",max:r.expectedCredits})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"pricePerCredit",children:"Price per Credit ($) *"}),y.jsx("input",{type:"number",id:"pricePerCredit",name:"pricePerCredit",value:a.pricePerCredit,onChange:l,required:!0,placeholder:"Price in USD",step:"0.01"})]})]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"availableFrom",children:"Available From *"}),y.jsx("input",{type:"date",id:"availableFrom",name:"availableFrom",value:a.availableFrom,onChange:l,required:!0})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"expiryDate",children:"Listing Expiry"}),y.jsx("input",{type:"date",id:"expiryDate",name:"expiryDate",value:a.expiryDate,onChange:l})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"description",children:"Description"}),y.jsx("textarea",{id:"description",name:"description",value:a.description,onChange:l,placeholder:"Describe your carbon credits, project benefits, and any additional information...",rows:"3"})]}),y.jsx("button",{type:"submit",className:"btn-primary",children:"Create Listing"})]})]}),y.jsxs("div",{className:"marketplace-section",children:[y.jsx("h3",{children:"📋 Your Active Listings"}),y.jsxs("div",{className:"listings-grid",children:[h().map(m=>y.jsxs("div",{className:"listing-card own-listing",children:[y.jsxs("div",{className:"listing-header",children:[y.jsx("h4",{children:m.projectName}),y.jsx("span",{className:`status-badge ${m.status}`,children:m.status})]}),y.jsxs("div",{className:"listing-details",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"Credits:"})," ",m.creditsToSell]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Price:"})," $",m.pricePerCredit,"/credit"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Total Value:"})," $",(m.creditsToSell*m.pricePerCredit).toFixed(2)]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Type:"})," ",m.projectType]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Location:"})," ",m.location]})]}),y.jsxs("div",{className:"listing-actions",children:[y.jsx("button",{className:"btn-secondary",children:"Edit"}),y.jsx("button",{className:"btn-danger",children:"Remove"})]})]},m.id)),h().length===0&&y.jsx("p",{className:"no-listings",children:"You haven't created any listings yet."})]})]}),y.jsxs("div",{className:"marketplace-section",children:[y.jsx("h3",{children:"🛒 Browse Available Credits"}),y.jsxs("div",{className:"listings-grid",children:[p().map(m=>y.jsxs("div",{className:"listing-card market-listing",children:[y.jsxs("div",{className:"listing-header",children:[y.jsx("h4",{children:m.projectName}),y.jsx("span",{className:"project-type",children:m.projectType})]}),y.jsxs("div",{className:"listing-details",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"Credits Available:"})," ",m.creditsToSell]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Price:"})," $",m.pricePerCredit,"/credit"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Location:"})," ",m.location]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Available From:"})," ",new Date(m.availableFrom).toLocaleDateString()]}),m.description&&y.jsxs("p",{children:[y.jsx("strong",{children:"Description:"})," ",m.description]})]}),y.jsxs("div",{className:"listing-actions",children:[y.jsx("button",{className:"btn-primary",children:"Contact Seller"}),y.jsx("button",{className:"btn-secondary",children:"View Details"})]})]},m.id)),p().length===0&&y.jsx("p",{className:"no-listings",children:"No credits available in the marketplace currently."})]})]}),y.jsxs("div",{className:"marketplace-section",children:[y.jsx("h3",{children:"📊 Market Statistics"}),y.jsxs("div",{className:"stats-grid",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:t.length}),y.jsx("div",{className:"stat-label",children:"Total Listings"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:t.reduce((m,v)=>m+parseInt(v.creditsToSell||0),0)}),y.jsx("div",{className:"stat-label",children:"Credits Available"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsxs("div",{className:"stat-number",children:["$",t.length>0?(t.reduce((m,v)=>m+parseFloat(v.pricePerCredit||0),0)/t.length).toFixed(2):"0.00"]}),y.jsx("div",{className:"stat-label",children:"Avg. Price/Credit"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:h().length}),y.jsx("div",{className:"stat-label",children:"Your Listings"})]})]})]})]})]})}function xae(){const[n,e]=ve.useState({name:"",email:"",subject:"",message:"",category:""}),t=r=>{const{name:i,value:a}=r.target;e(o=>({...o,[i]:a}))},s=r=>{r.preventDefault();const i=JSON.parse(localStorage.getItem("contactSubmissions")||"[]"),a={...n,id:Date.now(),submittedAt:new Date().toISOString()};i.push(a),localStorage.setItem("contactSubmissions",JSON.stringify(i)),alert("Thank you for your message! We will get back to you soon."),e({name:"",email:"",subject:"",message:"",category:""})};return y.jsxs("div",{className:"contact-container",children:[y.jsx(C1,{}),y.jsxs("div",{className:"contact-header",children:[y.jsx("h1",{className:"contact-title",children:"📞 Contact Us"}),y.jsx("p",{className:"contact-subtitle",children:"Get in touch with our team for support, partnerships, or general inquiries"})]}),y.jsxs("div",{className:"contact-content",children:[y.jsxs("div",{className:"contact-info-section",children:[y.jsx("h3",{children:"Get in Touch"}),y.jsxs("div",{className:"contact-methods",children:[y.jsxs("div",{className:"contact-method",children:[y.jsx("div",{className:"method-icon",children:"📧"}),y.jsxs("div",{className:"method-details",children:[y.jsx("h4",{children:"Email"}),y.jsx("p",{children:"contact@carbonlens.com"}),y.jsx("p",{children:"partnerships@carbonlens.com"})]})]}),y.jsxs("div",{className:"contact-method",children:[y.jsx("div",{className:"method-icon",children:"📱"}),y.jsxs("div",{className:"method-details",children:[y.jsx("h4",{children:"Phone"}),y.jsx("p",{children:"+91 9100899879"}),y.jsx("p",{children:"Mon-Sat, 9 AM - 6 PM EST"})]})]}),y.jsxs("div",{className:"contact-method",children:[y.jsx("div",{className:"method-icon",children:"📍"}),y.jsxs("div",{className:"method-details",children:[y.jsx("h4",{children:"Address"}),y.jsx("p",{children:"TPC"}),y.jsx("p",{children:"JORHAT ENGINEERING COLLEGE"})]})]})]})]}),y.jsxs("div",{className:"contact-form-section",children:[y.jsx("h3",{children:"Send us a Message"}),y.jsxs("form",{className:"contact-form",onSubmit:s,children:[y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"name",children:"Full Name *"}),y.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:t,required:!0,placeholder:"Enter your full name"})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"email",children:"Email Address *"}),y.jsx("input",{type:"email",id:"email",name:"email",value:n.email,onChange:t,required:!0,placeholder:"Enter your email"})]})]}),y.jsxs("div",{className:"form-row",children:[y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"category",children:"Category *"}),y.jsxs("select",{id:"category",name:"category",value:n.category,onChange:t,required:!0,children:[y.jsx("option",{value:"",children:"Select category"}),y.jsx("option",{value:"general",children:"General Inquiry"}),y.jsx("option",{value:"support",children:"Technical Support"}),y.jsx("option",{value:"partnership",children:"Partnership"}),y.jsx("option",{value:"verification",children:"Project Verification"}),y.jsx("option",{value:"billing",children:"Billing & Payments"}),y.jsx("option",{value:"feedback",children:"Feedback"})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"subject",children:"Subject *"}),y.jsx("input",{type:"text",id:"subject",name:"subject",value:n.subject,onChange:t,required:!0,placeholder:"Brief subject line"})]})]}),y.jsxs("div",{className:"form-group",children:[y.jsx("label",{htmlFor:"message",children:"Message *"}),y.jsx("textarea",{id:"message",name:"message",value:n.message,onChange:t,required:!0,placeholder:"Tell us how we can help you...",rows:"6"})]}),y.jsx("button",{type:"submit",className:"btn-primary",children:"Send Message"})]})]})]}),y.jsxs("div",{className:"faq-section",children:[y.jsx("h3",{children:"Frequently Asked Questions"}),y.jsxs("div",{className:"faq-grid",children:[y.jsxs("div",{className:"faq-item",children:[y.jsx("h4",{children:"How do I get my project verified?"}),y.jsx("p",{children:'Submit your project through the "Add Project" page with all required documentation. Our verification team will review within 5-7 business days.'})]}),y.jsxs("div",{className:"faq-item",children:[y.jsx("h4",{children:"What types of blue carbon projects are accepted?"}),y.jsx("p",{children:"We accept mangrove restoration, seagrass conservation, salt marsh restoration, oyster reef restoration, and kelp forest conservation projects."})]}),y.jsxs("div",{className:"faq-item",children:[y.jsx("h4",{children:"How are carbon credits priced?"}),y.jsx("p",{children:"Credit prices are set by project owners based on market conditions, project quality, and verification standards. Typical range is $20-50 per credit."})]}),y.jsxs("div",{className:"faq-item",children:[y.jsx("h4",{children:"What payment methods do you accept?"}),y.jsx("p",{children:"We accept major credit cards, bank transfers, and cryptocurrency payments for carbon credit transactions."})]})]})]})]})}function wae(){return y.jsxs("div",{className:"about-container",children:[y.jsx(C1,{}),y.jsxs("div",{className:"about-header",children:[y.jsx("h1",{className:"about-title",children:"🌊 About CarbonLens Platform"}),y.jsx("p",{className:"about-subtitle",children:"Protecting coastal ecosystems through transparent carbon credit trading"})]}),y.jsx("div",{className:"about-hero",children:y.jsxs("div",{className:"about-content",children:[y.jsx("h4",{children:"Revolutionizing Blue Carbon Conservation"}),y.jsx("p",{children:"Our platform connects coastal ecosystem protectors with carbon credit buyers, creating a transparent marketplace that drives real environmental impact while providing sustainable income for coastal communities."})]})}),y.jsxs("div",{className:"about-section",children:[y.jsx("h3",{children:"Our Mission"}),y.jsxs("div",{className:"mission-grid",children:[y.jsxs("div",{className:"mission-item",children:[y.jsx("div",{className:"mission-icon",children:"🌱"}),y.jsx("h4",{children:"Environmental Protection"}),y.jsx("p",{children:"Safeguard critical coastal ecosystems including mangroves, seagrass beds, and salt marshes that store vast amounts of carbon."})]}),y.jsxs("div",{className:"mission-item",children:[y.jsx("div",{className:"mission-icon",children:"🤝"}),y.jsx("h4",{children:"Community Empowerment"}),y.jsx("p",{children:"Provide sustainable income opportunities for coastal communities through verified carbon credit projects."})]}),y.jsxs("div",{className:"mission-item",children:[y.jsx("div",{className:"mission-icon",children:"🔗"}),y.jsx("h4",{children:"Transparent Trading"}),y.jsx("p",{children:"Create a trustworthy marketplace with blockchain-verified transactions and rigorous project monitoring."})]}),y.jsxs("div",{className:"mission-item",children:[y.jsx("div",{className:"mission-icon",children:"📊"}),y.jsx("h4",{children:"Scientific Rigor"}),y.jsx("p",{children:"Ensure all projects meet international standards through our comprehensive MRV (Monitor, Report, Verify) system."})]})]})]}),y.jsxs("div",{className:"about-section blue-carbon-section",children:[y.jsx("h3",{children:"What is Blue Carbon?"}),y.jsxs("div",{className:"blue-carbon-content",children:[y.jsxs("div",{className:"blue-carbon-text",children:[y.jsx("p",{children:"Blue carbon refers to the carbon captured and stored by coastal and marine ecosystems. These environments are among the most carbon-rich ecosystems on Earth, storing up to 10 times more carbon per hectare than terrestrial forests."}),y.jsxs("div",{className:"ecosystem-types",children:[y.jsx("h4",{children:"Key Blue Carbon Ecosystems:"}),y.jsxs("ul",{children:[y.jsxs("li",{children:[y.jsx("strong",{children:"Mangroves:"})," Tropical coastal forests that store carbon in both biomass and sediment"]}),y.jsxs("li",{children:[y.jsx("strong",{children:"Seagrass Beds:"})," Underwater meadows that sequester carbon in their roots and sediment"]}),y.jsxs("li",{children:[y.jsx("strong",{children:"Salt Marshes:"})," Coastal wetlands that capture carbon in plant matter and soil"]}),y.jsxs("li",{children:[y.jsx("strong",{children:"Kelp Forests:"})," Large marine algae that absorb CO2 from seawater"]})]})]})]}),y.jsxs("div",{className:"carbon-stats",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:"10x"}),y.jsx("div",{className:"stat-label",children:"More carbon storage than forests"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:"50%"}),y.jsx("div",{className:"stat-label",children:"Of ocean carbon sequestration"})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-number",children:"2-4x"}),y.jsx("div",{className:"stat-label",children:"Faster carbon capture rate"})]})]})]})]}),y.jsxs("div",{className:"about-section",children:[y.jsx("h3",{children:"How Our Platform Works"}),y.jsxs("div",{className:"process-steps",children:[y.jsxs("div",{className:"step",children:[y.jsx("div",{className:"step-number",children:"1"}),y.jsxs("div",{className:"step-content",children:[y.jsx("h4",{children:"Project Registration"}),y.jsx("p",{children:"Coastal communities and organizations register their blue carbon conservation projects with detailed documentation."})]})]}),y.jsxs("div",{className:"step",children:[y.jsx("div",{className:"step-number",children:"2"}),y.jsxs("div",{className:"step-content",children:[y.jsx("h4",{children:"Verification Process"}),y.jsx("p",{children:"Our expert team verifies projects using international standards and satellite monitoring technology."})]})]}),y.jsxs("div",{className:"step",children:[y.jsx("div",{className:"step-number",children:"3"}),y.jsxs("div",{className:"step-content",children:[y.jsx("h4",{children:"MRV Monitoring"}),y.jsx("p",{children:"Continuous monitoring, reporting, and verification ensure project integrity and carbon sequestration accuracy."})]})]}),y.jsxs("div",{className:"step",children:[y.jsx("div",{className:"step-number",children:"4"}),y.jsxs("div",{className:"step-content",children:[y.jsx("h4",{children:"Credit Trading"}),y.jsx("p",{children:"Verified carbon credits are listed on our marketplace for transparent, secure trading with buyers worldwide."})]})]})]})]}),y.jsxs("div",{className:"about-section",children:[y.jsx("h3",{children:"Our Team"}),y.jsxs("div",{className:"team-grid",children:[y.jsxs("div",{className:"team-member",children:[y.jsx("div",{className:"member-avatar",children:"👨‍💼"}),y.jsx("h4",{}),y.jsx("p",{className:"member-role"}),y.jsx("p",{})]}),y.jsxs("div",{className:"team-member",children:[y.jsx("div",{className:"member-avatar",children:"👩‍💻"}),y.jsx("h4",{}),y.jsx("p",{className:"member-role"}),y.jsx("p",{})]}),y.jsxs("div",{className:"team-member",children:[y.jsx("div",{className:"member-avatar",children:"👨‍🔬"}),y.jsx("h4",{}),y.jsx("p",{className:"member-role"}),y.jsx("p",{children:"."})]}),y.jsxs("div",{className:"team-member",children:[y.jsx("div",{className:"member-avatar",children:"👩‍🌾"}),y.jsx("h4",{}),y.jsx("p",{className:"member-role"}),y.jsx("p",{children:"."})]})]})]}),y.jsxs("div",{className:"about-section impact-section",children:[y.jsx("h3",{children:"Our Impact"}),y.jsxs("div",{className:"impact-stats",children:[y.jsxs("div",{className:"impact-stat",children:[y.jsx("div",{className:"impact-number",children:"5"}),y.jsx("div",{className:"impact-label",children:"Active Projects"})]}),y.jsxs("div",{className:"impact-stat",children:[y.jsx("div",{className:"impact-number",children:"19"}),y.jsx("div",{className:"impact-label",children:"Carbon Credits Traded"})]}),y.jsxs("div",{className:"impact-stat",children:[y.jsx("div",{className:"impact-number",children:"50,0"}),y.jsx("div",{className:"impact-label",children:"Hectares Protected"})]}),y.jsxs("div",{className:"impact-stat",children:[y.jsx("div",{className:"impact-number",children:"3"}),y.jsx("div",{className:"impact-label",children:"Communities Supported"})]})]})]}),y.jsxs("div",{className:"about-cta",children:[y.jsx("h3",{children:"Join the Blue Carbon Revolution"}),y.jsx("p",{children:"Whether you're a coastal community looking to protect your ecosystem or a business seeking to offset your carbon footprint, we're here to help."}),y.jsxs("div",{className:"cta-buttons",children:[y.jsx(ft,{to:"/signup",className:"btn-primary",children:"Get Started"}),y.jsx(ft,{to:"/contact",className:"btn-secondary",children:"Contact Us"})]})]})]})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tae=1e-7,Sae=1e-4;let Eae=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},$B=class{refCount(e){return xa("refCount")}incRef(e){return xa("incRef")}timerAvailable(){return!0}time(e){return xa("time")}read(e){return xa("read")}readSync(e){return xa("readSync")}readToGPU(e,t){return xa("readToGPU")}numDataIds(){return xa("numDataIds")}disposeData(e,t){return xa("disposeData")}write(e,t,s){return xa("write")}move(e,t,s,r,i){return xa("move")}memory(){return xa("memory")}floatPrecision(){return xa("floatPrecision")}epsilon(){return this.floatPrecision()===32?Tae:Sae}dispose(){return xa("dispose")}};function xa(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,P0(n,e,t)}function Nae(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,s=0;for(;t>0;)s=Math.random()*t|0,t--,P0(n,t,s),P0(e,t,s)}function Zy(n,e,t){return Math.max(n,Math.min(e,t))}function Iae(n){return n%2===0?n:n+1}function P0(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function Cae(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function kae(n,e){const t=Math.random();return e*t+(1-t)*n}function $ae(n,e){let t=0;for(let s=0;s<n.length;s++){const r=Number(n[s])-Number(e[s]);t+=r*r}return t}function re(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function vi(n,e,t=""){re(Kl(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function Gf(n){re(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function vf(n,e=[],t=!1){if(e==null&&(e=[]),Array.isArray(n)||Mr(n)&&!t)for(let s=0;s<n.length;++s)vf(n[s],e,t);else e.push(n);return e}function es(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Aae(n){return n.length===0}function Kl(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function _m(n){return n%1===0}function Rae(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function Dae(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Lae(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return AB(e),e}function Oy(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Oae(n,e=r=>0,t,s=setTimeout){return new Promise((r,i)=>{let a=0;const o=()=>{if(n()){r();return}a++;const l=e(a);if(t!=null&&a>=t){i();return}s(o,l)};o()})}function Pae(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Pv(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),re(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),re(n.every(s=>_m(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function RB(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:Pv(e,n).sort();let a=0;for(let o=0;o<n.length;++o){if(i!=null){if(i[a]===o&&n[o]!==1)throw new Error(`Can't squeeze axis ${o} since its dim '${n[o]}' is not 1`);(i[a]==null||i[a]>o)&&n[o]===1&&(t.push(n[o]),s.push(o)),i[a]<=o&&a++}n[o]!==1&&(t.push(n[o]),s.push(o))}return{newShape:t,keptDims:s}}function DB(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error(`Unknown data type ${n}`);return t}function LB(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function OB(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function PB(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Mae(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Mr(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}function sI(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function MB(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function uh(n){return typeof n=="string"||n instanceof String}function FB(n){return typeof n=="boolean"}function jB(n){return typeof n=="number"}function Q1(n){return Array.isArray(n)?Q1(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":jB(n)?"float32":uh(n)?"string":FB(n)?"bool":"float32"}function Lh(n){return!!(n&&n.constructor&&n.call&&n.apply)}function M0(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function qm(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function BB(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let a=0;a<i;a++)r[a]=t[n+a]}else{const i=e[0],a=e.slice(1),o=a.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<i;l++)r[l]=BB(n+l*o,a,t,s)}return r}function sf(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return BB(0,n,e,t)}function Ik(n,e){const t=J1(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function J1(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function Fae(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return sf(n,new Float32Array(t));if(e==="int32")return sf(n,new Int32Array(t));if(e==="bool")return sf(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Ck(n){n.forEach(e=>{re(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function jae(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Bae(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function bf(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aM="tfjsflags";let zB=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=zae,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Rt().getBool("IS_TEST")||Rt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];Rt().getBool("IS_TEST")||Rt().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(bf(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);aM in e&&e[aM].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=Uae(r,i)})}};function zae(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Vae(e,s[0],s[1]),s.join("="))),e}function Vae(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Uae(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${n}.`)}function Rt(){return kk}let kk=null;function Gae(n){kk=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ZE;function VB(){if(ZE==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");ZE=n}return ZE}function Wae(){const n=VB();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function $k(n,e){const t=Wae();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const UB="Abs",GB="Acos",WB="Acosh",Ak="Add",HB="AddN",qB="All",KB="Any",XB="ArgMax",ZB="ArgMin",YB="Asin",QB="Asinh",JB="Atan",ez="Atanh",tz="Atan2",nz="AvgPool",Hae="AvgPoolGrad",sz="AvgPool3D",qae="AvgPool3DGrad",rz="BatchMatMul",iz="BatchToSpaceND",az="Bincount",Kae="BroadcastTo",oz="BroadcastArgs",Rk="Cast",lz="Ceil",cz="ClipByValue",uz="Complex",hz="ComplexAbs",dz="Concat",fz="Conv2D",pz="Conv2DBackpropFilter",mz="Conv2DBackpropInput",gz="Conv3D",Xae="Conv3DBackpropFilterV2",yz="Conv3DBackpropInputV2",vz="Cos",bz="Cosh",_z="Cumprod",xz="Cumsum",wz="CropAndResize",Tz="DenseBincount",Sz="DepthToSpace",Ez="DepthwiseConv2dNative",Nz="DepthwiseConv2dNativeBackpropFilter",Iz="DepthwiseConv2dNativeBackpropInput",Cz="Diag",kz="Dilation2D",Zae="Dilation2DBackpropInput",Yae="Dilation2DBackpropFilter",$z="RealDiv",Az="Einsum",Rz="Elu",Qae="EluGrad",Dz="Erf",Lz="Equal",Oz="Exp",Pz="ExpandDims",Mz="Expm1",Fz="FFT",jz="Fill",Bz="FlipLeftRight",zz="Floor",Vz="FloorDiv",Uz="FusedBatchNorm",Gz="GatherV2",Wz="GatherNd",Hz="Greater",qz="GreaterEqual",Dk="Identity",Kz="IFFT",Xz="Imag",Zz="IsFinite",Yz="IsInf",Qz="IsNan",Jz="LeakyRelu",eV="Less",tV="LessEqual",nV="LinSpace",sV="Log",rV="Log1p",iV="LogicalAnd",aV="LogicalNot",oV="LogicalOr",Jae="LogicalXor",eoe="LogSoftmax",toe="LowerBound",lV="LRN",noe="LRNGrad",cV="Max",uV="Maximum",hV="MaxPool",soe="MaxPoolGrad",dV="MaxPool3D",roe="MaxPool3DGrad",fV="MaxPoolWithArgmax",pV="Mean",mV="Min",gV="Minimum",yV="MirrorPad",vV="Mod",bV="Multinomial",_V="Multiply",xV="Neg",wV="NotEqual",TV="NonMaxSuppressionV3",SV="NonMaxSuppressionV4",EV="NonMaxSuppressionV5",NV="OnesLike",IV="OneHot",CV="Pack",kV="PadV2",ioe="Pool",$V="Pow",AV="Prelu",RV="Prod",DV="RaggedGather",LV="RaggedTensorToTensor",OV="Range",PV="Real",MV="Reciprocal",FV="Relu",jV="Reshape",BV="ResizeNearestNeighbor",aoe="ResizeNearestNeighborGrad",zV="ResizeBilinear",ooe="ResizeBilinearGrad",VV="Relu6",UV="Reverse",GV="Round",WV="Rsqrt",HV="ScatterNd",qV="SearchSorted",KV="Select",XV="Selu",ZV="Slice",YV="Sin",QV="Sinh",JV="Sign",eU="Sigmoid",tU="Softplus",nU="Sqrt",sU="Sum",rU="SpaceToBatchND",iU="SplitV",aU="Softmax",oU="SparseFillEmptyRows",lU="SparseReshape",cU="SparseSegmentMean",uU="SparseSegmentSum",hU="SparseToDense",dU="SquaredDifference",loe="Square",fU="StridedSlice",pU="StringNGrams",mU="StringSplit",gU="StringToHashBucketFast",yU="Sub",vU="Tan",bU="Tanh",Lk="Tile",_U="TopK",xU="Transform",t0="Transpose",wU="Unique",TU="Unpack",SU="UnsortedSegmentSum",coe="UpperBound",EU="ZerosLike",NU="Step",rI="FromPixels",IU="RotateWithOffset",iI="_FusedMatMul",aI="FusedConv2D",oI="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lh(...n){Rt().getBool("IS_TEST")||Rt().getBool("PROD")||console.warn(...n)}function uoe(...n){Rt().getBool("IS_TEST")||Rt().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xm=$k("kernelRegistry",()=>new Map),Yy=$k("gradRegistry",()=>new Map);function F0(n,e){const t=Ok(n,e);return xm.get(t)}function lI(n){return Yy.get(n)}function j0(n){const e=xm.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,a]=r,[o]=i.split("_");o===n&&t.push(a)}return t}function CU(n){const{kernelName:e,backendName:t}=n,s=Ok(e,t);xm.has(s)&&lh(`The kernel '${e}' for backend '${t}' is already registered`),xm.set(s,n)}function hoe(n){const{kernelName:e}=n;Yy.has(e)&&Rt().getBool("DEBUG")&&lh(`Overriding the gradient for '${e}'`),Yy.set(e,n)}function doe(n,e){const t=Ok(n,e);if(!xm.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);xm.delete(t)}function foe(n){if(!Yy.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);Yy.delete(n)}function poe(n,e){j0(n).forEach(s=>{const r=Object.assign({},s,{backendName:e});CU(r)})}function Ok(n,e){return`${e}_${n}`}var YE,oM;function moe(){if(oM)return YE;oM=1,YE=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(M,k,V){this.low=M|0,this.high=k|0,this.unsigned=!!V}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(M){return(M&&M.__isLong__)===!0}e.isLong=t;var s={},r={};function i(M,k){var V,G,ae;return k?(M>>>=0,(ae=0<=M&&M<256)&&(G=r[M],G)?G:(V=o(M,(M|0)<0?-1:0,!0),ae&&(r[M]=V),V)):(M|=0,(ae=-128<=M&&M<128)&&(G=s[M],G)?G:(V=o(M,M<0?-1:0,!1),ae&&(s[M]=V),V))}e.fromInt=i;function a(M,k){if(isNaN(M))return k?C:E;if(k){if(M<0)return C;if(M>=_)return B}else{if(M<=-w)return P;if(M+1>=w)return W}return M<0?a(-M,k).neg():o(M%v|0,M/v|0,k)}e.fromNumber=a;function o(M,k,V){return new e(M,k,V)}e.fromBits=o;var l=Math.pow;function c(M,k,V){if(M.length===0)throw Error("empty string");if(M==="NaN"||M==="Infinity"||M==="+Infinity"||M==="-Infinity")return E;if(typeof k=="number"?(V=k,k=!1):k=!!k,V=V||10,V<2||36<V)throw RangeError("radix");var G;if((G=M.indexOf("-"))>0)throw Error("interior hyphen");if(G===0)return c(M.substring(1),k,V).neg();for(var ae=a(l(V,8)),J=E,X=0;X<M.length;X+=8){var se=Math.min(8,M.length-X),ne=parseInt(M.substring(X,X+se),V);if(se<8){var le=a(l(V,se));J=J.mul(le).add(a(ne))}else J=J.mul(ae),J=J.add(a(ne))}return J.unsigned=k,J}e.fromString=c;function h(M,k){return typeof M=="number"?a(M,k):typeof M=="string"?c(M,k):o(M.low,M.high,typeof k=="boolean"?k:M.unsigned)}e.fromValue=h;var p=65536,m=1<<24,v=p*p,_=v*v,w=_/2,T=i(m),E=i(0);e.ZERO=E;var C=i(0,!0);e.UZERO=C;var A=i(1);e.ONE=A;var D=i(1,!0);e.UONE=D;var F=i(-1);e.NEG_ONE=F;var W=o(-1,2147483647,!1);e.MAX_VALUE=W;var B=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=B;var P=o(0,-2147483648,!1);e.MIN_VALUE=P;var O=e.prototype;return O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*v+(this.low>>>0):this.high*v+(this.low>>>0)},O.toString=function(k){if(k=k||10,k<2||36<k)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(P)){var V=a(k),G=this.div(V),ae=G.mul(V).sub(this);return G.toString(k)+ae.toInt().toString(k)}else return"-"+this.neg().toString(k);for(var J=a(l(k,6),this.unsigned),X=this,se="";;){var ne=X.div(J),le=X.sub(ne.mul(J)).toInt()>>>0,K=le.toString(k);if(X=ne,X.isZero())return K+se;for(;K.length<6;)K="0"+K;se=""+K+se}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(P)?64:this.neg().getNumBitsAbs();for(var k=this.high!=0?this.high:this.low,V=31;V>0&&(k&1<<V)==0;V--);return this.high!=0?V+33:V+1},O.isZero=function(){return this.high===0&&this.low===0},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return(this.low&1)===1},O.isEven=function(){return(this.low&1)===0},O.equals=function(k){return t(k)||(k=h(k)),this.unsigned!==k.unsigned&&this.high>>>31===1&&k.high>>>31===1?!1:this.high===k.high&&this.low===k.low},O.eq=O.equals,O.notEquals=function(k){return!this.eq(k)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(k){return this.comp(k)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(k){return this.comp(k)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(k){return this.comp(k)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(k){return this.comp(k)>=0},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(k){if(t(k)||(k=h(k)),this.eq(k))return 0;var V=this.isNegative(),G=k.isNegative();return V&&!G?-1:!V&&G?1:this.unsigned?k.high>>>0>this.high>>>0||k.high===this.high&&k.low>>>0>this.low>>>0?-1:1:this.sub(k).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(P)?P:this.not().add(A)},O.neg=O.negate,O.add=function(k){t(k)||(k=h(k));var V=this.high>>>16,G=this.high&65535,ae=this.low>>>16,J=this.low&65535,X=k.high>>>16,se=k.high&65535,ne=k.low>>>16,le=k.low&65535,K=0,ie=0,de=0,ce=0;return ce+=J+le,de+=ce>>>16,ce&=65535,de+=ae+ne,ie+=de>>>16,de&=65535,ie+=G+se,K+=ie>>>16,ie&=65535,K+=V+X,K&=65535,o(de<<16|ce,K<<16|ie,this.unsigned)},O.subtract=function(k){return t(k)||(k=h(k)),this.add(k.neg())},O.sub=O.subtract,O.multiply=function(k){if(this.isZero())return E;if(t(k)||(k=h(k)),n){var V=n.mul(this.low,this.high,k.low,k.high);return o(V,n.get_high(),this.unsigned)}if(k.isZero())return E;if(this.eq(P))return k.isOdd()?P:E;if(k.eq(P))return this.isOdd()?P:E;if(this.isNegative())return k.isNegative()?this.neg().mul(k.neg()):this.neg().mul(k).neg();if(k.isNegative())return this.mul(k.neg()).neg();if(this.lt(T)&&k.lt(T))return a(this.toNumber()*k.toNumber(),this.unsigned);var G=this.high>>>16,ae=this.high&65535,J=this.low>>>16,X=this.low&65535,se=k.high>>>16,ne=k.high&65535,le=k.low>>>16,K=k.low&65535,ie=0,de=0,ce=0,Se=0;return Se+=X*K,ce+=Se>>>16,Se&=65535,ce+=J*K,de+=ce>>>16,ce&=65535,ce+=X*le,de+=ce>>>16,ce&=65535,de+=ae*K,ie+=de>>>16,de&=65535,de+=J*le,ie+=de>>>16,de&=65535,de+=X*ne,ie+=de>>>16,de&=65535,ie+=G*K+ae*le+J*ne+X*se,ie&=65535,o(ce<<16|Se,ie<<16|de,this.unsigned)},O.mul=O.multiply,O.divide=function(k){if(t(k)||(k=h(k)),k.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&k.low===-1&&k.high===-1)return this;var V=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,k.low,k.high);return o(V,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:E;var G,ae,J;if(this.unsigned){if(k.unsigned||(k=k.toUnsigned()),k.gt(this))return C;if(k.gt(this.shru(1)))return D;J=C}else{if(this.eq(P)){if(k.eq(A)||k.eq(F))return P;if(k.eq(P))return A;var X=this.shr(1);return G=X.div(k).shl(1),G.eq(E)?k.isNegative()?A:F:(ae=this.sub(k.mul(G)),J=G.add(ae.div(k)),J)}else if(k.eq(P))return this.unsigned?C:E;if(this.isNegative())return k.isNegative()?this.neg().div(k.neg()):this.neg().div(k).neg();if(k.isNegative())return this.div(k.neg()).neg();J=E}for(ae=this;ae.gte(k);){G=Math.max(1,Math.floor(ae.toNumber()/k.toNumber()));for(var se=Math.ceil(Math.log(G)/Math.LN2),ne=se<=48?1:l(2,se-48),le=a(G),K=le.mul(k);K.isNegative()||K.gt(ae);)G-=ne,le=a(G,this.unsigned),K=le.mul(k);le.isZero()&&(le=A),J=J.add(le),ae=ae.sub(K)}return J},O.div=O.divide,O.modulo=function(k){if(t(k)||(k=h(k)),n){var V=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,k.low,k.high);return o(V,n.get_high(),this.unsigned)}return this.sub(this.div(k).mul(k))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return o(~this.low,~this.high,this.unsigned)},O.and=function(k){return t(k)||(k=h(k)),o(this.low&k.low,this.high&k.high,this.unsigned)},O.or=function(k){return t(k)||(k=h(k)),o(this.low|k.low,this.high|k.high,this.unsigned)},O.xor=function(k){return t(k)||(k=h(k)),o(this.low^k.low,this.high^k.high,this.unsigned)},O.shiftLeft=function(k){return t(k)&&(k=k.toInt()),(k&=63)===0?this:k<32?o(this.low<<k,this.high<<k|this.low>>>32-k,this.unsigned):o(0,this.low<<k-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(k){return t(k)&&(k=k.toInt()),(k&=63)===0?this:k<32?o(this.low>>>k|this.high<<32-k,this.high>>k,this.unsigned):o(this.high>>k-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(k){if(t(k)&&(k=k.toInt()),k&=63,k===0)return this;var V=this.high;if(k<32){var G=this.low;return o(G>>>k|V<<32-k,V>>>k,this.unsigned)}else return k===32?o(V,0,this.unsigned):o(V>>>k-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},O.toBytes=function(k){return k?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var k=this.high,V=this.low;return[V&255,V>>>8&255,V>>>16&255,V>>>24,k&255,k>>>8&255,k>>>16&255,k>>>24]},O.toBytesBE=function(){var k=this.high,V=this.low;return[k>>>24,k>>>16&255,k>>>8&255,k&255,V>>>24,V>>>16&255,V>>>8&255,V&255]},e.fromBytes=function(k,V,G){return G?e.fromBytesLE(k,V):e.fromBytesBE(k,V)},e.fromBytesLE=function(k,V){return new e(k[0]|k[1]<<8|k[2]<<16|k[3]<<24,k[4]|k[5]<<8|k[6]<<16|k[7]<<24,V)},e.fromBytesBE=function(k,V){return new e(k[4]<<24|k[5]<<16|k[6]<<8|k[7],k[0]<<24|k[1]<<16|k[2]<<8|k[3],V)},YE}var kU=moe();const $U=E1(kU),goe=gF({__proto__:null,default:$U},[kU]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qd=$U||goe;function Mv(n){return qd.fromString(n,!0,16)}const AU=Mv("c3a5c85c97cb3127"),Wd=Mv("b492b66fbe98f273"),ui=Mv("9ae16a3b2f90404f");function cI(n){return n.xor(n.shru(47))}function RU(n,e,t){const s=n.slice(e,e+t);return qd.fromBytes(Array.from(s),!0,!0)}function zn(n,e){return RU(n,e,8)}function lM(n,e){return RU(n,e,4)}function lr(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function _h(n,e,t=Mv("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function yoe(n,e,t,s,r,i){r=r.add(n),i=lr(i.add(r).add(s),21);const a=r;return r=r.add(e),r=r.add(t),i=i.add(lr(r,44)),[r.add(s),i.add(a)]}function Ex(n,e,t,s){return yoe(zn(n,e),zn(n,e+8),zn(n,e+16),zn(n,e+24),t,s)}function voe(n,e=n.length){if(e>=8){const t=ui.add(e*2),s=zn(n,0).add(ui),r=zn(n,e-8),i=lr(r,37).mul(t).add(s),a=lr(s,25).add(r).mul(t);return _h(i,a,t)}if(e>=4){const t=ui.add(e*2),s=lM(n,0);return _h(s.shl(3).add(e),lM(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),a=e+(r<<2);return cI(ui.mul(i).xor(AU.mul(a))).mul(ui)}return ui}function boe(n,e=n.length){const t=ui.add(e*2),s=zn(n,0).mul(Wd),r=zn(n,8),i=zn(n,e-8).mul(t),a=zn(n,e-16).mul(ui);return _h(lr(s.add(r),43).add(lr(i,30)).add(a),s.add(lr(r.add(ui),18)).add(i),t)}function _oe(n,e=n.length){const t=ui.add(e*2),s=zn(n,0).mul(ui),r=zn(n,8),i=zn(n,e-8).mul(t),a=zn(n,e-16).mul(ui),o=lr(s.add(r),43).add(lr(i,30)).add(a),l=_h(o,s.add(lr(r.add(ui),18)).add(i),t),c=zn(n,16).mul(t),h=zn(n,24),p=o.add(zn(n,e-32)).mul(t),m=l.add(zn(n,e-24)).mul(t);return _h(lr(c.add(h),43).add(lr(p,30)).add(m),c.add(lr(h.add(s),18)).add(p),t)}function xoe(n,e=n.length){const t=qd.fromNumber(81,!0);if(e<=32)return e<=16?voe(n,e):boe(n,e);if(e<=64)return _oe(n,e);let s=t,r=t.mul(Wd).add(113),i=cI(r.mul(ui).add(113)).mul(ui),a=[qd.UZERO,qd.UZERO],o=[qd.UZERO,qd.UZERO];s=s.mul(ui).add(zn(n,0));let l=0;const c=(e-1>>6)*64,h=c+(e-1&63)-63;do s=lr(s.add(r).add(a[0]).add(zn(n,l+8)),37).mul(Wd),r=lr(r.add(a[1]).add(zn(n,l+48)),42).mul(Wd),s=s.xor(o[1]),r=r.add(a[0]).add(zn(n,l+40)),i=lr(i.add(o[0]),33).mul(Wd),a=Ex(n,l,a[1].mul(Wd),s.add(o[0])),o=Ex(n,l+32,i.add(o[1]),r.add(zn(n,l+16))),[i,s]=[s,i],l+=64;while(l!==c);const p=Wd.add(i.and(255).shl(1));return l=h,o[0]=o[0].add(e-1&63),a[0]=a[0].add(o[0]),o[0]=o[0].add(a[0]),s=lr(s.add(r).add(a[0]).add(zn(n,l+8)),37).mul(p),r=lr(r.add(a[1]).add(zn(n,l+48)),42).mul(p),s=s.xor(o[1].mul(9)),r=r.add(a[0].mul(9).add(zn(n,l+40))),i=lr(i.add(o[0]),33).mul(p),a=Ex(n,l,a[1].mul(p),s.add(o[0])),o=Ex(n,l+32,i.add(o[1]),r.add(zn(n,l+16))),[i,s]=[s,i],_h(_h(a[0],o[0],p).add(cI(r).mul(AU)).add(i),_h(a[1],o[1],p).add(s),p)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(n,e){return e==="string"?Fv(n):ew([n],e)}function Toe(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function ew(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=vf(n)),Rt().getBool("DEBUG")&&OB(n,e),Toe(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Qy(){return Rt().platform.now()}function Soe(n,e){return Rt().platform.fetch(n,e)}function Fv(n,e="utf-8"){return e=e||"utf-8",Rt().platform.encode(n,e)}function B0(n,e="utf-8"){return e=e||"utf-8",Rt().platform.decode(n,e)}const Eoe=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:Kl,assert:re,assertNonNegativeIntegerDimensions:Ck,assertNonNull:Gf,assertShapesMatch:vi,bytesFromStringArray:MB,bytesPerElement:sI,checkConversionForErrors:OB,clamp:Zy,computeStrides:qm,createScalarValue:woe,createShuffledIndices:Lae,decodeString:B0,distSquared:$ae,encodeString:Fv,fetch:Soe,fingerPrint64:xoe,flatten:vf,getArrayFromDType:LB,getTypedArrayFromDType:DB,hasEncodingLoss:Mae,hexToLong:Mv,indexToLoc:Bae,inferDtype:Q1,inferFromImplicitShape:Pae,isBoolean:FB,isFunction:Lh,isInt:_m,isNumber:jB,isPromise:bf,isScalarShape:Aae,isString:uh,isTypedArray:Mr,isValidDtype:PB,locToIndex:jae,makeOnesTypedArray:Ik,makeZerosNestedTypedArray:Fae,makeZerosTypedArray:J1,nearestDivisor:M0,nearestLargerEven:Iae,now:Qy,parseAxisParam:Pv,randUniform:kae,repeatedTry:Oae,rightPad:Oy,shuffle:AB,shuffleCombo:Nae,sizeFromShape:es,sizeToSquarishShape:Dae,squeezeShape:RB,sum:Cae,swap:P0,tanh:Rae,toNestedArray:sf,toTypedArray:ew},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Noe=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Coe)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let a;const o=Qy();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();for(const c of r)c.dataSync();a=Promise.resolve({kernelMs:Qy()-o})}if(Rt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const h=r[c];h.data().then(p=>{Ioe(p,h.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:a.then(c=>c.kernelMs),extraInfo:a.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:a}=e;s.forEach(o=>{Promise.all([o.data(),r,a]).then(l=>{this.logger.logKernelProfile(t,o,l[0],l[1],i,l[2])})})}};function Ioe(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}let Coe=class{logKernelProfile(e,t,s,r,i,a){const o=typeof r=="number"?Oy(`${r}ms`,9):r.error,l=Oy(e,25),c=t.rank,h=t.size,p=Oy(t.shape.toString(),14);let m="";for(const v in i){const _=i[v];if(_!=null){const w=_.shape||t.shape,T=w.length;m+=`${v}: ${T}D ${T>0?w:""} `}}console.log(`%c${l}	%c${o}	%c${c}D ${p}	%c${h}	%c${m}	%c${a}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],h=c.inputs;for(const p in h){const m=h[p];let v=!1;for(let _=0;_<e.length;_++)if(s[m.id]){c.outputs.forEach(w=>s[w.id]=!0),v=!0,r[c.id]=!0;break}if(v)break}}const i={};i[t.id]=!0;const a={};for(let l=n.length-1;l>=0;l--){const c=n[l],h=c.inputs;for(let p=0;p<c.outputs.length;p++)if(i[c.outputs[p].id]){for(const m in h)i[h[m].id]=!0,a[c.id]=!0;break}}const o=[];for(let l=0;l<n.length;l++){const c=n[l];if(r[c.id]&&a[c.id]){const h={};for(const m in c.inputs){const v=c.inputs[m];s[v.id]&&(h[m]=v)}const p=Object.assign({},c);p.inputs=h,p.outputs=c.outputs,o.push(p)}}return o}function $oe(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],a=[];if(i.outputs.forEach(l=>{const c=n[l.id];c!=null?a.push(c):a.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const o=i.gradient(a);for(const l in i.inputs){if(!(l in o))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(o)}.`);const c=t(()=>o[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const h=i.inputs[l];if(!Kl(c.shape,h.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=c;else{const p=n[h.id];n[h.id]=s(p,c),p.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cM=20,oy=3,QE=7;function Aoe(n,e,t,s){const r=qm(e),i=Roe(n,e,t,r),a=e.length,o=n0(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${a}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(o.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Roe(n,e,t,s){const r=es(e),i=s[s.length-1],a=new Array(i).fill(0),o=e.length,l=t==="complex64"?xy(n):n;if(o>1)for(let c=0;c<r/i;c++){const h=c*i;for(let p=0;p<i;p++)a[p]=Math.max(a[p],_y(l[h+p],0,t).length)}return a}function _y(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(QE))} + ${parseFloat(n[1].toFixed(QE))}j`:uh(n)?s=`'${n}'`:t==="bool"?s=DU(n):s=parseFloat(n.toFixed(QE)).toString(),Oy(s,e)}function DU(n){return n===0?"false":"true"}function n0(n,e,t,s,r,i=!0){const a=t==="complex64"?2:1,o=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=xy(n);return[_y(w[0],0,t)]}return t==="bool"?[DU(n[0])]:[n[0].toString()]}if(l===1){if(o>cM){const T=oy*a;let E=Array.from(n.slice(0,T)),C=Array.from(n.slice((o-oy)*a,o*a));return t==="complex64"&&(E=xy(E),C=xy(C)),["["+E.map((A,D)=>_y(A,r[D],t)).join(", ")+", ..., "+C.map((A,D)=>_y(A,r[o-oy+D],t)).join(", ")+"]"]}return["["+(t==="complex64"?xy(n):Array.from(n)).map((T,E)=>_y(T,r[E],t)).join(", ")+"]"]}const c=e.slice(1),h=s.slice(1),p=s[0]*a,m=[];if(o>cM){for(let w=0;w<oy;w++){const T=w*p,E=T+p;m.push(...n0(n.slice(T,E),c,t,h,r,!1))}m.push("...");for(let w=o-oy;w<o;w++){const T=w*p,E=T+p;m.push(...n0(n.slice(T,E),c,t,h,r,w===o-1))}}else for(let w=0;w<o;w++){const T=w*p,E=T+p;m.push(...n0(n.slice(T,E),c,t,h,r,w===o-1))}const v=l===2?",":"";m[0]="["+m[0]+v;for(let w=1;w<m.length-1;w++)m[w]=" "+m[w]+v;let _=`,
`;for(let w=2;w<l;w++)_+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":_),m}function xy(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let z0=class{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=es(e),s!=null){const r=s.length;re(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||LB(t,this.size),this.strides=qm(e)}set(e,...t){t.length===0&&(t=[0]),re(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Po().makeTensor(this.values,this.shape,this.dtype)}},Po=null,Wp=null;function Doe(n){Po=n}function Loe(n){Wp=n}let us=class{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=es(e),this.strides=qm(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Wp.buffer(this.shape,this.dtype,e)}bufferSync(){return Wp.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return sf(this.shape,e,this.dtype==="complex64")}arraySync(){return sf(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Po().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>B0(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Po().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Po().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>B0(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Po().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Po().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Wp.print(this,e)}clone(){return this.throwIfDisposed(),Wp.clone(this)}toString(e=!1){const t=this.dataSync();return Aoe(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Wp.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Po().makeVariable(this,e,t,s)}};Object.defineProperty(us,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Ooe(){return $k("Tensor",()=>us)}Ooe();let Jy=class extends us{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Kl(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Po().disposeTensor(this),this.dataId=e.dataId,Po().incRef(this,null)}dispose(){Po().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Jy,Symbol.hasInstance,{value:n=>n instanceof us&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uI;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(uI||(uI={}));var hI;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(hI||(hI={}));var dI;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(dI||(dI={}));var fI;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(fI||(fI={}));var pI;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(pI||(pI={}));const Poe={float32:fI,int32:hI,bool:dI,complex64:pI};function tw(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Poe[n][e]}function Moe(n){return tw(n,"int32")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(n,e){if(n.dtype===e.dtype)return[n,e];const t=tw(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function LU(n,e){re(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function Foe(n,e){return e.some(t=>t.id===n.id)}function Pk(n){const e=[];return OU(n,e,new Set),e}function OU(n,e,t){if(n==null)return;if(n instanceof us){e.push(n);return}if(!joe(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),OU(i,e,t))}}function joe(n){return Array.isArray(n)||typeof n=="object"}const Boe=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:LU,getTensorsInContainer:Pk,isTensorInList:Foe,makeTypesMatch:ds},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n){return n.kernelName!=null}let uM=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}},Mk=class mI{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new uM}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(lh(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Noe(this.backendInstance),!0}setupRegisteredKernels(){j0(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){j0(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof $B)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(a=>r<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,lh(`Initialization of backend ${e} failed`),lh(a.stack||a.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return lh(`Initialization of backend ${e} failed`),lh(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),a=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return mI.nextTensorId++}nextVariableId(){return mI.nextVariableId++}clone(e){const t=pe.runKernel(Dk,{x:e}),s={x:e},r=a=>({x:()=>{const o="float32",l={x:a},c={dtype:o};return pe.runKernel(Rk,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(F0(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let o;this.backendName==null&&this.backend;let l;const c=JE(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(JE(e)){const{kernelName:_,inputs:w,attrs:T}=e;this.backendName==null&&this.backend;const E=F0(_,this.backendName);re(E!=null,()=>`Cannot find registered kernel '${_}' for backend '${this.backendName}'`),o=()=>{const C=this.backend.numDataIds();l=E.kernelFunc({inputs:w,attrs:T,backend:this.backend});const A=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(_,C,A);const D=A.map(F=>F.rank!=null?F:this.makeTensorFromTensorInfo(F));if(r){const F=this.getTensorsForGradient(_,w,D);s=this.saveTensorsForBackwardMode(F)}return D}}else{const{forwardFunc:_}=e,w=T=>{r&&(s=T.map(E=>this.keep(this.clone(E))))};o=()=>{const T=this.backend.numDataIds();l=this.tidy(()=>_(this.backend,w));const E=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,T,E),E}}const{inputs:h,attrs:p}=e,m=JE(e)?null:e.backwardsFunc;let v;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=o():(v=this.profiler.profileKernel(c,h,()=>o()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(v),t=v.outputs)}),r&&this.addTapeNode(c,h,t,m,s,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(_=>h[_]!=null?h[_].shape:null),outputShapes:t.map(_=>_.shape),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=lI(e);if(r!=null){const i=r.inputsToSave||[],a=r.outputsToSave||[];let o;r.saveAllInputs?(re(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),o=Object.keys(t).map(c=>t[c])):o=i.map(c=>t[c]);const l=s.filter((c,h)=>a[h]);return o.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&uh(e[0])&&(i=e.map(l=>Fv(l)));const a=r.write(i,t,s),o=new us(t,s,a,this.nextTensorId());if(this.trackTensor(o,r),s==="string"){const l=this.state.tensorInfo.get(a),c=MB(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return o}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,a=new us(r,i,s,this.nextTensorId());return this.trackTensor(a,t),a}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Jy(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*sI(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Jy||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*sI(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,a){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=lI(e);l!=null&&(r=l.gradFunc),r!=null&&(o.gradient=c=>(c=c.map((h,p)=>{if(h==null){const m=s[p],v=J1(m.size,m.dtype);return this.makeTensor(v,m.shape,m.dtype)}return h}),r(c.length>1?c:c[0],i,a))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Pk(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const a=this.state.activeScope.track[i];!a.kept&&!s.has(a.id)&&a.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(re(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));re(i instanceof us,()=>"The result y returned by f() must be a tensor.");const a=koe(this.state.activeTape,t,i);if(!r&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const o={};o[i.id]=s??zoe(i.shape),$oe(o,a,c=>this.tidy(c),Voe);const l=t.map(c=>o[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const h of c.saved)h.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return re(Lh(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{re(t.every(o=>o instanceof us),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((o,l)=>{r[l]=o});const i=(o,l)=>(s=e(...t,l),re(s.value instanceof us,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),re(Lh(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),a=(o,l)=>{const c=s.gradFunc(o,l),h=Array.isArray(c)?c:[c];re(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),re(h.every(m=>m instanceof us),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const p={};return h.forEach((m,v)=>{p[v]=()=>m}),p};return this.runKernelFunc({forwardFunc:i,backwardsFunc:a,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Qy(),s=await this.backend.time(e);return s.wallMs=Qy()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new uM;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};Mk.nextTensorId=0;Mk.nextVariableId=0;function zoe(n){const e=Ik(es(n),"float32");return pe.makeTensor(e,n,"float32")}function PU(){const n=VB();if(n._tfengine==null){const e=new zB(n);n._tfengine=new Mk(e)}return Gae(n._tfengine.ENV),Doe(()=>n._tfengine),n._tfengine}const pe=PU();function Voe(n,e){const t={a:n,b:e};return pe.runKernel(Ak,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(){return typeof navigator<"u"&&navigator!=null}let gI;function Goe(n){gI=n}function Woe(n){if(gI!==void 0)return gI;if(n||Uoe()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function MU(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const Hoe=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:MU,isMobile:Woe,mockIsMobile:Goe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi=Rt();Yi.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Yi.registerFlag("IS_BROWSER",()=>MU());Yi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Yi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Yi.registerFlag("PROD",()=>!1);Yi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Yi.getBool("DEBUG"));Yi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Yi.registerFlag("IS_TEST",()=>!1);Yi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);Yi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Yi.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);Yi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Yi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xl(n,e){let t=n;if(Mr(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Mr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&Rt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&FU(n,s,[]),s}function FU(n,e,t){if(t=t||[],!Array.isArray(n)&&!Mr(n)){re(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}re(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),re(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)FU(n[r],s,t.concat(r))}function hM(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function Q(n,e,t,s="numeric"){if(n instanceof us)return hM(s,n.dtype,e,t),n;let r=Q1(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),hM(s,r,e,t),n==null||!Mr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Xl(n,r);!Mr(n)&&!Array.isArray(n)&&(n=[n]);const o=r!=="string"?ew(n,r):vf(n,[],!0);return pe.makeTensor(o,i,r)}function ev(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,a)=>Q(i,`${e}[${a}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fk="__op";function fe(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Fk;const r=(...i)=>{pe.startScope(t);try{const a=s(...i);return bf(a)&&console.error("Cannot return a Promise inside of tidy."),pe.endScope(a),a}catch(a){throw pe.endScope(null),a}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(n,e){const t=Q(n,"real","complex"),s=Q(e,"imag","complex");vi(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return pe.runKernel(uz,r)}const Xc=fe({complex_:qoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(n,e,t,s){if(s==null&&(s=Q1(n)),s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Mr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Ck(e);const r=es(e),i=es(t);re(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let a=0;a<t.length;++a){const o=t[a],l=a===t.length-1?o!==es(e.slice(a)):!0;re(t[a]===e[a]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Mr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?ew(n,s):vf(n,[],!0),pe.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vo(n,e,t){const s=Xl(n,t);return Xh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yI={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V0=4;async function Koe(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(a=>a.name):Object.keys(n);for(let a=0;a<r.length;++a){const o=r[a],l=Array.isArray(n)?n[a].tensor:n[o];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${o}': ${l.dtype}`);const c={name:o,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async p=>{const m=await l.bytes(),v=m.reduce((T,E)=>T+E.length,0)+V0*m.length,_=new Uint8Array(v);let w=0;for(let T=0;T<m.length;T++){const E=m[T],C=new Uint8Array(new Uint32Array([E.length]).buffer);_.set(C,w),w+=V0,_.set(E,w),w+=E.length}p(_)});s.push(h)}else s.push(l.data());e!=null&&(c.group=e),t.push(c)}const i=await Promise.all(s);return{data:Xoe(i),specs:t}}function jU(n,e){const t={};let s,r=0;for(const i of e){const a=i.name,o=i.dtype,l=i.shape,c=es(l);let h;if("quantization"in i){const p=i.quantization;if(p.dtype==="uint8"||p.dtype==="uint16"){if(!("min"in p&&"scale"in p))throw new Error(`Weight ${i.name} with quantization ${p.dtype} doesn't have corresponding metadata min and scale.`)}else if(p.dtype==="float16"){if(o!=="float32")throw new Error(`Weight ${i.name} is quantized with ${p.dtype} which only supports weights of type float32 not ${o}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${p.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const m=yI[p.dtype],v=n.slice(r,r+c*m),_=p.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(o==="float32")if(p.dtype==="uint8"||p.dtype==="uint16"){h=new Float32Array(_.length);for(let w=0;w<_.length;w++){const T=_[w];h[w]=T*p.scale+p.min}}else if(p.dtype==="float16")s===void 0&&(s=tle()),h=s(_);else throw new Error(`Unsupported quantization type ${p.dtype} for weight type float32.`);else if(o==="int32"){if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error(`Unsupported quantization type ${p.dtype} for weight type int32.`);h=new Int32Array(_.length);for(let w=0;w<_.length;w++){const T=_[w];h[w]=Math.round(T*p.scale+p.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${o}`);r+=c*m}else if(o==="string"){const p=es(i.shape);h=[];for(let m=0;m<p;m++){const v=new Uint32Array(n.slice(r,r+V0))[0];r+=V0;const _=new Uint8Array(n.slice(r,r+v));h.push(_),r+=v}}else{const p=yI[o],m=n.slice(r,r+c*p);if(o==="float32")h=new Float32Array(m);else if(o==="int32")h=new Int32Array(m);else if(o==="bool")h=new Uint8Array(m);else if(o==="complex64"){h=new Float32Array(m);const v=new Float32Array(h.length/2),_=new Float32Array(h.length/2);for(let E=0;E<v.length;E++)v[E]=h[E*2],_[E]=h[E*2+1];const w=Vo(v,l,"float32"),T=Vo(_,l,"float32");t[a]=Xc(w,T),w.dispose(),T.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${o}`);r+=c*p}o!=="complex64"&&(t[a]=Vo(h,l,o))}return t}function Xoe(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const jk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function dM(n){return jk?Buffer.byteLength(n):new Blob([n]).size}function Zoe(n){if(jk)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function Yoe(n){if(jk){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function Bk(n){if(n.length===1)return n[0];let e=0;n.forEach(r=>{e+=r.byteLength});const t=new Uint8Array(e);let s=0;return n.forEach(r=>{t.set(new Uint8Array(r),s),s+=r.byteLength}),t.buffer}function fM(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);const t=n.split("/");return t[t.length-1]}function BU(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function zU(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),s}async function zk(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),zU(n,t,s)}function jv(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:dM(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:dM(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function VU(n){const e=[];for(const t of n)e.push(...t.weights);return e}function Qoe(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function Joe(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function ele(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function tle(){const n=Qoe(),e=Joe(),t=ele();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let a=0;a<s.length;a++){const o=s[a],l=n[t[o>>10]+(o&1023)]+e[o>>10];i[a]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ca=class Lo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Lo.instance==null&&(Lo.instance=new Lo),Lo.instance}static registerSaveRouter(e){Lo.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Lo.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Lo.getHandlers(e,"save")}static getLoadHandlers(e,t){return Lo.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Lo.getInstance().loadRouters:Lo.getInstance().saveRouters).forEach(a=>{const o=a(e,s);o!==null&&r.push(o)}),r}};const nle=n=>Ca.registerSaveRouter(n),sle=n=>Ca.registerLoadRouter(n),rle=n=>Ca.getSaveHandlers(n),ile=(n,e)=>Ca.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vI="tensorflowjs",bI=1,Qd="models_store",hh="model_info_store";function UU(){if(!Rt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function _I(n){const e=n.result;e.createObjectStore(Qd,{keyPath:"modelPath"}),e.createObjectStore(hh,{keyPath:"modelPath"})}let _f=class{constructor(e){if(this.indexedDB=UU(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(vI,bI);i.onupgradeneeded=()=>_I(i),i.onsuccess=()=>{const a=i.result;if(t==null){const o=a.transaction(Qd,"readonly"),c=o.objectStore(Qd).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return a.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=h=>(a.close(),r(c.error)),o.oncomplete=()=>a.close()}else{const o=jv(t),l=a.transaction(hh,"readwrite");let c=l.objectStore(hh);const h=c.put({modelPath:this.modelPath,modelArtifactsInfo:o});let p;h.onsuccess=()=>{p=a.transaction(Qd,"readwrite");const v=p.objectStore(Qd).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:o});v.onsuccess=()=>s({modelArtifactsInfo:o}),v.onerror=_=>{c=l.objectStore(hh);const w=c.delete(this.modelPath);w.onsuccess=()=>(a.close(),r(v.error)),w.onerror=T=>(a.close(),r(v.error))}},h.onerror=m=>(a.close(),r(h.error)),l.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},i.onerror=a=>r(i.error)})}};_f.URL_SCHEME="indexeddb://";const GU=n=>Rt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(_f.URL_SCHEME)?ale(n.slice(_f.URL_SCHEME.length)):null;Ca.registerSaveRouter(GU);Ca.registerLoadRouter(GU);function ale(n){return new _f(n)}function ole(n){return n.startsWith(_f.URL_SCHEME)?n.slice(_f.URL_SCHEME.length):n}let lle=class{constructor(){this.indexedDB=UU()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(vI,bI);s.onupgradeneeded=()=>_I(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(hh,"readonly"),o=i.objectStore(hh).getAll();o.onsuccess=()=>{const l={};for(const c of o.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},o.onerror=l=>(r.close(),t(o.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=ole(e),new Promise((t,s)=>{const r=this.indexedDB.open(vI,bI);r.onupgradeneeded=()=>_I(r),r.onsuccess=()=>{const i=r.result,a=i.transaction(hh,"readwrite"),o=a.objectStore(hh),l=o.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=o.delete(e),p=()=>{c=i.transaction(Qd,"readwrite");const v=c.objectStore(Qd).delete(e);v.onsuccess=()=>t(l.result.modelArtifactsInfo),v.onerror=_=>s(l.error)};h.onsuccess=p,h.onerror=m=>(p(),i.close(),s(l.error))}},l.onerror=h=>(i.close(),s(l.error)),a.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lc="/",Hp="tensorflowjs_models",WU="info",cle="model_topology",ule="weight_specs",hle="weight_data",dle="model_metadata";function HU(n){return{info:[Hp,n,WU].join(Lc),topology:[Hp,n,cle].join(Lc),weightSpecs:[Hp,n,ule].join(Lc),weightData:[Hp,n,hle].join(Lc),modelMetadata:[Hp,n,dle].join(Lc)}}function qU(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function fle(n){const e=n.split(Lc);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Lc)}function ple(n){return n.startsWith(xf.URL_SCHEME)?n.slice(xf.URL_SCHEME.length):n}let xf=class{constructor(e){if(!Rt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=HU(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=jv(e);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,Zoe(e.weightData));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw qU(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const o=JSON.parse(i);t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)}const a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=Yoe(a),t}};xf.URL_SCHEME="localstorage://";const KU=n=>Rt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(xf.URL_SCHEME)?mle(n.slice(xf.URL_SCHEME.length)):null;Ca.registerSaveRouter(KU);Ca.registerLoadRouter(KU);function mle(n){return new xf(n)}let gle=class{constructor(){re(Rt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),re(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Hp+Lc,s=Lc+WU;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const a=fle(i);e[a]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=ple(e);const t=HU(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return qU(t),s}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const im="://";let Oh=class eh{constructor(){this.managers={}}static getInstance(){return eh.instance==null&&(eh.instance=new eh),eh.instance}static registerManager(e,t){re(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(im)&&(e=e.slice(0,e.indexOf(im))),re(e.length>0,()=>"scheme must not be an empty string.");const s=eh.getInstance();re(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=eh.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(eh.getInstance().managers)}};function s0(n){if(n.indexOf(im)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Oh.getSchemes().join(",")}`);return{scheme:n.split(im)[0],path:n.split(im)[1]}}async function XU(n,e,t=!1){re(n!==e,()=>`Old path and new path are the same: '${n}'`);const s=Ca.getLoadHandlers(n);re(s.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),re(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${n}.`);const r=s[0],i=Ca.getSaveHandlers(e);re(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),re(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const a=i[0],o=s0(n).scheme,l=s0(n).path,c=o===s0(n).scheme,h=await r.load();t&&c&&await Oh.getManager(o).removeModel(l);const p=await a.save(h);return t&&!c&&await Oh.getManager(o).removeModel(l),p.modelArtifactsInfo}async function yle(){const n=Oh.getSchemes(),e={};for(const t of n){const s=await Oh.getManager(t).listModels();for(const r in s){const i=t+im+r;e[i]=s[r]}}return e}async function vle(n){const e=s0(n);return Oh.getManager(e.scheme).removeModel(e.path)}async function ble(n,e){return XU(n,e,!1)}async function _le(n,e){return XU(n,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let xle=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(!window||!Rt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}};if(Rt().get("IS_BROWSER")){Rt().setPlatform("browser",new xle);try{Oh.registerManager(xf.URL_SCHEME,new gle)}catch{}try{Oh.registerManager(_f.URL_SCHEME,new lle)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wle={importFetch:()=>require("node-fetch")};let eN,Tle=class{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return Rt().global.fetch!=null?Rt().global.fetch(e,t):(eN==null&&(eN=wle.importFetch()),eN(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}};Rt().get("IS_NODE")&&!Rt().get("IS_BROWSER")&&Rt().setPlatform("node",new Tle);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ko(n,e="float32",t){return e=e||"float32",Ck(n),new z0(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(n,e){const t=Q(n,"x","cast");if(!PB(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return pe.runKernel(Rk,s,r)}const is=fe({cast_:Sle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(n){const t={x:Q(n,"x","clone","string_or_numeric")};return pe.runKernel(Dk,t)}const Vc=fe({clone_:Ele});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vk(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */PU();const Nle={buffer:Ko,cast:is,clone:Vc,print:Vk};Loe(Nle);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ile="model",Cle=".json",kle=".weights.bin";function pM(n){return new Promise(e=>setTimeout(e)).then(n)}class wf{constructor(e){if(!Rt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(wf.URL_SCHEME)&&(e=e.slice(wf.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Ile),this.modelJsonFileName=e+Cle,this.weightDataFileName=e+kle}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const s=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r=BU(e,s),i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=i,await pM(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const o=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;o.download=this.weightDataFileName,o.href=t,await pM(()=>o.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:jv(e)}}}}wf.URL_SCHEME="downloads://";class $le{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),a=i.modelTopology;if(a==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:a});return}const l=zk(i,c=>this.loadWeights(c));e(l)},s.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const t=[],s=[];for(const a of e)t.push(...a.weights),s.push(...a.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(a=>this.loadWeightsFile(a,r[a]));return Promise.all(i).then(a=>[t,Bk(a)])}loadWeightsFile(e,t){return new Promise((s,r)=>{const i=new FileReader;i.onload=a=>{const o=a.target.result;s(o)},i.onerror=a=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],s=this.weightsFiles.map(i=>fM(i.name)),r={};for(const i of e)i.paths.forEach(a=>{const o=fM(a);if(t.indexOf(o)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${o}'`);if(t.push(o),s.indexOf(o)===-1)throw new Error(`Weight file with basename '${o}' is not provided.`);r[a]=this.weightsFiles[s.indexOf(o)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const Ale=n=>Rt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(wf.URL_SCHEME)?Rle(n.slice(wf.URL_SCHEME.length)):null;Ca.registerSaveRouter(Ale);function Rle(n="model"){return new wf(n)}function Dle(n){return new $le(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mM(n,e,t,s){a(n),t=t??0,s=s??1,o(t,s);let r=0;const i=l=>(l.then(c=>{const h=t+ ++r/n.length*(s-t);return e(h),c}),l);function a(l){re(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function o(l,c){re(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),re(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),re(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function ZU(n,e){e==null&&(e={});const t=e.fetchFunc==null?Rt().platform.fetch:e.fetchFunc,s=n.map(p=>t(p,e.requestInit,{isBinary:!0})),o=(e.onProgress==null?await Promise.all(s):await mM(s,e.onProgress,0,.5)).map(p=>p.arrayBuffer());return e.onProgress==null?await Promise.all(o):await mM(o,e.onProgress,.5,1)}async function Lle(n,e="",t,s){return YU(a=>ZU(a,{requestInit:s}))(n,e,t)}function YU(n){return async(e,t="",s)=>{const r=e.map(()=>!1),i={},a=s!=null?s.map(()=>!1):[],o=[];if(e.forEach((v,_)=>{let w=0;v.weights.forEach(T=>{const E="quantization"in T?T.quantization.dtype:T.dtype,C=yI[E]*es(T.shape),A=()=>{r[_]=!0,i[_]==null&&(i[_]=[]),i[_].push({manifestEntry:T,groupOffset:w,sizeBytes:C})};s!=null?s.forEach((D,F)=>{D===T.name&&(A(),a[F]=!0)}):A(),o.push(T.name),w+=C})}),!a.every(v=>v)){const v=s.filter((_,w)=>!a[w]);throw new Error(`Could not find weights in manifest with names: ${v.join(", ")}. 
Manifest JSON has weights with names: ${o.join(", ")}.`)}const l=r.reduce((v,_,w)=>(_&&v.push(w),v),[]),c=[];l.forEach(v=>{e[v].paths.forEach(_=>{const w=t+(t.endsWith("/")?"":"/")+_;c.push(w)})});const h=await n(c),p={};let m=0;return l.forEach(v=>{const _=e[v].paths.length;let w=0;for(let D=0;D<_;D++)w+=h[m+D].byteLength;const T=new ArrayBuffer(w),E=new Uint8Array(T);let C=0;for(let D=0;D<_;D++){const F=new Uint8Array(h[m+D]);E.set(F,C),C+=F.byteLength}i[v].forEach(D=>{const F=T.slice(D.groupOffset,D.groupOffset+D.sizeBytes),W=jU(F,[D.manifestEntry]);for(const B in W)p[B]=W[B]}),m+=_}),p}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ole="application/octet-stream",Ple="application/json";class Uk{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(re(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Rt().platform.fetch,re(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&re(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=BU(e,s);t.body.append("model.json",new Blob([JSON.stringify(r)],{type:Ple}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:Ole}),"model.weights.bin");const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:jv(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let a=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?a+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":a+=" Please make sure the server is serving valid JSON for this request.",new Error(a)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return zk(t,i=>this.loadWeights(i))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=Mle(t),i=this.weightPathPrefix||s,a=VU(e),o=[],l=[];for(const h of e)for(const p of h.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(p)):o.push(i+p+r);this.weightUrlConverter&&o.push(...await Promise.all(l));const c=await ZU(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,Bk(c)]}}Uk.URL_SCHEME_REGEX=/^https?:\/\//;function Mle(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function xI(n){return n.match(Uk.URL_SCHEME_REGEX)!=null}const QU=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>xI(s)):t=xI(n),t)return Gk(n,e)}return null};Ca.registerSaveRouter(QU);Ca.registerLoadRouter(QU);function Gk(n,e){return new Uk(n,e)}function Fle(n,e){return Gk(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tN{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class JU{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class jle{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function Ble(n,e,t,s){const r=arguments;return new jle(e6(...r))}function e6(n,e,t,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new tN(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new tN({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new tN({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:s}))}function zle(n){return new JU(n)}function Vle(n){return new JU(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wk=Object.freeze(Object.defineProperty({__proto__:null,browserFiles:Dle,browserHTTPRequest:Fle,concatenateArrayBuffers:Bk,copyModel:ble,decodeWeights:jU,encodeWeights:Koe,fromMemory:Ble,fromMemorySync:e6,getLoadHandlers:ile,getModelArtifactsForJSON:zk,getModelArtifactsForJSONSync:zU,getModelArtifactsInfoForJSON:jv,getSaveHandlers:rle,getWeightSpecs:VU,http:Gk,isHTTPScheme:xI,listModels:yle,loadWeights:Lle,moveModel:_le,registerLoadRouter:sle,registerSaveRouter:nle,removeModel:vle,weightsLoaderFactory:YU,withSaveHandler:zle,withSaveHandlerSync:Vle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(n,e,t=!1,s=!1){let r=Q(n,"a","matMul"),i=Q(e,"b","matMul");[r,i]=ds(r,i);const a={a:r,b:i},o={transposeA:t,transposeB:s};return pe.runKernel(rz,a,o)}const wn=fe({matMul_:Ule});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gle(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const a={indices:Q(n,"indices","oneHot","int32")},o={dtype:r,depth:e,onValue:t,offValue:s};return pe.runKernel(IV,a,o)}const U0=fe({oneHot_:Gle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(){Rt().set("PROD",!0)}function Hle(){Rt().set("DEBUG",!0)}function qle(){Rt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Kle(n){Rt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Xle(){pe.disposeVariables()}function Zle(){return pe}function Yle(){return pe.memory()}function Qle(n){return pe.profile(n)}function pn(n,e){return pe.tidy(n,e)}function Br(n){Pk(n).forEach(t=>t.dispose())}function kl(n){return pe.keep(n)}function Jle(n){return pe.time(n)}function ece(n){return pe.setBackend(n)}function tce(){return pe.ready()}function nce(){return pe.backendName}function sce(n){pe.removeBackend(n)}function rce(n){return pe.findBackend(n)}function ice(n){return pe.findBackendFactory(n)}function ace(n,e,t=1){return pe.registerBackend(n,e,t)}function oce(){return pe.backend}function lce(n,e){Rt().setPlatform(n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(n){const t={input:Q(n,"input","imag")};return pe.runKernel(Xz,t)}const Bv=fe({imag_:cce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(n){const t={x:Q(n,"x","neg")};return pe.runKernel(xV,t)}const Fl=fe({neg_:uce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(n){const t={input:Q(n,"input","real")};return pe.runKernel(PV,t)}const wm=fe({real_:hce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(n,e,t){const s=Q(n,"x","transpose");if(e==null&&(e=s.shape.map((a,o)=>o).reverse()),re(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(a=>{re(a>=0&&a<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?pn(()=>{let a=wm(s),o=Bv(s);return a=pe.runKernel(t0,{x:a},i),o=pe.runKernel(t0,{x:o},i),t&&(o=Fl(o)),Xc(a,o)}):pe.runKernel(t0,r,i)}const tv=fe({transpose_:dce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(n,e,t){const s=Q(n,"labels","confusionMatrix"),r=Q(e,"predictions","confusionMatrix");re(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),re(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),re(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),re(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),re(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const i=U0(is(s,"int32"),t),a=U0(is(r,"int32"),t),o=tv(i),l=wn(o,a);return is(l,"int32")}const pce=fe({confusionMatrix_:fce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mce=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:pce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,a=n[i]||1;(e[e.length-1-r]||1)>1&&a===1&&s.unshift(i)}return s}function Hk(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,a=e[i];(r==null||r===1&&a>1)&&t.unshift(i)}return t}function js(n,e){const t=[],s=Math.max(n.length,e.length);for(let r=0;r<s;r++){let i=n[n.length-r-1];i==null&&(i=1);let a=e[e.length-r-1];if(a==null&&(a=1),i===1)t.unshift(a);else if(a===1)t.unshift(i);else if(i!==a){const o=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(o)}else t.unshift(i)}return t}const gce=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:js,getBroadcastDims:t6,getReductionAxes:Hk},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qk(n,e,t){if(Gf(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Xl(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xh(n,e,s,t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let zd;function n6(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,s=!1,r=!1,i=!1,a=!1,o=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)a=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)o=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(F0(rI,pe.backendName)!=null){const _={pixels:n},w={numChannels:e};return pe.runKernel(rI,_,w)}const[c,h]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let p;if(a)p=n.getContext("2d").getImageData(0,0,c,h).data;else if(s||t)p=n.data;else if(i||r||o){if(zd==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")zd=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else zd=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});zd.canvas.width=c,zd.canvas.height=h,zd.drawImage(n,0,0,c,h),p=zd.getImageData(0,0,c,h).data}let m;if(e===4)m=new Int32Array(p);else{const _=c*h;m=new Int32Array(_*e);for(let w=0;w<_;w++)for(let T=0;T<e;++T)m[w*e+T]=p[w*4+T]}return qk(m,[h,c,e],"int32")}function yce(n){return n!=null&&n.data instanceof Uint8Array}function vce(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function bce(n){return n!=null&&n.width!==0&&n.height!==0}function _ce(n){return vce()&&!(n instanceof ImageBitmap)&&bce(n)&&!yce(n)}async function xce(n,e=3){let t=null;if(Rt().getBool("WRAP_TO_IMAGEBITMAP")&&_ce(n)){let s;try{s=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===n.width&&s.height===n.height?t=s:t=n}else t=n;return n6(t,e)}async function s6(n,e){let t=Q(n,"img","toPixels");if(!(n instanceof us)){const c=t;t=is(c,"int32"),c.dispose()}if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const[s,r]=t.shape.slice(0,2),i=t.rank===2?1:t.shape[2];if(i>4||i===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${i}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`);const a=await t.data(),o=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let c=0;c<s*r;++c){const h=[0,0,0,255];for(let m=0;m<i;m++){const v=a[c*i+m];if(t.dtype==="float32"){if(v<0||v>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${v}.`)}else if(t.dtype==="int32"&&(v<0||v>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${v}.`);i===1?(h[0]=v*o,h[1]=v*o,h[2]=v*o):h[m]=v*o}const p=c*4;l[p+0]=Math.round(h[0]),l[p+1]=Math.round(h[1]),l[p+2]=Math.round(h[2]),l[p+3]=Math.round(h[3])}if(e!=null){e.width=r,e.height=s;const c=e.getContext("2d"),h=new ImageData(l,r,s);c.putImageData(h,0,0)}return t!==n&&t.dispose(),l}const r6=fe({fromPixels_:n6}),wce=Object.freeze(Object.defineProperty({__proto__:null,fromPixels:r6,fromPixelsAsync:xce,toPixels:s6},Symbol.toStringTag,{value:"Module"}));function i6(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(es(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let a=1;for(let p=0;p<r.length-1;++p)a*=r[p];const o=n.shape,l=r.slice();l.pop();let c=1;for(let p=i;p<t;++p)c*=o[p],l.push(o[p]);const h=[...qm(n.shape).map(p=>p/c),1].slice(0,i);return[l,a,c,h]}const Tce=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:i6},Symbol.toStringTag,{value:"Module"}));function Kk(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let a=0;a<r;++a)if(t.shape[a]!==e.shape[a])throw new Error(i+` updates.shape[${a}] (${t.shape[a]}) != indices.shape[${a}] (${e.shape[a]}).`);for(let a=0;a<t.rank-r;++a)if(t.shape[a+r]!==n[a+s])throw new Error(i+` updates.shape[${a+r}] (${t.shape[a+r]}) != shape[${a+r}] (${n[a+r]})`)}function Xk(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Kk(t,e,n)}function a6(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let a=1;for(let p=r;p<i;++p)a*=t[p];const o=r<1?1:r,l=es(e.shape)/o,c=[...qm(t.slice(0,r)),1],h=es(t);return{sliceRank:r,numUpdates:l,sliceSize:a,strides:c,outputSize:h}}const Sce=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:a6,validateInput:Xk,validateUpdateShape:Kk},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wI=-2,Ece=-1;function Nce(n,e,t){const s=n.shape.length;re(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),re(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)re(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function Ice(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Cce(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function o6(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function l6(n,e,t){return t<=n?t:t-(e-1)}function c6(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function kce(n,e,t,s,r,i,a,o,l){const c=n.length;let h=new Array(c),p=new Array(c),m=new Array(c);if(e.length&&t>0){const v=e[0],_=t+1;h=u6(a,v,_,s,n),p=h6(o,v,_,r,n),m=o6(i,v,_,n)}else for(let v=0;v<c;v++)h[v]=f6(a,s,i,n,v,l),p[v]=p6(o,r,i,n,v,l),m[v]=d6(i,v,l);return{begin:h,end:p,strides:m}}function u6(n,e,t,s,r){const i=[...r],a=c6(t,e);for(let o=0;o<i.length;o++)if(a.indexOf(o)>-1)i[o]=0;else{const l=l6(e,t,o);let c=s[l];n&1<<l&&(c=0),i[o]=c}return i}function h6(n,e,t,s,r){const i=[...r],a=c6(t,e);for(let o=0;o<i.length;o++)if(a.indexOf(o)>-1)i[o]=Number.MAX_SAFE_INTEGER;else{const l=l6(e,t,o);let c=s[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[o]=c}for(let o=0;o<i.length;o++){const l=r[o];i[o]<0&&(i[o]+=l),i[o]=Zy(0,i[o],r[o])}return i}function d6(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function f6(n,e,t,s,r,i){let a=e[r];const o=t[r]||1;(n&1<<r||i&1<<r||a==null)&&(o>0?a=Number.MIN_SAFE_INTEGER:a=Number.MAX_SAFE_INTEGER);const l=s[r];return a<0&&(a+=l),a=Zy(0,a,l-1),a}function p6(n,e,t,s,r,i){let a=e[r];const o=t[r]||1;(n&1<<r||i&1<<r||a==null)&&(o>0?a=Number.MAX_SAFE_INTEGER:a=Number.MIN_SAFE_INTEGER);const l=s[r];return a<0&&(a+=l),o>0?a=Zy(0,a,l):a=Zy(-1,a,l-1),a}function $ce(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Ace(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function Rce(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(a=>{re(a!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((a,o)=>a>=0?a:(re(a===-1,()=>`Negative size values should be exactly -1 but got ${a} for the slice() size at index ${o}.`),n.shape[o]-s[o])),[s,i]}function Dce(n,e,t,s,r,i,a,o,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,a!=null&&(a&a-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const p={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:r,endMask:i,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};for(let A=0;A<p.dims;A++)h&&(1<<A&o)!==0&&p.numAddAxisAfterEllipsis++,1<<A&a&&(h=!0);h||(p.ellipsisMask|=1<<p.dims,p.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Lce(p,m);let v=!0,_=!0,w=!0;const T=[],E=[];for(let A=0;A<n.length;++A){if(m.strides[A]===0)throw Error(`strides[${A}] must be non-zero`);const D=!!(m.shrinkAxisMask&1<<A),F=n[A];if(F===-1){T.push(D?1:-1);continue}const W=[m.beginMask&1<<A,m.endMask&1<<A],B=[m.strides[A]>0?0:-1,m.strides[A]>0?F:F-1];if(D&&m.strides[A]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&m.strides[A]===1;const P=!!(m.beginMask&1<<A&&m.endMask&1<<A);if(m.beginValid&&m.endValid){if(D){const V=m.begin[A]<0?F+m.begin[A]:m.begin[A];if(m.begin[A]=V,m.end[A]=m.begin[A]+1,V<0||V>=F)throw Error(`slice index ${m.begin[A]} of dimension ${A} out of bounds.`)}else m.begin[A]=gM(m.begin[A],0,m.strides[A],F,W,B),m.end[A]=gM(m.end[A],1,m.strides[A],F,W,B);const k=m.strides[A]===1&&m.begin[A]===0&&m.end[A]===F;v=v&&k,_=_&&(A===0&&m.strides[A]===1||k)}else v=v&&m.strides[A]===1&&P,_=_&&(A===0&&m.strides[A]===1||P);let O,M=!1;if(m.beginValid&&m.endValid?(O=m.end[A]-m.begin[A],M=!0):D?(O=1,M=!0):P&&F>=0&&(m.strides[A]<0?O=-F:O=F,M=!0),M){let k;O===0||O<0!=m.strides[A]<0?k=0:k=Math.trunc(O/m.strides[A])+(O%m.strides[A]!==0?1:0),T.push(k)}else T.push(-1)}for(let A=0;A<m.finalShapeGatherIndices.length;++A){const D=m.finalShapeGatherIndices[A];D>=0?E.push(T[D]):D===wI&&E.push(1)}return{finalShapeSparse:E.filter((A,D)=>m.finalShapeGatherIndices[D]!==wI),finalShape:E,isIdentity:v,sliceDim0:_,isSimpleSlice:w,begin:m.begin,end:m.end,strides:m.strides}}function Lce(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(wI),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(Ece),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function gM(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const a=n<0?s+n:n;return a<i[0]?i[0]:a>i[1]?i[1]:a}}const m6=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Nce,computeFlatOffset:Ace,computeOutShape:Cce,getNormalizedAxes:kce,isSliceContinous:$ce,maskToAxes:Ice,parseSliceParams:Rce,sliceInfo:Dce,startForAxis:f6,startIndicesWithElidedDims:u6,stopForAxis:p6,stopIndicesWithElidedDims:h6,stridesForAxis:d6,stridesWithElidedDims:o6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let g6=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},y6=class qp{constructor(){this.classNameMap={}}static getMap(){return qp.instance==null&&(qp.instance=new qp),qp.instance}static register(e){qp.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function Zh(n){re(n.className!=null,()=>"Class being registered does not have the static className property defined."),re(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),re(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),y6.register(n)}const Oce=Object.freeze(Object.defineProperty({__proto__:null,Serializable:g6,SerializationMap:y6,registerClass:Zh},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pce=.001,v6=.1;function Mce(n,e,t){return t==null&&(t=Zk()),TI(n,e,(s,r)=>Yk(s,r,t))}function Zk(){return pe.backend.floatPrecision()===32?Pce:v6}function TI(n,e,t){let s=!0;if((Mr(n)||Mr(e))&&(s=!1),Mr(n)&&Mr(e)&&(s=!0),s){const a=n.constructor.name,o=e.constructor.name;if(a!==o)throw new Error(`Arrays are of different type. Actual: ${a}. Expected: ${o}`)}if(Array.isArray(n)&&Array.isArray(e)){const a=Xl(n),o=Xl(e);if(!Kl(a,o))throw new Error(`Arrays have different shapes. Actual: [${a}]. Expected: [${o}]`)}const r=Mr(n)?n:vf(n),i=Mr(e)?e:vf(e);if(r.length!==i.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${i.length}.
Actual:   ${r}.
Expected: ${i}.`);for(let a=0;a<i.length;++a){const o=r[a],l=i[a];if(!t(o,l))throw new Error(`Arrays differ: actual[${a}] = ${o}, expected[${a}] = ${l}.
Actual:   ${r}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function Fce(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function jce(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return uh(n)||uh(n[0])||uh(e)||uh(e[0])?TI(n,t,(s,r)=>s==r):TI(n,e,(s,r)=>Yk(s,r,0))}function Bce(n,e,t){if(t==null&&(t=Zk()),!Yk(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function Yk(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function zce(n,e,t){for(let s=0;s<n.length;s++)if(n[s]<e||n[s]>t)throw new Error(`Value out of range:${n[s]} low: ${e}, high: ${t}`)}function Vce(n,e){const t=new Float32Array(n),s=new Float32Array(e);if(t.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${t.length}`);for(let r=0;r<s.length;r++)if(t[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${t[r]} instead`)}function b6(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?b6(t):n[e]=Fv(t)}return n}function Uce(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",s=>t(e)),e.load()})}async function Gce(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const Wce=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:v6,createVideoElement:Uce,encodeStrings:b6,expectArrayBuffersEqual:Vce,expectArraysClose:Mce,expectArraysEqual:jce,expectNumbersClose:Bce,expectPromiseToFail:Fce,expectValuesInRange:zce,play:Gce,testEpsilon:Zk},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const Hce="3.21.0";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qce(n,e){let t=Q(n,"a","add"),s=Q(e,"b","add");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel(Ak,r)}const Et=fe({add_:qce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(n,e){let t=Q(n,"a","floorDiv"),s=Q(e,"b","floorDiv");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel(Vz,r)}const Qk=fe({floorDiv_:Kce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xce(n,e){let t=Q(n,"a","div"),s=Q(e,"b","div");if([t,s]=ds(t,s),t.dtype==="int32"&&s.dtype==="int32")return Qk(t,s);const r={a:t,b:s},i={};return pe.runKernel($z,r,i)}const Wn=fe({div_:Xce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zce(n,e){let t=Q(n,"a","mul"),s=Q(e,"b","mul");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel(_V,r)}const Ye=fe({mul_:Zce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yce(n){const e=Q(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return pe.runKernel(hz,t)}else{const t={x:e};return pe.runKernel(UB,t)}}const Hi=fe({abs_:Yce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qce(n){const t={x:Q(n,"x","acos")};return pe.runKernel(GB,t)}const _6=fe({acos_:Qce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jce(n){const t={x:Q(n,"x","acosh")};return pe.runKernel(WB,t)}const x6=fe({acosh_:Jce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(n){re(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),re(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((r,i)=>Q(r,`tensors${i}`,"addN")),t=e[0];e.forEach(r=>{if(r.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!Kl(r.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return pe.runKernel(HB,s)}const w6=fe({addN_:eue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tue(n,e=null,t=!1){const r={x:Q(n,"x","all","bool")},i={axis:e,keepDims:t};return pe.runKernel(qB,r,i)}const T6=fe({all_:tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue(n,e=null,t=!1){const r={x:Q(n,"x","any","bool")},i={axis:e,keepDims:t};return pe.runKernel(KB,r,i)}const S6=fe({any_:nue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sue(n,e=0){const s={x:Q(n,"x","argMax")},r={axis:e};return pe.runKernel(XB,s,r)}const E6=fe({argMax_:sue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(n,e=0){const s={x:Q(n,"x","argMin")},r={axis:e};return pe.runKernel(ZB,s,r)}const N6=fe({argMin_:rue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(n){const t={x:Q(n,"x","asin")};return pe.runKernel(YB,t)}const I6=fe({asin_:iue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aue(n){const t={x:Q(n,"x","asinh")};return pe.runKernel(QB,t)}const C6=fe({asinh_:aue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(n){const t={x:Q(n,"x","atan")};return pe.runKernel(JB,t)}const k6=fe({atan_:oue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(n,e){let t=Q(n,"a","atan2"),s=Q(e,"b","atan2");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel(tz,r)}const $6=fe({atan2_:lue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cue(n){const t={x:Q(n,"x","atanh")};return pe.runKernel(ez,t)}const A6=fe({atanh_:cue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(n,e,t,s,r="NHWC",i){const a=n[3],o=[...e,a],l=L6(r);return zv(n,o,t,i,s,null,null,l)}function R6(n,e,t,s,r,i,a="channelsLast"){const[o,l]=G0(e);let c;if(a==="channelsLast")c=[o,l,n[3],n[3]];else if(a==="channelsFirst")c=[o,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${a}`);return zv(n,c,t,s,r,i,!1,a)}function hue(n,e,t,s,r,i,a="NDHWC"){const[o,l,c]=SI(e);let h,p;if(a==="NDHWC")p="channelsLast",h=[o,l,c,n[4],n[4]];else if(a==="NCDHW")p="channelsFirst",h=[o,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${a}`);return D6(n,h,t,s,r,!1,p,i)}function zv(n,e,t,s,r,i,a=!1,o="channelsLast"){let[l,c,h,p]=[-1,-1,-1,-1];if(o==="channelsLast")[l,c,h,p]=n;else if(o==="channelsFirst")[l,p,c,h]=n;else throw new Error(`Unknown dataFormat ${o}`);const[m,v,,_]=e,[w,T]=G0(t),[E,C]=G0(s),A=am(m,E),D=am(v,C),{padInfo:F,outHeight:W,outWidth:B}=pue(r,c,h,w,T,A,D,i,o),P=a?_*p:_;let O;return o==="channelsFirst"?O=[l,P,W,B]:o==="channelsLast"&&(O=[l,W,B,P]),{batchSize:l,dataFormat:o,inHeight:c,inWidth:h,inChannels:p,outHeight:W,outWidth:B,outChannels:P,padInfo:F,strideHeight:w,strideWidth:T,filterHeight:m,filterWidth:v,effectiveFilterHeight:A,effectiveFilterWidth:D,dilationHeight:E,dilationWidth:C,inShape:n,outShape:O,filterShape:e}}function D6(n,e,t,s,r,i=!1,a="channelsLast",o){let[l,c,h,p,m]=[-1,-1,-1,-1,-1];if(a==="channelsLast")[l,c,h,p,m]=n;else if(a==="channelsFirst")[l,m,c,h,p]=n;else throw new Error(`Unknown dataFormat ${a}`);const[v,_,w,,T]=e,[E,C,A]=SI(t),[D,F,W]=SI(s),B=am(v,D),P=am(_,F),O=am(w,W),{padInfo:M,outDepth:k,outHeight:V,outWidth:G}=mue(r,c,h,p,E,C,A,B,P,O,o),ae=i?T*m:T;let J;return a==="channelsFirst"?J=[l,ae,k,V,G]:a==="channelsLast"&&(J=[l,k,V,G,ae]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:p,inChannels:m,outDepth:k,outHeight:V,outWidth:G,outChannels:ae,padInfo:M,strideDepth:E,strideHeight:C,strideWidth:A,filterDepth:v,filterHeight:_,filterWidth:w,effectiveFilterDepth:B,effectiveFilterHeight:P,effectiveFilterWidth:O,dilationDepth:D,dilationHeight:F,dilationWidth:W,inShape:n,outShape:J,filterShape:e}}function due(n,e,t,s,r){s==null&&(s=Jk(n,e,t));const i=n[0],a=n[1],o=rf((i-e+2*s)/t+1,r),l=rf((a-e+2*s)/t+1,r);return[o,l]}function fue(n,e,t,s,r,i){r==null&&(r=Jk(n,e,s));const a=n[0],o=n[1],l=n[2],c=rf((a-e+2*r)/s+1,i),h=rf((o-e+2*r)/s+1,i),p=rf((l-e+2*r)/s+1,i);return[c,h,p,t]}function Jk(n,e,t,s=1){const r=am(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function G0(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function SI(n){return typeof n=="number"?[n,n,n]:n}function am(n,e){return e<=1?n:n+(n-1)*(e-1)}function pue(n,e,t,s,r,i,a,o,l){let c,h,p;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const v=due([e,t],i,s,n,o);h=v[0],p=v[1]}else if(n==="same"){h=Math.ceil(e/s),p=Math.ceil(t/r);const m=Math.max(0,(h-1)*s+i-e),v=Math.max(0,(p-1)*r+a-t),_=Math.floor(m/2),w=m-_,T=Math.floor(v/2),E=v-T;c={top:_,bottom:w,left:T,right:E,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-i+1)/s),p=Math.ceil((t-a+1)/r);else if(typeof n=="object"){const m=l==="channelsLast"?n[1][0]:n[2][0],v=l==="channelsLast"?n[1][1]:n[2][1],_=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];c={top:m,bottom:v,left:_,right:w,type:m===0&&v===0&&_===0&&w===0?"VALID":"EXPLICIT"},h=rf((e-i+m+v)/s+1,o),p=rf((t-a+_+w)/r+1,o)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:h,outWidth:p}}function mue(n,e,t,s,r,i,a,o,l,c,h){let p,m,v,_;if(typeof n=="number"){p={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const T=fue([e,t,s,1],o,1,r,n,h);m=T[0],v=T[1],_=T[2]}else if(n==="same"){m=Math.ceil(e/r),v=Math.ceil(t/i),_=Math.ceil(s/a);const w=(m-1)*r+o-e,T=(v-1)*i+l-t,E=(_-1)*a+c-s,C=Math.floor(w/2),A=w-C,D=Math.floor(T/2),F=T-D,W=Math.floor(E/2),B=E-W;p={top:D,bottom:F,left:W,right:B,front:C,back:A,type:"SAME"}}else if(n==="valid")p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},m=Math.ceil((e-o+1)/r),v=Math.ceil((t-l+1)/i),_=Math.ceil((s-c+1)/a);else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:p,outDepth:m,outHeight:v,outWidth:_}}function rf(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function nv(n){const[e,t,s]=G0(n);return e===1&&t===1&&s===1}function tu(n,e){return nv(n)||nv(e)}function L6(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function uo(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")re(_m(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{re(_m(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gue(n,e){const s={x:Q(n,"x","reshape","string_or_numeric")},r={shape:e};return pe.runKernel(jV,s,r)}const ze=fe({reshape_:gue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yue(n,e,t,s,r){const i=Q(n,"x","avgPool","float32"),a=1;re(tu(t,a),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`);let o=i,l=!1;i.rank===3&&(l=!0,o=ze(i,[1,i.shape[0],i.shape[1],i.shape[2]])),re(o.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),uo("avgPool",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let p=pe.runKernel(nz,c,h);return p=is(p,i.dtype),l?ze(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const e2=fe({avgPool_:yue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(n,e,t,s,r,i="NDHWC"){const a=Q(n,"x","avgPool3d","float32");let o=a,l=!1;a.rank===4&&(l=!0,o=ze(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),re(o.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`),re(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),uo("avgPool3d",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let p=pe.runKernel(sz,c,h);return p=is(p,o.dtype),l?ze(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const O6=fe({avgPool3d_:vue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(n,e=0){re(n.length>=1,()=>"Pass at least one tensor to concat");const t=ev(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Vc(t[0]);const s=t,r={axis:e};return pe.runKernel(dz,s,r)}const zr=fe({concat_:bue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ue(n){const t={x:Q(n,"x","sigmoid","float32")};return pe.runKernel(eU,t)}const af=fe({sigmoid_:_ue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xue(n,e,t){const s=Q(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return pe.runKernel(ZV,r,i)}const Mn=fe({slice_:xue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wue(n){const t={x:Q(n,"x","tanh","float32")};return pe.runKernel(bU,t)}const W0=fe({tanh_:wue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tue(n,e,t,s,r,i){const a=Q(n,"forgetBias","basicLSTMCell"),o=Q(e,"lstmKernel","basicLSTMCell"),l=Q(t,"lstmBias","basicLSTMCell"),c=Q(s,"data","basicLSTMCell"),h=Q(r,"c","basicLSTMCell"),p=Q(i,"h","basicLSTMCell"),m=zr([c,p],1),v=wn(m,o),_=Et(v,l),w=_.shape[0],T=_.shape[1]/4,E=[w,T],C=Mn(_,[0,0],E),A=Mn(_,[0,T],E),D=Mn(_,[0,T*2],E),F=Mn(_,[0,T*3],E),W=Et(Ye(af(C),W0(A)),Ye(h,af(Et(a,D)))),B=Ye(W0(W),af(F));return[W,B]}const P6=fe({basicLSTMCell_:Tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(n,e,t){const s=Q(n,"x","batchToSpaceND"),r=e.reduce((o,l)=>o*l);re(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),re(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),re(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},a={blockShape:e,crops:t};return pe.runKernel(iz,i,a)}const t2=fe({batchToSpaceND_:Sue});function Eue(n){let e;return n.rank===0||n.rank===1?e=ze(n,[1,1,1,n.size]):n.rank===2?e=ze(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ze(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nue(n,e,t,s,r,i){i==null&&(i=.001);const a=Q(n,"x","batchNorm"),o=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let c;r!=null&&(c=Q(r,"scale","batchNorm"));let h;s!=null&&(h=Q(s,"offset","batchNorm")),re(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),re(h==null||o.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),re(c==null||o.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:Eue(a),scale:c,offset:h,mean:o,variance:l},v={varianceEpsilon:i},_=pe.runKernel(Uz,m,v);return ze(_,a.shape)}const Vv=fe({batchNorm_:Nue});function Iue(n,e,t,s,r,i){const a=Q(n,"x","batchNorm"),o=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let c;r!=null&&(c=Q(r,"scale","batchNorm"));let h;return s!=null&&(h=Q(s,"offset","batchNorm")),re(a.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`),re(o.rank===2||o.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`),re(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&re(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&re(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Vv(a,o,l,h,c,i)}const M6=fe({batchNorm2d_:Iue});function Cue(n,e,t,s,r,i){const a=Q(n,"x","batchNorm"),o=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let c;r!=null&&(c=Q(r,"scale","batchNorm"));let h;return s!=null&&(h=Q(s,"offset","batchNorm")),re(a.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`),re(o.rank===3||o.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`),re(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&re(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&re(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Vv(a,o,l,h,c,i)}const F6=fe({batchNorm3d_:Cue});function kue(n,e,t,s,r,i){const a=Q(n,"x","batchNorm"),o=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let c;r!=null&&(c=Q(r,"scale","batchNorm"));let h;return s!=null&&(h=Q(s,"offset","batchNorm")),re(a.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`),re(o.rank===4||o.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`),re(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&re(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&re(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Vv(a,o,l,h,c,i)}const j6=fe({batchNorm4d_:kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ue(n,e,t){const s=Q(n,"x","bincount"),r=Q(e,"weights","bincount");re(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),re(t>=0,()=>`size must be non-negative, but got ${t}.`),re(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},a={size:t};return pe.runKernel(az,i,a)}const n2=fe({bincount_:$ue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aue(n,e){const t=Q(n,"s0","broadcastArgs","int32"),s=Q(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:t,s1:s};return pe.runKernel(oz,r)}const B6=fe({broadcastArgs_:Aue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rue(n,e){let t=Q(n,"broadcastTo","x");const s=t.shape;if(e.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=ze(t,c)}const r=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return Vc(t);const o={x:t},l={reps:i};return pe.runKernel(Lk,o,l)}const Py=fe({broadcastTo_:Rue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Due(n){const t={x:Q(n,"x","ceil","float32")};return pe.runKernel(lz,t)}const z6=fe({ceil_:Due});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Km(n,e,t){const s={shape:n,value:e,dtype:t};return pe.runKernel(jz,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lue(n,e,t){const s=Q(n,"x","clipByValue");if(re(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Km(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return pe.runKernel(cz,r,i)}const V6=fe({clipByValue_:Lue});function Oue(n){return zr(n,0)}const U6=fe({concat1d_:Oue});function Pue(n,e){return zr(n,e)}const G6=fe({concat2d_:Pue});function Mue(n,e){return zr(n,e)}const W6=fe({concat3d_:Mue});function Fue(n,e){return zr(n,e)}const H6=fe({concat4d_:Fue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jue(n,e,t,s,r="NHWC",i=[1,1],a){const o=Q(n,"x","conv2d","float32"),l=Q(e,"filter","conv2d","float32");let c=o,h=!1;o.rank===3&&(h=!0,c=ze(o,[1,o.shape[0],o.shape[1],o.shape[2]])),re(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),re(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),uo("conv2d",s,a);const p=r==="NHWC"?c.shape[3]:c.shape[1];re(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),re(tu(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const m={x:c,filter:l},v={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a},_=pe.runKernel(fz,m,v);return h?ze(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const Uv=fe({conv2d_:jue});function Bue(n,e,t,s,r="NWC",i=1,a){const o=Q(n,"x","conv1d"),l=Q(e,"filter","conv1d");let c=o,h=!1;o.rank===2&&(h=!0,c=ze(o,[1,o.shape[0],o.shape[1]])),re(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),re(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),uo("conv1d",s,a),re(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),re(tu(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),re(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const p=ze(l,[1,l.shape[0],l.shape[1],l.shape[2]]),m=ze(c,[c.shape[0],1,c.shape[1],c.shape[2]]),T=Uv(m,p,[1,t],s,"NHWC",[1,i],a);return h?ze(T,[T.shape[2],T.shape[3]]):ze(T,[T.shape[0],T.shape[2],T.shape[3]])}const q6=fe({conv1d_:Bue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zue(n,e,t,s,r,i="NHWC",a){re(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,l=e,c=!1;e.rank===3&&(c=!0,l=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]]),o=[1,n[0],n[1],n[2]]),re(o.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`),re(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),re(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=i==="NHWC"?o[3]:o[1],p=i==="NHWC"?l.shape[3]:l.shape[1];re(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),re(p===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${t.shape[3]}.`),uo("conv2dDerInput",r,a);const m={dy:l,filter:t},v={strides:s,pad:r,dataFormat:i,dimRoundingMode:a,inputShape:o},_=pe.runKernel(mz,m,v);return c?ze(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const K6=fe({conv2DBackpropInput_:zue});function Vue(n,e,t,s,r,i){const a=Q(n,"x","conv2dTranspose"),o=Q(e,"filter","conv2dTranspose");return K6(t,a,o,s,r,"NHWC",i)}const X6=fe({conv2dTranspose_:Vue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(n,e,t,s,r="NDHWC",i=[1,1,1]){const a=Q(n,"x","conv3d"),o=Q(e,"filter","conv3d");let l=a,c=!1;a.rank===4&&(c=!0,l=ze(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),re(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),re(o.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`),re(l.shape[4]===o.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`),re(tu(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),re(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`);const h={x:l,filter:o},p={strides:t,pad:s,dataFormat:r,dilations:i},m=pe.runKernel(gz,h,p);return c?ze(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const Z6=fe({conv3d_:Uue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(n,e,t,s,r){re(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,a=e,o=!1;e.rank===4&&(o=!0,a=ze(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],c=a.shape[4];re(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),re(a.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`),re(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),re(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),re(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const h={dy:a,filter:t},p={pad:r,strides:s,inputShape:i},m=pe.runKernel(yz,h,p);return o?ze(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const Wue=fe({conv3DBackpropInput_:Gue});function Hue(n,e,t,s,r){const i=Q(n,"x","conv3dTranspose"),a=Q(e,"filter","conv3dTranspose");return Wue(t,i,a,s,r)}const Y6=fe({conv3dTranspose_:Hue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(n){const t={x:Q(n,"x","cos","float32")};return pe.runKernel(vz,t)}const Q6=fe({cos_:que});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(n){const t={x:Q(n,"x","cosh","float32")};return pe.runKernel(bz,t)}const J6=fe({cosh_:Kue});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(n,e=0,t=!1,s=!1){const i={x:Q(n,"x","cumprod")},a={axis:e,exclusive:t,reverse:s};return pe.runKernel(_z,i,a)}const eG=fe({cumprod_:Xue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zue(n,e=0,t=!1,s=!1){const i={x:Q(n,"x","cumsum")},a={axis:e,exclusive:t,reverse:s};return pe.runKernel(xz,i,a)}const tG=fe({cumsum_:Zue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yue(n,e,t,s=!1){const r=Q(n,"x","denseBincount"),i=Q(e,"weights","denseBincount");re(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),re(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),re(t>=0,()=>`size must be non-negative, but got ${t}.`),re(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const a={x:r,weights:i},o={size:t,binaryOutput:s};return pe.runKernel(Tz,a,o)}const nG=fe({denseBincount_:Yue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(n,e,t="NHWC"){const s=Q(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],a=t==="NHWC"?s.shape[3]:s.shape[1];re(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),re(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),re(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),re(a%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${a} for depthToSpace with input shape ${s.shape}`);const o={x:s},l={blockSize:e,dataFormat:t};return pe.runKernel(Sz,o,l)}const sG=fe({depthToSpace_:Que});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jue(n,e,t,s,r="NHWC",i=[1,1],a){const o=Q(n,"x","depthwiseConv2d","float32"),l=Q(e,"filter","depthwiseConv2d","float32");let c=o,h=!1;o.rank===3&&(h=!0,c=ze(o,[1,o.shape[0],o.shape[1],o.shape[2]])),re(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),re(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const p=r==="NHWC"?c.shape[3]:c.shape[1];re(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),uo("depthwiseConv2d",s,a);const m={x:c,filter:l},v={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a},_=pe.runKernel(Ez,m,v);return h?ze(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const nw=fe({depthwiseConv2d_:Jue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ehe(n){const t={x:Q(n,"x","diag")};return pe.runKernel(Cz,t)}const rG=fe({diag_:ehe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function the(n,e,t,s,r=[1,1],i="NHWC"){const a=Q(n,"x","dilation2d"),o=Q(e,"filter","dilation2d");re(a.rank===3||a.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`),re(o.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`),re(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=a,c=!1;a.rank===3&&(l=ze(a,[1,a.shape[0],a.shape[1],a.shape[2]]),c=!0);const h={x:l,filter:o},p={strides:t,pad:s,dilations:r},m=pe.runKernel(kz,h,p);return c?ze(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const iG=fe({dilation2d_:the});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nhe(n,e){let t=Q(n,"a","equal","string_or_numeric"),s=Q(e,"b","equal","string_or_numeric");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(Lz,r)}const s2=fe({equal_:nhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function she(n,e,t){const s=Q(e,"a","where"),r=Q(t,"b","where"),i=Q(n,"condition","where","bool"),a=js(js(i.shape,s.shape),r.shape),o=Py(i,a),l=Py(s,a),c=Py(r,a),h={condition:o,t:l,e:c};return pe.runKernel(KV,h)}const Tf=fe({where_:she});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rhe(n){const t={x:Q(n,"x","zerosLike")};return pe.runKernel(EU,t)}const Zi=fe({zerosLike_:rhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ihe(n,e){let t=Q(n,"a","div"),s=Q(e,"b","div");[t,s]=ds(t,s);const r=Wn(t,s),i=Zi(r),a=s2(s,i);return Tf(a,i,r)}const aG=fe({divNoNan_:ihe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ahe(n,e){const t=Q(n,"t1","dot"),s=Q(e,"t2","dot");re((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(re(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const a=ze(t,[1,-1]),o=ze(s,[-1,1]),l=wn(a,o);return ze(l,[])}else if(t.rank===1&&s.rank===2){const a=ze(t,[1,-1]),o=ze(s,[s.shape[0],s.shape[1]]),l=wn(a,o);return ze(l,[l.size])}else if(t.rank===2&&s.rank===1){const a=ze(s,[-1,1]),o=wn(t,a);return ze(o,[o.size])}else{const a=ze(s,[s.shape[0],s.shape[1]]);return wn(t,a)}}const oG=fe({dot_:ahe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ohe(n,...e){const t=e.map((r,i)=>Q(r,`tensors${i}`,"einsum")),s={equation:n};return pe.runKernel(Az,t,s)}const lG=fe({einsum_:ohe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lhe(n){const t={x:Q(n,"x","elu","float32")};return pe.runKernel(Rz,t)}const r2=fe({elu_:lhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function che(n){let e=Q(n,"x","erf");re(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=is(e,"float32"));const t={x:e};return pe.runKernel(Dz,t)}const cG=fe({erf_:che});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i2(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function uG(n,e,t){const s=n.length+e.length,r=[];let i=0,a=0;for(let o=0;o<s;o++)t.indexOf(o)===-1?r.push(n[i++]):r.push(e[a++]);return r}function uhe(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function Gv(n,e){const t=e.map(s=>1);return uG(n,t,e)}function hhe(n,e,t){re(i2(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function dhe(n,e){if(i2(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function fhe(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function phe(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mhe(n,e=null,t=!1){const r={x:Q(n,"x","max")},i={reductionIndices:e,keepDims:t};return pe.runKernel(cV,r,i)}const of=fe({max_:mhe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ghe(n,e=null,t=!1){const r={x:Q(n,"x","min")},i={axis:e,keepDims:t};return pe.runKernel(mV,r,i)}const H0=fe({min_:ghe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yhe(n,e){let t=Q(n,"base","pow"),s=Q(e,"exp","pow");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel($V,r)}const Tm=fe({pow_:yhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(n,e){if((Mr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Mr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xh(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vhe(n){const t={x:Q(n,"x","sqrt","float32")};return pe.runKernel(nU,t)}const Zl=fe({sqrt_:vhe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bhe(n){const e=Q(n,"x","square"),t={};return pe.runKernel("Square",{x:e},t)}const oo=fe({square_:bhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _he(n,e=null,t=!1){let s=Q(n,"x","sum");s.dtype==="bool"&&(s=is(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return pe.runKernel(sU,r,i)}const Gn=fe({sum_:_he});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xhe(n,e="euclidean",t=null,s=!1){n=Q(n,"x","norm");const r=hG(n,e,t);let i=r.shape;if(s){const a=Pv(t,n.shape);i=Gv(r.shape,a)}return ze(r,i)}function hG(n,e,t=null){if(n.rank===0)return Hi(n);if(n.rank!==1&&t===null)return hG(ze(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Gn(Hi(n),t);if(e===1/0)return of(Hi(n),t);if(e===-1/0)return H0(Hi(n),t);if(e==="euclidean"||e===2)return Zl(Gn(Tm(Hi(n),Xt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return of(Gn(Hi(n),t[0]),t[1]-1);if(e===1/0)return of(Gn(Hi(n),t[1]),t[0]);if(e===-1/0)return H0(Gn(Hi(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Zl(Gn(oo(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Wv=fe({norm_:xhe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function whe(n,e=null,t=!1){return Wv(n,"euclidean",e,t)}const dG=fe({euclideanNorm_:whe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function The(n){const t={x:Q(n,"x","exp")};return pe.runKernel(Oz,t)}const Ph=fe({exp_:The});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(n,e=0){const t=Q(n,"x","expandDims","string_or_numeric");re(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return pe.runKernel(Pz,s,r)}const $c=fe({expandDims_:She});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(n){const t={x:Q(n,"x","expm1")};return pe.runKernel(Mz,t)}const fG=fe({expm1_:Ehe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nhe(n,e){const t=Q(n,"x","tile","string_or_numeric");re(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return pe.runKernel(Lk,s,r)}const om=fe({tile_:Nhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ihe(n,e,t,s="float32"){e==null&&(e=n);const r=Ko([n,e],s),i=n<=e?n:e;for(let o=0;o<i;++o)r.set(1,o,o);const a=ze(r.toTensor(),[n,e]);if(t==null)return a;if(t.length===1)return om($c(a,0),[t[0],1,1]);if(t.length===2)return om($c($c(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return om($c($c($c(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const a2=fe({eye_:Ihe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Che(n){const t={x:Q(n,"x","floor","float32")};return pe.runKernel(zz,t)}const o2=fe({floor_:Che});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function khe(n,e,t=0,s=0){const r=Q(n,"x","gather"),i=Q(e,"indices","gather","int32"),a={x:r,indices:i},o={axis:t,batchDims:s};return pe.runKernel(Gz,a,o)}const l2=fe({gather_:khe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $he(n,e){let t=Q(n,"a","greater","string_or_numeric"),s=Q(e,"b","greater","string_or_numeric");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(Hz,r)}const Hv=fe({greater_:$he});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ahe(n,e){let t=Q(n,"a","greaterEqual","string_or_numeric"),s=Q(e,"b","greaterEqual","string_or_numeric");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(qz,r)}const c2=fe({greaterEqual_:Ahe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rhe(n){const t={x:Q(n,"x","isFinite")};return pe.runKernel(Zz,t)}const pG=fe({isFinite_:Rhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dhe(n){const t={x:Q(n,"x","isInf")};return pe.runKernel(Yz,t)}const mG=fe({isInf_:Dhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lhe(n){const t={x:Q(n,"x","isNaN")};return pe.runKernel(Qz,t)}const gG=fe({isNaN_:Lhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ohe(n,e=.2){const s={x:Q(n,"x","leakyRelu")},r={alpha:e};return pe.runKernel(Jz,s,r)}const u2=fe({leakyRelu_:Ohe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(n,e){let t=Q(n,"a","less","string_or_numeric"),s=Q(e,"b","less","string_or_numeric");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(eV,r)}const yG=fe({less_:Phe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mhe(n,e){let t=Q(n,"a","lessEqual","string_or_numeric"),s=Q(e,"b","lessEqual","string_or_numeric");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(tV,r)}const sw=fe({lessEqual_:Mhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vG(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const s={start:n,stop:e,num:t};return pe.runKernel(nV,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fhe(n,e=5,t=1,s=1,r=.5){const i=Q(n,"x","localResponseNormalization");re(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),re(_m(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let a=i,o=!1;i.rank===3&&(o=!0,a=ze(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:a},c={depthRadius:e,bias:t,alpha:s,beta:r},h=pe.runKernel(lV,l,c);return o?ze(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const bG=fe({localResponseNormalization_:Fhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jhe(n){const t={x:Q(n,"x","log","float32")};return pe.runKernel(sV,t)}const Sm=fe({log_:jhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bhe(n){const t={x:Q(n,"x","log1p")};return pe.runKernel(rV,t)}const h2=fe({log1p_:Bhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zhe(n){return re(Lh(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const s=Q(e,"x","tf.grad","string_or_numeric"),r=t!=null?Q(t,"dy","tf.grad"):null;return pe.tidy(()=>{const{value:i,grads:a}=pe.gradients(()=>n(s),[s],r);return r!=null&&vi(i.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),rw(a),a[0]})}}function Vhe(n){return re(Lh(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{re(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=ev(e,"args","tf.grads","string_or_numeric"),r=t!=null?Q(t,"dy","tf.grads"):null;return pe.tidy(()=>{const{value:i,grads:a}=pe.gradients(()=>n(...s),s,r);return r!=null&&vi(i.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),rw(a),a})}}function Uhe(n){return re(Lh(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{re(e instanceof us,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),re(t==null||t instanceof us,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=pe.gradients(()=>n(e),[e],t);return rw(s),{grad:s[0],value:r}}}function Ghe(n){return re(Lh(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{re(Array.isArray(e)&&e.every(r=>r instanceof us),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),re(t==null||t instanceof us,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=pe.gradients(()=>n(...e),e,t);return t!=null&&vi(s.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),rw(s.grads),s}}function _G(n,e){re(Lh(n),()=>"The f passed in variableGrads(f) must be a function"),re(e==null||Array.isArray(e)&&e.every(c=>c instanceof Jy),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in pe.registeredVariables)e.push(pe.registeredVariables[c])}const s=t?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),re(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:a,grads:o}=pe.gradients(n,e,null,i);re(o.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),re(a.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${a.rank} tensor`);const l={};return e.forEach((c,h)=>{o[h]!=null&&(l[c.name]=o[h])}),s?.forEach(c=>l[c.name]=null),{value:a,grads:l}}function Yl(n){return pe.customGrad(n)}function rw(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Whe(n){const t={x:Q(n,"x","softplus")};return pe.runKernel(tU,t)}const d2=fe({softplus_:Whe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hhe(n){const e=Q(n,"x","logSigmoid");return Yl(s=>({value:Fl(d2(Fl(s))),gradFunc:a=>Ye(a,af(Fl(s)))}))(e)}const xG=fe({logSigmoid_:Hhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qhe(n,e){let t=Q(n,"a","sub"),s=Q(e,"b","sub");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel(yU,r)}const Bt=fe({sub_:qhe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Khe(n,e=-1){const t=Q(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Yl((r,i)=>{const o=of(r,e,!0),l=Bt(r,o),c=Bt(is(l,"float32"),Sm(Gn(Ph(l),e,!0)));return i([c]),{value:c,gradFunc:(p,m)=>{const[v]=m,_=!0,w=Ph(v);return Bt(p,Ye(Gn(p,e,_),w))}}})(t)}const wG=fe({logSoftmax_:Khe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xhe(n,e=null,t=!1){const s=Q(n,"x","logSumExp"),r=Pv(e,s.shape),i=of(s,r,!0),a=Bt(s,i),o=Ph(a),l=Gn(o,r),c=Sm(l),h=Et(ze(i,c.shape),c);if(t){const p=Gv(h.shape,r);return ze(h,p)}return h}const f2=fe({logSumExp_:Xhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zhe(n,e){const t=Q(n,"a","logicalAnd","bool"),s=Q(e,"b","logicalAnd","bool");js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(iV,r)}const sv=fe({logicalAnd_:Zhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yhe(n){const t={x:Q(n,"x","logicalNot","bool")};return pe.runKernel(aV,t)}const p2=fe({logicalNot_:Yhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qhe(n,e){const t=Q(n,"a","logicalOr","bool"),s=Q(e,"b","logicalOr","bool");js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(oV,r)}const m2=fe({logicalOr_:Qhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jhe(n,e){const t=Q(n,"a","logicalXor","bool"),s=Q(e,"b","logicalXor","bool");return js(t.shape,s.shape),sv(m2(n,e),p2(sv(n,e)))}const TG=fe({logicalXor_:Jhe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nx=2147483648;function ede(n,e,t="left"){const s=Q(n,"sortedSequence","searchSorted"),r=Q(e,"values","searchSorted"),i=s.shape[s.shape.length-1],a=r.shape[r.shape.length-1],o=ze(s,[-1,i]),l=ze(r,[-1,a]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(es(l.shape)>=Nx)throw new Error(`values tensor size must less than ${Nx}`);if(o.shape[1]>=Nx)throw new Error(`trailing dim_size must less than ${Nx} for int32 output type, was ${o.shape[1]}`);const c={sortedSequence:o,values:l},h={side:t};return pe.runKernel(qV,c,h)}const iw=fe({searchSorted_:ede});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SG(n,e){return iw(n,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tde(n,e,t,s,r){const i=Q(n,"x","maxPool"),a=1;let o=i,l=!1;i.rank===3&&(l=!0,o=ze(i,[1,i.shape[0],i.shape[1],i.shape[2]])),re(o.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),re(tu(t,a),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),uo("maxPool",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r},p=pe.runKernel(hV,c,h);return l?ze(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const g2=fe({maxPool_:tde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nde(n,e=[1,1,1],t,s,r,i="NDHWC"){const a=Q(n,"x","maxPool3d");let o=a,l=!1;a.rank===4&&(l=!0,o=ze(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),re(o.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`),re(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),uo("maxPool3d",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},p=pe.runKernel(dV,c,h);return l?ze(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const EG=fe({maxPool3d_:nde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sde(n,e,t,s,r=!1){const a={x:Q(n,"x","maxPoolWithArgmax")},o={filterSize:e,strides:t,pad:s,includeBatchInIndex:r},l=pe.runKernel(fV,a,o);return{result:l[0],indexes:l[1]}}const NG=fe({maxPoolWithArgmax_:sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rde(n,e){let t=Q(n,"a","maximum"),s=Q(e,"b","maximum");[t,s]=ds(t,s),t.dtype==="bool"&&(t=is(t,"int32"),s=is(s,"int32")),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(uV,r)}const y2=fe({maximum_:rde});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(n,e=null,t=!1){const r={x:Q(n,"x","mean")},i={axis:e,keepDims:t};return pe.runKernel(pV,r,i)}const rv=fe({mean_:ide});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sf(n,e="float32"){if(e==="complex64"){const s=Sf(n,"float32"),r=Sf(n,"float32");return Xc(s,r)}const t=J1(es(n),e);return pe.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dh(n,e="float32"){if(e==="complex64"){const s=dh(n,"float32"),r=Sf(n,"float32");return Xc(s,r)}const t=Ik(es(n),e);return pe.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IG(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let s=Q(n,"x","meshgrid",n instanceof us?n.dtype:"float32");if(e===void 0)return[s];let r=Q(e,"y","meshgrid",e instanceof us?e.dtype:"float32");const i=es(s.shape),a=es(r.shape);return t==="xy"?(s=ze(s,[1,-1]),r=ze(r,[-1,1]),[wn(dh([a,1],s.dtype),s),wn(r,dh([1,i],r.dtype))]):(s=ze(s,[-1,1]),r=ze(r,[1,-1]),[wn(s,dh([1,a],s.dtype)),wn(dh([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ade(n,e){let t=Q(n,"a","minimum"),s=Q(e,"b","minimum");[t,s]=ds(t,s),t.dtype==="bool"&&(t=is(t,"int32"),s=is(s,"int32")),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(gV,r)}const v2=fe({minimum_:ade});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ode(n,e,t){re(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=Q(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");re(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let o=0;o<s.rank;o++)re(e[o].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),re(e[o][0]>=0&&e[o][0]<=s.shape[o]-r&&e[o][1]>=0&&e[o][1]<=s.shape[o]-r,()=>`Padding in dimension ${o} cannot be greater than or equal to ${s.shape[o]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},a={x:s};return pe.runKernel(yV,a,i)}const CG=fe({mirrorPad_:ode});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lde(n,e){let t=Q(n,"a","mod"),s=Q(e,"b","mod");[t,s]=ds(t,s);const r={a:t,b:s};return pe.runKernel(vV,r)}const kG=fe({mod_:lde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cde(n,e=null,t=!1){n=Q(n,"x","moments");const s=Pv(e,n.shape),r=rv(n,s,t);let i=r.shape;t||(i=Gv(r.shape,s));const a=oo(Bt(is(n,"float32"),ze(r,i))),o=rv(a,s,t);return{mean:r,variance:o}}const $G=fe({moments_:cde});function ude(n,e,t,s){const r=Q(e,"data","multiRNNCell"),i=ev(t,"c","multiRNNCell"),a=ev(s,"h","multiRNNCell");let o=r;const l=[];for(let p=0;p<n.length;p++){const m=n[p](o,i[p],a[p]);l.push(m[0]),l.push(m[1]),o=m[1]}const c=[],h=[];for(let p=0;p<l.length;p+=2)c.push(l[p]),h.push(l[p+1]);return[c,h]}const AG=fe({multiRNNCell_:ude});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hde(n,e,t,s=!1){const r=Q(n,"logits","multinomial"),i=r.size,a=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(a>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${a}`);t=t||Math.random();const l={logits:a===1?ze(r,[1,-1]):r},c={numSamples:e,seed:t,normalized:s},h=pe.runKernel(bV,l,c);return a===1?ze(h,[h.size]):h}const RG=fe({multinomial_:hde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde(n,e){let t=Q(n,"a","notEqual","string_or_numeric"),s=Q(e,"b","notEqual","string_or_numeric");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s};return pe.runKernel(wV,r)}const b2=fe({notEqual_:dde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fde(n){const t={x:Q(n,"x","onesLike")};return pe.runKernel(NV,t)}const DG=fe({onesLike_:fde});function pde(n,e){const t=Q(n,"v1","outerProduct"),s=Q(e,"v2","outerProduct");re(t.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${s.rank}.`);const r=ze(t,[-1,1]),i=ze(s,[1,-1]);return wn(r,i)}const LG=fe({outerProduct_:pde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mde(n,e,t=0){const s=Q(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return pe.runKernel(kV,i,r)}const Xm=fe({pad_:mde});function gde(n,e,t=0){return re(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Xm(n,[e],t)}const OG=fe({pad1d_:gde});function yde(n,e,t=0){return re(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xm(n,e,t)}const PG=fe({pad2d_:yde});function vde(n,e,t=0){return re(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xm(n,e,t)}const MG=fe({pad3d_:vde});function bde(n,e,t=0){return re(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xm(n,e,t)}const FG=fe({pad4d_:bde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _de(n,e,t){const s=Q(n,"x","spaceToBatchND");re(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),re(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),re(s.shape.reduce((a,o,l)=>l>0&&l<=e.length?a&&(o+t[l-1][0]+t[l-1][1])%e[l-1]===0:a,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return pe.runKernel(rU,r,i)}const _2=fe({spaceToBatchND_:_de});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xde(n,e,t,s,r,i,a){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const o=Q(n,"x","maxPool");let l=o,c=!1;o.rank===3&&(c=!0,l=ze(o,[1,o.shape[0],o.shape[1],o.shape[2]])),re(tu(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const h=R6(l.shape,e,i,r,s),p=[h.dilationHeight,h.dilationWidth];let m;s==="same"?m=Tde([h.filterHeight,h.filterWidth],p):m=[[0,0],[0,0]];const v=p[0]===1&&p[1]===1,[_,w]=wde([h.inHeight,h.inWidth],p,m),T=v?s:"valid",E=v?l:_2(l,p,_),A=(t==="avg"?()=>e2(E,e,i,T,a):()=>g2(E,e,i,T,a))(),D=v?A:t2(A,p,w);return c?ze(D,[D.shape[1],D.shape[2],D.shape[3]]):D}function wde(n,e,t){const s=t.map(h=>h[0]),r=t.map(h=>h[1]),i=n.concat(s,r),a=e.map((h,p)=>(h-i[p]%h)%h),o=r.map((h,p)=>h+a[p]),l=e.map((h,p)=>[s[p],o[p]]),c=e.map((h,p)=>[0,a[p]]);return[l,c]}function Tde(n,e){const s=n.map((a,o)=>a+(a-1)*(e[o]-1)).map(a=>a-1),r=s.map(a=>Math.floor(a/2)),i=s.map((a,o)=>a-r[o]);return s.map((a,o)=>[r[o],i[o]])}const jG=fe({pool_:xde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sde(n,e){const t=Q(n,"x","prelu"),s=Q(e,"alpha","prelu"),r={x:t,alpha:s};return pe.runKernel(AV,r)}const x2=fe({prelu_:Sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ede(n,e=null,t=!1){let s=Q(n,"x","prod");s.dtype==="bool"&&(s=is(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return pe.runKernel(RV,r,i)}const BG=fe({prod_:Ede});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nde(n,e,t,s){const r=n.map((h,p)=>Q(h,`tensors${p}`,"raggedGather","int32")),i=Q(e,"paramsDenseValues","raggedGather"),a=Q(t,"indices","raggedGather","int32"),o={paramsNestedSplits:r,paramsDenseValues:i,indices:a},l={outputRaggedRank:s},c=pe.runKernel(DV,o,l);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}const zG=fe({raggedGather_:Nde});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ide(n,e,t,s,r){const i=Q(n,"shape","raggedTensorToTensor","int32"),a=Q(e,"values","raggedTensorToTensor"),o=Q(t,"defaultValue","raggedTensorToTensor",a.dtype),l=s.map((p,m)=>Q(p,`tensors${m}`,"raggedTensorToTensor","int32")),c={shape:i,values:a,defaultValue:o,rowPartitionTensors:l},h={rowPartitionTypes:r};return pe.runKernel(LV,c,h)}const VG=fe({raggedTensorToTensor_:Ide});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cde(n,e,t){const s=es(n);let r=null;if(t==null||t==="float32")r=new Float32Array(s);else if(t==="int32")r=new Int32Array(s);else if(t==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${t}`);for(let i=0;i<s;i++)r[i]=e();return pe.makeTensor(r,n,t)}const UG=fe({rand_:Cde});var r0={exports:{}},kde=r0.exports,yM;function $de(){return yM||(yM=1,(function(n){(function(e,t,s){function r(l){var c=this,h=o();c.next=function(){var p=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=p-(c.c=p|0)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(l),c.s0<0&&(c.s0+=1),c.s1-=h(l),c.s1<0&&(c.s1+=1),c.s2-=h(l),c.s2<0&&(c.s2+=1),h=null}function i(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function a(l,c){var h=new r(l),p=c&&c.state,m=h.next;return m.int32=function(){return h.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&i(p,h),m.state=function(){return i(h,{})}),m}function o(){var l=4022871197,c=function(h){h=String(h);for(var p=0;p<h.length;p++){l+=h.charCodeAt(p);var m=.02519603282416938*l;l=m>>>0,m-=l,m*=l,l=m>>>0,m-=l,l+=m*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=a:this.alea=a})(kde,n)})(r0)),r0.exports}var i0={exports:{}},Ade=i0.exports,vM;function Rde(){return vM||(vM=1,(function(n){(function(e,t,s){function r(o){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var p=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^p^p>>>8},o===(o|0)?l.x=o:c+=o;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,l.next()}function i(o,l){return l.x=o.x,l.y=o.y,l.z=o.z,l.w=o.w,l}function a(o,l){var c=new r(o),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,v=(c.next()>>>0)/4294967296,_=(m+v)/(1<<21);while(_===0);return _},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&i(h,c),p.state=function(){return i(c,{})}),p}t&&t.exports?t.exports=a:this.xor128=a})(Ade,n)})(i0)),i0.exports}var a0={exports:{}},Dde=a0.exports,bM;function Lde(){return bM||(bM=1,(function(n){(function(e,t,s){function r(o){var l=this,c="";l.next=function(){var p=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(p^p<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,o===(o|0)?l.x=o:c+=o;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,h==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(o,l){return l.x=o.x,l.y=o.y,l.z=o.z,l.w=o.w,l.v=o.v,l.d=o.d,l}function a(o,l){var c=new r(o),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,v=(c.next()>>>0)/4294967296,_=(m+v)/(1<<21);while(_===0);return _},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&i(h,c),p.state=function(){return i(c,{})}),p}t&&t.exports?t.exports=a:this.xorwow=a})(Dde,n)})(a0)),a0.exports}var o0={exports:{}},Ode=o0.exports,_M;function Pde(){return _M||(_M=1,(function(n){(function(e,t,s){function r(o){var l=this;l.next=function(){var h=l.x,p=l.i,m,v;return m=h[p],m^=m>>>7,v=m^m<<24,m=h[p+1&7],v^=m^m>>>10,m=h[p+3&7],v^=m^m>>>3,m=h[p+4&7],v^=m^m<<7,m=h[p+7&7],m=m^m<<13,v^=m^m<<9,h[p]=v,l.i=p+1&7,v};function c(h,p){var m,v=[];if(p===(p|0))v[0]=p;else for(p=""+p,m=0;m<p.length;++m)v[m&7]=v[m&7]<<15^p.charCodeAt(m)+v[m+1&7]<<13;for(;v.length<8;)v.push(0);for(m=0;m<8&&v[m]===0;++m);for(m==8?v[7]=-1:v[m],h.x=v,h.i=0,m=256;m>0;--m)h.next()}c(l,o)}function i(o,l){return l.x=o.x.slice(),l.i=o.i,l}function a(o,l){o==null&&(o=+new Date);var c=new r(o),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,v=(c.next()>>>0)/4294967296,_=(m+v)/(1<<21);while(_===0);return _},p.int32=c.next,p.quick=p,h&&(h.x&&i(h,c),p.state=function(){return i(c,{})}),p}t&&t.exports?t.exports=a:this.xorshift7=a})(Ode,n)})(o0)),o0.exports}var l0={exports:{}},Mde=l0.exports,xM;function Fde(){return xM||(xM=1,(function(n){(function(e,t,s){function r(o){var l=this;l.next=function(){var h=l.w,p=l.X,m=l.i,v,_;return l.w=h=h+1640531527|0,_=p[m+34&127],v=p[m=m+1&127],_^=_<<13,v^=v<<17,_^=_>>>15,v^=v>>>12,_=p[m]=_^v,l.i=m,_+(h^h>>>16)|0};function c(h,p){var m,v,_,w,T,E=[],C=128;for(p===(p|0)?(v=p,p=null):(p=p+"\0",v=0,C=Math.max(C,p.length)),_=0,w=-32;w<C;++w)p&&(v^=p.charCodeAt((w+32)%p.length)),w===0&&(T=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,w>=0&&(T=T+1640531527|0,m=E[w&127]^=v+T,_=m==0?_+1:0);for(_>=128&&(E[(p&&p.length||0)&127]=-1),_=127,w=512;w>0;--w)v=E[_+34&127],m=E[_=_+1&127],v^=v<<13,m^=m<<17,v^=v>>>15,m^=m>>>12,E[_]=v^m;h.w=T,h.X=E,h.i=_}c(l,o)}function i(o,l){return l.i=o.i,l.w=o.w,l.X=o.X.slice(),l}function a(o,l){o==null&&(o=+new Date);var c=new r(o),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,v=(c.next()>>>0)/4294967296,_=(m+v)/(1<<21);while(_===0);return _},p.int32=c.next,p.quick=p,h&&(h.X&&i(h,c),p.state=function(){return i(c,{})}),p}t&&t.exports?t.exports=a:this.xor4096=a})(Mde,n)})(l0)),l0.exports}var c0={exports:{}},jde=c0.exports,wM;function Bde(){return wM||(wM=1,(function(n){(function(e,t,s){function r(o){var l=this,c="";l.next=function(){var p=l.b,m=l.c,v=l.d,_=l.a;return p=p<<25^p>>>7^m,m=m-v|0,v=v<<24^v>>>8^_,_=_-p|0,l.b=p=p<<20^p>>>12^m,l.c=m=m-v|0,l.d=v<<16^m>>>16^_,l.a=_-p|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,o===Math.floor(o)?(l.a=o/4294967296|0,l.b=o|0):c+=o;for(var h=0;h<c.length+20;h++)l.b^=c.charCodeAt(h)|0,l.next()}function i(o,l){return l.a=o.a,l.b=o.b,l.c=o.c,l.d=o.d,l}function a(o,l){var c=new r(o),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,v=(c.next()>>>0)/4294967296,_=(m+v)/(1<<21);while(_===0);return _},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&i(h,c),p.state=function(){return i(c,{})}),p}t&&t.exports?t.exports=a:this.tychei=a})(jde,n)})(c0)),c0.exports}var u0={exports:{}};const zde={},Vde=Object.freeze(Object.defineProperty({__proto__:null,default:zde},Symbol.toStringTag,{value:"Module"})),Ude=yF(Vde);var Gde=u0.exports,TM;function Wde(){return TM||(TM=1,(function(n){(function(e,t,s){var r=256,i=6,a=52,o="random",l=s.pow(r,i),c=s.pow(2,a),h=c*2,p=r-1,m;function v(D,F,W){var B=[];F=F==!0?{entropy:!0}:F||{};var P=E(T(F.entropy?[D,A(t)]:D??C(),3),B),O=new _(B),M=function(){for(var k=O.g(i),V=l,G=0;k<c;)k=(k+G)*r,V*=r,G=O.g(1);for(;k>=h;)k/=2,V/=2,G>>>=1;return(k+G)/V};return M.int32=function(){return O.g(4)|0},M.quick=function(){return O.g(4)/4294967296},M.double=M,E(A(O.S),t),(F.pass||W||function(k,V,G,ae){return ae&&(ae.S&&w(ae,O),k.state=function(){return w(O,{})}),G?(s[o]=k,V):k})(M,P,"global"in F?F.global:this==s,F.state)}function _(D){var F,W=D.length,B=this,P=0,O=B.i=B.j=0,M=B.S=[];for(W||(D=[W++]);P<r;)M[P]=P++;for(P=0;P<r;P++)M[P]=M[O=p&O+D[P%W]+(F=M[P])],M[O]=F;(B.g=function(k){for(var V,G=0,ae=B.i,J=B.j,X=B.S;k--;)V=X[ae=p&ae+1],G=G*r+X[p&(X[ae]=X[J=p&J+V])+(X[J]=V)];return B.i=ae,B.j=J,G})(r)}function w(D,F){return F.i=D.i,F.j=D.j,F.S=D.S.slice(),F}function T(D,F){var W=[],B=typeof D,P;if(F&&B=="object")for(P in D)try{W.push(T(D[P],F-1))}catch{}return W.length?W:B=="string"?D:D+"\0"}function E(D,F){for(var W=D+"",B,P=0;P<W.length;)F[p&P]=p&(B^=F[p&P]*19)+W.charCodeAt(P++);return A(F)}function C(){try{var D;return m&&(D=m.randomBytes)?D=D(r):(D=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(D)),A(D)}catch{var F=e.navigator,W=F&&F.plugins;return[+new Date,e,W,e.screen,A(t)]}}function A(D){return String.fromCharCode.apply(0,D)}if(E(s.random(),t),n.exports){n.exports=v;try{m=Ude}catch{}}else s["seed"+o]=v})(typeof self<"u"?self:Gde,[],Math)})(u0)),u0.exports}var nN,SM;function Hde(){if(SM)return nN;SM=1;var n=$de(),e=Rde(),t=Lde(),s=Pde(),r=Fde(),i=Bde(),a=Wde();return a.alea=n,a.xor128=e,a.xorwow=t,a.xorshift7=s,a.xor4096=r,a.tychei=i,nN=a,nN}var Zm=Hde();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let w2=class{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const a=i||Math.random();this.random=Zm.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,a;do r=2*this.random()-1,i=2*this.random()-1,a=r*r+i*i;while(a>=1||a===0);const o=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*i*o,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}};class qde{constructor(e,t,s,r){this.alpha=e,this.beta=1/t,this.dtype=s;const i=r||Math.random();this.randu=Zm.alea(i.toString()),this.randn=new w2(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,s,r,i,a;for(;;){do r=this.randn.nextValue(),a=1+this.c*r;while(a<=0);if(a*=a*a,e=r*r,t=1-.331*e*e,s=.5*e+this.d*(1-a+Math.log(a)),i=this.randu(),i<t||Math.log(i)<s)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}let Kde=class{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Zm.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xde(n,e,t=1,s="float32",r){if(t==null&&(t=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new qde(e,t,s,r),a=Ko(n,s);for(let o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}const GG=fe({randomGamma_:Xde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zde(n,e=0,t=1,s,r){if(s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new w2(e,t,s,!1,r),a=Ko(n,s);for(let o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}const T2=fe({randomNormal_:Zde});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return T2(n,0,1,e,t)}const WG=fe({randomStandardNormal_:Yde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qde(n,e=0,t=1,s="float32",r){const i=Ko(n,s),a=new Kde(e,t,null,r);for(let o=0;o<i.values.length;o++)i.values[o]=a.nextValue();return i.toTensor()}const S2=fe({randomUniform_:Qde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Em(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return pe.runKernel(OV,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jde(n){const t={x:Q(n,"x","reciprocal")};return pe.runKernel(MV,t)}const HG=fe({reciprocal_:Jde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function efe(n){const t={x:Q(n,"x","relu")};return pe.runKernel(FV,t)}const qv=fe({relu_:efe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tfe(n){const t={x:Q(n,"x","relu6")};return pe.runKernel(VV,t)}const E2=fe({relu6_:tfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nfe(n,e){const s={x:Q(n,"x","reverse")},r={dims:e};return pe.runKernel(UV,s,r)}const Mh=fe({reverse_:nfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sfe(n){const e=Q(n,"x","reverse");return re(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Mh(e,0)}const qG=fe({reverse1d_:sfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rfe(n,e){const t=Q(n,"x","reverse");return re(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Mh(t,e)}const KG=fe({reverse2d_:rfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ife(n,e){const t=Q(n,"x","reverse");return re(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Mh(t,e)}const XG=fe({reverse3d_:ife});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function afe(n,e){const t=Q(n,"x","reverse");return re(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Mh(t,e)}const ZG=fe({reverse4d_:afe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ofe(n){const t={x:Q(n,"x","round")};return pe.runKernel(GV,t)}const N2=fe({round_:ofe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lfe(n){const t={x:Q(n,"x","rsqrt","float32")};return pe.runKernel(WV,t)}const YG=fe({rsqrt_:lfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cfe(n){const t={x:Q(n,"x","selu")};return pe.runKernel(XV,t)}const QG=fe({selu_:cfe});function ufe(n,e,t,s,r,i=[1,1],a="NHWC"){const o=Q(n,"x","separableConv2d"),l=Q(e,"depthwiseFilter","separableConv2d"),c=Q(t,"pointwiseFilter","separableConv2d");let h=o,p=!1;if(o.rank===3&&(p=!0,h=ze(o,[1,o.shape[0],o.shape[1],o.shape[2]])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");re(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),re(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),re(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),re(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),re(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const m=l.shape[2],v=l.shape[3];re(c.shape[2]===m*v,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*v}, but got ${c.shape[2]}.`);const _=nw(h,l,s,r,a,i),T=Uv(_,c,1,"valid",a);return p?ze(T,[T.shape[1],T.shape[2],T.shape[3]]):T}const JG=fe({separableConv2d_:ufe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function hfe(n,e){const t=Q(n,"x","setdiff1d"),s=Q(e,"y","setdiff1d");re(t.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${s.dtype}).`),re(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),re(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await t.data(),i=await s.data(),a=new Set(i);let o=0;for(let h=0;h<r.length;h++)a.has(r[h])||o++;const l=new z0([o],t.dtype),c=new z0([o],"int32");for(let h=0,p=0;h<r.length;h++)a.has(r[h])||(l.values[p]=r[h],c.values[p]=h,p++);return[l.toTensor(),c.toTensor()]}const eW=hfe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dfe(n){const t={x:Q(n,"x","sign")};return pe.runKernel(JV,t)}const tW=fe({sign_:dfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ffe(n){const t={x:Q(n,"x","sin","float32")};return pe.runKernel(YV,t)}const nW=fe({sin_:ffe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pfe(n){const t={x:Q(n,"x","sinh")};return pe.runKernel(QV,t)}const sW=fe({sinh_:pfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mfe(n,e,t){const s=Q(n,"x","slice1d");return re(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Mn(s,[e],[t])}const rW=fe({slice1d_:mfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gfe(n,e,t){const s=Q(n,"x","slice2d");return re(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Mn(s,e,t)}const iW=fe({slice2d_:gfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yfe(n,e,t){const s=Q(n,"x","slice3d");return re(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Mn(s,e,t)}const aW=fe({slice3d_:yfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vfe(n,e,t){const s=Q(n,"x","slice4d");return re(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Mn(s,e,t)}const oW=fe({slice4d_:vfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(n,e=-1){const t=Q(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return pe.runKernel(aU,s,r)}const lW=fe({softmax_:bfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _fe(n){re(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return pe.runKernel(Fz,e)}const aw=fe({fft_:_fe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xfe(n){re(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return pe.runKernel(Kz,e)}const iv=fe({ifft_:xfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wfe(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ze(n,[t,e]);s=iv(r)}else{const r=[t,2*(e-1)],i=ze(wm(n),[t,e]),a=ze(Bv(n),[t,e]),o=Mh(Mn(i,[0,1],[t,e-2]),1),l=Ye(Mh(Mn(a,[0,1],[t,e-2]),1),Xt(-1)),c=zr([i,o],1),h=zr([a,l],1),p=ze(Xc(c,h),[r[0],r[1]]);s=iv(p)}if(s=wm(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=ze(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const I2=fe({irfft_:wfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tfe(n,e,t=0){const r={x:Q(n,"x","split")},i={numOrSizeSplits:e,axis:t};return pe.runKernel(iU,r,i)}const Nm=fe({split_:Tfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sfe(n,e){re(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const _=n.shape.map(T=>0),w=n.shape.map(T=>T);w[n.shape.length-1]=e,r=Mn(n,_,w),t=e}else if(e!=null&&e>t){const _=n.shape.map(w=>w);_[n.shape.length-1]=e-t,r=zr([n,Sf(_)],n.shape.length-1),t=e}else r=n;const i=Zi(r),a=ze(Xc(r,i),[s,t]),o=aw(a),l=Math.floor(t/2)+1,c=wm(o),h=Bv(o),p=Nm(c,[l,t-l],c.shape.length-1),m=Nm(h,[l,t-l],h.shape.length-1),v=r.shape.slice();return v[r.shape.length-1]=l,ze(Xc(p[0],m[0]),v)}const ow=fe({rfft_:Sfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Efe(n,e){let t=Q(n,"a","squaredDifference"),s=Q(e,"b","squaredDifference");[t,s]=ds(t,s),js(t.shape,s.shape);const r={a:t,b:s},i={};return pe.runKernel(dU,r,i)}const C2=fe({squaredDifference_:Efe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(n,e){const t=Q(n,"x","squeeze","string_or_numeric");return ze(t,RB(t.shape,e).newShape)}const Kv=fe({squeeze_:Nfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ife(n,e=0){const t=ev(n,"tensors","stack","string_or_numeric");re(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&re(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return pe.runKernel(CV,s,r)}const Ql=fe({stack_:Ife});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cfe(n,e=0){const s={x:Q(n,"x","step")},r={alpha:e};return pe.runKernel(NU,s,r)}const k2=fe({step_:Cfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kfe(n,e,t,s,r=0,i=0,a=0,o=0,l=0){const h={x:Q(n,"x","stridedSlice","string_or_numeric")},p={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};return pe.runKernel(fU,h,p)}const cW=fe({stridedSlice_:kfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $fe(n){const t={x:Q(n,"x","tan","float32")};return pe.runKernel(vU,t)}const uW=fe({tan_:$fe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(n,e){Gf(n);const t=Xl(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xh(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lm(n,e,t){if(Gf(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Xl(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n,e,t){if(Gf(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Xl(n,t);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Xh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(n,e,t){if(Gf(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Xl(n,t);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Xh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n,e,t){if(Gf(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Xl(n,t);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,Xh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Afe(n,e=1,t=!0){const s=Q(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},a={k:e,sorted:t},[o,l]=pe.runKernel(_U,i,a);return{values:o,indices:l}}const pW=fe({topk_:Afe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rfe(n,e=0,t=1,s,r){if(s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new w2(e,t,s,!0,r),a=Ko(n,s);for(let o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}const mW=fe({truncatedNormal_:Rfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dfe(n,e=0){const t=Q(n,"x","unique","string_or_numeric");re(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,a]=pe.runKernel(wU,s,r);return{values:i,indices:a}}const gW=fe({unique_:Dfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lfe(n,e,t){const s=Q(n,"x","unsortedSegmentSum"),r=Q(e,"segmentIds","unsortedSegmentSum","int32");re(_m(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},a={numSegments:t};return pe.runKernel(SU,i,a)}const yW=fe({unsortedSegmentSum_:Lfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ofe(n,e=0){const t=Q(n,"x","unstack","string_or_numeric");re(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return pe.runKernel(TU,s,r)}const Yh=fe({unstack_:Ofe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(n,e){return iw(n,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(n,e=!0,t,s){return pe.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=Ko(n,"int32"),r=Ko([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const a=s.indexToLoc(t[i]),o=i*n.length;r.values.set(a,o)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Pfe(n){const e=Q(n,"condition","whereAsync","bool"),t=await e.data(),s=_W(e.shape,t);return n!==e&&e.dispose(),s}const $2=Pfe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Mfe(n,e,t){const s=Q(n,"tensor","boolMask"),r=Q(e,"mask","boolMask","bool"),i=t??0,a=r.rank,o=s.shape;re(a>0,()=>"mask cannot be scalar"),vi(o.slice(i,i+a),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let w=i;w<i+a;w++)l*=o[w];const c=o.slice(0,i).concat([l],o.slice(i+a)),h=ze(s,c),p=ze(r,[-1]),m=await $2(p),v=Kv(m,[1]),_=l2(h,v,i);return n!==s&&s.dispose(),e!==r&&r.dispose(),v.dispose(),h.dispose(),p.dispose(),m.dispose(),_}const xW=Mfe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ffe(n,e,t,s,r=!0){const i=Q(n,"v","movingAverage"),a=Q(e,"x","movingAverage"),o=Q(t,"decay","movingAverage");LU(i,a),re(Kl(i.shape,a.shape),()=>"Shape mismatch in v and x");const l=Xt(1),c=Bt(l,o);let h=Ye(Bt(a,i),c);if(r){re(s!=null,()=>"When using zeroDebias: true, step is required.");const p=Q(s,"step","movingAverage");h=Wn(h,Bt(l,Tm(o,p)))}return Et(i,h)}const wW=fe({movingAverage_:Ffe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(n,e,t){const s=Q(n,"indices","scatterND","int32"),r=Q(e,"updates","scatterND");Xk(r,s,t);const i={indices:s,updates:r},a={shape:t};return pe.runKernel(HV,i,a)}const TW=fe({scatterND_:jfe});function Bfe(n,e,t,s){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const r=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${i}.`);const a=e.size;if(!(e.rank===0||e.rank===1&&a===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zfe(n,e,t,s=0){const r=Q(n,"sparseIndices","sparseToDense","int32"),i=Q(e,"sparseValues","sparseToDense","string_or_numeric"),a=Q(s,"defaultValue","sparseToDense",i.dtype);Bfe(r,i,t,a);const o={sparseIndices:r,sparseValues:i,defaultValue:a},l={outputShape:t};return pe.runKernel(hU,o,l)}const SW=fe({sparseToDense_:zfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vfe(n,e){const t=Q(e,"indices","gatherND","int32"),r={params:Q(n,"x","gatherND","string_or_numeric"),indices:t};return pe.runKernel(Wz,r)}const EW=fe({gatherND_:Vfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ufe(n,e){if(e==null)return n.shape.slice();if(Kl(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gfe(n,e,t,s){const r=Q(n,"x","dropout");if(re(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),re(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof us?r.clone():r;const i=Ufe(r,t),a=1-e,o=Wn(o2(Et(S2(i,0,1,"float32",s),a)),a);return Ye(r,o)}const NW=fe({dropout_:Gfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A2(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function lw(n,e,t){const s=1-n%2,r=new Float32Array(n);for(let i=0;i<n;++i){const a=2*Math.PI*i/(n+s-1);r[i]=e-t*Math.cos(a)}return ro(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Wfe(n,e,t=1){const s=Q(n,"predictions","inTopK"),r=Q(e,"targets","inTopK");re(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),re(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),vi(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];re(t>0&&t<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${t}`);const a=await s.data(),o=await r.data(),[l,c]=[a.length/i,i],h=DB("bool",l);for(let p=0;p<l;p++){const m=p*c,v=a.subarray(m,m+c),_=[];for(let w=0;w<v.length;w++)_.push({value:v[w],index:w});_.sort((w,T)=>T.value-w.value),h[p]=0;for(let w=0;w<t;w++)if(_[w].index===o[p]){h[p]=1;break}}return n!==s&&s.dispose(),e!==r&&r.dispose(),Vo(h,r.shape,"bool")}const IW=Wfe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hfe(n,e,t,s,r,i="NHWC",a){let o=n;n.rank===3&&(o=ze(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]])),re(o.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`),re(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),re(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=i==="NHWC"?o.shape[3]:o.shape[1],h=i==="NHWC"?l.shape[3]:l.shape[1];re(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),re(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),uo("conv2dDerFilter",r,a);const p={x:o,dy:l},m={strides:s,pad:r,dataFormat:i,dimRoundingMode:a,filterShape:t};return pe.runKernel(pz,p,m)}const qfe=fe({conv2DBackpropFilter_:Hfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cw(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Ye(n,k2(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function uw(n,e){let t=e;const s=Hk(n.shape,e.shape);return s.length>0&&(t=Gn(t,s)),ze(t,n.shape)}function hw(n,e,t,s){if(e==="linear")return n;if(e==="relu")return qv(n);if(e==="elu")return r2(n);if(e==="relu6")return E2(n);if(e==="prelu")return x2(n,t);if(e==="leakyrelu")return u2(n,s);if(e==="sigmoid")return af(n);throw new Error(`Unknown fused activation ${e}.`)}const dw=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kfe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(l=l||"linear",dw(pe.state.gradientDepth,l)===!1){re(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let W=Uv(n,e,t,s,r,i,a);return o!=null&&(W=Et(W,o)),hw(W,l,c,h)}const p=Q(n,"x","conv2d","float32"),m=Q(e,"filter","conv2d","float32");let v=p,_=!1;p.rank===3&&(_=!0,v=ze(p,[1,p.shape[0],p.shape[1],p.shape[2]])),re(v.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${v.rank}.`),re(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),uo("fused conv2d",s,a);const w=r==="NHWC"?v.shape[3]:v.shape[1];re(m.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${m.shape[2]}.`),re(tu(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const T=zv(v.shape,m.shape,t,i,s,a);let E;o!=null&&(E=Q(o,"bias","fused conv2d"),[E]=ds(E,p),r==="NHWC"?js(T.outShape,E.shape):(re(E.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${E.shape.length}.`),re(E.shape.length===0||E.shape[0]===T.outChannels||E.shape[0]===1,()=>`Error in fused conv2d: bias shape (${E.shape}) is not compatible with the number of output channels (${T.outChannels})`)));let C;if(c!=null){const W=c.shape;if(re(W.length<=1||W.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${W.length}.`),W.length===1)re(W[0]===1||W[0]===T.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${W}) is not compatible with the number of output channels (${T.outChannels}).`);else if(W.length===3)try{js(W,T.outShape)}catch{const P=`Error in fused conv2d: PReLU activation weights (${W}) is not compatible with the output shape of the conv2d (${T.outShape}).`;throw Error(P)}C=Q(c,"prelu weights","fused conv2d")}const A=(W,B)=>{re(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[P,O,M,k]=B,V=cw(W,M,l);re(nv(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const G=K6(O.shape,V,P,t,s),ae=qfe(O,V,P.shape,t,s),J=[G,ae];if(k!=null){const X=uw(k,V);J.push(X)}return J},D={x:v,filter:m,bias:E,preluActivationWeights:C},F={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a,activation:l,leakyreluAlpha:h};return o==null?Yl((B,P,O)=>{let M=pe.runKernel(aI,D,F);return O([P,B,M]),_&&(M=ze(M,[M.shape[1],M.shape[2],M.shape[3]])),{value:M,gradFunc:A}})(v,m):Yl((B,P,O,M)=>{let k=pe.runKernel(aI,D,F);return M([P,B,k,O]),_&&(k=ze(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:A}})(v,m,E)}const Xfe=fe({fusedConv2d_:Kfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zfe(n,e,t,s,r,i=[1,1],a){let o=n;n.rank===3&&(o=ze(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:o,dy:l},h={strides:s,pad:r,dimRoundingMode:a,dilations:i,filterShape:t};return pe.runKernel(Nz,c,h)}const Yfe=fe({depthwiseConv2dNativeBackpropFilter_:Zfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(n,e,t,s,r,i=[1,1],a){let o=e,l=!1;e.rank===3&&(l=!0,o=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:o,filter:t},h={strides:s,pad:r,dimRoundingMode:a,dilations:i,inputShape:n},p=pe.runKernel(Iz,c,h);return l?ze(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Jfe=fe({depthwiseConv2dNativeBackpropInput_:Qfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(dw(pe.state.gradientDepth,l)===!1){let F=nw(n,e,t,s,r,i,a);return o!=null&&(F=Et(F,o)),hw(F,l,c,h)}const p=Q(n,"x","depthwiseConv2d","float32"),m=Q(e,"filter","depthwiseConv2d","float32");let v=p,_=!1;p.rank===3&&(_=!0,v=ze(p,[1,p.shape[0],p.shape[1],p.shape[2]])),re(v.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${v.rank}.`),re(m.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${m.rank}.`),re(v.shape[3]===m.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${v.shape[3]}) must match the inChannels dimension in filter ${m.shape[2]}.`),i==null&&(i=[1,1]),re(tu(t,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),uo("fused depthwiseConv2d",s,a);const w=zv(v.shape,m.shape,t,i,s,a,!0);let T;o!=null&&(T=Q(o,"bias","fused conv2d"),[T]=ds(T,p),js(w.outShape,T.shape));let E;c!=null&&(E=Q(c,"prelu weights","fused depthwiseConv2d"));const C=(F,W)=>{re(nv(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[B,P,O,M]=W,k=cw(F,O,l),V=Jfe(P.shape,k,B,t,s,i,a),G=Yfe(P,k,B.shape,t,s,i,a);if(M!=null){const ae=uw(T,k);return[V,G,ae]}return[V,G]},A={x:v,filter:m,bias:T,preluActivationWeights:E},D={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a,activation:l,leakyreluAlpha:h};return o==null?Yl((W,B,P)=>{let O=pe.runKernel(oI,A,D);return P([B,W,O]),_&&(O=ze(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:C}})(v,m):Yl((W,B,P,O)=>{let M=pe.runKernel(oI,A,D);return O([B,W,M,P]),_&&(M=ze(M,[M.shape[1],M.shape[2],M.shape[3]])),{value:M,gradFunc:C}})(v,m,T)}const tpe=fe({fusedDepthwiseConv2d_:epe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:a,leakyreluAlpha:o=.2}){if(dw(pe.state.gradientDepth,i)===!1){let k=wn(n,e,t,s);return r!=null&&(k=Et(k,r)),hw(k,i,a,o)}let l=Q(n,"a","fused matMul"),c=Q(e,"b","fused matMul");[l,c]=ds(l,c);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],p=s?c.shape[c.rank-1]:c.shape[c.rank-2],m=t?l.shape[l.rank-1]:l.shape[l.rank-2],v=s?c.shape[c.rank-2]:c.shape[c.rank-1],_=l.shape.slice(0,-2),w=c.shape.slice(0,-2),T=es(_),E=es(w);re(h===p,()=>`Error in fused matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${s} must match.`);const A=js(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([m,v]),D=t?ze(l,[T,h,m]):ze(l,[T,m,h]),F=s?ze(c,[E,v,p]):ze(c,[E,p,v]);let W;r!=null&&(W=Q(r,"bias","fused matMul"),[W]=ds(W,l),js(A,W.shape));let B;a!=null&&(B=Q(a,"prelu weights","fused matMul"));const P=(k,V)=>{const[G,ae,J,X]=V,se=cw(ze(k,J.shape),J,i);let ne,le;if(!t&&!s?(ne=wn(se,ae,!1,!0),le=wn(G,se,!0,!1)):!t&&s?(ne=wn(se,ae,!1,!1),le=wn(se,G,!0,!1)):t&&!s?(ne=wn(ae,se,!1,!0),le=wn(G,se,!1,!1)):(ne=wn(ae,se,!0,!0),le=wn(se,G,!0,!0)),r!=null){const K=uw(X,se);return[ne,le,K]}else return[ne,le]},O={a:D,b:F,bias:W,preluActivationWeights:B},M={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:o};return r==null?Yl((V,G,ae)=>{const J=pe.runKernel(iI,O,M);return ae([V,G,J]),{value:ze(J,A),gradFunc:P}})(D,F):Yl((V,G,ae,J)=>{const X=pe.runKernel(iI,O,M);return J([V,G,X,ae]),{value:ze(X,A),gradFunc:P}})(D,F,W)}const spe=fe({fusedMatMul_:npe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CW=Object.freeze(Object.defineProperty({__proto__:null,conv2d:Xfe,depthwiseConv2d:tpe,matMul:spe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rpe(n){return lw(n,.54,.46)}const ipe=fe({hammingWindow_:rpe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ape(n){return lw(n,.5,.5)}const kW=fe({hannWindow_:ape});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ope(n,e,t,s=!1,r=0){let i=0;const a=[];for(;i+e<=n.size;)a.push(Mn(n,i,e)),i+=t;if(s)for(;i<n.size;){const o=i+e-n.size,l=zr([Mn(n,i,e-o),Km([o],r)]);a.push(l),i+=t}return a.length===0?lm([],[0,e]):ze(zr(a),[a.length,e])}const $W=fe({frame_:ope});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpe(n,e,t,s,r=kW){s==null&&(s=A2(e));const i=$W(n,e,t),a=Ye(i,r(e));return ow(a,s)}const cpe=fe({stft_:lpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function upe(n,e,t,s,r="bilinear",i=0){const a=Q(n,"image","cropAndResize"),o=Q(e,"boxes","cropAndResize","float32"),l=Q(t,"boxInd","cropAndResize","int32"),c=o.shape[0];re(a.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`),re(o.rank===2&&o.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${o.shape}.`),re(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${o.shape}.`),re(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),re(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),re(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:a,boxes:o,boxInd:l},p={method:r,extrapolationValue:i,cropSize:s};return pe.runKernel(wz,h,p)}const hpe=fe({cropAndResize_:upe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dpe(n){const e=Q(n,"image","flipLeftRight","float32");re(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return pe.runKernel(Bz,t,{})}const fpe=fe({flipLeftRight_:dpe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ppe(n){const e=Q(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];re(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),re(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,om(e,r)}const mpe=fe({grayscaleToRGB_:ppe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gpe(n,e,t=0,s=.5){const r=Q(n,"image","rotateWithOffset","float32");re(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},a={radians:e,fillValue:t,center:s};return pe.runKernel(IU,i,a)}const ype=fe({rotateWithOffset_:gpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ym(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const a=n.shape[0];return t=Math.min(t,a),re(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),re(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),re(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),re(e.rank===1,()=>"scores must be a 1D tensor"),re(e.shape[0]===a,()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${e.shape[0]}`),re(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vpe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Q(n,"boxes","nonMaxSuppression","float32"),a=Q(e,"scores","nonMaxSuppression","float32"),o=Ym(i,a,t,s,r);t=o.maxOutputSize,s=o.iouThreshold,r=o.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return pe.runKernel(TV,{boxes:i,scores:a},l)}const bpe=fe({nonMaxSuppression_:vpe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _pe(n,e,t){const s=xpe(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function xpe(n,e,t){return Tpe(n,e,t||wpe)}function wpe(n,e){return n>e?1:n<e?-1:0}function Tpe(n,e,t){let s=0,r=n.length,i=0,a=!1;for(;s<r;){i=s+(r-s>>>1);const o=t(e,n[i]);o>0?s=i+1:(r=i,a=!o)}return a?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AW(n,e,t,s,r){return R2(n,e,t,s,r,0)}function RW(n,e,t,s,r,i){return R2(n,e,t,s,r,0,!1,i,!0)}function DW(n,e,t,s,r,i){return R2(n,e,t,s,r,i,!0)}function R2(n,e,t,s,r,i,a=!1,o=!1,l=!1){const c=[];for(let T=0;T<e.length;T++)e[T]>r&&c.push({score:e[T],boxIndex:T,suppressBeginIndex:0});c.sort(EM);const h=i>0?-.5/i:0,p=[],m=[];for(;p.length<t&&c.length>0;){const T=c.pop(),{score:E,boxIndex:C,suppressBeginIndex:A}=T;if(E<r)break;let D=!1;for(let F=p.length-1;F>=A;--F){const W=Spe(n,C,p[F]);if(W>=s){D=!0;break}if(T.score=T.score*Epe(s,h,W),T.score<=r)break}T.suppressBeginIndex=p.length,D||(T.score===E?(p.push(C),m.push(T.score)):T.score>r&&_pe(c,T,EM))}const v=p.length,_=t-v;o&&_>0&&(p.push(...new Array(_).fill(0)),m.push(...new Array(_).fill(0)));const w={selectedIndices:p};return a&&(w.selectedScores=m),l&&(w.validOutputs=v),w}function Spe(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),a=Math.min(s[1],s[3]),o=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),p=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),v=(o-i)*(l-a),_=(p-c)*(m-h);if(v<=0||_<=0)return 0;const w=Math.max(i,c),T=Math.max(a,h),E=Math.min(o,p),C=Math.min(l,m),A=Math.max(E-w,0)*Math.max(C-T,0);return A/(v+_-A)}function Epe(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function EM(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Npe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Q(n,"boxes","nonMaxSuppressionAsync"),a=Q(e,"scores","nonMaxSuppressionAsync"),o=Ym(i,a,t,s,r);t=o.maxOutputSize,s=o.iouThreshold,r=o.scoreThreshold;const l=await Promise.all([i.data(),a.data()]),c=l[0],h=l[1],{selectedIndices:p}=AW(c,h,t,s,r);return i!==n&&i.dispose(),a!==e&&a.dispose(),ro(p,"int32")}const Ipe=Npe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cpe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const a=Q(n,"boxes","nonMaxSuppression"),o=Q(e,"scores","nonMaxSuppression"),l=Ym(a,o,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:a,scores:o},h={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},p=pe.runKernel(EV,c,h);return{selectedIndices:p[0],selectedScores:p[1]}}const kpe=fe({nonMaxSuppressionWithScore_:Cpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $pe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const a=Q(n,"boxes","nonMaxSuppressionAsync"),o=Q(e,"scores","nonMaxSuppressionAsync"),l=Ym(a,o,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([a.data(),o.data()]),h=c[0],p=c[1],{selectedIndices:m,selectedScores:v}=DW(h,p,t,s,r,i);return a!==n&&a.dispose(),o!==e&&o.dispose(),{selectedIndices:ro(m,"int32"),selectedScores:ro(v)}}const Ape=$pe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rpe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const a=Q(n,"boxes","nonMaxSuppression"),o=Q(e,"scores","nonMaxSuppression"),l=Ym(a,o,t,s,r,null),c=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,m={boxes:a,scores:o},v={maxOutputSize:c,iouThreshold:h,scoreThreshold:p,padToMaxOutputSize:i},_=pe.runKernel(SV,m,v);return{selectedIndices:_[0],validOutputs:_[1]}}const Dpe=fe({nonMaxSuppressionPadded_:Rpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Lpe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const a=Q(n,"boxes","nonMaxSuppressionAsync"),o=Q(e,"scores","nonMaxSuppressionAsync"),l=Ym(a,o,t,s,r,null),c=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,[m,v]=await Promise.all([a.data(),o.data()]),{selectedIndices:_,validOutputs:w}=RW(m,v,c,h,p,i);return a!==n&&a.dispose(),o!==e&&o.dispose(),{selectedIndices:ro(_,"int32"),validOutputs:Xt(w,"int32")}}const Ope=Lpe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ppe(n,e,t=!1,s=!1){const r=Q(n,"images","resizeBilinear");re(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),re(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),re(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,a=!1;r.rank===3&&(a=!0,i=ze(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const o={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},c=pe.runKernel(zV,o,l);return a?ze(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Mpe=fe({resizeBilinear_:Ppe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fpe(n,e,t=!1,s=!1){const r=Q(n,"images","resizeNearestNeighbor");re(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),re(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),re(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),re(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,a=!1;r.rank===3&&(a=!0,i=ze(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const o={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},c=pe.runKernel(BV,o,l);return a?ze(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const jpe=fe({resizeNearestNeighbor_:Fpe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bpe(n,e="binary",t=!1,s=.5){const r=Q(n,"image","threshold"),i=.2989,a=.587,o=.114,l=r.shape[0]*r.shape[1];let c=Ye(ro([s]),255),h,p,m,v;if(re(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),re(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),re(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),re(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[h,p,m]=Nm(r,[1,1,1],-1);const T=Ye(h,i),E=Ye(p,a),C=Ye(m,o);v=Et(Et(T,E),C)}else v=n;if(e==="otsu"){const T=n2(is(N2(v),"int32"),Vo([]),256);c=zpe(T,l)}const _=t?sw(v,c):Hv(v,c);return is(Ye(_,255),"int32")}function zpe(n,e){let t=ro([-1]),s=ro([0]),r=ro([0]),i,a,o,l,c,h;for(let p=0;p<n.size-1;p++){i=Mn(n,0,p+1),a=Mn(n,p+1),c=Wn(Gn(i),e),h=Wn(Gn(a),e);const m=Gn(Ye(i,Em(0,i.size)));o=Wn(m,Gn(i));const v=Km(a.shape,i.size),_=Et(Em(0,a.size),v),w=Ye(a,_);l=Wn(Gn(w),Gn(a));const T=Bt(o,l),E=Bt(o,l),C=Ye(c,h);r=Ye(Ye(C,T),E);const A=Hv(r,s);s=Tf(A,r,s),t=Tf(A,ro([p]),t)}return t}const Vpe=fe({threshold_:Bpe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Upe(n,e,t="nearest",s="constant",r=0,i){const a=Q(n,"image","transform","float32"),o=Q(e,"transforms","transform","float32");re(a.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`),re(o.rank===2&&(o.shape[0]===a.shape[0]||o.shape[0]===1)&&o.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),re(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:a,transforms:o},c={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return pe.runKernel(xU,l,c)}const Gpe=fe({transform_:Upe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wpe(n,e,t){re(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),re(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`);const s=Q(n,"a","bandPart");re(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,a]=s.shape.slice(-2);if(!(e<=i))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`);if(!(t<=a))throw new Error(`bandPart(): numUpper (${t}) must not be greater than the number of columns (${a}).`);e<0&&(e=i),t<0&&(t=a);const o=ze(Em(0,i,1,"int32"),[-1,1]),l=Em(0,a,1,"int32"),c=Bt(o,l),h=sv(sw(c,Xt(+e,"int32")),c2(c,Xt(-t,"int32"))),p=Sf([i,a],s.dtype);return ze(Ql(Yh(ze(s,[-1,i,a])).map(m=>Tf(h,m,p))),r)}const Hpe=fe({bandPart_:Wpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qpe(n){let e;if(Array.isArray(n)){e=!1,re(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)re(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=Nm(n,n.shape[0],0).map(r=>Kv(r,[0]));re(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(pe.tidy(()=>{let i=s[r];if(r>0)for(let a=0;a<r;++a){const o=Ye(Gn(Ye(t[a],i)),t[a]);i=Bt(i,o)}return Wn(i,Wv(i,"euclidean"))}));return e?Ql(t,0):t}const Kpe=fe({gramSchmidt_:qpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpe(n,e=!1){if(re(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return NM(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),s=Yh(ze(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[c,h]=NM(l,e);r.push(c),i.push(h)});const a=ze(Ql(r,0),n.shape),o=ze(Ql(i,0),n.shape);return[a,o]}}function NM(n,e=!1){return pe.tidy(()=>{re(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=a2(t),i=Vc(n);const a=lm([[1]],[1,1]);let o=Vc(a);const l=t>=s?s:t;for(let c=0;c<l;++c){const h=i,p=o,m=r;[o,i,r]=pe.tidy(()=>{const v=Mn(i,[c,c],[t-c,1]),_=Wv(v),w=Mn(i,[c,c],[1,1]),T=Tf(Hv(w,0),lm([[-1]]),lm([[1]])),E=Bt(w,Ye(T,_)),C=Wn(v,E);C.shape[0]===1?o=Vc(a):o=zr([a,Mn(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const A=Fl(Wn(wn(T,E),_)),D=Mn(i,[c,0],[t-c,s]),F=Ye(A,o),W=tv(o);if(c===0)i=Bt(D,wn(F,wn(W,D)));else{const O=Bt(D,wn(F,wn(W,D)));i=zr([Mn(i,[0,0],[c,s]),O],0)}const B=tv(F),P=Mn(r,[0,c],[t,r.shape[1]-c]);if(c===0)r=Bt(P,wn(wn(P,o),B));else{const O=Bt(P,wn(wn(P,o),B));r=zr([Mn(r,[0,0],[t,c]),O],1)}return[o,i,r]}),Br([h,p,m])}return!e&&t>s&&(r=Mn(r,[0,0],[t,s]),i=Mn(i,[0,0],[s,s])),[r,i]})}const Zpe=fe({qr_:Xpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var di;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(di||(di={}));function Ype(n,e,t=di.SUM_BY_NONZERO_WEIGHTS){const s=Q(n,"losses","computeWeightedLoss");let r=null;e!=null&&(r=Q(e,"weights","computeWeightedLoss"));const i=r==null?s:Ye(s,r);if(t===di.NONE)return i;if(t===di.SUM)return Gn(i);if(t===di.MEAN){if(r==null)return rv(i);{const a=s.size/r.size,o=Wn(Gn(i),Gn(r));return a>1?Wn(o,Xt(a)):o}}if(t===di.SUM_BY_NONZERO_WEIGHTS){if(r==null)return Wn(Gn(i),Xt(s.size));{const a=Ye(r,dh(s.shape)),o=is(Gn(b2(a,Xt(0))),"float32");return Wn(Gn(i),o)}}throw Error(`Unknown reduction: ${t}`)}const nu=fe({computeWeightedLoss_:Ype});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qpe(n,e,t,s=di.SUM_BY_NONZERO_WEIGHTS){const r=Q(n,"labels","absoluteDifference"),i=Q(e,"predictions","absoluteDifference");let a=null;t!=null&&(a=Q(t,"weights","absoluteDifference")),vi(r.shape,i.shape,"Error in absoluteDifference: ");const o=Hi(Bt(r,i));return nu(o,a,s)}const Jpe=fe({absoluteDifference_:Qpe});function eme(n,e,t,s,r=di.SUM_BY_NONZERO_WEIGHTS){const i=Q(n,"labels","cosineDistance"),a=Q(e,"predictions","cosineDistance");let o=null;s!=null&&(o=Q(s,"weights","cosineDistance")),vi(i.shape,a.shape,"Error in cosineDistance: ");const l=Xt(1),c=Bt(l,Gn(Ye(i,a),t,!0));return nu(c,o,r)}const tme=fe({cosineDistance_:eme});function nme(n,e,t,s=di.SUM_BY_NONZERO_WEIGHTS){let r=Q(n,"labels","hingeLoss");const i=Q(e,"predictions","hingeLoss");let a=null;t!=null&&(a=Q(t,"weights","hingeLoss")),vi(r.shape,i.shape,"Error in hingeLoss: ");const o=Xt(1);r=Bt(Ye(Xt(2),r),o);const l=qv(Bt(o,Ye(r,i)));return nu(l,a,s)}const sme=fe({hingeLoss_:nme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rme(n,e,t,s=1,r=di.SUM_BY_NONZERO_WEIGHTS){const i=Q(n,"labels","huberLoss"),a=Q(e,"predictions","huberLoss");let o=null;t!=null&&(o=Q(t,"weights","huberLoss")),vi(i.shape,a.shape,"Error in huberLoss: ");const l=Xt(s),c=Hi(Bt(a,i)),h=v2(c,l),p=Bt(c,h),m=Et(Ye(Xt(.5),oo(h)),Ye(l,p));return nu(m,o,r)}const ime=fe({huberLoss_:rme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ame(n,e,t,s=1e-7,r=di.SUM_BY_NONZERO_WEIGHTS){const i=Q(n,"labels","logLoss"),a=Q(e,"predictions","logLoss");let o=null;t!=null&&(o=Q(t,"weights","logLoss")),vi(i.shape,a.shape,"Error in logLoss: ");const l=Xt(1),c=Xt(s),h=Fl(Ye(i,Sm(Et(a,c)))),p=Ye(Bt(l,i),Sm(Et(Bt(l,a),c))),m=Bt(h,p);return nu(m,o,r)}const ome=fe({logLoss_:ame});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lme(n,e,t,s=di.SUM_BY_NONZERO_WEIGHTS){const r=Q(n,"labels","meanSquaredError"),i=Q(e,"predictions","meanSquaredError");let a=null;t!=null&&(a=Q(t,"weights","meanSquaredError")),vi(r.shape,i.shape,"Error in meanSquaredError: ");const o=C2(r,i);return nu(o,a,s)}const cme=fe({meanSquaredError_:lme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ume(n,e){const t=Q(n,"labels","sigmoidCrossEntropyWithLogits"),s=Q(e,"logits","sigmoidCrossEntropyWithLogits");vi(t.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=qv(s),i=Ye(s,t),a=h2(Ph(Fl(Hi(s))));return Et(Bt(r,i),a)}function hme(n,e,t,s=0,r=di.SUM_BY_NONZERO_WEIGHTS){let i=Q(n,"multiClassLabels","sigmoidCrossEntropy");const a=Q(e,"logits","sigmoidCrossEntropy");let o=null;if(t!=null&&(o=Q(t,"weights","sigmoidCrossEntropy")),vi(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),s>0){const c=Xt(s),h=Xt(1),p=Xt(.5);i=Et(Ye(i,Bt(h,c)),Ye(p,c))}const l=ume(i,a);return nu(l,o,r)}const dme=fe({sigmoidCrossEntropy_:hme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fme(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Yl((r,i,a)=>{const l=f2(i,[t],!0),c=Bt(is(i,"float32"),l);a([r,c]);const h=Fl(Ye(c,r));return{value:Gn(h,[t]),gradFunc:(v,_)=>{const[w,T]=_,E=Gv(v.shape,[t]);return[Ye(ze(v,E),Bt(is(w,"float32"),Ph(T))),Ye(ze(v,E),Bt(Ph(T),is(w,"float32")))]}}})(n,e)}function pme(n,e,t,s=0,r=di.SUM_BY_NONZERO_WEIGHTS){let i=Q(n,"onehotLabels","softmaxCrossEntropy");const a=Q(e,"logits","softmaxCrossEntropy");let o=null;if(t!=null&&(o=Q(t,"weights","softmaxCrossEntropy")),vi(i.shape,a.shape,"Error in softmaxCrossEntropy: "),s>0){const c=Xt(s),h=Xt(1),p=Xt(i.shape[1]);i=Et(Ye(i,Bt(h,c)),Wn(c,p))}const l=fme(i,a);return nu(l,o,r)}const mme=fe({softmaxCrossEntropy_:pme});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gme(n,e,t,s){const r=Q(n,"indices","sparseFillEmptyRows","int32"),i=Q(e,"values","sparseFillEmptyRows"),a=Q(t,"denseShape","sparseFillEmptyRows","int32"),o=Q(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(a.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${a.shape}`);if(o.rank!==0)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);const l={indices:r,values:i,denseShape:a,defaultValue:o},c=pe.runKernel(oU,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}const yme=fe({sparseFillEmptyRows_:gme});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vme(n,e,t){const s=Q(n,"inputIndices","sparseReshape","int32"),r=Q(e,"inputShape","sparseReshape","int32"),i=Q(t,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const a={inputIndices:s,inputShape:r,newShape:i},o=pe.runKernel(lU,a);return{outputIndices:o[0],outputShape:o[1]}}const bme=fe({sparseReshape_:vme});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _me(n,e,t){const s=Q(n,"data","sparseSegmentMean"),r=Q(e,"indices","sparseSegmentMean","int32"),i=Q(t,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const a={data:s,indices:r,segmentIds:i};return pe.runKernel(cU,a)}const xme=fe({sparseSegmentMean_:_me});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wme(n,e,t){const s=Q(n,"data","sparseSegmentSum"),r=Q(e,"indices","sparseSegmentSum","int32"),i=Q(t,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const a={data:s,indices:r,segmentIds:i};return pe.runKernel(uU,a)}const Tme=fe({sparseSegmentSum_:wme});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sme(n,e,t,s,r,i,a,o){const l=Q(n,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=Q(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const h={separator:t,nGramWidths:s,leftPad:r,rightPad:i,padWidth:a,preserveShortSequences:o},p={data:l,dataSplits:c},m=pe.runKernel(pU,p,h);return{nGrams:m[0],nGramsSplits:m[1]}}const Eme=fe({stringNGrams_:Sme});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nme(n,e,t=!0){const s=Q(n,"input","stringSplit","string"),r=Q(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:t},a={input:s,delimiter:r},o=pe.runKernel(mU,a,i);return{indices:o[0],values:o[1],shape:o[2]}}const Ime=fe({stringSplit_:Nme});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(n,e){const t=Q(n,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:t};return pe.runKernel(gU,r,s)}const kme=fe({stringToHashBucketFast_:Cme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LW={fft:aw,ifft:iv,rfft:ow,irfft:I2},OW={hammingWindow:ipe,hannWindow:kW,frame:$W,stft:cpe},D2={flipLeftRight:fpe,grayscaleToRGB:mpe,resizeNearestNeighbor:jpe,resizeBilinear:Mpe,rotateWithOffset:ype,cropAndResize:hpe,nonMaxSuppression:bpe,nonMaxSuppressionAsync:Ipe,nonMaxSuppressionWithScore:kpe,nonMaxSuppressionWithScoreAsync:Ape,nonMaxSuppressionPadded:Dpe,nonMaxSuppressionPaddedAsync:Ope,threshold:Vpe,transform:Gpe},PW={bandPart:Hpe,gramSchmidt:Kpe,qr:Zpe},MW={absoluteDifference:Jpe,computeWeightedLoss:nu,cosineDistance:tme,hingeLoss:sme,huberLoss:ime,logLoss:ome,meanSquaredError:cme,sigmoidCrossEntropy:dme,softmaxCrossEntropy:mme},FW={sparseFillEmptyRows:yme,sparseReshape:bme,sparseSegmentMean:xme,sparseSegmentSum:Tme},jW={stringNGrams:Eme,stringSplit:Ime,stringToHashBucketFast:kme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Qh=class extends g6{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const a=s.map(o=>({name:o.name,tensor:i[o.name]}));this.applyGradients(a)}else this.applyGradients(i);return Br(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return _G(e,t)}dispose(){this.iterations_!=null&&Br(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Xt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(Qh,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let fw=class extends Qh{constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=pe.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=pe.registeredVariables[s],a=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:pn(()=>Zi(i).variable(a))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:pn(()=>Zi(i).variable(a))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;pn(()=>{const h=Et(Ye(l,this.rho),Ye(oo(o),1-this.rho)),p=Ye(Wn(Zl(Et(c,this.epsilon)),Zl(Et(l,this.epsilon))),o),m=Et(Ye(c,this.rho),Ye(oo(p),1-this.rho));l.assign(h),c.assign(m);const v=Et(Ye(p,-this.learningRate),i);i.assign(v)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Br(this.accumulatedGrads.map(e=>e.variable)),Br(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}};fw.className="Adadelta";Zh(fw);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let pw=class extends Qh{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=pe.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:pn(()=>Km(i.shape,this.initialAccumulatorValue).variable(!1))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const o=this.accumulatedGrads[r].variable;pn(()=>{const l=Et(o,oo(a));o.assign(l);const c=Et(Ye(Wn(a,Zl(Et(l,pe.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Br(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}};pw.className="Adagrad";Zh(pw);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let mw=class extends Qh{constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],pn(()=>{this.accBeta1=Xt(t).variable(),this.accBeta2=Xt(s).variable()}),r==null&&(this.epsilon=pe.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);pn(()=>{const s=Bt(1,this.accBeta1),r=Bt(1,this.accBeta2);t.forEach((i,a)=>{const o=pe.registeredVariables[i],l=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${i}/m`,variable:pn(()=>Zi(o).variable(l))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${i}/v`,variable:pn(()=>Zi(o).variable(l))});const c=Array.isArray(e)?e[a].tensor:e[i];if(c==null)return;const h=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,m=Et(Ye(h,this.beta1),Ye(c,1-this.beta1)),v=Et(Ye(p,this.beta2),Ye(oo(c),1-this.beta2)),_=Wn(m,s),w=Wn(v,r);h.assign(m),p.assign(v);const T=Et(Ye(Wn(_,Et(Zl(w),this.epsilon)),-this.learningRate),o);o.assign(T)}),this.accBeta1.assign(Ye(this.accBeta1,this.beta1)),this.accBeta2.assign(Ye(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Br(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Br(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),pn(()=>{this.accBeta1.assign(Tm(this.beta1,this.iterations_+1)),this.accBeta2.assign(Tm(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}};mw.className="Adam";Zh(mw);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let gw=class extends Qh{constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],pn(()=>{this.iteration=Xt(0).variable(),this.accBeta1=Xt(t).variable()}),r==null&&(this.epsilon=pe.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);pn(()=>{const s=Bt(1,this.accBeta1),r=Wn(-this.learningRate,Et(Ye(this.iteration,this.decay),1));t.forEach((i,a)=>{const o=pe.registeredVariables[i],l=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${i}/m`,variable:Zi(o).variable(l)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${i}/v`,variable:Zi(o).variable(l)});const c=Array.isArray(e)?e[a].tensor:e[i];if(c==null)return;const h=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,m=Et(Ye(h,this.beta1),Ye(c,1-this.beta1)),v=Ye(p,this.beta2),_=Hi(c),w=y2(v,_);h.assign(m),p.assign(w);const T=Et(Ye(Wn(r,s),Wn(m,Et(w,this.epsilon))),o);o.assign(T)}),this.iteration.assign(Et(this.iteration,1)),this.accBeta1.assign(Ye(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Br(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Br(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}};gw.className="Adamax";Zh(gw);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Xv=class extends Qh{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=pe.registeredVariables[s];pn(()=>{const o=Et(Ye(this.c,i),a);a.assign(o)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=kl(Xt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}};Xv.className="SGD";Zh(Xv);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let yw=class extends Xv{constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Xt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=pe.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:pn(()=>Zi(i).variable(!1))});const a=this.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[s];o!=null&&pn(()=>{let l;const c=Et(Ye(this.m,a),o);this.useNesterov?l=Et(Ye(this.c,Et(o,Ye(c,this.m))),i):l=Et(Ye(this.c,c),i),a.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Br(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}};yw.className="Momentum";Zh(yw);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let vw=class extends Qh{constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=pe.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=pe.registeredVariables[s],a=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:pn(()=>Zi(i).variable(a))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:pn(()=>Zi(i).variable(a))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:pn(()=>Zi(i).variable(a))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;pn(()=>{const h=Et(Ye(l,this.decay),Ye(oo(o),1-this.decay));if(this.centered){const p=this.accumulatedMeanGrads[r].variable,m=Et(Ye(p,this.decay),Ye(o,1-this.decay)),v=Wn(Ye(o,this.learningRate),Zl(Bt(h,Et(oo(m),this.epsilon)))),_=Et(Ye(c,this.momentum),v);l.assign(h),p.assign(m),c.assign(_);const w=Bt(i,_);i.assign(w)}else{const p=Et(Ye(l,this.decay),Ye(oo(o),1-this.decay)),m=Et(Ye(c,this.momentum),Wn(Ye(o,this.learningRate),Zl(Et(p,this.epsilon))));l.assign(p),c.assign(m);const v=Bt(i,m);i.assign(v)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Br(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Br(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Br(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}};vw.className="RMSProp";Zh(vw);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let th=class{static sgd(e){return new Xv(e)}static momentum(e,t,s=!1){return new yw(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new vw(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new mw(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new fw(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new gw(e,t,s,r,i)}static adagrad(e,t=.1){return new pw(e,t)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $me={sgd:th.sgd,momentum:th.momentum,adadelta:th.adadelta,adagrad:th.adagrad,rmsprop:th.rmsprop,adamax:th.adamax,adam:th.adam};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ame=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Rme(){return new Promise(n=>Ame(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dme(n,e){const t=n[0].length;n.forEach((r,i)=>{re(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),re(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let a=0;a<t;a++)re(a===e||r[a]===s[a],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Lme(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Tl;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Tl||(Tl={}));function Ome(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],a=s[s.length-t.length+r],o=s[a];if(i>=0)if(o>=0){if(o!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${o}`)}else s[a]=i}return s}function Pme(n){const e={FIRST_DIM_SIZE:Tl.FIRST_DIM_SIZE,VALUE_ROWIDS:Tl.VALUE_ROWIDS,ROW_LENGTHS:Tl.ROW_LENGTHS,ROW_SPLITS:Tl.ROW_SPLITS,ROW_LIMITS:Tl.ROW_LIMITS,ROW_STARTS:Tl.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Mme(n){return n.length===0?0:n[0]===Tl.FIRST_DIM_SIZE?n.length-1:n.length}function Fme(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],a=e[r+1];if(i>=0&&a>=0&&i!==1&&i!==a)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${a}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L2=30;function jme(n){return n<=L2?n:M0(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bme(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zme(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let a=0;a<i;++a)r=r.concat([n[a+1]/e[a],e[a]]);r=r.concat(n.slice(i+1))}return r}function Vme(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let a=1;a<n;++a)a>=e*2+1||a%2===1?i.push(a):r.push(a);s.push(...r),s.push(0),s.push(...i)}return s}function Ume(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function Gme(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function Wme(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hme=1.7580993408473768,qme=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kme=.3275911,Xme=.254829592,Zme=-.284496736,Yme=1.421413741,Qme=-1.453152027,Jme=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ege(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function tge(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function nge(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function sge(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function rge(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function ige(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function age(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function oge(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sN="->",lge=/->/g,IM=",",CM="...";function cge(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(lge,"").length)/sN.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${sN}").`);const[s,r]=n.split(sN);re(s.indexOf(CM)===-1,()=>`The ellipsis notation ("${CM}") is not supported yet.`);const i=s.split(IM),a=i.length;if(e!==a)throw new Error(`Expected ${a} input tensors, received ${e}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let m=0;m<r.length;++m){const v=r[m];if(!i.some(_=>_.indexOf(v)!==-1))throw new Error(`Output subscripts contain the label ${v} not present in the input subscripts.`);o.indexOf(v)===-1&&o.push(v)}for(let m=0;m<s.length;++m){const v=s[m];o.indexOf(v)===-1&&v!==IM&&o.push(v)}const l=new Array(i.length);for(let m=0;m<a;++m){if(new Set(i[m].split("")).size!==i[m].length)throw new Error(`Found duplicate axes in input component ${i[m]}. Support for duplicate axes in input is not implemented yet.`);l[m]=[];for(let v=0;v<i[m].length;++v)l[m].push(o.indexOf(i[m][v]))}const c=o.length,h=r.length,p=[];for(let m=h;m<c;++m)p.push(m);return{allDims:o,summedDims:p,idDims:l}}function uge(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function hge(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let a=0;a<e[r].length;++a)s[e[r][a]]===void 0?s[e[r][a]]=i[a]:re(s[e[r][a]]===i[a],()=>`Expected dimension ${s[e[r][a]]} at axis ${a} of input shaped ${JSON.stringify(i)}, but got dimension ${i[a]}`)}}function dge(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let a=0;a<r;++a)s.push([]);const i=[];for(let a=0;a<t.length;++a){const o=t[a],l=pge(e,o);for(const c of l)i.indexOf(c)===-1&&(s[a].push(c),i.push(c))}return{path:t,steps:s}}function fge(n){return n.every((e,t)=>e===t)}function pge(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function mge(n,e,t=0){let s=[];if(typeof e=="number")re(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((a,o)=>(o===-1&&(a+=1),a),0);re(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const a=e.reduce((o,l)=>l>0?o+l:o);e[i]=n.shape[t]-a}re(n.shape[t]===e.reduce((a,o)=>a+o),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gge(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function yge(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function vge(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bge(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function _ge(n,e){return`size ${n} must be non-negative, not ${e}`}function xge(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function wge(n,e){const t=es(n),s=es(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function Tge(n,e){const t=es(n),s=es(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sge(){return"segment ids must be >= 0"}function Ege(){return"segment ids are not increasing"}function Nge(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Ige(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cge(n,e){let t=!1,s;for(n<=L2?(s=n,t=!0):s=M0(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=M0(n,s+1);return s}function kge(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function $ge(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let p=0;p<s;++p)if(n.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${n.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);const a=n.shape[t],o=[];let l=1,c=1,h=1;for(let p=0;p<s;++p)o.push(n.shape[p]),l*=n.shape[p];for(let p=s;p<t;p++)o.push(n.shape[p]),c*=n.shape[p];for(let p=s;p<r;p++)o.push(e.shape[p]);for(let p=t+1;p<i;p++)o.push(n.shape[p]),h*=n.shape[p];return{batchSize:l,sliceSize:h,outerSize:c,dimSize:a,outputShape:o}}const Age=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:$ge,computeOutShape:kge,segOpComputeOptimalWindowSize:Cge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rge(n){try{return n.map(e=>B0(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Dge(n){return n.map(e=>Fv(e))}const Lge=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Xme,ERF_A2:Zme,ERF_A3:Yme,ERF_A4:Qme,ERF_A5:Jme,ERF_P:Kme,PARALLELIZE_THRESHOLD:L2,get RowPartitionType(){return Tl},SELU_SCALE:qme,SELU_SCALEALPHA:Hme,applyActivation:hw,assertAndGetBroadcastShape:js,assertAxesAreInnerMostDims:hhe,assertParamsConsistent:Dme,assignToTypedArray:ige,axesAreInnerMostDims:i2,calculateShapes:a6,checkEinsumDimSizes:hge,checkPadOnDimRoundingMode:uo,combineLocations:uG,combineRaggedTensorToTensorShapes:Ome,complexWithEvenIndex:nge,complexWithOddIndex:sge,computeConv2DInfo:zv,computeConv3DInfo:D6,computeDefaultPad:Jk,computeDilation2DInfo:uue,computeOptimalWindowSize:jme,computeOutAndReduceShapes:uhe,computeOutShape:Lme,computePool2DInfo:R6,computePool3DInfo:hue,convertConv2DDataFormat:L6,decodeEinsumEquation:cge,eitherStridesOrDilationsAreOne:tu,expandShapeToKeepDim:Gv,exponent:oge,exponents:age,fromStringArrayToUint8:Dge,fromUint8ToStringArray:Rge,getAxesPermutation:dhe,getBroadcastDims:t6,getComplexWithIndex:rge,getEinsumComputePath:dge,getEinsumPermutation:uge,getFusedBiasGradient:uw,getFusedDyActivation:cw,getImageCenter:Bme,getInnerMostAxes:phe,getPermuted:Vme,getRaggedRank:Mme,getReductionAxes:Hk,getReshaped:zme,getReshapedPermuted:Ume,getRowPartitionTypesHelper:Pme,getSliceBeginCoords:Gme,getSliceSize:Wme,getSparseFillEmptyRowsIndicesDenseShapeMismatch:gge,getSparseFillEmptyRowsNegativeIndexErrorMessage:yge,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:vge,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:xge,getSparseReshapeInputOutputMismatchErrorMessage:Tge,getSparseReshapeInputOutputMultipleErrorMessage:wge,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:bge,getSparseReshapeNegativeOutputDimErrorMessage:_ge,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Ige,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Sge,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Ege,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Nge,getUndoAxesPermutation:fhe,isIdentityPermutation:fge,log:uoe,mergeRealAndImagArrays:ege,prepareAndValidate:i6,prepareSplitSize:mge,segment_util:Age,shouldFuse:dw,slice_util:m6,splitRealAndImagArrays:tge,tupleValuesAreOne:nv,upcastType:tw,validateDefaultValueShape:Fme,validateInput:Xk,validateUpdateShape:Kk,warn:lh},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oge=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:AW,nonMaxSuppressionV4Impl:RW,nonMaxSuppressionV5Impl:DW,whereImpl:_W},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pge=Object.freeze(Object.defineProperty({__proto__:null,Abs:UB,Acos:GB,Acosh:WB,AdadeltaOptimizer:fw,AdagradOptimizer:pw,AdamOptimizer:mw,AdamaxOptimizer:gw,Add:Ak,AddN:HB,All:qB,Any:KB,ArgMax:XB,ArgMin:ZB,Asin:YB,Asinh:QB,Atan:JB,Atan2:tz,Atanh:ez,AvgPool:nz,AvgPool3D:sz,AvgPool3DGrad:qae,AvgPoolGrad:Hae,BatchMatMul:rz,BatchToSpaceND:iz,Bincount:az,BroadcastArgs:oz,BroadcastTo:Kae,Cast:Rk,Ceil:lz,ClipByValue:cz,Complex:uz,ComplexAbs:hz,Concat:dz,Conv2D:fz,Conv2DBackpropFilter:pz,Conv2DBackpropInput:mz,Conv3D:gz,Conv3DBackpropFilterV2:Xae,Conv3DBackpropInputV2:yz,Cos:vz,Cosh:bz,CropAndResize:wz,Cumprod:_z,Cumsum:xz,DataStorage:Eae,DenseBincount:Tz,DepthToSpace:Sz,DepthwiseConv2dNative:Ez,DepthwiseConv2dNativeBackpropFilter:Nz,DepthwiseConv2dNativeBackpropInput:Iz,Diag:Cz,Dilation2D:kz,Dilation2DBackpropFilter:Yae,Dilation2DBackpropInput:Zae,get ENV(){return kk},Einsum:Az,Elu:Rz,EluGrad:Qae,Environment:zB,Equal:Lz,Erf:Dz,Exp:Oz,ExpandDims:Pz,Expm1:Mz,FFT:Fz,Fill:jz,FlipLeftRight:Bz,Floor:zz,FloorDiv:Vz,FromPixels:rI,FusedBatchNorm:Uz,FusedConv2D:aI,FusedDepthwiseConv2D:oI,GatherNd:Wz,GatherV2:Gz,Greater:Hz,GreaterEqual:qz,IFFT:Kz,Identity:Dk,Imag:Xz,IsFinite:Zz,IsInf:Yz,IsNan:Qz,KernelBackend:$B,LRN:lV,LRNGrad:noe,LeakyRelu:Jz,Less:eV,LessEqual:tV,LinSpace:nV,Log:sV,Log1p:rV,LogSoftmax:eoe,LogicalAnd:iV,LogicalNot:aV,LogicalOr:oV,LogicalXor:Jae,LowerBound:toe,Max:cV,MaxPool:hV,MaxPool3D:dV,MaxPool3DGrad:roe,MaxPoolGrad:soe,MaxPoolWithArgmax:fV,Maximum:uV,Mean:pV,Min:mV,Minimum:gV,MirrorPad:yV,Mod:vV,MomentumOptimizer:yw,Multinomial:bV,Multiply:_V,Neg:xV,NonMaxSuppressionV3:TV,NonMaxSuppressionV4:SV,NonMaxSuppressionV5:EV,NotEqual:wV,OP_SCOPE_SUFFIX:Fk,OneHot:IV,OnesLike:NV,Optimizer:Qh,OptimizerConstructors:th,Pack:CV,PadV2:kV,Pool:ioe,Pow:$V,Prelu:AV,Prod:RV,RMSPropOptimizer:vw,RaggedGather:DV,RaggedTensorToTensor:LV,Range:OV,get Rank(){return uI},Real:PV,RealDiv:$z,Reciprocal:MV,get Reduction(){return di},Relu:FV,Relu6:VV,Reshape:jV,ResizeBilinear:zV,ResizeBilinearGrad:ooe,ResizeNearestNeighbor:BV,ResizeNearestNeighborGrad:aoe,Reverse:UV,RotateWithOffset:IU,Round:GV,Rsqrt:WV,SGDOptimizer:Xv,ScatterNd:HV,SearchSorted:qV,Select:KV,Selu:XV,Sigmoid:eU,Sign:JV,Sin:YV,Sinh:QV,Slice:ZV,Softmax:aU,Softplus:tU,SpaceToBatchND:rU,SparseFillEmptyRows:oU,SparseReshape:lU,SparseSegmentMean:cU,SparseSegmentSum:uU,SparseToDense:hU,SplitV:iU,Sqrt:nU,Square:loe,SquaredDifference:dU,Step:NU,StridedSlice:fU,StringNGrams:pU,StringSplit:mU,StringToHashBucketFast:gU,Sub:yU,Sum:sU,Tan:vU,Tanh:bU,Tensor:us,TensorBuffer:z0,Tile:Lk,TopK:_U,Transform:xU,Transpose:t0,Unique:wU,Unpack:TU,UnsortedSegmentSum:SU,UpperBound:coe,Variable:Jy,ZerosLike:EU,_FusedMatMul:iI,abs:Hi,acos:_6,acosh:x6,add:Et,addN:w6,all:T6,any:S6,argMax:E6,argMin:N6,asin:I6,asinh:C6,atan:k6,atan2:$6,atanh:A6,avgPool:e2,avgPool3d:O6,backend:oce,backend_util:Lge,basicLSTMCell:P6,batchNorm:Vv,batchNorm2d:M6,batchNorm3d:F6,batchNorm4d:j6,batchToSpaceND:t2,bincount:n2,booleanMaskAsync:xW,broadcastArgs:B6,broadcastTo:Py,broadcast_util:gce,browser:wce,buffer:Ko,cast:is,ceil:z6,clipByValue:V6,clone:Vc,complex:Xc,concat:zr,concat1d:U6,concat2d:G6,concat3d:W6,concat4d:H6,conv1d:q6,conv2d:Uv,conv2dTranspose:X6,conv3d:Z6,conv3dTranspose:Y6,copyRegisteredKernels:poe,cos:Q6,cosh:J6,cosineWindow:lw,cumprod:eG,cumsum:tG,customGrad:Yl,denseBincount:nG,deprecationWarn:Kle,depthToSpace:sG,depthwiseConv2d:nw,device_util:Hoe,diag:rG,dilation2d:iG,disableDeprecationWarnings:qle,dispose:Br,disposeVariables:Xle,div:Wn,divNoNan:aG,dot:oG,dropout:NW,einsum:lG,elu:r2,enableDebugMode:Hle,enableProdMode:Wle,enclosingPowerOfTwo:A2,engine:Zle,env:Rt,equal:s2,erf:cG,euclideanNorm:dG,exp:Ph,expandDims:$c,expm1:fG,eye:a2,fft:aw,fill:Km,findBackend:rce,findBackendFactory:ice,floor:o2,floorDiv:Qk,fused:CW,gather:l2,gatherND:EW,gather_util:Tce,getBackend:nce,getGradient:lI,getKernel:F0,getKernelsForBackend:j0,grad:zhe,grads:Vhe,greater:Hv,greaterEqual:c2,ifft:iv,imag:Bv,image:D2,inTopKAsync:IW,io:Wk,irfft:I2,isFinite:pG,isInf:mG,isNaN:gG,keep:kl,kernel_impls:Oge,leakyRelu:u2,less:yG,lessEqual:sw,linalg:PW,linspace:vG,localResponseNormalization:bG,log:Sm,log1p:h2,logSigmoid:xG,logSoftmax:wG,logSumExp:f2,logicalAnd:sv,logicalNot:p2,logicalOr:m2,logicalXor:TG,losses:MW,lowerBound:SG,matMul:wn,math:mce,max:of,maxPool:g2,maxPool3d:EG,maxPoolWithArgmax:NG,maximum:y2,mean:rv,memory:Yle,meshgrid:IG,min:H0,minimum:v2,mirrorPad:CG,mod:kG,moments:$G,movingAverage:wW,mul:Ye,multiRNNCell:AG,multinomial:RG,neg:Fl,nextFrame:Rme,norm:Wv,notEqual:b2,oneHot:U0,ones:dh,onesLike:DG,op:fe,outerProduct:LG,pad:Xm,pad1d:OG,pad2d:PG,pad3d:MG,pad4d:FG,pool:jG,pow:Tm,prelu:x2,print:Vk,prod:BG,profile:Qle,raggedGather:zG,raggedTensorToTensor:VG,rand:UG,randomGamma:GG,randomNormal:T2,randomStandardNormal:WG,randomUniform:S2,range:Em,ready:tce,real:wm,reciprocal:HG,registerBackend:ace,registerGradient:hoe,registerKernel:CU,relu:qv,relu6:E2,removeBackend:sce,reshape:ze,reverse:Mh,reverse1d:qG,reverse2d:KG,reverse3d:XG,reverse4d:ZG,rfft:ow,round:N2,rsqrt:YG,scalar:Xt,scatterND:TW,scatter_util:Sce,searchSorted:iw,selu:QG,separableConv2d:JG,serialization:Oce,setBackend:ece,setPlatform:lce,setdiff1dAsync:eW,sigmoid:af,sign:tW,signal:OW,sin:nW,sinh:sW,slice:Mn,slice1d:rW,slice2d:iW,slice3d:aW,slice4d:oW,slice_util:m6,softmax:lW,softplus:d2,spaceToBatchND:_2,sparse:FW,sparseToDense:SW,spectral:LW,split:Nm,sqrt:Zl,square:oo,squaredDifference:C2,squeeze:Kv,stack:Ql,step:k2,stridedSlice:cW,string:jW,sub:Bt,sum:Gn,sumOutType:Moe,tan:uW,tanh:W0,tensor:Vo,tensor1d:ro,tensor2d:lm,tensor3d:qk,tensor4d:hW,tensor5d:dW,tensor6d:fW,tensor_util:Boe,test_util:Wce,tidy:pn,tile:om,time:Jle,topk:pW,train:$me,transpose:tv,truncatedNormal:mW,unique:gW,unregisterGradient:foe,unregisterKernel:doe,unsortedSegmentSum:yW,unstack:Yh,upcastType:tw,upperBound:vW,util:Eoe,valueAndGrad:Uhe,valueAndGrads:Ghe,variable:bW,variableGrads:_G,version_core:Hce,where:Tf,whereAsync:$2,zeros:Sf,zerosLike:Zi},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mge=Rt();Mge.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Ja;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ja||(Ja={}));var kM;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(kM||(kM={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fge={};function BW(n){return Fge[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U(n,e,t,s,r){const i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){const o=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return fi(e.inputNames[i.inputIndexStart],t,s,r);if(i.type==="tensors")return e.inputNames.slice(o,l).map(m=>fi(m,t,s,r));const c=fi(e.inputNames.slice(o)[0],t,s,r),h=c.dataSync();return i.type==="number"?h[0]:sf(c.shape,h)}const a=e.attrParams[n];return a&&a.value}function fi(n,e,t,s){const[r,i]=Gi(n);if(s!=null){const o=s.getHashTableHandleByName(r);if(o!=null)return o}const a=t.currentContextIds.find(o=>!!e[q0(r,o)]);return a!==void 0?e[q0(r,a)][i]:void 0}function jge(n,e,t){return e[q0(n,t.currentContextId)]}function Sl(n,e){const[t,s,r]=Gi(n);return[q0(t,e&&e.currentContextId),s,r]}function q0(n,e){return e?`${n}-${e}`:n}function Gi(n){const e=n.split(":");if(e.length===1)return[n,0,void 0];const t=e[0],s=e.length===3?e[1]:void 0,r=Number(e[e.length-1]);return[t,r,s]}function h0(n,e,t){let s=U("pad",n,e,t);if(s==="explicit"){s=U("explicitPaddings",n,e,t);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function Ac(n){return n.kept?n:Vc(n)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bge=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],zge=Object.freeze(Object.defineProperty({__proto__:null,json:Bge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vge=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Uge=Object.freeze(Object.defineProperty({__proto__:null,json:Vge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gge=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Wge=Object.freeze(Object.defineProperty({__proto__:null,json:Gge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hge=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],qge=Object.freeze(Object.defineProperty({__proto__:null,json:Hge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kge=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Xge=Object.freeze(Object.defineProperty({__proto__:null,json:Kge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zge=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Yge=Object.freeze(Object.defineProperty({__proto__:null,json:Zge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qge=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Jge=Object.freeze(Object.defineProperty({__proto__:null,json:Qge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eye=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],tye=Object.freeze(Object.defineProperty({__proto__:null,json:eye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nye=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],sye=Object.freeze(Object.defineProperty({__proto__:null,json:nye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rye=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],iye=Object.freeze(Object.defineProperty({__proto__:null,json:rye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aye=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],oye=Object.freeze(Object.defineProperty({__proto__:null,json:aye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lye=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],cye=Object.freeze(Object.defineProperty({__proto__:null,json:lye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uye=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],hye=Object.freeze(Object.defineProperty({__proto__:null,json:uye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dye=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],fye=Object.freeze(Object.defineProperty({__proto__:null,json:dye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pye=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],mye=Object.freeze(Object.defineProperty({__proto__:null,json:pye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gye=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],yye=Object.freeze(Object.defineProperty({__proto__:null,json:gye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vye=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],bye=Object.freeze(Object.defineProperty({__proto__:null,json:vye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ye=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],xye=Object.freeze(Object.defineProperty({__proto__:null,json:_ye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wye=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Tye=Object.freeze(Object.defineProperty({__proto__:null,json:wye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $M{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[zge,Uge,Wge,qge,Xge,Yge,Jge,tye,sye,iye,oye,cye,hye,fye,mye,yye,bye,xye,Tye],t=[].concat(...e.map(s=>s.json));this.opMappers=t.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,t={}){const s=e.node,r=[],i=[],a=[],o=s.reduce((w,T)=>(w[T.name]=this.mapNode(T),T.op.startsWith("Placeholder")?r.push(w[T.name]):T.op==="Const"?i.push(w[T.name]):(T.input==null||T.input.length===0)&&a.push(w[T.name]),w),{});let l=[];const c=[];let h={},p={};t!=null&&(h=this.mapSignatureEntries(t.inputs),p=this.mapSignatureEntries(t.outputs));const m=Object.keys(o);m.forEach(w=>{const T=o[w];T.inputNames.forEach((E,C)=>{const[A,,D]=Sl(E),F=o[A];if(F.outputs!=null){const W=F.outputs.indexOf(D);if(W!==-1){const B=`${A}:${W}`;T.inputNames[C]=B}}T.inputs.push(F),F.children.push(T)})}),Object.keys(p).length===0?m.forEach(w=>{const T=o[w];T.children.length===0&&c.push(T)}):Object.keys(p).forEach(w=>{const[T]=Sl(w),E=o[T];E!=null&&(E.signatureKey=p[w],c.push(E))}),Object.keys(h).length>0?Object.keys(h).forEach(w=>{const[T]=Sl(w),E=o[T];E&&(E.signatureKey=h[w],l.push(E))}):l=r;let v={};e.library!=null&&e.library.function!=null&&(v=e.library.function.reduce((w,T)=>(w[T.signature.name]=this.mapFunction(T),w),{}));const _={nodes:o,inputs:l,outputs:c,weights:i,placeholders:r,signature:t,functions:v};return a.length>0&&(_.initNodes=a),_}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,s)=>(t[e[s].name]=s,t),{})}mapNode(e){const t=BW(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(s.inputParams=t.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),t.attrs!=null&&(s.attrParams=t.attrs.reduce((r,i)=>{const a=i.type;let o;switch(i.type){case"string":o=EI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=EI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":o=RI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=RI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":o=II(e.attr,i.tfName,i.defaultValue||0),o===void 0&&i.tfDeprecatedName&&(o=II(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":o=AI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=AI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":o=NI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=NI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":o=LI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=LI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":o=$I(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=$I(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":o=DI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=DI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":o=CI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=CI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":o=kI(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=kI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":o=AM(e.attr,i.tfName,i.defaultValue),o===void 0&&i.tfDeprecatedName&&(o=AM(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:o,type:a},r},{})),s}mapFunction(e){const t=e.nodeDef,s=[],r=[];let i={};t!=null&&(i=t.reduce((p,m)=>(p[m.name]=this.mapNode(m),m.op==="Const"&&r.push(p[m.name]),p),{}));const a=[],o=[];e.signature.inputArg.forEach(p=>{const[m]=Sl(p.name),v={name:m,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:O2(p.type),type:"dtype"}},children:[]};v.signatureKey=p.name,a.push(v),i[m]=v}),Object.keys(i).forEach(p=>{const m=i[p];m.inputNames.forEach((v,_)=>{const[w,,T]=Sl(v),E=i[w];if(E.outputs!=null){const C=E.outputs.indexOf(T);if(C!==-1){const A=`${w}:${C}`;m.inputNames[_]=A}}m.inputs.push(E),E.children.push(m)})});const c=e.ret;e.signature.outputArg.forEach(p=>{const[m,v]=Sl(c[p.name]),_=i[m];_!=null&&(_.defaultOutput=v,o.push(_))});const h=this.mapArgsToSignature(e);return{nodes:i,inputs:a,outputs:o,weights:r,placeholders:s,signature:h}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s),t),{}),outputs:e.signature.outputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s,e.ret),t),{})}}mapArgToTensorInfo(e,t){let s=e.name;return t!=null&&(s=t[s]),{name:s,dtype:e.type}}}function Sye(n){const e=Rt().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function zW(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):Sye(n);return e?t:t.toLowerCase()}function EI(n,e,t,s=!1){const r=n[e];return r!=null?zW(r.s,s):t}function NI(n,e,t){const s=n[e];return s?s.b:t}function II(n,e,t){const s=n[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:t;return typeof r=="number"?r:parseInt(r,10)}function O2(n){switch(typeof n=="string"&&(n=Ja[n]),n){case Ja.DT_FLOAT:case Ja.DT_HALF:return"float32";case Ja.DT_INT32:case Ja.DT_INT64:case Ja.DT_INT8:case Ja.DT_UINT8:return"int32";case Ja.DT_BOOL:return"bool";case Ja.DT_DOUBLE:return"float32";case Ja.DT_STRING:return"string";default:return null}}function AM(n,e,t){const s=n[e];return s&&s.func?s.func.name:t}function CI(n,e,t){const s=n[e];return s&&s.type?O2(s.type):t}function kI(n,e,t){const s=n[e];return s&&s.list&&s.list.type?s.list.type.map(r=>O2(r)):t}function VW(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function $I(n,e,t){const s=n[e];return s&&s.shape?VW(s.shape):t}function AI(n,e,t){const s=n[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):t}function RI(n,e,t,s=!1){const r=n[e];return r&&r.list&&r.list.s?r.list.s.map(i=>zW(i,s)):t}function DI(n,e,t){const s=n[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>VW(r)):t}function LI(n,e,t){const s=n[e];return s&&s.list&&s.list.b?s.list.b:t}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eye{constructor(e,t,s){this.node=e,this.tensorMap=t,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return fi(e,this.tensorMap,this.context)}getAttr(e,t){const s=this.node.rawAttrs[e];if(s.tensor!=null)return fi(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return II(this.node.rawAttrs,e,t);if(s.s!=null)return EI(this.node.rawAttrs,e,t);if(s.b!=null)return NI(this.node.rawAttrs,e,t);if(s.shape!=null)return $I(this.node.rawAttrs,e,t);if(s.type!=null)return CI(this.node.rawAttrs,e,t);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return AI(this.node.rawAttrs,e,t);if(s.list.s!=null)return RI(this.node.rawAttrs,e,t);if(s.list.shape!=null)return DI(this.node.rawAttrs,e,t);if(s.list.b!=null)return LI(this.node.rawAttrs,e,t);if(s.list.type!=null)return kI(this.node.rawAttrs,e,t)}return t}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hr=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:Fk,abs:Hi,acos:_6,acosh:x6,add:Et,addN:w6,all:T6,any:S6,argMax:E6,argMin:N6,asin:I6,asinh:C6,atan:k6,atan2:$6,atanh:A6,avgPool:e2,avgPool3d:O6,basicLSTMCell:P6,batchNorm:Vv,batchNorm2d:M6,batchNorm3d:F6,batchNorm4d:j6,batchToSpaceND:t2,bincount:n2,booleanMaskAsync:xW,broadcastArgs:B6,broadcastTo:Py,buffer:Ko,cast:is,ceil:z6,clipByValue:V6,clone:Vc,complex:Xc,concat:zr,concat1d:U6,concat2d:G6,concat3d:W6,concat4d:H6,conv1d:q6,conv2d:Uv,conv2dTranspose:X6,conv3d:Z6,conv3dTranspose:Y6,cos:Q6,cosh:J6,cosineWindow:lw,cumprod:eG,cumsum:tG,denseBincount:nG,depthToSpace:sG,depthwiseConv2d:nw,diag:rG,dilation2d:iG,div:Wn,divNoNan:aG,dot:oG,dropout:NW,einsum:lG,elu:r2,enclosingPowerOfTwo:A2,equal:s2,erf:cG,euclideanNorm:dG,exp:Ph,expandDims:$c,expm1:fG,eye:a2,fft:aw,fill:Km,floor:o2,floorDiv:Qk,fused:CW,gather:l2,gatherND:EW,greater:Hv,greaterEqual:c2,ifft:iv,imag:Bv,image:D2,inTopKAsync:IW,irfft:I2,isFinite:pG,isInf:mG,isNaN:gG,leakyRelu:u2,less:yG,lessEqual:sw,linalg:PW,linspace:vG,localResponseNormalization:bG,log:Sm,log1p:h2,logSigmoid:xG,logSoftmax:wG,logSumExp:f2,logicalAnd:sv,logicalNot:p2,logicalOr:m2,logicalXor:TG,losses:MW,lowerBound:SG,matMul:wn,max:of,maxPool:g2,maxPool3d:EG,maxPoolWithArgmax:NG,maximum:y2,mean:rv,meshgrid:IG,min:H0,minimum:v2,mirrorPad:CG,mod:kG,moments:$G,movingAverage:wW,mul:Ye,multiRNNCell:AG,multinomial:RG,neg:Fl,norm:Wv,notEqual:b2,oneHot:U0,ones:dh,onesLike:DG,op:fe,outerProduct:LG,pad:Xm,pad1d:OG,pad2d:PG,pad3d:MG,pad4d:FG,pool:jG,pow:Tm,prelu:x2,print:Vk,prod:BG,raggedGather:zG,raggedTensorToTensor:VG,rand:UG,randomGamma:GG,randomNormal:T2,randomStandardNormal:WG,randomUniform:S2,range:Em,real:wm,reciprocal:HG,relu:qv,relu6:E2,reshape:ze,reverse:Mh,reverse1d:qG,reverse2d:KG,reverse3d:XG,reverse4d:ZG,rfft:ow,round:N2,rsqrt:YG,scalar:Xt,scatterND:TW,searchSorted:iw,selu:QG,separableConv2d:JG,setdiff1dAsync:eW,sigmoid:af,sign:tW,signal:OW,sin:nW,sinh:sW,slice:Mn,slice1d:rW,slice2d:iW,slice3d:aW,slice4d:oW,softmax:lW,softplus:d2,spaceToBatchND:_2,sparse:FW,sparseToDense:SW,spectral:LW,split:Nm,sqrt:Zl,square:oo,squaredDifference:C2,squeeze:Kv,stack:Ql,step:k2,stridedSlice:cW,string:jW,sub:Bt,sum:Gn,tan:uW,tanh:W0,tensor:Vo,tensor1d:ro,tensor2d:lm,tensor3d:qk,tensor4d:hW,tensor5d:dW,tensor6d:fW,tile:om,topk:pW,transpose:tv,truncatedNormal:mW,unique:gW,unsortedSegmentSum:yW,unstack:Yh,upperBound:vW,variable:bW,where:Tf,whereAsync:$2,zeros:Sf,zerosLike:Zi},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nye=(n,e,t,s=Hr)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(U("a",n,e,t),U("b",n,e,t))];case"AddN":return[s.addN(U("tensors",n,e,t))];case"FloorMod":case"Mod":return[s.mod(U("a",n,e,t),U("b",n,e,t))];case"Mul":return[s.mul(U("a",n,e,t),U("b",n,e,t))];case"RealDiv":case"Div":return[s.div(U("a",n,e,t),U("b",n,e,t))];case"DivNoNan":return[s.divNoNan(U("a",n,e,t),U("b",n,e,t))];case"FloorDiv":return[s.floorDiv(U("a",n,e,t),U("b",n,e,t))];case"Sub":return[s.sub(U("a",n,e,t),U("b",n,e,t))];case"Minimum":return[s.minimum(U("a",n,e,t),U("b",n,e,t))];case"Maximum":return[s.maximum(U("a",n,e,t),U("b",n,e,t))];case"Pow":return[s.pow(U("a",n,e,t),U("b",n,e,t))];case"SquaredDifference":return[s.squaredDifference(U("a",n,e,t),U("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iye=(n,e,t,s=Hr)=>{switch(n.op){case"Abs":case"ComplexAbs":return[s.abs(U("x",n,e,t))];case"Acos":return[s.acos(U("x",n,e,t))];case"Acosh":return[s.acosh(U("x",n,e,t))];case"Asin":return[s.asin(U("x",n,e,t))];case"Asinh":return[s.asinh(U("x",n,e,t))];case"Atan":return[s.atan(U("x",n,e,t))];case"Atan2":return[s.atan2(U("x",n,e,t),U("y",n,e,t))];case"Atanh":return[s.atanh(U("x",n,e,t))];case"Ceil":return[s.ceil(U("x",n,e,t))];case"Complex":return[s.complex(U("real",n,e,t),U("imag",n,e,t))];case"Cos":return[s.cos(U("x",n,e,t))];case"Cosh":return[s.cosh(U("x",n,e,t))];case"Elu":return[s.elu(U("x",n,e,t))];case"Erf":return[s.erf(U("x",n,e,t))];case"Exp":return[s.exp(U("x",n,e,t))];case"Expm1":return[s.expm1(U("x",n,e,t))];case"Floor":return[s.floor(U("x",n,e,t))];case"Log":return[s.log(U("x",n,e,t))];case"Log1p":return[s.log1p(U("x",n,e,t))];case"Imag":return[s.imag(U("x",n,e,t))];case"Neg":return[s.neg(U("x",n,e,t))];case"Reciprocal":return[s.reciprocal(U("x",n,e,t))];case"Real":return[s.real(U("x",n,e,t))];case"Relu":return[s.relu(U("x",n,e,t))];case"Round":return[s.round(U("x",n,e,t))];case"Selu":return[s.selu(U("x",n,e,t))];case"Sigmoid":return[s.sigmoid(U("x",n,e,t))];case"Sin":return[s.sin(U("x",n,e,t))];case"Sign":return[s.sign(U("x",n,e,t))];case"Sinh":return[s.sinh(U("x",n,e,t))];case"Softplus":return[s.softplus(U("x",n,e,t))];case"Sqrt":return[s.sqrt(U("x",n,e,t))];case"Square":return[s.square(U("x",n,e,t))];case"Tanh":return[s.tanh(U("x",n,e,t))];case"Tan":return[s.tan(U("x",n,e,t))];case"ClipByValue":return[s.clipByValue(U("x",n,e,t),U("clipValueMin",n,e,t),U("clipValueMax",n,e,t))];case"Relu6":return[s.relu6(U("x",n,e,t))];case"Rsqrt":return[s.rsqrt(fi(n.inputNames[0],e,t))];case"Prod":return[s.prod(U("x",n,e,t),U("axes",n,e,t))];case"LeakyRelu":return[s.leakyRelu(U("x",n,e,t),U("alpha",n,e,t))];case"Prelu":return[s.prelu(U("x",n,e,t),U("alpha",n,e,t))];case"IsNan":return[s.isNaN(fi(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){re(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let s=0;s<n.length;s++){const r=n[s],i=e[s];re(r<0||i<0||r===i,()=>t+` Shapes ${n} and ${e} must match`)}}}function RM(n){return!(typeof n=="number"||n.some(e=>e<0))}function ly(n,e,t){let s=OI(n,t);const r=!RM(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=OI(i.shape,s)}),!RM(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function OI(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let s=0;s<n.length;++s){const r=n[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[s]=r>=0?r:i}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cye{constructor(e,t,s,r,i,a,o){this.name=e,this.dtype=t,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=Xt(0),kl(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),to(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=t,kl(t),s.written=!0,this.tensors[e]=s}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((s,r)=>this.write(s,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Vo([],[0].concat(this.elementShape));const s=this.readMany(e);return to(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Ql(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Vo([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const s=this.readMany(t);return to(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),zr(s,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Yh(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:t.size/s,a=[];pn(()=>{t=ze(t,[1,s,i]);for(let l=0;l<e.length;++l){const h=[0,l===0?0:r[l-1],0],p=[1,e[l],i];a[l]=ze(Mn(t,h,p),this.elementShape)}return a});const o=[];for(let l=0;l<e.length;l++)o[l]=l;this.writeMany(o,a)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ef{constructor(e,t,s,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=s,e?.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);to(t,i.shape,"TensorList shape mismatch: "),kl(i)}),this.idTensor=Xt(0),this.maxNumElements=r,kl(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Ef([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,s=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);to(e,this.elementShape,"TensorList shape mismatch: ");const r=ly(this.elementShape,this.tensors,e);return pn(()=>{const i=this.tensors.map(a=>ze(a,r));return Ql(i,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=ly(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,to(r.shape,e,"TensorList shape mismatch: "),ze(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(to(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");kl(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new Ef([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)t.tensors[s]=this.tensors[s];return t}getItem(e,t,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);to(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=ly(this.elementShape,this.tensors,t);return ze(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);to(this.elementShape,t.shape,"TensorList shape mismatch: "),kl(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,s){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);to(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=ly(this.elementShape,this.tensors,s);return e.length===0?Vo([],[0].concat(r)):pn(()=>{const i=e.map(a=>ze(this.tensors[a],r));return Ql(i,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);to(this.elementShape,t,"TensorList shape mismatch: ");const s=ly(this.elementShape,this.tensors,t);return this.size()===0?Vo([],[0].concat(s)):pn(()=>{const r=this.tensors.map(i=>ze(i,s));return zr(r,0)})}}function kye(n,e,t){const s=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const r=n.shape.slice(1);to(r,e,"TensorList shape mismatch: ");const i=Yh(n);return new Ef(i,e,s)}function $ye(n,e,t,s){return new Ef([],n,e,s)}function Aye(n,e,t,s){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Ef([],t,n.dtype,s),a=Yh(n,0);return e.forEach((o,l)=>{i.setItem(o,a[l])}),i}function Rye(n,e,t){let s=0;const r=e.map(h=>(s+=h,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);const i=n.shape.slice(1),a=OI(i,t),o=s===0?0:n.size/s,l=pn(()=>{const h=[];n=ze(n,[1,s,o]);for(let p=0;p<e.length;++p){const v=[0,p===0?0:r[p-1],0],_=[1,e[p],o];h[p]=ze(Mn(n,v,_),a)}return n.dispose(),h}),c=new Ef([],t,n.dtype,e.length);for(let h=0;h<l.length;h++)c.setItem(h,l[h]);return c}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dye=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const s=U("thenBranch",n,e,t),r=U("elseBranch",n,e,t),i=U("cond",n,e,t),a=U("args",n,e,t);return(await i.data())[0]?t.functionMap[s].executeFunctionAsync(a,t.tensorArrayMap,t.tensorListMap):t.functionMap[r].executeFunctionAsync(a,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const s=U("body",n,e,t),r=U("cond",n,e,t),i=U("args",n,e,t),a=await t.functionMap[r].executeFunctionAsync(i,t.tensorArrayMap,t.tensorListMap),o=i.map(h=>h.id);let l=await a[0].data();a.forEach(h=>{!h.kept&&o.indexOf(h.id)===-1&&h.dispose()});let c=i;for(;l[0];){const h=c;c=await t.functionMap[s].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap);const p=c.map(v=>v.id);h.forEach(v=>{!v.kept&&o.indexOf(v.id)===-1&&p.indexOf(v.id)===-1&&v.dispose()});const m=await t.functionMap[r].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap);l=await m[0].data(),m.forEach(v=>{!v.kept&&o.indexOf(v.id)===-1&&p.indexOf(v.id)===-1&&v.dispose()})}return c}case"LoopCond":{const s=U("pred",n,e,t);return[Ac(s)]}case"Switch":{const s=U("pred",n,e,t);let r=U("data",n,e,t);return r.kept||(r=Ac(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=n.inputNames.find(r=>fi(r,e,t)!==void 0);if(s){const r=fi(s,e,t);return[Ac(r)]}return}case"Enter":{const s=U("frameName",n,e,t),r=U("tensor",n,e,t);return t.enterFrame(s),[Ac(r)]}case"Exit":{const s=U("tensor",n,e,t);return t.exitFrame(),[Ac(s)]}case"NextIteration":{const s=U("tensor",n,e,t);return t.nextIteration(),[Ac(s)]}case"TensorArrayV3":{const s=U("size",n,e,t),r=U("dtype",n,e,t),i=U("elementShape",n,e,t),a=U("dynamicSize",n,e,t),o=U("clearAfterRead",n,e,t),l=U("identicalElementShapes",n,e,t),c=U("name",n,e,t),h=new Cye(c,r,s,i,l,a,o);return t.addTensorArray(h),[h.idTensor,Xt(1)]}case"TensorArrayWriteV3":{const s=U("tensorArrayId",n,e,t),r=U("index",n,e,t),i=U("tensor",n,e,t),a=t.getTensorArray(s.id);return a.write(r,i),[a.idTensor]}case"TensorArrayReadV3":{const s=U("tensorArrayId",n,e,t),r=U("index",n,e,t);return[t.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=U("tensorArrayId",n,e,t),r=U("indices",n,e,t),i=U("dtype",n,e,t);return[t.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=U("tensorArrayId",n,e,t),r=U("indices",n,e,t),i=U("tensor",n,e,t),a=t.getTensorArray(s.id);return a.scatter(r,i),[a.idTensor]}case"TensorArrayConcatV3":{const s=U("tensorArrayId",n,e,t),r=t.getTensorArray(s.id),i=U("dtype",n,e,t);return[r.concat(i)]}case"TensorArraySplitV3":{const s=U("tensorArrayId",n,e,t),r=U("tensor",n,e,t),i=U("lengths",n,e,t),a=t.getTensorArray(s.id);return a.split(i,r),[a.idTensor]}case"TensorArraySizeV3":{const s=U("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return[Xt(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=U("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=U("tensorListId",n,e,t),r=U("index",n,e,t),i=U("tensor",n,e,t),a=t.getTensorList(s.id);return a.setItem(r,i),[a.idTensor]}case"TensorListGetItem":{const s=U("tensorListId",n,e,t),r=U("index",n,e,t),i=U("elementShape",n,e,t),a=U("elementDType",n,e,t);return[t.getTensorList(s.id).getItem(r,i,a)]}case"TensorListScatterV2":case"TensorListScatter":{const s=U("indices",n,e,t),r=U("tensor",n,e,t),i=U("elementShape",n,e,t),a=U("numElements",n,e,t),o=Aye(r,s,i,a);return t.addTensorList(o),[o.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=U("elementShape",n,e,t),r=U("elementDType",n,e,t);let i;n.op==="TensorListReserve"?i="numElements":i="maxNumElements";const a=U(i,n,e,t),o=n.op==="TensorListReserve"?-1:a,l=$ye(s,r,a,o);return t.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=U("tensorListId",n,e,t),r=U("indices",n,e,t),i=U("elementShape",n,e,t),a=U("elementDType",n,e,t);return[t.getTensorList(s.id).gather(r,a,i)]}case"TensorListStack":{const s=U("tensorListId",n,e,t),r=U("elementShape",n,e,t),i=U("elementDType",n,e,t),a=U("numElements",n,e,t);return[t.getTensorList(s.id).stack(r,i,a)]}case"TensorListFromTensor":{const s=U("tensor",n,e,t),r=U("elementShape",n,e,t),i=U("elementDType",n,e,t),a=kye(s,r,i);return t.addTensorList(a),[a.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=U("tensorListId",n,e,t),r=t.getTensorList(s.id),i=U("dtype",n,e,t),a=U("elementShape",n,e,t);return[r.concat(i,a)]}case"TensorListPushBack":{const s=U("tensorListId",n,e,t),r=U("tensor",n,e,t),i=t.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=U("tensorListId",n,e,t),r=U("elementShape",n,e,t),i=U("elementDType",n,e,t);return[t.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=U("tensor",n,e,t),r=U("elementShape",n,e,t),i=U("lengths",n,e,t),a=Rye(s,i,r);return t.addTensorList(a),[a.idTensor]}case"TensorListLength":{const s=U("tensorListId",n,e,t),r=t.getTensorList(s.id);return[Xt(r.size(),"int32")]}case"TensorListResize":{const s=U("tensorListId",n,e,t),r=U("size",n,e,t),a=t.getTensorList(s.id).resize(r);return t.addTensorList(a),[a.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DM(n,e,t){const[s,r]=U("fusedOps",n,e,t),i=s==="biasadd",a=!i,o=r==="prelu",l=s==="fusedbatchnorm",c=U("numArgs",n,e,t);if(i){if(o&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&i&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const h=U("strides",n,e,t),p=h0(n,e,t),m=U("dataFormat",n,e,t).toUpperCase(),v=U("dilations",n,e,t);let[_,w]=U("args",n,e,t);a&&(w=_,_=void 0);const T=U("leakyreluAlpha",n,e,t);return{stride:h,pad:p,dataFormat:m,dilations:v,biasArg:_,preluArg:w,activationFunc:r,leakyreluAlpha:T}}const Lye=(n,e,t,s=Hr)=>{switch(n.op){case"Conv1D":{const r=U("stride",n,e,t),i=U("pad",n,e,t),a=U("dataFormat",n,e,t).toUpperCase(),o=U("dilation",n,e,t);return[s.conv1d(U("x",n,e,t),U("filter",n,e,t),r,i,a,o)]}case"Conv2D":{const r=U("strides",n,e,t),i=h0(n,e,t),a=U("dataFormat",n,e,t).toUpperCase(),o=U("dilations",n,e,t);return[s.conv2d(U("x",n,e,t),U("filter",n,e,t),[r[1],r[2]],i,a,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:a,dilations:o,biasArg:l,preluArg:c,activationFunc:h,leakyreluAlpha:p}=DM(n,e,t);return[s.fused.conv2d({x:U("x",n,e,t),filter:U("filter",n,e,t),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[o[1],o[2]],bias:l,activation:h,preluActivationWeights:c,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:a,dilations:o,biasArg:l,preluArg:c,activationFunc:h,leakyreluAlpha:p}=DM(n,e,t);return[s.fused.depthwiseConv2d({x:U("x",n,e,t),filter:U("filter",n,e,t),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[o[1],o[2]],bias:l,activation:h,preluActivationWeights:c,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=U("outputShape",n,e,t),i=U("strides",n,e,t),a=h0(n,e,t);return[s.conv2dTranspose(U("x",n,e,t),U("filter",n,e,t),r,[i[1],i[2]],a)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=U("strides",n,e,t),i=h0(n,e,t),a=U("dilations",n,e,t),o=U("dataFormat",n,e,t).toUpperCase();return[s.depthwiseConv2d(U("input",n,e,t),U("filter",n,e,t),[r[1],r[2]],i,o,[a[1],a[2]])]}case"Conv3D":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("dataFormat",n,e,t).toUpperCase(),o=U("dilations",n,e,t);return[s.conv3d(U("x",n,e,t),U("filter",n,e,t),[r[1],r[2],r[3]],i,a,[o[1],o[2],o[3]])]}case"AvgPool":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("kernelSize",n,e,t);return[s.avgPool(U("x",n,e,t),[a[1],a[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("kernelSize",n,e,t);return[s.maxPool(U("x",n,e,t),[a[1],a[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("kernelSize",n,e,t),o=U("includeBatchInIndex",n,e,t),{result:l,indexes:c}=s.maxPoolWithArgmax(U("x",n,e,t),[a[1],a[2]],[r[1],r[2]],i,o);return[l,c]}case"AvgPool3D":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("kernelSize",n,e,t);return[s.avgPool3d(U("x",n,e,t),[a[1],a[2],a[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("kernelSize",n,e,t);return[s.maxPool3d(U("x",n,e,t),[a[1],a[2],a[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=U("strides",n,e,t),i=U("pad",n,e,t),a=U("dilations",n,e,t),o=r[1],l=r[2],c=a[1],h=a[2];return[s.dilation2d(U("x",n,e,t),U("filter",n,e,t),[o,l],i,[c,h],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oye=(n,e,t,s=Hr)=>{switch(n.op){case"Fill":{const r=U("shape",n,e,t),i=U("dtype",n,e,t),a=U("value",n,e,t);return[s.fill(r,a,i)]}case"LinSpace":{const r=U("start",n,e,t),i=U("stop",n,e,t),a=U("num",n,e,t);return[s.linspace(r,i,a)]}case"Multinomial":{const r=U("logits",n,e,t),i=U("numSamples",n,e,t),a=U("seed",n,e,t);return[s.multinomial(r,i,a)]}case"OneHot":{const r=U("indices",n,e,t),i=U("depth",n,e,t),a=U("onValue",n,e,t),o=U("offValue",n,e,t),l=U("dtype",n,e,t);return[s.oneHot(r,i,a,o,l)]}case"Ones":return[s.ones(U("shape",n,e,t),U("dtype",n,e,t))];case"OnesLike":return[s.onesLike(U("x",n,e,t))];case"RandomStandardNormal":return[s.randomStandardNormal(U("shape",n,e,t),U("dtype",n,e,t),U("seed",n,e,t))];case"RandomUniform":return[s.randomUniform(U("shape",n,e,t),U("minval",n,e,t),U("maxval",n,e,t),U("dtype",n,e,t))];case"Range":{const r=U("start",n,e,t),i=U("stop",n,e,t),a=U("step",n,e,t);return[s.range(r,i,a,U("dtype",n,e,t))]}case"TruncatedNormal":{const r=U("shape",n,e,t),i=U("mean",n,e,t),a=U("stdDev",n,e,t),o=U("seed",n,e,t);return[s.truncatedNormal(r,i,a,U("dtype",n,e,t),o)]}case"Zeros":return[s.zeros(U("shape",n,e,t),U("dtype",n,e,t))];case"ZerosLike":return[s.zerosLike(U("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rN(n,e,t){const s=U("boxes",n,e,t),r=U("scores",n,e,t),i=U("maxOutputSize",n,e,t),a=U("iouThreshold",n,e,t),o=U("scoreThreshold",n,e,t),l=U("softNmsSigma",n,e,t);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:a,scoreThreshold:o,softNmsSigma:l}}const Pye=async(n,e,t,s,r=Hr)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:a,maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:h}=rN(n,e,t),p=await r.image.nonMaxSuppressionWithScoreAsync(i,a,o,l,c,h);return[p.selectedIndices,p.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:a,maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=rN(n,e,t),h=U("padToMaxOutputSize",n,e,t),p=await r.image.nonMaxSuppressionPaddedAsync(i,a,o,l,c,h);return[p.selectedIndices,p.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:a,maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=rN(n,e,t);return[await r.image.nonMaxSuppressionAsync(i,a,o,l,c)]}case"Where":{const i=r.cast(U("condition",n,e,t),"bool"),a=[await r.whereAsync(i)];return i.dispose(),a}case"ListDiff":return r.setdiff1dAsync(U("x",n,e,t),U("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mye=(n,e,t,s=Hr)=>{switch(n.op){case"LowerBound":{const r=U("sortedSequence",n,e,t),i=U("values",n,e,t);return[s.lowerBound(r,i)]}case"TopKV2":{const r=U("x",n,e,t),i=U("k",n,e,t),a=U("sorted",n,e,t),o=s.topk(r,i,a);return[o.values,o.indices]}case"UpperBound":{const r=U("sortedSequence",n,e,t),i=U("values",n,e,t);return[s.upperBound(r,i)]}case"Unique":{const r=U("x",n,e,t),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=U("x",n,e,t),i=U("axis",n,e,t),a=s.unique(r,i);return[a.values,a.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fye=(n,e,t,s=Hr)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const r=U("default",n,e,t);return[fi(n.name,e,t)||r];case"Placeholder":return[fi(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const h=U("x",n,e,t);return[Ac(h)]}case"IdentityN":return U("x",n,e,t).map(h=>Ac(h));case"Snapshot":const i=U("x",n,e,t);return[Ac(i)];case"Shape":return[s.tensor1d(U("x",n,e,t).shape,"int32")];case"ShapeN":return U("x",n,e,t).map(h=>s.tensor1d(h.shape));case"Size":return[s.scalar(U("x",n,e,t).size,"int32")];case"Rank":return[s.scalar(U("x",n,e,t).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const a=U("x",n,e,t),o=U("data",n,e,t),l=U("message",n,e,t),c=U("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let h=0;h<o.length;h++)console.log(Array.prototype.slice.call(o[h].dataSync()).slice(0,c));return[a];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jye{constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Xt(0),this.tensorMap=new Map,kl(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Xt(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),pn(()=>{const r=Yh(t),i=s.length,a=r.length;re(i===a,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${a} elements.`);for(let o=0;o<i;o++){const l=s[o],c=r[o];kl(c),this.tensorMap.set(l,c)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return pn(()=>{const r=[];for(let i=0;i<s.length;i++){const a=s[i],o=this.findWithDefault(a,t);r.push(o)}return Ql(r)})}findWithDefault(e,t){const s=this.tensorMap.get(e);return s??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bye=async(n,e,t,s)=>{switch(n.op){case"HashTable":case"HashTableV2":{const r=U("keyDType",n,e,t),i=U("valueDType",n,e,t),a=new jye(r,i);return s.addHashTable(n.name,a),[a.handle]}case"LookupTableImport":case"LookupTableImportV2":{const r=U("tableHandle",n,e,t,s),i=U("keys",n,e,t),a=U("values",n,e,t);return[await s.getHashTableById(r.id).import(i,a)]}case"LookupTableFind":case"LookupTableFindV2":{const r=U("tableHandle",n,e,t,s),i=U("keys",n,e,t),a=U("defaultValue",n,e,t);return[await s.getHashTableById(r.id).find(i,a)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=U("tableHandle",n,e,t,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zye=(n,e,t,s=Hr)=>{switch(n.op){case"ResizeBilinear":{const r=U("images",n,e,t),i=U("size",n,e,t),a=U("alignCorners",n,e,t),o=U("halfPixelCenters",n,e,t);return[s.image.resizeBilinear(r,[i[0],i[1]],a,o)]}case"ResizeNearestNeighbor":{const r=U("images",n,e,t),i=U("size",n,e,t),a=U("alignCorners",n,e,t),o=U("halfPixelCenters",n,e,t);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],a,o)]}case"CropAndResize":{const r=U("image",n,e,t),i=U("boxes",n,e,t),a=U("boxInd",n,e,t),o=U("cropSize",n,e,t),l=U("method",n,e,t),c=U("extrapolationValue",n,e,t);return[s.image.cropAndResize(r,i,a,o,l,c)]}case"ImageProjectiveTransformV3":{const r=U("images",n,e,t),i=U("transforms",n,e,t),a=U("outputShape",n,e,t),o=U("fillValue",n,e,t),l=U("interpolation",n,e,t),c=U("fillMode",n,e,t);return[s.image.transform(r,i,l.toLowerCase(),c.toLowerCase(),o,a)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vye=(n,e,t,s=Hr)=>{switch(n.op){case"Equal":return[s.equal(U("a",n,e,t),U("b",n,e,t))];case"NotEqual":return[s.notEqual(U("a",n,e,t),U("b",n,e,t))];case"Greater":return[s.greater(U("a",n,e,t),U("b",n,e,t))];case"GreaterEqual":return[s.greaterEqual(U("a",n,e,t),U("b",n,e,t))];case"Less":return[s.less(U("a",n,e,t),U("b",n,e,t))];case"LessEqual":return[s.lessEqual(U("a",n,e,t),U("b",n,e,t))];case"LogicalAnd":return[s.logicalAnd(U("a",n,e,t),U("b",n,e,t))];case"LogicalNot":return[s.logicalNot(U("a",n,e,t))];case"LogicalOr":return[s.logicalOr(U("a",n,e,t),U("b",n,e,t))];case"Select":case"SelectV2":return[s.where(U("condition",n,e,t),U("a",n,e,t),U("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uye=(n,e,t,s=Hr)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(U("a",n,e,t),U("b",n,e,t),U("transposeA",n,e,t),U("transposeB",n,e,t))];case"Einsum":return[s.einsum(U("equation",n,e,t),...U("tensors",n,e,t))];case"Transpose":return[s.transpose(U("x",n,e,t),U("perm",n,e,t))];case"_FusedMatMul":const[r,i]=U("fusedOps",n,e,t),a=r==="biasadd",o=i==="prelu",l=U("numArgs",n,e,t),c=U("leakyreluAlpha",n,e,t);if(a){if(o&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[h,p]=U("args",n,e,t);return[s.fused.matMul({a:U("a",n,e,t),b:U("b",n,e,t),transposeA:U("transposeA",n,e,t),transposeB:U("transposeB",n,e,t),bias:h,activation:i,preluActivationWeights:p,leakyreluAlpha:c})];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gye=(n,e,t,s=Hr)=>{switch(n.op){case"EuclideanNorm":return[s.euclideanNorm(U("x",n,e,t),U("axis",n,e,t),U("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(U("x",n,e,t),U("mean",n,e,t),U("variance",n,e,t),U("offset",n,e,t),U("scale",n,e,t),U("epsilon",n,e,t))];case"FusedBatchNormV3":return[s.batchNorm(U("x",n,e,t),U("mean",n,e,t),U("variance",n,e,t),U("offset",n,e,t),U("scale",n,e,t),U("epsilon",n,e,t))];case"LRN":return[s.localResponseNormalization(U("x",n,e,t),U("radius",n,e,t),U("bias",n,e,t),U("alpha",n,e,t),U("beta",n,e,t))];case"Softmax":return[s.softmax(U("x",n,e,t))];case"LogSoftmax":return[s.logSoftmax(U("x",n,e,t))];case"SparseToDense":return[s.sparseToDense(U("sparseIndices",n,e,t),U("outputShape",n,e,t),U("sparseValues",n,e,t),U("defaultValue",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wye=(n,e,t,s=Hr)=>{switch(n.op){case"Max":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.max(U("x",n,e,t),o,l)]}case"Mean":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.mean(U("x",n,e,t),o,l)]}case"Min":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.min(U("x",n,e,t),o,l)]}case"Sum":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.sum(U("x",n,e,t),o,l)]}case"All":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.all(U("x",n,e,t),o,l)]}case"Any":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.any(U("x",n,e,t),o,l)]}case"ArgMax":{const o=U("axis",n,e,t);return[s.argMax(U("x",n,e,t),o)]}case"ArgMin":{const o=U("axis",n,e,t);return[s.argMin(U("x",n,e,t),o)]}case"Prod":{const o=U("axis",n,e,t),l=U("keepDims",n,e,t);return[s.prod(U("x",n,e,t),o,l)]}case"Cumprod":{const o=U("axis",n,e,t),l=U("exclusive",n,e,t),c=U("reverse",n,e,t);return[s.cumprod(U("x",n,e,t),o,l,c)]}case"Cumsum":{const o=U("axis",n,e,t),l=U("exclusive",n,e,t),c=U("reverse",n,e,t);return[s.cumsum(U("x",n,e,t),o,l,c)]}case"Bincount":const r=U("x",n,e,t),i=U("weights",n,e,t),a=U("size",n,e,t);return[s.bincount(r,i,a)];case"DenseBincount":{const o=U("x",n,e,t),l=U("weights",n,e,t),c=U("size",n,e,t),h=U("binaryOutput",n,e,t);return[s.denseBincount(o,l,c,h)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hye=(n,e,t,s=Hr)=>{switch(n.op){case"ConcatV2":case"Concat":{const r=U("n",n,e,t),i=U("axis",n,e,t);let a=U("tensors",n,e,t);return a=a.slice(0,r),[s.concat(a,i)]}case"Gather":{const r=U("x",n,e,t),i=U("indices",n,e,t);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=U("axis",n,e,t),i=U("batchDims",n,e,t),a=U("x",n,e,t),o=U("indices",n,e,t);return[s.gather(a,s.cast(o,"int32"),r,i)]}case"Reverse":{const r=U("dims",n,e,t),i=[];for(let o=0;o<r.length;o++)r[o]&&i.push(o);const a=U("x",n,e,t);return[s.reverse(a,i)]}case"ReverseV2":{const r=U("axis",n,e,t),i=U("x",n,e,t);return[s.reverse(i,r)]}case"Slice":{const r=U("begin",n,e,t),i=U("size",n,e,t);return[s.slice(U("x",n,e,t),r,i)]}case"StridedSlice":{const r=U("begin",n,e,t),i=U("end",n,e,t),a=U("strides",n,e,t),o=U("beginMask",n,e,t),l=U("endMask",n,e,t),c=U("ellipsisMask",n,e,t),h=U("newAxisMask",n,e,t),p=U("shrinkAxisMask",n,e,t),m=U("x",n,e,t);return[s.stridedSlice(m,r,i,a,o,l,c,h,p)]}case"Pack":return pn(()=>{const r=U("axis",n,e,t),i=U("tensors",n,e,t),a=i[0].shape,o=s.squeeze(i[0]).shape,l=i.map(c=>{const h=Kl(c.shape,a);if(!h&&!Kl(s.squeeze(c).shape,o))throw new Error("the input tensors shape does not match");return h?c:s.reshape(c,a)});return[s.stack(l,r)]});case"Unpack":{const r=U("axis",n,e,t),i=U("tensor",n,e,t);return s.unstack(i,r)}case"Tile":{const r=U("reps",n,e,t);return[s.tile(U("x",n,e,t),r)]}case"Split":case"SplitV":{const r=U("axis",n,e,t),i=U("numOrSizeSplits",n,e,t),a=U("x",n,e,t);return s.split(a,i,r)}case"ScatterNd":{const r=U("indices",n,e,t),i=U("values",n,e,t),a=U("shape",n,e,t);return[s.scatterND(r,i,a)]}case"GatherNd":{const r=U("x",n,e,t),i=U("indices",n,e,t);return[s.gatherND(r,i)]}case"SparseToDense":{const r=U("sparseIndices",n,e,t),i=U("outputShape",n,e,t),a=U("sparseValues",n,e,t),o=U("defaultValue",n,e,t);return[s.sparseToDense(r,a,i,a.dtype===o.dtype?o:s.cast(o,a.dtype))]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qye=(n,e,t,s=Hr)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:a,reverseIndexMap:o}=s.sparse.sparseFillEmptyRows(U("indices",n,e,t),U("values",n,e,t),U("denseShape",n,e,t),U("defaultValue",n,e,t));return[r,i,a,o]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(U("inputIndices",n,e,t),U("inputShape",n,e,t),U("newShape",n,e,t));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(U("data",n,e,t),U("indices",n,e,t),U("segmentIds",n,e,t))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(U("data",n,e,t),U("indices",n,e,t),U("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kye=(n,e,t,s=Hr)=>{switch(n.op){case"FFT":return[s.fft(U("x",n,e,t))];case"IFFT":return[s.ifft(U("x",n,e,t))];case"RFFT":return[s.rfft(U("x",n,e,t))];case"IRFFT":return[s.irfft(U("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xye=(n,e,t,s=Hr)=>{switch(n.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(U("data",n,e,t),U("dataSplits",n,e,t),U("separator",n,e,t),U("nGramWidths",n,e,t),U("leftPad",n,e,t),U("rightPad",n,e,t),U("padWidth",n,e,t),U("preserveShortSequences",n,e,t));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:a}=s.string.stringSplit(U("input",n,e,t),U("delimiter",n,e,t),U("skipEmpty",n,e,t));return[r,i,a]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(U("input",n,e,t),U("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zye=(n,e,t,s=Hr)=>{switch(n.op){case"Cast":return[s.cast(U("x",n,e,t),U("dtype",n,e,t))];case"ExpandDims":{const r=U("axis",n,e,t);return[s.expandDims(U("x",n,e,t),r)]}case"Squeeze":{const r=U("axis",n,e,t);return[s.squeeze(U("x",n,e,t),r)]}case"Reshape":return[s.reshape(U("x",n,e,t),U("shape",n,e,t))];case"MirrorPad":return[s.mirrorPad(U("x",n,e,t),U("padding",n,e,t),U("mode",n,e,t))];case"PadV2":case"Pad":return[s.pad(U("x",n,e,t),U("padding",n,e,t),U("constantValue",n,e,t))];case"SpaceToBatchND":{const r=U("blockShape",n,e,t),i=U("paddings",n,e,t);return[s.spaceToBatchND(U("x",n,e,t),r,i)]}case"BatchToSpaceND":{const r=U("blockShape",n,e,t),i=U("crops",n,e,t);return[s.batchToSpaceND(U("x",n,e,t),r,i)]}case"DepthToSpace":{const r=U("blockSize",n,e,t),i=U("dataFormat",n,e,t).toUpperCase();return[s.depthToSpace(U("x",n,e,t),r,i)]}case"BroadcastTo":return[s.broadcastTo(U("x",n,e,t),U("shape",n,e,t))];case"BroadcastArgs":return[s.broadcastArgs(U("s0",n,e,t),U("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LM(n,e,t,s,r=pn){const i=((a,o,l)=>{switch(a.category){case"arithmetic":return r(()=>Nye(a,o,l));case"basic_math":return r(()=>Iye(a,o,l));case"control":return Dye(a,o,l);case"convolution":return r(()=>Lye(a,o,l));case"creation":return r(()=>Oye(a,o,l));case"dynamic":return Pye(a,o,l);case"evaluation":return r(()=>Mye(a,o,l));case"image":return r(()=>zye(a,o,l));case"graph":return r(()=>Fye(a,o,l));case"logical":return r(()=>Vye(a,o,l));case"matrices":return r(()=>Uye(a,o,l));case"normalization":return r(()=>Gye(a,o,l));case"reduction":return r(()=>Wye(a,o,l));case"slice_join":return r(()=>Hye(a,o,l));case"sparse":return r(()=>qye(a,o,l));case"spectral":return r(()=>Kye(a,o,l));case"string":return r(()=>Xye(a,o,l));case"transformation":return r(()=>Zye(a,o,l));case"hash_table":return Bye(a,o,l,s);case"custom":const c=BW(a.op);if(c&&c.customExecutor)return c.customExecutor(new Eye(a,o,l));throw TypeError(`Custom op ${a.op} is not registered.`);default:throw TypeError(`Unknown op '${a.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return bf(i)?i.then(a=>[].concat(a)):[].concat(i)}class OM{constructor(e={},t={},s={},r={}){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=s,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const s=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PM(n,e,t,s){const r=new Set,i=[];let a=null,o=null;const l=new Set,c=Object.keys(n).map(m=>Gi(m)[0]);let h=[];s!=null&&(h=s.map(m=>Gi(m.name)[0]));const p=[...e];for(;p.length>0;){const m=p.pop();if((UW(m)||tve(m)||nve(m))&&a==null&&(a=m,o=a.children.map(v=>v.name).filter(v=>r.has(v))),r.add(m.name),t[m.name]==null&&c.indexOf(m.name)===-1&&h.indexOf(m.name)===-1){if(m.inputs.length===0){i.push(m.name);continue}m.inputs.forEach(v=>{l.has(v.name)||(l.add(v.name),p.push(v))})}}return{inputs:n,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:a,syncInputs:o}}function Yye(n,e,t){const{usedNodes:s,inputs:r}=t,i=[],a=Object.keys(r).map(h=>Gi(h)[0]).map(h=>n.nodes[h]),o=n.initNodes;a.forEach(h=>{s.has(h.name)&&i.push(h)}),n.weights.forEach(h=>{s.has(h.name)&&i.push(h)}),o?.forEach(h=>{s.has(h.name)&&i.push(h)});const l=new Set,c=[];for(;i.length>0;){const h=i.pop();l.add(h.name),e[h.name]||c.push(h),h.children.forEach(p=>{!l.has(p.name)&&s.has(p.name)&&p.inputs.every(m=>l.has(m.name))&&i.push(p)})}return c}const Qye=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],Jye=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],eve=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function UW(n){return Qye.indexOf(n.op)>=0}function tve(n){return Jye.indexOf(n.op)>=0}function nve(n){return eve.indexOf(n.op)>=0}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K0{constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new K0(e.functions[s],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}getCompilationKey(e,t){const s=e.map(i=>i.name).sort(),r=t.map(i=>i.name).sort();return s.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(e,t){const s=PM(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:a}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${a}]`);if(r.length>0){const o=t.map(c=>c.name),l=Object.keys(e);throw new Error(`Cannot compute the outputs [${o}] from the provided inputs [${l}]. Missing the following inputs: [${r}]`)}return Yye(this.graph,this.weightMap,s)}execute(e,t){e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=s.map(p=>this.graph.nodes[Gi(p)[0]]),i=t.map(p=>Gi(p)[0]);let a=i.map(p=>this.graph.nodes[p]);this.resetIntermediateTensors(),a.length===0&&(a=this._outputs);const o=this.getCompilationKey(r,a);let l=this.compiledMap.get(o);l==null&&(l=this.compile(e,a),this.compiledMap.set(o,l));const c={},h={};return pn(()=>{const p=new OM(this.weightMap,c,h,this.functionExecutorMap),m=Object.assign({},this.weightMap);Object.keys(e).forEach(w=>{const[T,E]=Gi(w),C=[];C[E]=e[w],m[T]=C});const v=this.getFrozenTensorIds(m),_={};for(let w=0;w<l.length;w++){const T=l[w];if(!m[T.name]){const E=LM(T,m,p,this._resourceManager);if(bf(E))throw new Error(`The execution of the op '${T.op}' returned a promise. Please use model.executeAsync() instead.`);m[T.name]=E,this.checkTensorForDisposal(T.name,T,m,p,v,i,_)}}return this.parent==null&&p.dispose(v),t.map(w=>fi(w,m,p))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(t)}checkTensorForDisposal(e,t,s,r,i,a,o){t.category==="control"||a.indexOf(e)!==-1||(s[e].forEach(l=>{l!=null&&(o[l.id]=(o[l.id]||0)+t.children.length)}),t.inputs.forEach(l=>{if(l.category!=="control"){const c=jge(l.name,s,r);c?.forEach(h=>{if(h&&!h.kept&&!i.has(h.id)){const p=o[h.id];if(p===1){if(!this.keepTensorForDebug)h.dispose();else{const[m,v]=Sl(t.name,r);this.intermediateTensors[m]?this.intermediateTensors[m][v]=h:(this.intermediateTensors[m]=[],this.intermediateTensors[m][v]=h)}delete o[h.id]}else p!=null&&o[h.id]--}})}}))}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach(e=>this.intermediateTensors[e].forEach(t=>t.dispose())),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach(e=>{this.tensorsMap[e].forEach(s=>{s&&!s.kept&&!s.isDisposed&&!this.keepIds.has(s.id)&&s.dispose()})})}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const e in this.intermediateTensors)this.intermediateTensors[e].forEach(t=>t.dispose()),delete this.intermediateTensors[e]}async _executeAsync(e,t,s=!1,r={},i={}){s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepTensorForDebug=Rt().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){console.warn(h.message)}this.resetIntermediateTensors();const a=new OM(this.weightMap,r,i,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(e,a,t,s);const o=t.map(h=>fi(h,this.tensorsMap,a)),l=o.map(h=>h.id),c=Object.keys(e).map(h=>e[h].id);return this.keepIds=new Set([...l,...c,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&a.dispose(this.keepIds),o}async executeFunctionAsync(e,t,s){const r=e.reduce((i,a,o)=>(i[this.inputs[o].name]=a,i),{});return this._executeAsync(r,this.outputNodes,!0,t,s)}async executeWithControlFlow(e,t,s,r){const i=Object.keys(e),a=i.map(A=>this.graph.nodes[Gi(A)[0]]),o=s.map(A=>Gi(A)[0]);let l=o.map(A=>this.graph.nodes[A]);l.length===0&&(l=this._outputs);const{usedNodes:c,missingInputs:h,dynamicNode:p,syncInputs:m}=PM(e,l,this.weightMap,this._initNodes),v=[...a,...this.graph.weights,...this._initNodes||[]].map(A=>({node:A,contexts:t.currentContext})),_=Object.assign({},this.weightMap);Object.keys(e).forEach(A=>{const[D,F]=Gi(A),W=[];W[F]=e[A],_[D]=W});const w={},T=this.getFrozenTensorIds(_),E={};for(;v.length>0;){const A=this.processStack(a,v,t,_,E,T,o,w,c);await Promise.all(A)}p==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const C=l.filter(A=>!UW(A)&&!fi(A.name,_,t)).map(A=>A.name);if(C.length>0){let A="";throw p!=null&&(A=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${m}]`),new Error(`Cannot compute the outputs [${C}] from the provided inputs [${i}]. Consider providing the following inputs: [${h}]. ${A}`)}return _}processStack(e,t,s,r,i,a,o,l,c){const h=[];for(;t.length>0;){const p=t.pop();s.currentContext=p.contexts;let m="";if(p.node.op==="Enter"&&U("isConstant",p.node,r,s)&&([m]=Sl(p.node.name,s)),r[p.node.name]==null){const v=LM(p.node,r,s,this._resourceManager);m||([m]=Sl(p.node.name,s));const _=s.currentContext;bf(v)?h.push(v.then(w=>(r[m]=w,s.currentContext=_,this.checkTensorForDisposal(m,p.node,r,s,a,o,l),this.processChildNodes(p.node,t,s,r,i,c),w))):(r[m]=v,this.checkTensorForDisposal(m,p.node,r,s,a,o,l),this.processChildNodes(p.node,t,s,r,i,c))}else this.processChildNodes(p.node,t,s,r,i,c)}return h}processChildNodes(e,t,s,r,i,a){e.children.forEach(o=>{const[l]=Sl(o.name,s);i[l]||!a.has(o.name)||(o.op==="Merge"?o.inputNames.some(c=>!!fi(c,r,s))&&(i[l]=!0,t.push({contexts:s.currentContext,node:o})):o.inputNames.every(c=>!!fi(c,r,s))&&(i[l]=!0,t.push({contexts:s.currentContext,node:o})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const s=e[t],[r]=Gi(t),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const a=i.attrParams.shape.value,o=a.length===s.shape.length&&s.shape.every((l,c)=>a[c]===-1||a[c]===l);re(o,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${a}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&re(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){const t={};for(const s in e)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[s]!=null){const r=this._signature.inputs[s];t[r.name]=e[s]}else t[s]=e[s];return t}checkInputs(e){const t=Object.keys(e).filter(s=>{const[r]=Gi(s);return this.graph.nodes[r]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[t]!=null?this._signature.outputs[t].name:t,{})}checkOutputs(e){e.forEach(t=>{const[s]=Gi(t);if(!this.graph.nodes[s])throw new Error(`The output '${t}' is not found in the graph`)})}}class sve{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rve="?tfjs-format=file",ive="model.json";class ave{constructor(e,t={},s=Wk){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=s,t==null&&(this.loadOptions={}),this.resourceManager=new sve}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return bf(e)?e.then(t=>this.loadSync(t)):this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(s=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}this.signature=s,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new K0($M.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=$M.Instance.transformGraph(e.modelInitializer);this.initializer=new K0(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,t){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,t){const s=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){const r=s instanceof us?[s]:s,i={};return r.forEach((a,o)=>i[this.structuredOutputKeys[o]]=a),i}return s}normalizeInputs(e){if(!(e instanceof us)&&!Array.isArray(e))return e;if(e=Array.isArray(e)?e:[e],e.length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce((t,s,r)=>(t[s]=e[r],t),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=this.executor.execute(e,t);return s.length>1?s:s[0]}async executeAsync(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=await this.executor.executeAsync(e,t);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=[e[s]],t),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function ove(n,e={},t=Wk){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=lve(n));const s=new ave(n,e,t);return await s.load(),s}function lve(n){return n.endsWith("/")||(n=n+"/"),`${n}${ive}${rve}`}/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    *//**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function X0(n,e,t,s){return new(t||(t=Promise))((function(r,i){function a(c){try{l(s.next(c))}catch(h){i(h)}}function o(c){try{l(s.throw(c))}catch(h){i(h)}}function l(c){c.done?r(c.value):new t((function(h){h(c.value)})).then(a,o)}l((s=s.apply(n,[])).next())}))}function Z0(n,e){var t,s,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function o(l){return function(c){return(function(h){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,s&&(r=2&h[0]?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[2&h[0],r.value]),h[0]){case 0:case 1:r=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,s=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||h[0]!==6&&h[0]!==2)){a=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){a.label=h[1];break}if(h[0]===6&&a.label<r[1]){a.label=r[1],r=h;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(h);break}r[2]&&a.ops.pop(),a.trys.pop();continue}h=e.call(n,a)}catch(p){h=[6,p],s=0}finally{t=r=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}})([l,c])}}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cve="https://tfhub.dev/tensorflow/tfjs-model/deeplab",uve=513,iN={ADE20K:[[0,0,0],[120,120,120],[180,120,120],[6,230,230],[80,50,50],[4,200,3],[120,120,80],[140,140,140],[204,5,255],[230,230,230],[4,250,7],[224,5,255],[235,255,7],[150,5,61],[120,120,70],[8,255,51],[255,6,82],[143,255,140],[204,255,4],[255,51,7],[204,70,3],[0,102,200],[61,230,250],[255,6,51],[11,102,255],[255,7,71],[255,9,224],[9,7,230],[220,220,220],[255,9,92],[112,9,255],[8,255,214],[7,255,224],[255,184,6],[10,255,71],[255,41,10],[7,255,255],[224,255,8],[102,8,255],[255,61,6],[255,194,7],[255,122,8],[0,255,20],[255,8,41],[255,5,153],[6,51,255],[235,12,255],[160,150,20],[0,163,255],[140,140,140],[250,10,15],[20,255,0],[31,255,0],[255,31,0],[255,224,0],[153,255,0],[0,0,255],[255,71,0],[0,235,255],[0,173,255],[31,0,255],[11,200,200],[255,82,0],[0,255,245],[0,61,255],[0,255,112],[0,255,133],[255,0,0],[255,163,0],[255,102,0],[194,255,0],[0,143,255],[51,255,0],[0,82,255],[0,255,41],[0,255,173],[10,0,255],[173,255,0],[0,255,153],[255,92,0],[255,0,255],[255,0,245],[255,0,102],[255,173,0],[255,0,20],[255,184,184],[0,31,255],[0,255,61],[0,71,255],[255,0,204],[0,255,194],[0,255,82],[0,10,255],[0,112,255],[51,0,255],[0,194,255],[0,122,255],[0,255,163],[255,153,0],[0,255,10],[255,112,0],[143,255,0],[82,0,255],[163,255,0],[255,235,0],[8,184,170],[133,0,255],[0,255,92],[184,0,255],[255,0,31],[0,184,255],[0,214,255],[255,0,112],[92,255,0],[0,224,255],[112,224,255],[70,184,160],[163,0,255],[153,0,255],[71,255,0],[255,0,163],[255,204,0],[255,0,143],[0,255,235],[133,255,0],[255,0,235],[245,0,255],[255,0,122],[255,245,0],[10,190,212],[214,255,0],[0,204,255],[20,0,255],[255,255,0],[0,153,255],[0,41,255],[0,255,204],[41,0,255],[41,255,0],[173,0,255],[0,245,255],[71,0,255],[122,0,255],[0,255,184],[0,92,255],[184,255,0],[0,133,255],[255,214,0],[25,194,194],[102,255,0],[92,0,255]],CITYSCAPES:[[128,64,128],[244,35,232],[70,70,70],[102,102,156],[190,153,153],[153,153,153],[250,170,30],[220,220,0],[107,142,35],[152,251,152],[70,130,180],[220,20,60],[255,0,0],[0,0,142],[0,0,70],[0,60,100],[0,80,100],[0,0,230],[119,11,32]],PASCAL:[[0,0,0],[128,0,0],[0,128,0],[128,128,0],[0,0,128],[128,0,128],[0,128,128],[128,128,128],[64,0,0],[192,0,0],[64,128,0],[192,128,0],[64,0,128],[192,0,128],[64,128,128],[192,128,128],[0,64,0],[128,64,0],[0,192,0],[128,192,0],[0,64,128],[128,64,128],[0,192,128],[128,192,128],[64,64,0],[192,64,0],[64,192,0],[192,192,0],[64,64,128],[192,64,128],[64,192,128],[192,192,128],[0,0,64],[128,0,64],[0,128,64],[128,128,64],[0,0,192],[128,0,192],[0,128,192],[128,128,192],[64,0,64],[192,0,64],[64,128,64],[192,128,64],[64,0,192],[192,0,192],[64,128,192],[192,128,192],[0,64,64],[128,64,64],[0,192,64],[128,192,64],[0,64,192],[128,64,192],[0,192,192],[128,192,192],[64,64,64],[192,64,64],[64,192,64],[192,192,64],[64,64,192],[192,64,192],[64,192,192],[192,192,192],[32,0,0],[160,0,0],[32,128,0],[160,128,0],[32,0,128],[160,0,128],[32,128,128],[160,128,128],[96,0,0],[224,0,0],[96,128,0],[224,128,0],[96,0,128],[224,0,128],[96,128,128],[224,128,128],[32,64,0],[160,64,0],[32,192,0],[160,192,0],[32,64,128],[160,64,128],[32,192,128],[160,192,128],[96,64,0],[224,64,0],[96,192,0],[224,192,0],[96,64,128],[224,64,128],[96,192,128],[224,192,128],[32,0,64],[160,0,64],[32,128,64],[160,128,64],[32,0,192],[160,0,192],[32,128,192],[160,128,192],[96,0,64],[224,0,64],[96,128,64],[224,128,64],[96,0,192],[224,0,192],[96,128,192],[224,128,192],[32,64,64],[160,64,64],[32,192,64],[160,192,64],[32,64,192],[160,64,192],[32,192,192],[160,192,192],[96,64,64],[224,64,64],[96,192,64],[224,192,64],[96,64,192],[224,64,192],[96,192,192],[224,192,192],[0,32,0],[128,32,0],[0,160,0],[128,160,0],[0,32,128],[128,32,128],[0,160,128],[128,160,128],[64,32,0],[192,32,0],[64,160,0],[192,160,0],[64,32,128],[192,32,128],[64,160,128],[192,160,128],[0,96,0],[128,96,0],[0,224,0],[128,224,0],[0,96,128],[128,96,128],[0,224,128],[128,224,128],[64,96,0],[192,96,0],[64,224,0],[192,224,0],[64,96,128],[192,96,128],[64,224,128],[192,224,128],[0,32,64],[128,32,64],[0,160,64],[128,160,64],[0,32,192],[128,32,192],[0,160,192],[128,160,192],[64,32,64],[192,32,64],[64,160,64],[192,160,64],[64,32,192],[192,32,192],[64,160,192],[192,160,192],[0,96,64],[128,96,64],[0,224,64],[128,224,64],[0,96,192],[128,96,192],[0,224,192],[128,224,192],[64,96,64],[192,96,64],[64,224,64],[192,224,64],[64,96,192],[192,96,192],[64,224,192],[192,224,192],[32,32,0],[160,32,0],[32,160,0],[160,160,0],[32,32,128],[160,32,128],[32,160,128],[160,160,128],[96,32,0],[224,32,0],[96,160,0],[224,160,0],[96,32,128],[224,32,128],[96,160,128],[224,160,128],[32,96,0],[160,96,0],[32,224,0],[160,224,0],[32,96,128],[160,96,128],[32,224,128],[160,224,128],[96,96,0],[224,96,0],[96,224,0],[224,224,0],[96,96,128],[224,96,128],[96,224,128],[224,224,128],[32,32,64],[160,32,64],[32,160,64],[160,160,64],[32,32,192],[160,32,192],[32,160,192],[160,160,192],[96,32,64],[224,32,64],[96,160,64],[224,160,64],[96,32,192],[224,32,192],[96,160,192],[224,160,192],[32,96,64],[160,96,64],[32,224,64],[160,224,64],[32,96,192],[160,96,192],[32,224,192],[160,224,192],[96,96,64],[224,96,64],[96,224,64],[224,224,64],[96,96,192],[224,96,192],[96,224,192],[224,224,192]]},aN={PASCAL:["background","aeroplane","bicycle","bird","boat","bottle","bus","car","cat","chair","cow","dining table","dog","horse","motorbike","person","potted plant","sheep","sofa","train","TV"],CITYSCAPES:["road","sidewalk","building","wall","fence","pole","traffic light","traffic sign","vegetation","terrain","sky","person","rider","car","truck","bus","train","motorcycle","bicycle"],ADE20K:["background","wall","building","sky","floor","tree","ceiling","road","bed","windowpane","grass","cabinet","sidewalk","person","earth","door","table","mountain","plant","curtain","chair","car","water","painting","sofa","shelf","house","sea","mirror","rug","field","armchair","seat","fence","desk","rock","wardrobe","lamp","bathtub","railing","cushion","base","box","column","signboard","chest","counter","sand","sink","skyscraper","fireplace","refrigerator","grandstand","path","stairs","runway","case","pool","pillow","screen","stairway","river","bridge","bookcase","blind","coffee","toilet","flower","book","hill","bench","countertop","stove","palm","kitchen","computer","swivel","boat","bar","arcade","hovel","bus","towel","light","truck","tower","chandelier","awning","streetlight","booth","television","airplane","dirt","apparel","pole","land","bannister","escalator","ottoman","bottle","buffet","poster","stage","van","ship","fountain","conveyer","canopy","washer","plaything","swimming","stool","barrel","basket","waterfall","tent","bag","minibike","cradle","oven","ball","food","step","tank","trade","microwave","pot","animal","bicycle","lake","dishwasher","screen","blanket","sculpture","hood","sconce","vase","traffic","tray","ashcan","fan","pier","screen","plate","monitor","bulletin","shower","radiator","glass","clock","flag"]};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hve(n,e){return""+cve+"/"+(e===4?n+"/1/default/1/model.json":n+"/1/quantized/"+e+"/1/model.json")+"?tfjs-format=file"}function dve(n){if(n==="pascal")return iN.PASCAL;if(n==="ade20k")return iN.ADE20K;if(n==="cityscapes")return iN.CITYSCAPES;throw new Error("SemanticSegmentation cannot be constructed with an invalid base model "+n+". Try one of 'pascal', 'cityscapes' and 'ade20k'.")}function fve(n){if(n==="pascal")return aN.PASCAL;if(n==="ade20k")return aN.ADE20K;if(n==="cityscapes")return aN.CITYSCAPES;throw new Error("SemanticSegmentation cannot be constructed with an invalid base model "+n+". Try one of 'pascal', 'cityscapes' and 'ade20k'.")}function pve(n,e,t,s){return X0(this,void 0,void 0,(function(){var r,i,a,o,l,c,h,p,m,v,_,w,T,E;return Z0(this,(function(C){switch(C.label){case 0:if(n.length<e.length)throw new Error("The colormap must be expansive enough to encode each label. Aborting, since the given colormap has length "+n.length+", but there are "+e.length+" labels.");return r=t.shape,i=r[0],a=r[1],o=Ko([i,a,3],"int32"),[4,t.array()];case 1:for(l=C.sent(),c=new Set,h=0;h<i;++h)for(p=0;p<a;++p)E=l[h][p],c.add(E),o.set(n[E][0],h,p,0),o.set(n[E][1],h,p,1),o.set(n[E][2],h,p,2);return m=o.toTensor(),[4,s6(m,s)];case 2:for(v=C.sent(),Br(m),_={},w=0,T=Array.from(c);w<T.length;w++)E=T[w],_[e[E]]=n[E];return[2,{legend:_,segmentationMap:v}]}}))}))}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mve(n){return n===void 0&&(n={base:"pascal",quantizationBytes:2}),X0(this,void 0,void 0,(function(){var e;return Z0(this,(function(t){switch(t.label){case 0:if(Pge==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(n.base){if(["pascal","cityscapes","ade20k"].indexOf(n.base)===-1)throw new Error("SemanticSegmentation cannot be constructed with an invalid base model "+n.base+". Try one of 'pascal', 'cityscapes' and 'ade20k'.");if([1,2,4].indexOf(n.quantizationBytes)===-1)throw new Error("Only quantization to 1, 2 or 4 bytes is supported.")}else if(!n.modelUrl)throw new Error("SemanticSegmentation can be constructed either by passing the weights URL or one of the supported base model names from 'pascal', 'cityscapes' and 'ade20k',together with the degree of quantization (either 1, 2 or 4).Aborting, since neither has been provided.");return[4,ove(n.modelUrl||hve(n.base,n.quantizationBytes))];case 1:return e=t.sent(),[2,new gve(e,n.base)]}}))}))}var gve=(function(){function n(e,t){this.model=e,this.base=t}return n.prototype.predict=function(e){var t=this;return pn((function(){var s=is((function(r){return pn((function(){var i=r instanceof us?r:r6(r),a=i.shape,o=a[0],l=a[1],c=uve/Math.max(l,o),h=Math.round(o*c),p=Math.round(l*c);return $c(D2.resizeBilinear(i,[h,p]))}))})(e),"int32");return Kv(t.model.execute(s))}))},n.prototype.segment=function(e,t){return t===void 0&&(t={}),X0(this,void 0,void 0,(function(){var s,r,i,a,o,l,c,h,p,m,v=this;return Z0(this,(function(_){switch(_.label){case 0:if(!(t.colormap&&t.labels||this.base))throw new Error("Calling the 'segment' method requires either the 'base' attribute to be defined (e.g. 'pascal', 'cityscapes' or'ade20k'), or 'colormap' and 'labels' options to be set. Aborting, since neither has been provided.");return t.colormap&&t.labels||(t.colormap=dve(this.base),t.labels=fve(this.base)),s=t.colormap,r=t.labels,i=t.canvas,a=pn((function(){return v.predict(e)})),o=a.shape,l=o[0],c=o[1],[4,pve(s,r,a,i)];case 1:return h=_.sent(),p=h.legend,m=h.segmentationMap,Br(a),[2,{legend:p,height:l,width:c,segmentationMap:m}]}}))}))},n.prototype.dispose=function(){return X0(this,void 0,void 0,(function(){return Z0(this,(function(e){return this.model&&this.model.dispose(),[2]}))}))},n})();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yve=1e-7,vve=1e-4;class GW{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class P2{refCount(e){return Ui("refCount")}incRef(e){return Ui("incRef")}timerAvailable(){return!0}time(e){return Ui("time")}read(e){return Ui("read")}readSync(e){return Ui("readSync")}readToGPU(e,t){return Ui("readToGPU")}numDataIds(){return Ui("numDataIds")}disposeData(e,t){return Ui("disposeData")}write(e,t,s){return Ui("write")}move(e,t,s,r,i){return Ui("move")}createTensorFromGPUData(e,t,s){return Ui("createTensorFromGPUData")}memory(){return Ui("memory")}floatPrecision(){return Ui("floatPrecision")}epsilon(){return this.floatPrecision()===32?yve:vve}dispose(){return Ui("dispose")}}function Ui(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bve(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Kp(n,e,t)}function Nf(n,e,t){return Math.max(n,Math.min(e,t))}function M2(n){return n%2===0?n:n+1}function Kp(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function _ve(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function te(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function F2(n,e,t=""){te(xn(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function WW(n){te(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Me(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function xn(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Im(n){return n%1===0}function PI(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function cm(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function MM(n,e=r=>0,t,s){return new Promise((r,i)=>{let a=0;const o=()=>{if(n()){r();return}a++;const l=e(a);if(t!=null&&a>=t){i();return}s!=null?s(o,l):setTimeout(o,l)};o()})}function HW(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Vt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),te(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),te(n.every(s=>Im(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Jh(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:Vt(e,n).sort();let a=0;for(let o=0;o<n.length;++o){if(i!=null){if(i[a]===o&&n[o]!==1)throw new Error(`Can't squeeze axis ${o} since its dim '${n[o]}' is not 1`);(i[a]==null||i[a]>o)&&n[o]===1&&(t.push(n[o]),s.push(o)),i[a]<=o&&a++}n[o]!==1&&(t.push(n[o]),s.push(o))}return{newShape:t,keptDims:s}}function Ur(n,e){return ws(n,e)}function ws(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function xve(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function wve(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function qW(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Y0(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function Tve(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Zv(n){return typeof n=="string"||n instanceof String}function Sve(n){return typeof n=="boolean"}function MI(n){return typeof n=="number"}function Qm(n){return Array.isArray(n)?Qm(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":MI(n)?"float32":Zv(n)?"string":Sve(n)?"bool":"float32"}function FI(n){return!!(n&&n.constructor&&n.call&&n.apply)}function jI(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function ht(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function KW(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let a=0;a<i;a++)r[a]=t[n+a]}else{const i=e[0],a=e.slice(1),o=a.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<i;l++)r[l]=KW(n+l*o,a,t,s)}return r}function Uo(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return KW(0,n,e,t)}function Eve(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function j2(n,e){const t=Gr(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Gr(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function XW(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Uo(n,new Float32Array(t));if(e==="int32")return Uo(n,new Int32Array(t));if(e==="bool")return Uo(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function su(n){n.forEach(e=>{te(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function jl(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Jm(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function B2(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FM="tfjsflags";class Nve{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ive,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Re().getBool("IS_TEST")||Re().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];Re().getBool("IS_TEST")||Re().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(B2(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);FM in e&&e[FM].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=kve(r,i)})}}function Ive(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Cve(e,s[0],s[1]),s.join("="))),e}function Cve(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function kve(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function Re(){return ZW}let ZW=null;function $ve(n){ZW=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let oN;function YW(){if(oN==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");oN=n}return oN}function Ave(){const n=YW();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function z2(n,e){const t=Ave();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const bw="Abs",Yv="Acos",Qv="Acosh",eg="Add",V2="AddN",U2="All",G2="Any",_w="ArgMax",xw="ArgMin",Jv="Asin",eb="Asinh",tb="Atan",nb="Atanh",sb="Atan2",ww="AvgPool",W2="AvgPoolGrad",Tw="AvgPool3D",H2="AvgPool3DGrad",Sw="BatchMatMul",Ew="BatchToSpaceND",q2="Bincount",K2="BitwiseAnd",Rve="BroadcastTo",QW="BroadcastArgs",rb="Cast",ib="Ceil",ab="ClipByValue",X2="Complex",Nw="ComplexAbs",Iw="Concat",Cw="Conv2D",Z2="Conv2DBackpropFilter",kw="Conv2DBackpropInput",$w="Conv3D",Y2="Conv3DBackpropFilterV2",Q2="Conv3DBackpropInputV2",ob="Cos",lb="Cosh",J2="Cumprod",Aw="Cumsum",e$="CropAndResize",t$="DenseBincount",n$="DepthToSpace",Rw="DepthwiseConv2dNative",s$="DepthwiseConv2dNativeBackpropFilter",r$="DepthwiseConv2dNativeBackpropInput",JW="Diag",Dw="Dilation2D",BI="Dilation2DBackpropInput",zI="Dilation2DBackpropFilter",Dve="Draw",cb="RealDiv",i$="Einsum",ub="Elu",a$="EluGrad",hb="Erf",Lw="Equal",db="Exp",Ow="ExpandDims",fb="Expm1",o$="FFT",l$="Fill",c$="FlipLeftRight",pb="Floor",mb="FloorDiv",Pw="FusedBatchNorm",Mw="GatherV2",e5="GatherNd",Fw="Greater",gb="GreaterEqual",yb="Identity",u$="IFFT",h$="Imag",vb="IsFinite",bb="IsInf",_b="IsNan",jw="LeakyRelu",Bw="Less",zw="LessEqual",t5="LinSpace",xb="Log",wb="Log1p",Vw="LogicalAnd",Uw="LogicalNot",Gw="LogicalOr",Lve="LogSoftmax",Ww="LRN",d$="LRNGrad",Hw="Max",Tb="Maximum",qw="MaxPool",f$="MaxPoolGrad",Kw="MaxPool3D",p$="MaxPool3DGrad",n5="MaxPoolWithArgmax",Xw="Mean",Zw="Min",Sb="Minimum",Yw="MirrorPad",Eb="Mod",s5="Multinomial",Nb="Multiply",Qw="Neg",Jw="NotEqual",m$="NonMaxSuppressionV3",g$="NonMaxSuppressionV4",y$="NonMaxSuppressionV5",eT="OnesLike",tT="OneHot",nT="Pack",sT="PadV2",Ib="Pow",rT="Prelu",iT="Prod",r5="RaggedGather",i5="RaggedRange",a5="RaggedTensorToTensor",v$="Range",b$="Real",Cb="Reciprocal",kb="Relu",aT="Reshape",oT="ResizeNearestNeighbor",_$="ResizeNearestNeighborGrad",lT="ResizeBilinear",x$="ResizeBilinearGrad",$b="Relu6",cT="Reverse",Ab="Round",Rb="Rsqrt",o5="ScatterNd",l5="TensorScatterUpdate",c5="SearchSorted",uT="Select",Db="Selu",hT="Slice",Lb="Sin",Ob="Sinh",Pb="Sign",Mb="Sigmoid",Fb="Softplus",jb="Sqrt",dT="Sum",fT="SpaceToBatchND",pT="SplitV",mT="Softmax",u5="SparseFillEmptyRows",h5="SparseReshape",d5="SparseSegmentMean",f5="SparseSegmentSum",p5="SparseToDense",Bb="SquaredDifference",w$="Square",T$="StaticRegexReplace",S$="StridedSlice",m5="StringNGrams",g5="StringSplit",y5="StringToHashBucketFast",zb="Sub",Vb="Tan",Ub="Tanh",Gb="Tile",E$="TopK",N$="Transform",um="Transpose",I$="Unique",gT="Unpack",yT="UnsortedSegmentSum",vT="ZerosLike",Wb="Step",Ove="FromPixels",C$="RotateWithOffset",Q0="_FusedMatMul",J0="FusedConv2D",v5="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ta(...n){Re().getBool("IS_TEST")||Re().getBool("PROD")||console.warn(...n)}function Pve(...n){Re().getBool("IS_TEST")||Re().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e1=z2("kernelRegistry",()=>new Map),VI=z2("gradRegistry",()=>new Map);function jM(n,e){const t=_5(n,e);return e1.get(t)}function BM(n){return VI.get(n)}function zM(n){const e=e1.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,a]=r,[o]=i.split("_");o===n&&t.push(a)}return t}function b5(n){const{kernelName:e,backendName:t}=n,s=_5(e,t);e1.has(s)&&Ta(`The kernel '${e}' for backend '${t}' is already registered`),e1.set(s,n)}function Mve(n){const{kernelName:e}=n;VI.has(e)&&Re().getBool("DEBUG")&&Ta(`Overriding the gradient for '${e}'`),VI.set(e,n)}function _5(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var lN,VM;function Fve(){if(VM)return lN;VM=1,lN=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(M,k,V){this.low=M|0,this.high=k|0,this.unsigned=!!V}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(M){return(M&&M.__isLong__)===!0}e.isLong=t;var s={},r={};function i(M,k){var V,G,ae;return k?(M>>>=0,(ae=0<=M&&M<256)&&(G=r[M],G)?G:(V=o(M,(M|0)<0?-1:0,!0),ae&&(r[M]=V),V)):(M|=0,(ae=-128<=M&&M<128)&&(G=s[M],G)?G:(V=o(M,M<0?-1:0,!1),ae&&(s[M]=V),V))}e.fromInt=i;function a(M,k){if(isNaN(M))return k?C:E;if(k){if(M<0)return C;if(M>=_)return B}else{if(M<=-w)return P;if(M+1>=w)return W}return M<0?a(-M,k).neg():o(M%v|0,M/v|0,k)}e.fromNumber=a;function o(M,k,V){return new e(M,k,V)}e.fromBits=o;var l=Math.pow;function c(M,k,V){if(M.length===0)throw Error("empty string");if(M==="NaN"||M==="Infinity"||M==="+Infinity"||M==="-Infinity")return E;if(typeof k=="number"?(V=k,k=!1):k=!!k,V=V||10,V<2||36<V)throw RangeError("radix");var G;if((G=M.indexOf("-"))>0)throw Error("interior hyphen");if(G===0)return c(M.substring(1),k,V).neg();for(var ae=a(l(V,8)),J=E,X=0;X<M.length;X+=8){var se=Math.min(8,M.length-X),ne=parseInt(M.substring(X,X+se),V);if(se<8){var le=a(l(V,se));J=J.mul(le).add(a(ne))}else J=J.mul(ae),J=J.add(a(ne))}return J.unsigned=k,J}e.fromString=c;function h(M,k){return typeof M=="number"?a(M,k):typeof M=="string"?c(M,k):o(M.low,M.high,typeof k=="boolean"?k:M.unsigned)}e.fromValue=h;var p=65536,m=1<<24,v=p*p,_=v*v,w=_/2,T=i(m),E=i(0);e.ZERO=E;var C=i(0,!0);e.UZERO=C;var A=i(1);e.ONE=A;var D=i(1,!0);e.UONE=D;var F=i(-1);e.NEG_ONE=F;var W=o(-1,2147483647,!1);e.MAX_VALUE=W;var B=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=B;var P=o(0,-2147483648,!1);e.MIN_VALUE=P;var O=e.prototype;return O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*v+(this.low>>>0):this.high*v+(this.low>>>0)},O.toString=function(k){if(k=k||10,k<2||36<k)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(P)){var V=a(k),G=this.div(V),ae=G.mul(V).sub(this);return G.toString(k)+ae.toInt().toString(k)}else return"-"+this.neg().toString(k);for(var J=a(l(k,6),this.unsigned),X=this,se="";;){var ne=X.div(J),le=X.sub(ne.mul(J)).toInt()>>>0,K=le.toString(k);if(X=ne,X.isZero())return K+se;for(;K.length<6;)K="0"+K;se=""+K+se}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(P)?64:this.neg().getNumBitsAbs();for(var k=this.high!=0?this.high:this.low,V=31;V>0&&(k&1<<V)==0;V--);return this.high!=0?V+33:V+1},O.isZero=function(){return this.high===0&&this.low===0},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return(this.low&1)===1},O.isEven=function(){return(this.low&1)===0},O.equals=function(k){return t(k)||(k=h(k)),this.unsigned!==k.unsigned&&this.high>>>31===1&&k.high>>>31===1?!1:this.high===k.high&&this.low===k.low},O.eq=O.equals,O.notEquals=function(k){return!this.eq(k)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(k){return this.comp(k)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(k){return this.comp(k)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(k){return this.comp(k)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(k){return this.comp(k)>=0},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(k){if(t(k)||(k=h(k)),this.eq(k))return 0;var V=this.isNegative(),G=k.isNegative();return V&&!G?-1:!V&&G?1:this.unsigned?k.high>>>0>this.high>>>0||k.high===this.high&&k.low>>>0>this.low>>>0?-1:1:this.sub(k).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(P)?P:this.not().add(A)},O.neg=O.negate,O.add=function(k){t(k)||(k=h(k));var V=this.high>>>16,G=this.high&65535,ae=this.low>>>16,J=this.low&65535,X=k.high>>>16,se=k.high&65535,ne=k.low>>>16,le=k.low&65535,K=0,ie=0,de=0,ce=0;return ce+=J+le,de+=ce>>>16,ce&=65535,de+=ae+ne,ie+=de>>>16,de&=65535,ie+=G+se,K+=ie>>>16,ie&=65535,K+=V+X,K&=65535,o(de<<16|ce,K<<16|ie,this.unsigned)},O.subtract=function(k){return t(k)||(k=h(k)),this.add(k.neg())},O.sub=O.subtract,O.multiply=function(k){if(this.isZero())return E;if(t(k)||(k=h(k)),n){var V=n.mul(this.low,this.high,k.low,k.high);return o(V,n.get_high(),this.unsigned)}if(k.isZero())return E;if(this.eq(P))return k.isOdd()?P:E;if(k.eq(P))return this.isOdd()?P:E;if(this.isNegative())return k.isNegative()?this.neg().mul(k.neg()):this.neg().mul(k).neg();if(k.isNegative())return this.mul(k.neg()).neg();if(this.lt(T)&&k.lt(T))return a(this.toNumber()*k.toNumber(),this.unsigned);var G=this.high>>>16,ae=this.high&65535,J=this.low>>>16,X=this.low&65535,se=k.high>>>16,ne=k.high&65535,le=k.low>>>16,K=k.low&65535,ie=0,de=0,ce=0,Se=0;return Se+=X*K,ce+=Se>>>16,Se&=65535,ce+=J*K,de+=ce>>>16,ce&=65535,ce+=X*le,de+=ce>>>16,ce&=65535,de+=ae*K,ie+=de>>>16,de&=65535,de+=J*le,ie+=de>>>16,de&=65535,de+=X*ne,ie+=de>>>16,de&=65535,ie+=G*K+ae*le+J*ne+X*se,ie&=65535,o(ce<<16|Se,ie<<16|de,this.unsigned)},O.mul=O.multiply,O.divide=function(k){if(t(k)||(k=h(k)),k.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&k.low===-1&&k.high===-1)return this;var V=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,k.low,k.high);return o(V,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:E;var G,ae,J;if(this.unsigned){if(k.unsigned||(k=k.toUnsigned()),k.gt(this))return C;if(k.gt(this.shru(1)))return D;J=C}else{if(this.eq(P)){if(k.eq(A)||k.eq(F))return P;if(k.eq(P))return A;var X=this.shr(1);return G=X.div(k).shl(1),G.eq(E)?k.isNegative()?A:F:(ae=this.sub(k.mul(G)),J=G.add(ae.div(k)),J)}else if(k.eq(P))return this.unsigned?C:E;if(this.isNegative())return k.isNegative()?this.neg().div(k.neg()):this.neg().div(k).neg();if(k.isNegative())return this.div(k.neg()).neg();J=E}for(ae=this;ae.gte(k);){G=Math.max(1,Math.floor(ae.toNumber()/k.toNumber()));for(var se=Math.ceil(Math.log(G)/Math.LN2),ne=se<=48?1:l(2,se-48),le=a(G),K=le.mul(k);K.isNegative()||K.gt(ae);)G-=ne,le=a(G,this.unsigned),K=le.mul(k);le.isZero()&&(le=A),J=J.add(le),ae=ae.sub(K)}return J},O.div=O.divide,O.modulo=function(k){if(t(k)||(k=h(k)),n){var V=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,k.low,k.high);return o(V,n.get_high(),this.unsigned)}return this.sub(this.div(k).mul(k))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return o(~this.low,~this.high,this.unsigned)},O.and=function(k){return t(k)||(k=h(k)),o(this.low&k.low,this.high&k.high,this.unsigned)},O.or=function(k){return t(k)||(k=h(k)),o(this.low|k.low,this.high|k.high,this.unsigned)},O.xor=function(k){return t(k)||(k=h(k)),o(this.low^k.low,this.high^k.high,this.unsigned)},O.shiftLeft=function(k){return t(k)&&(k=k.toInt()),(k&=63)===0?this:k<32?o(this.low<<k,this.high<<k|this.low>>>32-k,this.unsigned):o(0,this.low<<k-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(k){return t(k)&&(k=k.toInt()),(k&=63)===0?this:k<32?o(this.low>>>k|this.high<<32-k,this.high>>k,this.unsigned):o(this.high>>k-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(k){if(t(k)&&(k=k.toInt()),k&=63,k===0)return this;var V=this.high;if(k<32){var G=this.low;return o(G>>>k|V<<32-k,V>>>k,this.unsigned)}else return k===32?o(V,0,this.unsigned):o(V>>>k-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},O.toBytes=function(k){return k?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var k=this.high,V=this.low;return[V&255,V>>>8&255,V>>>16&255,V>>>24,k&255,k>>>8&255,k>>>16&255,k>>>24]},O.toBytesBE=function(){var k=this.high,V=this.low;return[k>>>24,k>>>16&255,k>>>8&255,k&255,V>>>24,V>>>16&255,V>>>8&255,V&255]},e.fromBytes=function(k,V,G){return G?e.fromBytesLE(k,V):e.fromBytesBE(k,V)},e.fromBytesLE=function(k,V){return new e(k[0]|k[1]<<8|k[2]<<16|k[3]<<24,k[4]|k[5]<<8|k[6]<<16|k[7]<<24,V)},e.fromBytesBE=function(k,V){return new e(k[4]<<24|k[5]<<16|k[6]<<8|k[7],k[0]<<24|k[1]<<16|k[2]<<8|k[3],V)},lN}var w5=Fve();const T5=E1(w5),jve=gF({__proto__:null,default:T5},[w5]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kd=T5||jve;function bT(n){return Kd.fromString(n,!0,16)}const S5=bT("c3a5c85c97cb3127"),Hd=bT("b492b66fbe98f273"),hi=bT("9ae16a3b2f90404f");function UI(n){return n.xor(n.shru(47))}function E5(n,e,t){const s=n.slice(e,e+t);return Kd.fromBytes(Array.from(s),!0,!0)}function Vn(n,e){return E5(n,e,8)}function UM(n,e){return E5(n,e,4)}function cr(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function xh(n,e,t=bT("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Bve(n,e,t,s,r,i){r=r.add(n),i=cr(i.add(r).add(s),21);const a=r;return r=r.add(e),r=r.add(t),i=i.add(cr(r,44)),[r.add(s),i.add(a)]}function Ix(n,e,t,s){return Bve(Vn(n,e),Vn(n,e+8),Vn(n,e+16),Vn(n,e+24),t,s)}function zve(n,e=n.length){if(e>=8){const t=hi.add(e*2),s=Vn(n,0).add(hi),r=Vn(n,e-8),i=cr(r,37).mul(t).add(s),a=cr(s,25).add(r).mul(t);return xh(i,a,t)}if(e>=4){const t=hi.add(e*2),s=UM(n,0);return xh(s.shl(3).add(e),UM(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),a=e+(r<<2);return UI(hi.mul(i).xor(S5.mul(a))).mul(hi)}return hi}function Vve(n,e=n.length){const t=hi.add(e*2),s=Vn(n,0).mul(Hd),r=Vn(n,8),i=Vn(n,e-8).mul(t),a=Vn(n,e-16).mul(hi);return xh(cr(s.add(r),43).add(cr(i,30)).add(a),s.add(cr(r.add(hi),18)).add(i),t)}function Uve(n,e=n.length){const t=hi.add(e*2),s=Vn(n,0).mul(hi),r=Vn(n,8),i=Vn(n,e-8).mul(t),a=Vn(n,e-16).mul(hi),o=cr(s.add(r),43).add(cr(i,30)).add(a),l=xh(o,s.add(cr(r.add(hi),18)).add(i),t),c=Vn(n,16).mul(t),h=Vn(n,24),p=o.add(Vn(n,e-32)).mul(t),m=l.add(Vn(n,e-24)).mul(t);return xh(cr(c.add(h),43).add(cr(p,30)).add(m),c.add(cr(h.add(s),18)).add(p),t)}function Gve(n,e=n.length){const t=Kd.fromNumber(81,!0);if(e<=32)return e<=16?zve(n,e):Vve(n,e);if(e<=64)return Uve(n,e);let s=t,r=t.mul(Hd).add(113),i=UI(r.mul(hi).add(113)).mul(hi),a=[Kd.UZERO,Kd.UZERO],o=[Kd.UZERO,Kd.UZERO];s=s.mul(hi).add(Vn(n,0));let l=0;const c=(e-1>>6)*64,h=c+(e-1&63)-63;do s=cr(s.add(r).add(a[0]).add(Vn(n,l+8)),37).mul(Hd),r=cr(r.add(a[1]).add(Vn(n,l+48)),42).mul(Hd),s=s.xor(o[1]),r=r.add(a[0]).add(Vn(n,l+40)),i=cr(i.add(o[0]),33).mul(Hd),a=Ix(n,l,a[1].mul(Hd),s.add(o[0])),o=Ix(n,l+32,i.add(o[1]),r.add(Vn(n,l+16))),[i,s]=[s,i],l+=64;while(l!==c);const p=Hd.add(i.and(255).shl(1));return l=h,o[0]=o[0].add(e-1&63),a[0]=a[0].add(o[0]),o[0]=o[0].add(a[0]),s=cr(s.add(r).add(a[0]).add(Vn(n,l+8)),37).mul(p),r=cr(r.add(a[1]).add(Vn(n,l+48)),42).mul(p),s=s.xor(o[1].mul(9)),r=r.add(a[0].mul(9).add(Vn(n,l+40))),i=cr(i.add(o[0]),33).mul(p),a=Ix(n,l,a[1].mul(p),s.add(o[0])),o=Ix(n,l+32,i.add(o[1]),r.add(Vn(n,l+16))),[i,s]=[s,i],xh(xh(a[0],o[0],p).add(UI(r).mul(S5)).add(i),xh(a[1],o[1],p).add(s),p)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ed(n,e){return e==="string"?wh(n):Wf([n],e)}function Wve(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Wf(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=If(n)),Re().getBool("DEBUG")&&xve(n,e),Wve(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function ki(){return Re().platform.now()}function wh(n,e="utf-8"){return e=e||"utf-8",Re().platform.encode(n,e)}function Fh(n,e="utf-8"){return e=e||"utf-8",Re().platform.decode(n,e)}function lo(n){return Re().platform.isTypedArray!=null?Re().platform.isTypedArray(n):x5(n)}function If(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||B2(n)||n==null||lo(n)&&t)e.push(n);else if(Array.isArray(n)||lo(n))for(let s=0;s<n.length;++s)If(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)If(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hve{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Kve)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let a;const o=ki();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();for(const c of r)c.dataSync();a=Promise.resolve({kernelMs:ki()-o})}if(Re().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const h=r[c];h.data().then(p=>{qve(p,h.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:a.then(c=>c.kernelMs),extraInfo:a.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:a}=e;s.forEach(o=>{Promise.all([o.data(),r,a]).then(l=>{this.logger.logKernelProfile(t,o,l[0],l[1],i,l[2])})})}}function qve(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class Kve{logKernelProfile(e,t,s,r,i,a){const o=typeof r=="number"?cm(`${r}ms`,9):r.error,l=cm(e,25),c=t.rank,h=t.size,p=cm(t.shape.toString(),14);let m="";for(const v in i){const _=i[v];if(_!=null){const w=_.shape||t.shape,T=w.length;m+=`${v}: ${T}D ${T>0?w:""} `}}console.log(`%c${l}	%c${o}	%c${c}D ${p}	%c${h}	%c${m}	%c${a}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xve(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],h=c.inputs;for(const p in h){const m=h[p];let v=!1;for(let _=0;_<e.length;_++)if(s[m.id]){c.outputs.forEach(w=>s[w.id]=!0),v=!0,r[c.id]=!0;break}if(v)break}}const i={};i[t.id]=!0;const a={};for(let l=n.length-1;l>=0;l--){const c=n[l],h=c.inputs;for(let p=0;p<c.outputs.length;p++)if(i[c.outputs[p].id]){for(const m in h)i[h[m].id]=!0,a[c.id]=!0;break}}const o=[];for(let l=0;l<n.length;l++){const c=n[l];if(r[c.id]&&a[c.id]){const h={};for(const m in c.inputs){const v=c.inputs[m];s[v.id]&&(h[m]=v)}const p=Object.assign({},c);p.inputs=h,p.outputs=c.outputs,o.push(p)}}return o}function Zve(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],a=[];if(i.outputs.forEach(l=>{const c=n[l.id];c!=null?a.push(c):a.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const o=i.gradient(a);for(const l in i.inputs){if(!(l in o))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(o)}.`);const c=t(()=>o[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const h=i.inputs[l];if(!xn(c.shape,h.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=c;else{const p=n[h.id];n[h.id]=s(p,c),p.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GM=20,cy=3,cN=7;function Yve(n,e,t,s){const r=ht(e),i=Qve(n,e,t,r),a=e.length,o=d0(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${a}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(o.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Qve(n,e,t,s){const r=Me(e),i=s[s.length-1],a=new Array(i).fill(0),o=e.length,l=t==="complex64"?Ty(n):n;if(o>1)for(let c=0;c<r/i;c++){const h=c*i;for(let p=0;p<i;p++)a[p]=Math.max(a[p],wy(l[h+p],0,t).length)}return a}function wy(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(cN))} + ${parseFloat(n[1].toFixed(cN))}j`:Zv(n)?s=`'${n}'`:t==="bool"?s=N5(n):s=parseFloat(n.toFixed(cN)).toString(),cm(s,e)}function N5(n){return n===0?"false":"true"}function d0(n,e,t,s,r,i=!0){const a=t==="complex64"?2:1,o=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=Ty(n);return[wy(w[0],0,t)]}return t==="bool"?[N5(n[0])]:[n[0].toString()]}if(l===1){if(o>GM){const T=cy*a;let E=Array.from(n.slice(0,T)),C=Array.from(n.slice((o-cy)*a,o*a));return t==="complex64"&&(E=Ty(E),C=Ty(C)),["["+E.map((A,D)=>wy(A,r[D],t)).join(", ")+", ..., "+C.map((A,D)=>wy(A,r[o-cy+D],t)).join(", ")+"]"]}return["["+(t==="complex64"?Ty(n):Array.from(n)).map((T,E)=>wy(T,r[E],t)).join(", ")+"]"]}const c=e.slice(1),h=s.slice(1),p=s[0]*a,m=[];if(o>GM){for(let w=0;w<cy;w++){const T=w*p,E=T+p;m.push(...d0(n.slice(T,E),c,t,h,r,!1))}m.push("...");for(let w=o-cy;w<o;w++){const T=w*p,E=T+p;m.push(...d0(n.slice(T,E),c,t,h,r,w===o-1))}}else for(let w=0;w<o;w++){const T=w*p,E=T+p;m.push(...d0(n.slice(T,E),c,t,h,r,w===o-1))}const v=l===2?",":"";m[0]="["+(o>0?m[0]+v:"");for(let w=1;w<m.length-1;w++)m[w]=" "+m[w]+v;let _=`,
`;for(let w=2;w<l;w++)_+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":_),m}function Ty(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sr{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=Me(e),s!=null){const r=s.length;te(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||ws(t,this.size),this.strides=ht(e)}set(e,...t){t.length===0&&(t=[0]),te(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Mo().makeTensor(this.values,this.shape,this.dtype)}}let Mo=null,Xp=null;function Jve(n){Mo=n}function ebe(n){Xp=n}class Ks{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Me(e),this.strides=ht(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Xp.buffer(this.shape,this.dtype,e)}bufferSync(){return Xp.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Uo(this.shape,e,this.dtype==="complex64")}arraySync(){return Uo(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Mo().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Fh(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Mo().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Mo().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Fh(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Mo().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Mo().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Xp.print(this,e)}clone(){return this.throwIfDisposed(),Xp.clone(this)}toString(e=!1){const t=this.dataSync();return Yve(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Xp.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Mo().makeVariable(this,e,t,s)}}Object.defineProperty(Ks,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Pe(){return z2("Tensor",()=>Ks)}Pe();class t1 extends Ks{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!xn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Mo().disposeTensor(this),this.dataId=e.dataId,Mo().incRef(this,null)}dispose(){Mo().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(t1,Symbol.hasInstance,{value:n=>n instanceof Ks&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var WM;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(WM||(WM={}));var GI;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(GI||(GI={}));var WI;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(WI||(WI={}));var HI;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(HI||(HI={}));var qI;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(qI||(qI={}));const tbe={float32:HI,int32:GI,bool:WI,complex64:qI};function Qi(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return tbe[n][e]}function k$(n){return Qi(n,"int32")}function I5(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function C5(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Es(n,e){if(n.dtype===e.dtype)return[n,e];const t=Qi(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function k5(n){const e=[];return $5(n,e,new Set),e}function $5(n,e,t){if(n==null)return;if(n instanceof Ks){e.push(n);return}if(!nbe(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),$5(i,e,t))}}function nbe(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uN(n){return n.kernelName!=null}class HM{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Cm{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new HM}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Ta(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Hve(this.backendInstance),!0}setupRegisteredKernels(){zM(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){zM(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof P2)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(a=>r<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Ta(`Initialization of backend ${e} failed`),Ta(a.stack||a.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Ta(`Initialization of backend ${e} failed`),Ta(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),a=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return Cm.nextTensorId++}nextVariableId(){return Cm.nextVariableId++}clone(e){const t=be.runKernel(yb,{x:e}),s={x:e},r=a=>({x:()=>{const o="float32",l={x:a},c={dtype:o};return be.runKernel(rb,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(jM(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let o;this.backendName==null&&this.backend;let l;const c=uN(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(uN(e)){const{kernelName:_,inputs:w,attrs:T}=e;this.backendName==null&&this.backend;const E=jM(_,this.backendName);te(E!=null,()=>`Cannot find registered kernel '${_}' for backend '${this.backendName}'`),o=()=>{const C=this.backend.numDataIds();l=E.kernelFunc({inputs:w,attrs:T,backend:this.backend});const A=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(_,C,A);const D=A.map(F=>F.rank!=null?F:this.makeTensorFromTensorInfo(F));if(r){const F=this.getTensorsForGradient(_,w,D);s=this.saveTensorsForBackwardMode(F)}return D}}else{const{forwardFunc:_}=e,w=T=>{r&&(s=T.map(E=>this.keep(this.clone(E))))};o=()=>{const T=this.backend.numDataIds();l=this.tidy(()=>_(this.backend,w));const E=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,T,E),E}}const{inputs:h,attrs:p}=e,m=uN(e)?null:e.backwardsFunc;let v;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=o():(v=this.profiler.profileKernel(c,h,()=>o()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(v),t=v.outputs)}),r&&this.addTapeNode(c,h,t,m,s,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(_=>h[_]!=null?h[_].shape:null),outputShapes:t.map(_=>_.shape),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=BM(e);if(r!=null){const i=r.inputsToSave||[],a=r.outputsToSave||[];let o;r.saveAllInputs?(te(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),o=Object.keys(t).map(c=>t[c])):o=i.map(c=>t[c]);const l=s.filter((c,h)=>a[h]);return o.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Zv(e[0])&&(i=e.map(l=>wh(l)));const a=r.write(i,t,s),o=new Ks(t,s,a,this.nextTensorId());if(this.trackTensor(o,r),s==="string"){const l=this.state.tensorInfo.get(a),c=Tve(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return o}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,a=new Ks(r,i,s,this.nextTensorId());return this.trackTensor(a,t),a}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new t1(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Y0(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof t1||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Y0(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,a){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=BM(e);l!=null&&(r=l.gradFunc),r!=null&&(o.gradient=c=>(c=c.map((h,p)=>{if(h==null){const m=s[p],v=Gr(m.size,m.dtype);return this.makeTensor(v,m.shape,m.dtype)}return h}),r(c.length>1?c:c[0],i,a))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=k5(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const a=this.state.activeScope.track[i];!a.kept&&!s.has(a.id)&&a.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(te(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));te(i instanceof Ks,()=>"The result y returned by f() must be a tensor.");const a=Xve(this.state.activeTape,t,i);if(!r&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const o={};o[i.id]=s??sbe(i.shape),Zve(o,a,c=>this.tidy(c),rbe);const l=t.map(c=>o[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const h of c.saved)h.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return te(FI(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{te(t.every(o=>o instanceof Ks),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((o,l)=>{r[l]=o});const i=(o,l)=>(s=e(...t,l),te(s.value instanceof Ks,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),te(FI(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),a=(o,l)=>{const c=s.gradFunc(o,l),h=Array.isArray(c)?c:[c];te(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),te(h.every(m=>m instanceof Ks),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const p={};return h.forEach((m,v)=>{p[v]=()=>m}),p};return this.runKernelFunc({forwardFunc:i,backwardsFunc:a,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=ki(),s=await this.backend.time(e);return s.wallMs=ki()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new HM;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Cm.nextTensorId=0;Cm.nextVariableId=0;function sbe(n){const e=j2(Me(n),"float32");return be.makeTensor(e,n,"float32")}function A5(){const n=YW();if(n._tfengine==null){const e=new Nve(n);n._tfengine=new Cm(e)}return $ve(n._tfengine.ENV),Jve(()=>n._tfengine),n._tfengine}const be=A5();function rbe(n,e){const t={a:n,b:e};return be.runKernel(eg,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ibe(){return typeof navigator<"u"&&navigator!=null}function R5(n){if(n||ibe()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function D5(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Di=Re();Di.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Di.registerFlag("IS_BROWSER",()=>D5());Di.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Di.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Di.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Di.registerFlag("PROD",()=>!1);Di.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Di.getBool("DEBUG"));Di.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Di.registerFlag("IS_TEST",()=>!1);Di.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Di.getBool("DEBUG"));Di.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Di.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Di.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _T(n,e){let t=n;if(lo(n))return e==="string"?[]:[n.length];if(I5(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(C5(n))return[n.buffer.size/(e==null?4:Y0(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||lo(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&Re().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&L5(n,s,[]),s}function L5(n,e,t){if(t=t||[],!Array.isArray(n)&&!lo(n)){te(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}te(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),te(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)L5(n[r],s,t.concat(r))}function qM(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function oe(n,e,t,s="numeric"){if(n instanceof Pe())return qM(s,n.dtype,e,t),n;let r=Qm(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),qM(s,r,e,t),n==null||!lo(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=_T(n,r);!lo(n)&&!Array.isArray(n)&&(n=[n]);const o=r!=="string"?Wf(n,r):If(n,[],!0);return be.makeTensor(o,i,r)}function O5(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,a)=>oe(i,`${e}[${a}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abe="__op";function xe(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+abe;const r=(...i)=>{be.startScope(t);try{const a=s(...i);return B2(a)&&console.error("Cannot return a Promise inside of tidy."),be.endScope(a),a}catch(a){throw be.endScope(null),a}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function obe(n,e){const t=oe(n,"real","complex"),s=oe(e,"imag","complex");F2(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return be.runKernel(X2,r)}const km=xe({complex_:obe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(n,e,t,s){if(s==null)s=Qm(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(C5(n)||I5(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return be.backend.createTensorFromGPUData(n,e||t,s)}if(!lo(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){su(e);const r=Me(e),i=Me(t);te(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let a=0;a<t.length;++a){const o=t[a],l=a===t.length-1?o!==Me(e.slice(a)):!0;te(t[a]===e[a]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!lo(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Wf(n,s):If(n,[],!0),be.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(n,e,t){const s=_T(n,t);return xT(n,e,s,t)}class tg{static join(e){return new tg(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>lo(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),a=new Uint8Array(i);let o=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],p=e+o-c.start,m=o,_=Math.min(t,c.end)-c.start,w=new Uint8Array(c.buffer,p,_-p);if(a.set(w,m),o+=w.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=lbe(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function lbe(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(){return be}function KM(){return be.memory()}function ke(n,e){return be.tidy(n,e)}function Ht(n){k5(n).forEach(t=>t.dispose())}function Bl(n){return be.keep(n)}function M5(n,e,t=1){return be.registerBackend(n,e,t)}function cbe(){return be.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XM=4;async function ZM(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(a=>a.name):Object.keys(n);for(let a=0;a<r.length;++a){const o=r[a],l=Array.isArray(n)?n[a].tensor:n[o];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${o}': ${l.dtype}`);const c={name:o,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async p=>{const m=await l.bytes(),v=m.reduce((T,E)=>T+E.length,0)+XM*m.length,_=new Uint8Array(v);let w=0;for(let T=0;T<m.length;T++){const E=m[T],C=new Uint8Array(new Uint32Array([E.length]).buffer);_.set(C,w),w+=XM,_.set(E,w),w+=E.length}p(_)});s.push(h)}else s.push(l.data());e!=null&&(c.group=e),t.push(c)}const i=await Promise.all(s);return{data:ube(i),specs:t}}function ube(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const $$=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function YM(n){return $$?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function hbe(n){if($$)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function dbe(n){if($$){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function fbe(n){return tg.join(n)}function F5(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:YM(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:YM(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new tg(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ai{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return ai.instance==null&&(ai.instance=new ai),ai.instance}static registerSaveRouter(e){ai.getInstance().saveRouters.push(e)}static registerLoadRouter(e){ai.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return ai.getHandlers(e,"save")}static getLoadHandlers(e,t){return ai.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?ai.getInstance().loadRouters:ai.getInstance().saveRouters).forEach(a=>{const o=a(e,s);o!==null&&r.push(o)}),r}}const pbe=n=>ai.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KI="tensorflowjs",XI=1,Jd="models_store",fh="model_info_store";function j5(){if(!Re().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ZI(n){const e=n.result;e.createObjectStore(Jd,{keyPath:"modelPath"}),e.createObjectStore(fh,{keyPath:"modelPath"})}class Cf{constructor(e){if(this.indexedDB=j5(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(KI,XI);i.onupgradeneeded=()=>ZI(i),i.onsuccess=()=>{const a=i.result;if(t==null){const o=a.transaction(Jd,"readonly"),c=o.objectStore(Jd).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return a.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=h=>(a.close(),r(c.error)),o.oncomplete=()=>a.close()}else{t.weightData=tg.join(t.weightData);const o=F5(t),l=a.transaction(fh,"readwrite");let c=l.objectStore(fh),h;try{h=c.put({modelPath:this.modelPath,modelArtifactsInfo:o})}catch(m){return r(m)}let p;h.onsuccess=()=>{p=a.transaction(Jd,"readwrite");const m=p.objectStore(Jd);let v;try{v=m.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:o})}catch(_){return r(_)}v.onsuccess=()=>s({modelArtifactsInfo:o}),v.onerror=_=>{c=l.objectStore(fh);const w=c.delete(this.modelPath);w.onsuccess=()=>(a.close(),r(v.error)),w.onerror=T=>(a.close(),r(v.error))}},h.onerror=m=>(a.close(),r(h.error)),l.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},i.onerror=a=>r(i.error)})}}Cf.URL_SCHEME="indexeddb://";const B5=n=>Re().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Cf.URL_SCHEME)?mbe(n.slice(Cf.URL_SCHEME.length)):null;ai.registerSaveRouter(B5);ai.registerLoadRouter(B5);function mbe(n){return new Cf(n)}function gbe(n){return n.startsWith(Cf.URL_SCHEME)?n.slice(Cf.URL_SCHEME.length):n}class ybe{constructor(){this.indexedDB=j5()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(KI,XI);s.onupgradeneeded=()=>ZI(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(fh,"readonly"),o=i.objectStore(fh).getAll();o.onsuccess=()=>{const l={};for(const c of o.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},o.onerror=l=>(r.close(),t(o.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=gbe(e),new Promise((t,s)=>{const r=this.indexedDB.open(KI,XI);r.onupgradeneeded=()=>ZI(r),r.onsuccess=()=>{const i=r.result,a=i.transaction(fh,"readwrite"),o=a.objectStore(fh),l=o.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=o.delete(e),p=()=>{c=i.transaction(Jd,"readwrite");const v=c.objectStore(Jd).delete(e);v.onsuccess=()=>t(l.result.modelArtifactsInfo),v.onerror=_=>s(l.error)};h.onsuccess=p,h.onerror=m=>(p(),i.close(),s(l.error))}},l.onerror=h=>(i.close(),s(l.error)),a.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oc="/",Zp="tensorflowjs_models",z5="info",vbe="model_topology",bbe="weight_specs",_be="weight_data",xbe="model_metadata";function V5(n){return{info:[Zp,n,z5].join(Oc),topology:[Zp,n,vbe].join(Oc),weightSpecs:[Zp,n,bbe].join(Oc),weightData:[Zp,n,_be].join(Oc),modelMetadata:[Zp,n,xbe].join(Oc)}}function U5(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function wbe(n){const e=n.split(Oc);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Oc)}function Tbe(n){return n.startsWith(kf.URL_SCHEME)?n.slice(kf.URL_SCHEME.length):n}class kf{constructor(e){if(!Re().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=V5(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=F5(e),i=tg.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,hbe(i));const a={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:r}}catch{throw U5(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const o=JSON.parse(i);t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)}const a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=dbe(a),t}}kf.URL_SCHEME="localstorage://";const G5=n=>Re().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(kf.URL_SCHEME)?Sbe(n.slice(kf.URL_SCHEME.length)):null;ai.registerSaveRouter(G5);ai.registerLoadRouter(G5);function Sbe(n){return new kf(n)}class Ebe{constructor(){te(Re().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),te(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Zp+Oc,s=Oc+z5;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const a=wbe(i);e[a]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Tbe(e);const t=V5(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return U5(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QM="://";class wl{constructor(){this.managers={}}static getInstance(){return wl.instance==null&&(wl.instance=new wl),wl.instance}static registerManager(e,t){te(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(QM)&&(e=e.slice(0,e.indexOf(QM))),te(e.length>0,()=>"scheme must not be an empty string.");const s=wl.getInstance();te(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=wl.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(wl.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nbe{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!Re().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return x5(e)}}if(Re().get("IS_BROWSER")){Re().setPlatform("browser",new Nbe);try{wl.registerManager(kf.URL_SCHEME,new Ebe)}catch{}try{wl.registerManager(Cf.URL_SCHEME,new ybe)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ibe={importFetch:()=>require("node-fetch")};let hN;class Cbe{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return Re().global.fetch!=null?Re().global.fetch(e,t):(hN==null&&(hN=Ibe.importFetch()),hN(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Re().get("IS_NODE")&&!Re().get("IS_BROWSER")&&Re().setPlatform("node",new Cbe);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zt(n,e="float32",t){return e=e||"float32",su(n),new Sr(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kbe(n,e){const t=oe(n,"x","cast");if(!wve(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return be.runKernel(rb,s,r)}const tt=xe({cast_:kbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $be(n){const t={x:oe(n,"x","clone","string_or_numeric")};return be.runKernel(yb,t)}const lf=xe({clone_:$be});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Abe(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */A5();const Rbe={buffer:zt,cast:tt,clone:lf,print:Abe};ebe(Rbe);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dbe(n,e){let t=oe(n,"a","add"),s=oe(e,"b","add");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(eg,r)}const Ke=xe({add_:Dbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lbe(n,e){let t=oe(n,"a","floorDiv"),s=oe(e,"b","floorDiv");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(mb,r)}const W5=xe({floorDiv_:Lbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Obe(n,e){let t=oe(n,"a","div"),s=oe(e,"b","div");if([t,s]=Es(t,s),t.dtype==="int32"&&s.dtype==="int32")return W5(t,s);const r={a:t,b:s},i={};return be.runKernel(cb,r,i)}const yt=xe({div_:Obe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pbe(n,e){let t=oe(n,"a","mul"),s=oe(e,"b","mul");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(Nb,r)}const ye=xe({mul_:Pbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mbe(n){const e=oe(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return be.runKernel(Nw,t)}else{const t={x:e};return be.runKernel(bw,t)}}const li=xe({abs_:Mbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fbe(n){const t={x:oe(n,"x","acos")};return be.runKernel(Yv,t)}const jbe=xe({acos_:Fbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bbe(n){const t={x:oe(n,"x","acosh")};return be.runKernel(Qv,t)}const zbe=xe({acosh_:Bbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vbe(n,e=null,t=!1){const r={x:oe(n,"x","all","bool")},i={axis:e,keepDims:t};return be.runKernel(U2,r,i)}const H5=xe({all_:Vbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ube(n,e=null,t=!1){const r={x:oe(n,"x","any","bool")},i={axis:e,keepDims:t};return be.runKernel(G2,r,i)}const YI=xe({any_:Ube});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gbe(n,e=0){const s={x:oe(n,"x","argMax")},r={axis:e};return be.runKernel(_w,s,r)}const av=xe({argMax_:Gbe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wbe(n,e=0){const s={x:oe(n,"x","argMin")},r={axis:e};return be.runKernel(xw,s,r)}const Hbe=xe({argMin_:Wbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qbe(n){const t={x:oe(n,"x","asin")};return be.runKernel(Jv,t)}const Kbe=xe({asin_:qbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(n){const t={x:oe(n,"x","asinh")};return be.runKernel(eb,t)}const Zbe=xe({asinh_:Xbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ybe(n){const t={x:oe(n,"x","atan")};return be.runKernel(tb,t)}const Qbe=xe({atan_:Ybe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jbe(n,e){let t=oe(n,"a","atan2"),s=oe(e,"b","atan2");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(sb,r)}const e_e=xe({atan2_:Jbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_e(n){const t={x:oe(n,"x","atanh")};return be.runKernel(nb,t)}const n_e=xe({atanh_:t_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hb(n,e,t,s,r="NHWC",i){const a=n[3],o=[...e,a],l=iu(r);return Er(n,o,t,i,s,null,null,l)}function ho(n,e,t,s,r,i,a="channelsLast"){const[o,l]=ov(e);let c;if(a==="channelsLast")c=[o,l,n[3],n[3]];else if(a==="channelsFirst")c=[o,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${a}`);return Er(n,c,t,s,r,i,!1,a)}function ru(n,e,t,s,r,i,a="NDHWC"){const[o,l,c]=QI(e);let h,p;if(a==="NDHWC")p="channelsLast",h=[o,l,c,n[4],n[4]];else if(a==="NCDHW")p="channelsFirst",h=[o,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${a}`);return td(n,h,t,s,r,!1,p,i)}function Er(n,e,t,s,r,i,a=!1,o="channelsLast"){let[l,c,h,p]=[-1,-1,-1,-1];if(o==="channelsLast")[l,c,h,p]=n;else if(o==="channelsFirst")[l,p,c,h]=n;else throw new Error(`Unknown dataFormat ${o}`);const[m,v,,_]=e,[w,T]=ov(t),[E,C]=ov(s),A=hm(m,E),D=hm(v,C),{padInfo:F,outHeight:W,outWidth:B}=i_e(r,c,h,w,T,A,D,i,o),P=a?_*p:_;let O;return o==="channelsFirst"?O=[l,P,W,B]:o==="channelsLast"&&(O=[l,W,B,P]),{batchSize:l,dataFormat:o,inHeight:c,inWidth:h,inChannels:p,outHeight:W,outWidth:B,outChannels:P,padInfo:F,strideHeight:w,strideWidth:T,filterHeight:m,filterWidth:v,effectiveFilterHeight:A,effectiveFilterWidth:D,dilationHeight:E,dilationWidth:C,inShape:n,outShape:O,filterShape:e}}function td(n,e,t,s,r,i=!1,a="channelsLast",o){let[l,c,h,p,m]=[-1,-1,-1,-1,-1];if(a==="channelsLast")[l,c,h,p,m]=n;else if(a==="channelsFirst")[l,m,c,h,p]=n;else throw new Error(`Unknown dataFormat ${a}`);const[v,_,w,,T]=e,[E,C,A]=QI(t),[D,F,W]=QI(s),B=hm(v,D),P=hm(_,F),O=hm(w,W),{padInfo:M,outDepth:k,outHeight:V,outWidth:G}=a_e(r,c,h,p,E,C,A,B,P,O,o),ae=i?T*m:T;let J;return a==="channelsFirst"?J=[l,ae,k,V,G]:a==="channelsLast"&&(J=[l,k,V,G,ae]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:p,inChannels:m,outDepth:k,outHeight:V,outWidth:G,outChannels:ae,padInfo:M,strideDepth:E,strideHeight:C,strideWidth:A,filterDepth:v,filterHeight:_,filterWidth:w,effectiveFilterDepth:B,effectiveFilterHeight:P,effectiveFilterWidth:O,dilationDepth:D,dilationHeight:F,dilationWidth:W,inShape:n,outShape:J,filterShape:e}}function s_e(n,e,t,s,r){s==null&&(s=A$(n,e,t));const i=n[0],a=n[1],o=lv((i-e+2*s)/t+1,r),l=lv((a-e+2*s)/t+1,r);return[o,l]}function r_e(n,e,t,s,r,i){r==null&&(r=A$(n,e[0],s[0]));const a=[0,0,0,t];for(let o=0;o<3;o++)n[o]+2*r>=e[o]&&(a[o]=lv((n[o]-e[o]+2*r)/s[o]+1,i));return a}function A$(n,e,t,s=1){const r=hm(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function ov(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function QI(n){return typeof n=="number"?[n,n,n]:n}function hm(n,e){return e<=1?n:n+(n-1)*(e-1)}function i_e(n,e,t,s,r,i,a,o,l){let c,h,p;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const v=s_e([e,t],i,s,n,o);h=v[0],p=v[1]}else if(n==="same"){h=Math.ceil(e/s),p=Math.ceil(t/r);const m=Math.max(0,(h-1)*s+i-e),v=Math.max(0,(p-1)*r+a-t),_=Math.floor(m/2),w=m-_,T=Math.floor(v/2),E=v-T;c={top:_,bottom:w,left:T,right:E,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-i+1)/s),p=Math.ceil((t-a+1)/r);else if(typeof n=="object"){const m=l==="channelsLast"?n[1][0]:n[2][0],v=l==="channelsLast"?n[1][1]:n[2][1],_=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];c={top:m,bottom:v,left:_,right:w,type:m===0&&v===0&&_===0&&w===0?"VALID":"EXPLICIT"},h=lv((e-i+m+v)/s+1,o),p=lv((t-a+_+w)/r+1,o)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:h,outWidth:p}}function a_e(n,e,t,s,r,i,a,o,l,c,h){let p,m,v,_;if(n==="valid"&&(n=0),typeof n=="number"){p={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const T=r_e([e,t,s,1],[o,l,c],1,[r,i,a],n,h);m=T[0],v=T[1],_=T[2]}else if(n==="same"){m=Math.ceil(e/r),v=Math.ceil(t/i),_=Math.ceil(s/a);const w=(m-1)*r+o-e,T=(v-1)*i+l-t,E=(_-1)*a+c-s,C=Math.floor(w/2),A=w-C,D=Math.floor(T/2),F=T-D,W=Math.floor(E/2),B=E-W;p={top:D,bottom:F,left:W,right:B,front:C,back:A,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:p,outDepth:m,outHeight:v,outWidth:_}}function lv(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function $f(n){const[e,t,s]=ov(n);return e===1&&t===1&&s===1}function qr(n,e){return $f(n)||$f(e)}function Af(n){return ov(n).every(e=>e>0)}function iu(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Oi(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")te(Im(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{te(Im(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(n,e){const s={x:oe(n,"x","reshape","string_or_numeric")},r={shape:e};return be.runKernel(aT,s,r)}const _e=xe({reshape_:o_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(n,e,t,s,r){const i=oe(n,"x","avgPool","float32"),a=1;te(qr(t,a),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`);let o=i,l=!1;i.rank===3&&(l=!0,o=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]])),te(o.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),Oi("avgPool",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let p=be.runKernel(ww,c,h);return p=tt(p,i.dtype),l?_e(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const R$=xe({avgPool_:l_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_e(n,e,t,s,r,i="NDHWC"){const a=oe(n,"x","avgPool3d","float32");let o=a,l=!1;a.rank===4&&(l=!0,o=_e(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),te(o.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`),te(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),te(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Oi("avgPool3d",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let p=be.runKernel(Tw,c,h);return p=tt(p,o.dtype),l?_e(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const u_e=xe({avgPool3d_:c_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_e(n,e=0){te(n.length>=1,()=>"Pass at least one tensor to concat");const t=O5(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return lf(t[0]);const s=t,r={axis:e};return be.runKernel(Iw,s,r)}const Ri=xe({concat_:h_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(n,e,t=!1,s=!1){let r=oe(n,"a","matMul"),i=oe(e,"b","matMul");[r,i]=Es(r,i);const a={a:r,b:i},o={transposeA:t,transposeB:s};return be.runKernel(Sw,a,o)}const bn=xe({matMul_:d_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(n){const t={x:oe(n,"x","sigmoid","float32")};return be.runKernel(Mb,t)}const ng=xe({sigmoid_:f_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(n,e,t){const s=oe(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return be.runKernel(hT,r,i)}const Un=xe({slice_:p_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_e(n){const t={x:oe(n,"x","tanh","float32")};return be.runKernel(Ub,t)}const wT=xe({tanh_:m_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_e(n,e,t){const s=oe(n,"x","batchToSpaceND"),r=e.reduce((o,l)=>o*l);te(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),te(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),te(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},a={blockShape:e,crops:t};return be.runKernel(Ew,i,a)}const D$=xe({batchToSpaceND_:g_e});function y_e(n){let e;return n.rank===0||n.rank===1?e=_e(n,[1,1,1,n.size]):n.rank===2?e=_e(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=_e(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(n,e,t,s,r,i){i==null&&(i=.001);const a=oe(n,"x","batchNorm"),o=oe(e,"mean","batchNorm"),l=oe(t,"variance","batchNorm");let c;r!=null&&(c=oe(r,"scale","batchNorm"));let h;s!=null&&(h=oe(s,"offset","batchNorm")),te(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),te(h==null||o.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),te(c==null||o.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:y_e(a),scale:c,offset:h,mean:o,variance:l},v={varianceEpsilon:i},_=be.runKernel(Pw,m,v);return _e(_,a.shape)}const TT=xe({batchNorm_:v_e});function b_e(n,e,t,s,r,i){const a=oe(n,"x","batchNorm"),o=oe(e,"mean","batchNorm"),l=oe(t,"variance","batchNorm");let c;r!=null&&(c=oe(r,"scale","batchNorm"));let h;return s!=null&&(h=oe(s,"offset","batchNorm")),te(a.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`),te(o.rank===2||o.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`),te(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&te(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&te(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),TT(a,o,l,h,c,i)}const __e=xe({batchNorm2d_:b_e});function x_e(n,e,t,s,r,i){const a=oe(n,"x","batchNorm"),o=oe(e,"mean","batchNorm"),l=oe(t,"variance","batchNorm");let c;r!=null&&(c=oe(r,"scale","batchNorm"));let h;return s!=null&&(h=oe(s,"offset","batchNorm")),te(a.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`),te(o.rank===3||o.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`),te(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&te(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&te(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),TT(a,o,l,h,c,i)}const w_e=xe({batchNorm3d_:x_e});function T_e(n,e,t,s,r,i){const a=oe(n,"x","batchNorm"),o=oe(e,"mean","batchNorm"),l=oe(t,"variance","batchNorm");let c;r!=null&&(c=oe(r,"scale","batchNorm"));let h;return s!=null&&(h=oe(s,"offset","batchNorm")),te(a.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`),te(o.rank===4||o.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`),te(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&te(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&te(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),TT(a,o,l,h,c,i)}const S_e=xe({batchNorm4d_:T_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_e(n,e,t){const s=oe(n,"x","bincount"),r=oe(e,"weights","bincount");te(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),te(t>=0,()=>`size must be non-negative, but got ${t}.`),te(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},a={size:t};return be.runKernel(q2,i,a)}const N_e=xe({bincount_:E_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_e(n,e){let t=oe(n,"broadcastTo","x");const s=t.shape;if(su(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=_e(t,c)}const r=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return lf(t);const o={x:t},l={reps:i};return be.runKernel(Gb,o,l)}const My=xe({broadcastTo_:I_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_e(n){const t={x:oe(n,"x","ceil","float32")};return be.runKernel(ib,t)}const k_e=xe({ceil_:C_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ST(n,e,t){su(n),t=t||Qm(e);const s={shape:n,value:e,dtype:t};return be.runKernel(l$,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_e(n,e,t){const s=oe(n,"x","clipByValue");if(te(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return ST(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return be.runKernel(ab,r,i)}const ka=xe({clipByValue_:$_e});function A_e(n){return Ri(n,0)}const R_e=xe({concat1d_:A_e});function D_e(n,e){return Ri(n,e)}const L_e=xe({concat2d_:D_e});function O_e(n,e){return Ri(n,e)}const P_e=xe({concat3d_:O_e});function M_e(n,e){return Ri(n,e)}const F_e=xe({concat4d_:M_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_e(n,e,t,s,r="NHWC",i=[1,1],a){const o=oe(n,"x","conv2d","float32"),l=oe(e,"filter","conv2d","float32");let c=o,h=!1;o.rank===3&&(h=!0,c=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]])),te(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),te(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Oi("conv2d",s,a);const p=r==="NHWC"?c.shape[3]:c.shape[1];te(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),te(qr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),te(Af(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),te(Af(t),()=>"Error in conv2D: Strides should be larger than 0.");const m={x:c,filter:l},v={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a},_=be.runKernel(Cw,m,v);return h?_e(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const Rf=xe({conv2d_:j_e});function B_e(n,e,t,s,r="NWC",i=1,a){const o=oe(n,"x","conv1d"),l=oe(e,"filter","conv1d");let c=o,h=!1;o.rank===2&&(h=!0,c=_e(o,[1,o.shape[0],o.shape[1]])),te(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),te(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Oi("conv1d",s,a),te(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),te(qr(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),te(Af(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),te(Af(t),()=>"Error in conv1D: Stride should be larger than 0."),te(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const p=_e(l,[1,l.shape[0],l.shape[1],l.shape[2]]),m=_e(c,[c.shape[0],1,c.shape[1],c.shape[2]]),T=Rf(m,p,[1,t],s,"NHWC",[1,i],a);return h?_e(T,[T.shape[2],T.shape[3]]):_e(T,[T.shape[0],T.shape[2],T.shape[3]])}const q5=xe({conv1d_:B_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_e(n,e,t,s,r,i="NHWC",a){te(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,l=e,c=!1;e.rank===3&&(c=!0,l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]),o=[1,n[0],n[1],n[2]]),te(o.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`),te(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),te(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=i==="NHWC"?o[3]:o[1],p=i==="NHWC"?l.shape[3]:l.shape[1];te(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),te(p===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${t.shape[3]}.`),Oi("conv2dDerInput",r,a);const m={dy:l,filter:t},v={strides:s,pad:r,dataFormat:i,dimRoundingMode:a,inputShape:o},_=be.runKernel(kw,m,v);return c?_e(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const L$=xe({conv2DBackpropInput_:z_e});function V_e(n,e,t,s,r,i){const a=oe(n,"x","conv2dTranspose"),o=oe(e,"filter","conv2dTranspose");return L$(t,a,o,s,r,"NHWC",i)}const K5=xe({conv2dTranspose_:V_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_e(n,e,t,s,r="NDHWC",i=[1,1,1]){const a=oe(n,"x","conv3d"),o=oe(e,"filter","conv3d");let l=a,c=!1;a.rank===4&&(c=!0,l=_e(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),te(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),te(o.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`),te(l.shape[4]===o.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`),te(qr(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),te(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),te(Af(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),te(Af(t),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:o},p={strides:t,pad:s,dataFormat:r,dilations:i},m=be.runKernel($w,h,p);return c?_e(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const G_e=xe({conv3d_:U_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(n,e,t,s,r){te(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,a=e,o=!1;e.rank===4&&(o=!0,a=_e(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],c=a.shape[4];te(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),te(a.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`),te(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),te(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),te(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const h={dy:a,filter:t},p={pad:r,strides:s,inputShape:i},m=be.runKernel(Q2,h,p);return o?_e(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const X5=xe({conv3DBackpropInput_:W_e});function H_e(n,e,t,s,r){const i=oe(n,"x","conv3dTranspose"),a=oe(e,"filter","conv3dTranspose");return X5(t,i,a,s,r)}const q_e=xe({conv3dTranspose_:H_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_e(n){const t={x:oe(n,"x","cos","float32")};return be.runKernel(ob,t)}const O$=xe({cos_:K_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X_e(n){const t={x:oe(n,"x","cosh","float32")};return be.runKernel(lb,t)}const Z5=xe({cosh_:X_e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_e(n,e=0,t=!1,s=!1){const i={x:oe(n,"x","cumprod")},a={axis:e,exclusive:t,reverse:s};return be.runKernel(J2,i,a)}const JI=xe({cumprod_:Z_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_e(n,e=0,t=!1,s=!1){const i={x:oe(n,"x","cumsum")},a={axis:e,exclusive:t,reverse:s};return be.runKernel(Aw,i,a)}const Y5=xe({cumsum_:Y_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_e(n,e,t,s=!1){const r=oe(n,"x","denseBincount"),i=oe(e,"weights","denseBincount");te(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),te(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),te(t>=0,()=>`size must be non-negative, but got ${t}.`),te(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const a={x:r,weights:i},o={size:t,binaryOutput:s};return be.runKernel(t$,a,o)}const JM=xe({denseBincount_:Q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J_e(n,e,t="NHWC"){const s=oe(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],a=t==="NHWC"?s.shape[3]:s.shape[1];te(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),te(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),te(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),te(a%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${a} for depthToSpace with input shape ${s.shape}`);const o={x:s},l={blockSize:e,dataFormat:t};return be.runKernel(n$,o,l)}const exe=xe({depthToSpace_:J_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txe(n,e,t,s,r="NHWC",i=[1,1],a){const o=oe(n,"x","depthwiseConv2d","float32"),l=oe(e,"filter","depthwiseConv2d","float32");let c=o,h=!1;o.rank===3&&(h=!0,c=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]])),te(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),te(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const p=r==="NHWC"?c.shape[3]:c.shape[1];te(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),Oi("depthwiseConv2d",s,a);const m={x:c,filter:l},v={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a},_=be.runKernel(Rw,m,v);return h?_e(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const P$=xe({depthwiseConv2d_:txe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nxe(n,e,t,s,r=[1,1],i="NHWC"){const a=oe(n,"x","dilation2d"),o=oe(e,"filter","dilation2d");te(a.rank===3||a.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`),te(o.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`),te(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=a,c=!1;a.rank===3&&(l=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]]),c=!0),te(l.shape[3]===o.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${o.shape[2]}`);const h={x:l,filter:o},p={strides:t,pad:s,dilations:r},m=be.runKernel(Dw,h,p);return c?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const sxe=xe({dilation2d_:nxe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $m(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,a=n[i]||1;(e[e.length-1-r]||1)>1&&a===1&&s.unshift(i)}return s}function tr(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,a=e[i];(r==null||r===1&&a>1)&&t.unshift(i)}return t}function Dt(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let a=e[e.length-r-1];if(a==null&&(a=1),i===1)s[t-r-1]=a;else if(a===1)s[t-r-1]=i;else if(i!==a){const o=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(o)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rxe(n,e){let t=oe(n,"a","equal","string_or_numeric"),s=oe(e,"b","equal","string_or_numeric");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Lw,r)}const Jl=xe({equal_:rxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ixe(n,e,t){const s=oe(e,"a","where"),r=oe(t,"b","where"),i=oe(n,"condition","where","bool"),a=Dt(Dt(i.shape,s.shape),r.shape),o=My(i,a),l=My(s,a),c=My(r,a),h={condition:o,t:l,e:c};return be.runKernel(uT,h)}const mi=xe({where_:ixe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function axe(n){const t={x:oe(n,"x","zerosLike")};return be.runKernel(vT,t)}const ln=xe({zerosLike_:axe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oxe(n,e){let t=oe(n,"a","div"),s=oe(e,"b","div");[t,s]=Es(t,s);const r=yt(t,s),i=ln(r),a=Jl(s,i);return mi(a,i,r)}const lxe=xe({divNoNan_:oxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cxe(n,e){const t=oe(n,"t1","dot"),s=oe(e,"t2","dot");te((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(te(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const a=_e(t,[1,-1]),o=_e(s,[-1,1]),l=bn(a,o);return _e(l,[])}else if(t.rank===1&&s.rank===2){const a=_e(t,[1,-1]),o=_e(s,[s.shape[0],s.shape[1]]),l=bn(a,o);return _e(l,[l.size])}else if(t.rank===2&&s.rank===1){const a=_e(s,[-1,1]),o=bn(t,a);return _e(o,[o.size])}else{const a=_e(s,[s.shape[0],s.shape[1]]);return bn(t,a)}}const uxe=xe({dot_:cxe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hxe(n,...e){const t=e.map((r,i)=>oe(r,`tensors${i}`,"einsum")),s={equation:n};return be.runKernel(i$,t,s)}const uy=xe({einsum_:hxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dxe(n){const t={x:oe(n,"x","elu","float32")};return be.runKernel(ub,t)}const ET=xe({elu_:dxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fxe(n){let e=oe(n,"x","erf");te(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=tt(e,"float32"));const t={x:e};return be.runKernel(hb,t)}const Q5=xe({erf_:fxe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function J5(n,e,t){const s=n.length+e.length,r=[];let i=0,a=0;for(let o=0;o<s;o++)t.indexOf(o)===-1?r.push(n[i++]):r.push(e[a++]);return r}function fr(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function Bs(n,e){const t=e.map(s=>1);return J5(n,t,e)}function Nr(n,e,t){te(M$(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function fs(n,e){if(M$(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function nd(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Is(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pxe(n,e=null,t=!1){const r={x:oe(n,"x","max")},i={reductionIndices:e,keepDims:t};return be.runKernel(Hw,r,i)}const Go=xe({max_:pxe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mxe(n,e=null,t=!1){const r={x:oe(n,"x","min")},i={axis:e,keepDims:t};return be.runKernel(Zw,r,i)}const n1=xe({min_:mxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gxe(n,e){let t=oe(n,"base","pow"),s=oe(e,"exp","pow");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(Ib,r)}const Df=xe({pow_:gxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _n(n,e){if((lo(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&lo(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xT(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yxe(n){const t={x:oe(n,"x","sqrt","float32")};return be.runKernel(jb,t)}const Wr=xe({sqrt_:yxe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vxe(n){const e=oe(n,"x","square"),t={};return be.runKernel("Square",{x:e},t)}const Jn=xe({square_:vxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxe(n,e=null,t=!1){let s=oe(n,"x","sum");s.dtype==="bool"&&(s=tt(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return be.runKernel(dT,r,i)}const pt=xe({sum_:bxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _xe(n,e="euclidean",t=null,s=!1){n=oe(n,"x","norm");const r=eH(n,e,t);let i=r.shape;if(s){const a=Vt(t,n.shape);i=Bs(r.shape,a)}return _e(r,i)}function eH(n,e,t=null){if(n.rank===0)return li(n);if(n.rank!==1&&t===null)return eH(_e(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return pt(li(n),t);if(e===1/0)return Go(li(n),t);if(e===-1/0)return n1(li(n),t);if(e==="euclidean"||e===2)return Wr(pt(Df(li(n),_n(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Go(pt(li(n),t[0]),t[1]-1);if(e===1/0)return Go(pt(li(n),t[1]),t[0]);if(e===-1/0)return n1(pt(li(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Wr(pt(Jn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const NT=xe({norm_:_xe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xxe(n,e=null,t=!1){return NT(n,"euclidean",e,t)}const wxe=xe({euclideanNorm_:xxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Txe(n){const t={x:oe(n,"x","exp")};return be.runKernel(db,t)}const ec=xe({exp_:Txe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sxe(n,e=0){const t=oe(n,"x","expandDims","string_or_numeric");te(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return be.runKernel(Ow,s,r)}const $i=xe({expandDims_:Sxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Exe(n){const t={x:oe(n,"x","expm1")};return be.runKernel(fb,t)}const Nxe=xe({expm1_:Exe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ixe(n,e){const t=oe(n,"x","tile","string_or_numeric");te(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return be.runKernel(Gb,s,r)}const Bo=xe({tile_:Ixe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cxe(n,e,t,s="float32"){e==null&&(e=n);const r=zt([n,e],s),i=n<=e?n:e;for(let o=0;o<i;++o)r.set(1,o,o);const a=_e(r.toTensor(),[n,e]);if(t==null)return a;if(t.length===1)return Bo($i(a,0),[t[0],1,1]);if(t.length===2)return Bo($i($i(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return Bo($i($i($i(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const tH=xe({eye_:Cxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kxe(n){const t={x:oe(n,"x","floor","float32")};return be.runKernel(pb,t)}const IT=xe({floor_:kxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $xe(n,e,t=0,s=0){const r=oe(n,"x","gather"),i=oe(e,"indices","gather","int32"),a={x:r,indices:i},o={axis:t,batchDims:s};return be.runKernel(Mw,a,o)}const F$=xe({gather_:$xe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Axe(n,e){let t=oe(n,"a","greater","string_or_numeric"),s=oe(e,"b","greater","string_or_numeric");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Fw,r)}const $a=xe({greater_:Axe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(n,e){let t=oe(n,"a","greaterEqual","string_or_numeric"),s=oe(e,"b","greaterEqual","string_or_numeric");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(gb,r)}const Hf=xe({greaterEqual_:Rxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxe(n){const t={input:oe(n,"input","imag")};return be.runKernel(h$,t)}const j$=xe({imag_:Dxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lxe(n){const t={x:oe(n,"x","isFinite")};return be.runKernel(vb,t)}const Oxe=xe({isFinite_:Lxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pxe(n){const t={x:oe(n,"x","isInf")};return be.runKernel(bb,t)}const Mxe=xe({isInf_:Pxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fxe(n){const t={x:oe(n,"x","isNaN")};return be.runKernel(_b,t)}const jxe=xe({isNaN_:Fxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bxe(n,e=.2){const s={x:oe(n,"x","leakyRelu")},r={alpha:e};return be.runKernel(jw,s,r)}const B$=xe({leakyRelu_:Bxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zxe(n,e){let t=oe(n,"a","less","string_or_numeric"),s=oe(e,"b","less","string_or_numeric");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Bw,r)}const s1=xe({less_:zxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vxe(n,e){let t=oe(n,"a","lessEqual","string_or_numeric"),s=oe(e,"b","lessEqual","string_or_numeric");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(zw,r)}const sg=xe({lessEqual_:Vxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uxe(n,e=5,t=1,s=1,r=.5){const i=oe(n,"x","localResponseNormalization");te(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),te(Im(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let a=i,o=!1;i.rank===3&&(o=!0,a=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:a},c={depthRadius:e,bias:t,alpha:s,beta:r},h=be.runKernel(Ww,l,c);return o?_e(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Gxe=xe({localResponseNormalization_:Uxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxe(n){const t={x:oe(n,"x","log","float32")};return be.runKernel(xb,t)}const tc=xe({log_:Wxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hxe(n){const t={x:oe(n,"x","log1p")};return be.runKernel(wb,t)}const nH=xe({log1p_:Hxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qxe(n,e){te(FI(n),()=>"The f passed in variableGrads(f) must be a function"),te(e==null||Array.isArray(e)&&e.every(c=>c instanceof t1),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in be.registeredVariables)e.push(be.registeredVariables[c])}const s=t?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),te(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:a,grads:o}=be.gradients(n,e,null,i);te(o.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),te(a.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${a.rank} tensor`);const l={};return e.forEach((c,h)=>{o[h]!=null&&(l[c.name]=o[h])}),s?.forEach(c=>l[c.name]=null),{value:a,grads:l}}function Am(n){return be.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kxe(n){const t={x:oe(n,"x","neg")};return be.runKernel(Qw,t)}const Ts=xe({neg_:Kxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xxe(n){const t={x:oe(n,"x","softplus")};return be.runKernel(Fb,t)}const qb=xe({softplus_:Xxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zxe(n){const e=oe(n,"x","logSigmoid");return Am(s=>({value:Ts(qb(Ts(s))),gradFunc:a=>ye(a,ng(Ts(s)))}))(e)}const Yxe=xe({logSigmoid_:Zxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qxe(n,e){let t=oe(n,"a","sub"),s=oe(e,"b","sub");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(zb,r)}const _t=xe({sub_:Qxe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(n,e=-1){const t=oe(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Am((r,i)=>{const o=Go(r,e,!0),l=_t(r,o),c=_t(tt(l,"float32"),tc(pt(ec(l),e,!0)));return i([c]),{value:c,gradFunc:(p,m)=>{const[v]=m,_=!0,w=ec(v);return _t(p,ye(pt(p,e,_),w))}}})(t)}const sH=xe({logSoftmax_:Jxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0e(n,e=null,t=!1){const s=oe(n,"x","logSumExp"),r=Vt(e,s.shape),i=Go(s,r,!0),a=_t(s,i),o=ec(a),l=pt(o,r),c=tc(l),h=Ke(_e(i,c.shape),c);if(t){const p=Bs(h.shape,r);return _e(h,p)}return h}const rH=xe({logSumExp_:e0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0e(n,e){const t=oe(n,"a","logicalAnd","bool"),s=oe(e,"b","logicalAnd","bool");Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Vw,r)}const Zc=xe({logicalAnd_:t0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(n){const t={x:oe(n,"x","logicalNot","bool")};return be.runKernel(Uw,t)}const z$=xe({logicalNot_:n0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s0e(n,e){const t=oe(n,"a","logicalOr","bool"),s=oe(e,"b","logicalOr","bool");Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Gw,r)}const iH=xe({logicalOr_:s0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0e(n,e){const t=oe(n,"a","logicalXor","bool"),s=oe(e,"b","logicalXor","bool");return Dt(t.shape,s.shape),Zc(iH(n,e),z$(Zc(n,e)))}const i0e=xe({logicalXor_:r0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0e(n,e,t,s,r){const i=oe(n,"x","maxPool"),a=1;let o=i,l=!1;i.rank===3&&(l=!0,o=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]])),te(o.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),te(qr(t,a),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),Oi("maxPool",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r},p=be.runKernel(qw,c,h);return l?_e(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const V$=xe({maxPool_:a0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(n,e=[1,1,1],t,s,r,i="NDHWC"){const a=oe(n,"x","maxPool3d");let o=a,l=!1;a.rank===4&&(l=!0,o=_e(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),te(o.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`),te(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Oi("maxPool3d",s,r);const c={x:o},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},p=be.runKernel(Kw,c,h);return l?_e(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const l0e=xe({maxPool3d_:o0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0e(n,e){let t=oe(n,"a","maximum"),s=oe(e,"b","maximum");[t,s]=Es(t,s),t.dtype==="bool"&&(t=tt(t,"int32"),s=tt(s,"int32")),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Tb,r)}const sd=xe({maximum_:c0e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(n,e=null,t=!1){const r={x:oe(n,"x","mean")},i={axis:e,keepDims:t};return be.runKernel(Xw,r,i)}const Ps=xe({mean_:u0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ur(n,e="float32"){if(su(n),e==="complex64"){const s=ur(n,"float32"),r=ur(n,"float32");return km(s,r)}const t=Gr(Me(n),e);return be.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rd(n,e="float32"){if(su(n),e==="complex64"){const s=rd(n,"float32"),r=ur(n,"float32");return km(s,r)}const t=j2(Me(n),e);return be.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(n,e){let t=oe(n,"a","minimum"),s=oe(e,"b","minimum");[t,s]=Es(t,s),t.dtype==="bool"&&(t=tt(t,"int32"),s=tt(s,"int32")),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Sb,r)}const cv=xe({minimum_:h0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0e(n,e,t){te(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=oe(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");te(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let o=0;o<s.rank;o++)te(e[o].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),te(e[o][0]>=0&&e[o][0]<=s.shape[o]-r&&e[o][1]>=0&&e[o][1]<=s.shape[o]-r,()=>`Padding in dimension ${o} cannot be greater than or equal to ${s.shape[o]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},a={x:s};return be.runKernel(Yw,a,i)}const f0e=xe({mirrorPad_:d0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0e(n,e){let t=oe(n,"a","mod"),s=oe(e,"b","mod");[t,s]=Es(t,s);const r={a:t,b:s};return be.runKernel(Eb,r)}const m0e=xe({mod_:p0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0e(n,e=null,t=!1){n=oe(n,"x","moments");const s=Vt(e,n.shape),r=Ps(n,s,t);let i=r.shape;t||(i=Bs(r.shape,s));const a=Jn(_t(tt(n,"float32"),_e(r,i))),o=Ps(a,s,t);return{mean:r,variance:o}}const U$=xe({moments_:g0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y0e(n,e){let t=oe(n,"a","notEqual","string_or_numeric"),s=oe(e,"b","notEqual","string_or_numeric");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return be.runKernel(Jw,r)}const r1=xe({notEqual_:y0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0e(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const a={indices:oe(n,"indices","oneHot","int32")},o={dtype:r,depth:e,onValue:t,offValue:s};return be.runKernel(tT,a,o)}const aH=xe({oneHot_:v0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b0e(n){const t={x:oe(n,"x","onesLike")};return be.runKernel(eT,t)}const co=xe({onesLike_:b0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _0e(n,e,t=0){const s=oe(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return be.runKernel(sT,i,r)}const G$=xe({pad_:_0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0e(n,e,t){const s=oe(n,"x","spaceToBatchND");te(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),te(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),te(s.shape.reduce((a,o,l)=>l>0&&l<=e.length?a&&(o+t[l-1][0]+t[l-1][1])%e[l-1]===0:a,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return be.runKernel(fT,r,i)}const W$=xe({spaceToBatchND_:x0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0e(n,e,t,s,r,i,a){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const o=oe(n,"x","maxPool");let l=o,c=!1;o.rank===3&&(c=!0,l=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]])),te(qr(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const h=ho(l.shape,e,i,r,s),p=[h.dilationHeight,h.dilationWidth];let m;s==="same"?m=S0e([h.filterHeight,h.filterWidth],p):m=[[0,0],[0,0]];const v=p[0]===1&&p[1]===1,[_,w]=T0e([h.inHeight,h.inWidth],p,m),T=v?s:"valid",E=v?l:W$(l,p,_),A=(t==="avg"?()=>R$(E,e,i,T,a):()=>V$(E,e,i,T,a))(),D=v?A:D$(A,p,w);return c?_e(D,[D.shape[1],D.shape[2],D.shape[3]]):D}function T0e(n,e,t){const s=t.map(h=>h[0]),r=t.map(h=>h[1]),i=n.concat(s,r),a=e.map((h,p)=>(h-i[p]%h)%h),o=r.map((h,p)=>h+a[p]),l=e.map((h,p)=>[s[p],o[p]]),c=e.map((h,p)=>[0,a[p]]);return[l,c]}function S0e(n,e){const s=n.map((a,o)=>a+(a-1)*(e[o]-1)).map(a=>a-1),r=s.map(a=>Math.floor(a/2)),i=s.map((a,o)=>a-r[o]);return s.map((a,o)=>[r[o],i[o]])}const E0e=xe({pool_:w0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0e(n,e){const t=oe(n,"x","prelu"),s=oe(e,"alpha","prelu"),r={x:t,alpha:s};return be.runKernel(rT,r)}const H$=xe({prelu_:N0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0e(n,e=null,t=!1){let s=oe(n,"x","prod");s.dtype==="bool"&&(s=tt(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return be.runKernel(iT,r,i)}const C0e=xe({prod_:I0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oH{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const a=i||Math.random();this.random=Zm.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,a;do r=2*this.random()-1,i=2*this.random()-1,a=r*r+i*i;while(a>=1||a===0);const o=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*i*o,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class k0e{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Zm.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0e(n,e=0,t=1,s,r){if(su(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new oH(e,t,s,!1,r),a=zt(n,s);for(let o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}const A0e=xe({randomNormal_:$0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0e(n,e=0,t=1,s="float32",r){su(n);const i=zt(n,s),a=new k0e(e,t,null,r);for(let o=0;o<i.values.length;o++)i.values[o]=a.nextValue();return i.toTensor()}const Kb=xe({randomUniform_:R0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return be.runKernel(v$,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0e(n){const t={input:oe(n,"input","real")};return be.runKernel(b$,t)}const i1=xe({real_:D0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0e(n){const t={x:oe(n,"x","reciprocal")};return be.runKernel(Cb,t)}const O0e=xe({reciprocal_:L0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0e(n){const t={x:oe(n,"x","relu")};return be.runKernel(kb,t)}const qf=xe({relu_:P0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(n){const t={x:oe(n,"x","relu6")};return be.runKernel($b,t)}const lH=xe({relu6_:M0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0e(n,e){const s={x:oe(n,"x","reverse")},r={dims:e};return be.runKernel(cT,s,r)}const Lf=xe({reverse_:F0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(n){const t={x:oe(n,"x","round")};return be.runKernel(Ab,t)}const cH=xe({round_:j0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e(n){const t={x:oe(n,"x","rsqrt","float32")};return be.runKernel(Rb,t)}const uH=xe({rsqrt_:B0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z0e(n){const t={x:oe(n,"x","selu")};return be.runKernel(Db,t)}const hH=xe({selu_:z0e});function V0e(n,e,t,s,r,i=[1,1],a="NHWC"){const o=oe(n,"x","separableConv2d"),l=oe(e,"depthwiseFilter","separableConv2d"),c=oe(t,"pointwiseFilter","separableConv2d");let h=o,p=!1;if(o.rank===3&&(p=!0,h=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");te(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),te(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),te(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),te(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),te(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const m=l.shape[2],v=l.shape[3];te(c.shape[2]===m*v,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*v}, but got ${c.shape[2]}.`);const _=P$(h,l,s,r,a,i),T=Rf(_,c,1,"valid",a);return p?_e(T,[T.shape[1],T.shape[2],T.shape[3]]):T}const dH=xe({separableConv2d_:V0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0e(n){const t={x:oe(n,"x","sign")};return be.runKernel(Pb,t)}const G0e=xe({sign_:U0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0e(n){const t={x:oe(n,"x","sin","float32")};return be.runKernel(Lb,t)}const fH=xe({sin_:W0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0e(n){const t={x:oe(n,"x","sinh")};return be.runKernel(Ob,t)}const pH=xe({sinh_:H0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0e(n,e,t){const s=oe(n,"x","slice1d");return te(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Un(s,[e],[t])}const q$=xe({slice1d_:q0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(n,e,t){const s=oe(n,"x","slice2d");return te(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Un(s,e,t)}const mH=xe({slice2d_:K0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0e(n,e,t){const s=oe(n,"x","slice3d");return te(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Un(s,e,t)}const K$=xe({slice3d_:X0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0e(n,e,t){const s=oe(n,"x","slice4d");return te(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Un(s,e,t)}const a1=xe({slice4d_:Z0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(n,e=-1){const t=oe(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return be.runKernel(mT,s,r)}const X$=xe({softmax_:Y0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0e(n){te(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return be.runKernel(o$,e)}const gH=xe({fft_:Q0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0e(n){te(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return be.runKernel(u$,e)}const eC=xe({ifft_:J0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e1e(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=_e(n,[t,e]);s=eC(r)}else{const r=[t,2*(e-1)],i=_e(i1(n),[t,e]),a=_e(j$(n),[t,e]),o=Lf(Un(i,[0,1],[t,e-2]),1),l=ye(Lf(Un(a,[0,1],[t,e-2]),1),_n(-1)),c=Ri([i,o],1),h=Ri([a,l],1),p=_e(km(c,h),[r[0],r[1]]);s=eC(p)}if(s=i1(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=_e(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const t1e=xe({irfft_:e1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n1e(n,e,t=0){const r={x:oe(n,"x","split")},i={numOrSizeSplits:e,axis:t};return be.runKernel(pT,r,i)}const Ia=xe({split_:n1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s1e(n,e){te(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const _=n.shape.map(T=>0),w=n.shape.map(T=>T);w[n.shape.length-1]=e,r=Un(n,_,w),t=e}else if(e!=null&&e>t){const _=n.shape.map(w=>w);_[n.shape.length-1]=e-t,r=Ri([n,ur(_)],n.shape.length-1),t=e}else r=n;const i=ln(r),a=_e(km(r,i),[s,t]),o=gH(a),l=Math.floor(t/2)+1,c=i1(o),h=j$(o),p=Ia(c,[l,t-l],c.shape.length-1),m=Ia(h,[l,t-l],h.shape.length-1),v=r.shape.slice();return v[r.shape.length-1]=l,_e(km(p[0],m[0]),v)}const r1e=xe({rfft_:s1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i1e(n,e){let t=oe(n,"a","squaredDifference"),s=oe(e,"b","squaredDifference");[t,s]=Es(t,s),Dt(t.shape,s.shape);const r={a:t,b:s},i={};return be.runKernel(Bb,r,i)}const a1e=xe({squaredDifference_:i1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o1e(n,e){const t=oe(n,"x","squeeze","string_or_numeric");return _e(t,Jh(t.shape,e).newShape)}const Xb=xe({squeeze_:o1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l1e(n,e=0){const t=O5(n,"tensors","stack","string_or_numeric");te(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&te(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return be.runKernel(nT,s,r)}const Yc=xe({stack_:l1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1e(n,e=0){const s={x:oe(n,"x","step")},r={alpha:e};return be.runKernel(Wb,s,r)}const Zb=xe({step_:c1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u1e(n,e,t,s,r=0,i=0,a=0,o=0,l=0){const h={x:oe(n,"x","stridedSlice","string_or_numeric")},p={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};return be.runKernel(S$,h,p)}const h1e=xe({stridedSlice_:u1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d1e(n){const t={x:oe(n,"x","tan","float32")};return be.runKernel(Vb,t)}const f1e=xe({tan_:d1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(n,e){WW(n);const t=_T(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xT(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dN(n,e,t){if(WW(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=_T(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xT(n,e,s,t)}function yH(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let a=0;a<r;++a)if(t.shape[a]!==e.shape[a])throw new Error(i+` updates.shape[${a}] (${t.shape[a]}) != indices.shape[${a}] (${e.shape[a]}).`);for(let a=0;a<t.rank-r;++a)if(t.shape[a+r]!==n[a+s])throw new Error(i+` updates.shape[${a+r}] (${t.shape[a+r]}) != shape[${a+r}] (${n[a+r]})`)}function p1e(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}yH(t,e,n)}function Kf(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let a=1;for(let p=r;p<i;++p)a*=t[p];const o=r<1?1:r,l=Me(e.shape)/o,c=[...ht(t.slice(0,r)),1],h=Me(t);return{sliceRank:r,numUpdates:l,sliceSize:a,strides:c,outputSize:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m1e(n,e=1,t=!0){const s=oe(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},a={k:e,sorted:t},[o,l]=be.runKernel(E$,i,a);return{values:o,indices:l}}const g1e=xe({topk_:m1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1e(n,e=0,t=1,s,r){if(su(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new oH(e,t,s,!0,r),a=zt(n,s);for(let o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}const vH=xe({truncatedNormal_:y1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(n,e=0){const t=oe(n,"x","unique","string_or_numeric");te(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,a]=be.runKernel(I$,s,r);return{values:i,indices:a}}const b1e=xe({unique_:v1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1e(n,e,t){const s=oe(n,"x","unsortedSegmentSum"),r=oe(e,"segmentIds","unsortedSegmentSum","int32");te(Im(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},a={numSegments:t};return be.runKernel(yT,i,a)}const bH=xe({unsortedSegmentSum_:_1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x1e(n,e=0){const t=oe(n,"x","unstack","string_or_numeric");te(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return be.runKernel(gT,s,r)}const Of=xe({unstack_:x1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1e(n,e=!0,t,s){return be.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _H(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=zt(n,"int32"),r=zt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const a=s.indexToLoc(t[i]),o=i*n.length;r.values.set(a,o)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1e(n,e,t){const s=oe(n,"x","transpose");if(e==null&&(e=s.shape.map((a,o)=>o).reverse()),te(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(a=>{te(a>=0&&a<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?ke(()=>{let a=i1(s),o=j$(s);return a=be.runKernel(um,{x:a},i),o=be.runKernel(um,{x:o},i),t&&(o=Ts(o)),km(a,o)}):be.runKernel(um,r,i)}const on=xe({transpose_:T1e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1e(n,e){if(e==null)return n.shape.slice();if(xn(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1e(n,e,t,s){const r=oe(n,"x","dropout");if(te(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),te(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Ks?r.clone():r;const i=S1e(r,t),a=1-e,o=yt(IT(Ke(Kb(i,0,1,"float32",s),a)),a);return ye(r,o)}const N1e=xe({dropout_:E1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1e(n,e,t,s,r,i="NHWC",a){let o=n;n.rank===3&&(o=_e(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]])),te(o.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`),te(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),te(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=i==="NHWC"?o.shape[3]:o.shape[1],h=i==="NHWC"?l.shape[3]:l.shape[1];te(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),te(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),Oi("conv2dDerFilter",r,a);const p={x:o,dy:l},m={strides:s,pad:r,dataFormat:i,dimRoundingMode:a,filterShape:t};return be.runKernel(Z2,p,m)}const Z$=xe({conv2DBackpropFilter_:I1e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ye(n,Zb(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Q$(n,e){let t=e;const s=tr(n.shape,e.shape);return s.length>0&&(t=pt(t,s)),_e(t,n.shape)}function J$(n,e,t,s){if(e==="linear")return n;if(e==="relu")return qf(n);if(e==="elu")return ET(n);if(e==="relu6")return lH(n);if(e==="prelu")return H$(n,t);if(e==="leakyrelu")return B$(n,s);if(e==="sigmoid")return ng(n);throw new Error(`Unknown fused activation ${e}.`)}const eA=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1e({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(l=l||"linear",eA(be.state.gradientDepth,l)===!1){te(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let W=Rf(n,e,t,s,r,i,a);return o!=null&&(W=Ke(W,o)),J$(W,l,c,h)}const p=oe(n,"x","conv2d","float32"),m=oe(e,"filter","conv2d","float32");let v=p,_=!1;p.rank===3&&(_=!0,v=_e(p,[1,p.shape[0],p.shape[1],p.shape[2]])),te(v.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${v.rank}.`),te(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Oi("fused conv2d",s,a);const w=r==="NHWC"?v.shape[3]:v.shape[1];te(m.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${m.shape[2]}.`),te(qr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const T=Er(v.shape,m.shape,t,i,s,a);let E;o!=null&&(E=oe(o,"bias","fused conv2d"),[E]=Es(E,p),r==="NHWC"?Dt(T.outShape,E.shape):(te(E.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${E.shape.length}.`),te(E.shape.length===0||E.shape[0]===T.outChannels||E.shape[0]===1,()=>`Error in fused conv2d: bias shape (${E.shape}) is not compatible with the number of output channels (${T.outChannels})`)));let C;if(c!=null){const W=c.shape;if(te(W.length<=1||W.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${W.length}.`),W.length===1)te(W[0]===1||W[0]===T.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${W}) is not compatible with the number of output channels (${T.outChannels}).`);else if(W.length===3)try{Dt(W,T.outShape)}catch{const P=`Error in fused conv2d: PReLU activation weights (${W}) is not compatible with the output shape of the conv2d (${T.outShape}).`;throw Error(P)}C=oe(c,"prelu weights","fused conv2d")}const A=(W,B)=>{te(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[P,O,M,k]=B,V=Y$(W,M,l);te($f(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const G=L$(O.shape,V,P,t,s),ae=Z$(O,V,P.shape,t,s),J=[G,ae];if(k!=null){const X=Q$(k,V);J.push(X)}return J},D={x:v,filter:m,bias:E,preluActivationWeights:C},F={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:a,activation:l,leakyreluAlpha:h};return o==null?Am((B,P,O)=>{let M=be.runKernel(J0,D,F);return O([P,B,M]),_&&(M=_e(M,[M.shape[1],M.shape[2],M.shape[3]])),{value:M,gradFunc:A}})(v,m):Am((B,P,O,M)=>{let k=be.runKernel(J0,D,F);return M([P,B,k,O]),_&&(k=_e(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:A}})(v,m,E)}const k1e=xe({fusedConv2d_:C1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1e(n,e,t,s,r,i=[1,1],a){let o=n;n.rank===3&&(o=_e(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:o,dy:l},h={strides:s,pad:r,dimRoundingMode:a,dilations:i,filterShape:t};return be.runKernel(s$,c,h)}const A1e=xe({depthwiseConv2dNativeBackpropFilter_:$1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1e(n,e,t,s,r,i=[1,1],a){let o=e,l=!1;e.rank===3&&(l=!0,o=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:o,filter:t},h={strides:s,pad:r,dimRoundingMode:a,dilations:i,inputShape:n},p=be.runKernel(r$,c,h);return l?_e(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const D1e=xe({depthwiseConv2dNativeBackpropInput_:R1e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L1e({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:a,leakyreluAlpha:o=.2}){if(eA(be.state.gradientDepth,i)===!1){let k=bn(n,e,t,s);return r!=null&&(k=Ke(k,r)),J$(k,i,a,o)}let l=oe(n,"a","fused matMul"),c=oe(e,"b","fused matMul");[l,c]=Es(l,c);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],p=s?c.shape[c.rank-1]:c.shape[c.rank-2],m=t?l.shape[l.rank-1]:l.shape[l.rank-2],v=s?c.shape[c.rank-2]:c.shape[c.rank-1],_=l.shape.slice(0,-2),w=c.shape.slice(0,-2),T=Me(_),E=Me(w);te(h===p,()=>`Error in fused matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${s} must match.`);const A=Dt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([m,v]),D=t?_e(l,[T,h,m]):_e(l,[T,m,h]),F=s?_e(c,[E,v,p]):_e(c,[E,p,v]);let W;r!=null&&(W=oe(r,"bias","fused matMul"),[W]=Es(W,l),Dt(A,W.shape));let B;a!=null&&(B=oe(a,"prelu weights","fused matMul"));const P=(k,V)=>{const[G,ae,J,X]=V,se=Y$(_e(k,J.shape),J,i);let ne,le;if(!t&&!s?(ne=bn(se,ae,!1,!0),le=bn(G,se,!0,!1)):!t&&s?(ne=bn(se,ae,!1,!1),le=bn(se,G,!0,!1)):t&&!s?(ne=bn(ae,se,!1,!0),le=bn(G,se,!1,!1)):(ne=bn(ae,se,!0,!0),le=bn(se,G,!0,!0)),r!=null){const K=Q$(X,se);return[ne,le,K]}else return[ne,le]},O={a:D,b:F,bias:W,preluActivationWeights:B},M={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:o};return r==null?Am((V,G,ae)=>{const J=be.runKernel(Q0,O,M);return ae([V,G,J]),{value:_e(J,A),gradFunc:P}})(D,F):Am((V,G,ae,J)=>{const X=be.runKernel(Q0,O,M);return J([V,G,X,ae]),{value:_e(X,A),gradFunc:P}})(D,F,W)}const e3=xe({fusedMatMul_:L1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1e(n,e,t,s,r="bilinear",i=0){const a=oe(n,"image","cropAndResize"),o=oe(e,"boxes","cropAndResize","float32"),l=oe(t,"boxInd","cropAndResize","int32"),c=o.shape[0];te(a.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`),te(o.rank===2&&o.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${o.shape}.`),te(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${o.shape}.`),te(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),te(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),te(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:a,boxes:o,boxInd:l},p={method:r,extrapolationValue:i,cropSize:s};return be.runKernel(e$,h,p)}const P1e=xe({cropAndResize_:O1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M1e(n){const e=oe(n,"image","flipLeftRight","float32");te(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return be.runKernel(c$,t,{})}const F1e=xe({flipLeftRight_:M1e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j1e(n){const e=oe(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];te(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),te(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Bo(e,r)}const B1e=xe({grayscaleToRGB_:j1e});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1e(n){const e=oe(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];te(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),te(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=tt(e,"float32"),a=Xi([.2989,.587,.114]);let o;switch(e.rank){case 2:o=uy("ij,j->i",i,a);break;case 3:o=uy("ijk,k->ij",i,a);break;case 4:o=uy("ijkl,l->ijk",i,a);break;case 5:o=uy("ijklm,m->ijkl",i,a);break;case 6:o=uy("ijklmn,n->ijklm",i,a);break;default:throw new Error("Not a valid tensor rank.")}return o=$i(o,-1),tt(o,r)}const V1e=xe({rgbToGrayscale_:z1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U1e(n,e,t=0,s=.5){const r=oe(n,"image","rotateWithOffset","float32");te(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},a={radians:e,fillValue:t,center:s};return be.runKernel(C$,i,a)}const G1e=xe({rotateWithOffset_:U1e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rg(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const a=n.shape[0];return t=Math.min(t,a),te(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),te(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),te(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),te(e.rank===1,()=>"scores must be a 1D tensor"),te(e.shape[0]===a,()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${e.shape[0]}`),te(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W1e(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=oe(n,"boxes","nonMaxSuppression","float32"),a=oe(e,"scores","nonMaxSuppression","float32"),o=rg(i,a,t,s,r);t=o.maxOutputSize,s=o.iouThreshold,r=o.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return be.runKernel(m$,{boxes:i,scores:a},l)}const H1e=xe({nonMaxSuppression_:W1e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q1e(n,e,t){const s=K1e(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function K1e(n,e,t){return Z1e(n,e,t||X1e)}function X1e(n,e){return n>e?1:n<e?-1:0}function Z1e(n,e,t){let s=0,r=n.length,i=0,a=!1;for(;s<r;){i=s+(r-s>>>1);const o=t(e,n[i]);o>0?s=i+1:(r=i,a=!o)}return a?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(n,e,t,s,r){return rA(n,e,t,s,r,0)}function nA(n,e,t,s,r,i){return rA(n,e,t,s,r,0,!1,i,!0)}function sA(n,e,t,s,r,i){return rA(n,e,t,s,r,i,!0)}function rA(n,e,t,s,r,i,a=!1,o=!1,l=!1){const c=[];for(let T=0;T<e.length;T++)e[T]>r&&c.push({score:e[T],boxIndex:T,suppressBeginIndex:0});c.sort(t3);const h=i>0?-.5/i:0,p=[],m=[];for(;p.length<t&&c.length>0;){const T=c.pop(),{score:E,boxIndex:C,suppressBeginIndex:A}=T;if(E<r)break;let D=!1;for(let F=p.length-1;F>=A;--F){const W=Y1e(n,C,p[F]);if(W>=s){D=!0;break}if(T.score=T.score*Q1e(s,h,W),T.score<=r)break}T.suppressBeginIndex=p.length,D||(T.score===E?(p.push(C),m.push(T.score)):T.score>r&&q1e(c,T,t3))}const v=p.length,_=t-v;o&&_>0&&(p.push(...new Array(_).fill(0)),m.push(...new Array(_).fill(0)));const w={selectedIndices:p};return a&&(w.selectedScores=m),l&&(w.validOutputs=v),w}function Y1e(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),a=Math.min(s[1],s[3]),o=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),p=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),v=(o-i)*(l-a),_=(p-c)*(m-h);if(v<=0||_<=0)return 0;const w=Math.max(i,c),T=Math.max(a,h),E=Math.min(o,p),C=Math.min(l,m),A=Math.max(E-w,0)*Math.max(C-T,0);return A/(v+_-A)}function Q1e(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function t3(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function J1e(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=oe(n,"boxes","nonMaxSuppressionAsync"),a=oe(e,"scores","nonMaxSuppressionAsync"),o=rg(i,a,t,s,r);t=o.maxOutputSize,s=o.iouThreshold,r=o.scoreThreshold;const l=await Promise.all([i.data(),a.data()]),c=l[0],h=l[1],{selectedIndices:p}=tA(c,h,t,s,r);return i!==n&&i.dispose(),a!==e&&a.dispose(),Xi(p,"int32")}const ewe=J1e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function twe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const a=oe(n,"boxes","nonMaxSuppression"),o=oe(e,"scores","nonMaxSuppression"),l=rg(a,o,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:a,scores:o},h={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},p=be.runKernel(y$,c,h);return{selectedIndices:p[0],selectedScores:p[1]}}const nwe=xe({nonMaxSuppressionWithScore_:twe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function swe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const a=oe(n,"boxes","nonMaxSuppressionAsync"),o=oe(e,"scores","nonMaxSuppressionAsync"),l=rg(a,o,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([a.data(),o.data()]),h=c[0],p=c[1],{selectedIndices:m,selectedScores:v}=sA(h,p,t,s,r,i);return a!==n&&a.dispose(),o!==e&&o.dispose(),{selectedIndices:Xi(m,"int32"),selectedScores:Xi(v)}}const rwe=swe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iwe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const a=oe(n,"boxes","nonMaxSuppression"),o=oe(e,"scores","nonMaxSuppression"),l=rg(a,o,t,s,r,null),c=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,m={boxes:a,scores:o},v={maxOutputSize:c,iouThreshold:h,scoreThreshold:p,padToMaxOutputSize:i},_=be.runKernel(g$,m,v);return{selectedIndices:_[0],validOutputs:_[1]}}const awe=xe({nonMaxSuppressionPadded_:iwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function owe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const a=oe(n,"boxes","nonMaxSuppressionAsync"),o=oe(e,"scores","nonMaxSuppressionAsync"),l=rg(a,o,t,s,r,null),c=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,[m,v]=await Promise.all([a.data(),o.data()]),{selectedIndices:_,validOutputs:w}=nA(m,v,c,h,p,i);return a!==n&&a.dispose(),o!==e&&o.dispose(),{selectedIndices:Xi(_,"int32"),validOutputs:_n(w,"int32")}}const lwe=owe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cwe(n,e,t=!1,s=!1){const r=oe(n,"images","resizeBilinear");te(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),te(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),te(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,a=!1;r.rank===3&&(a=!0,i=_e(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const o={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},c=be.runKernel(lT,o,l);return a?_e(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const xH=xe({resizeBilinear_:cwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uwe(n,e,t=!1,s=!1){const r=oe(n,"images","resizeNearestNeighbor");te(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),te(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),te(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),te(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,a=!1;r.rank===3&&(a=!0,i=_e(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const o={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},c=be.runKernel(oT,o,l);return a?_e(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const wH=xe({resizeNearestNeighbor_:uwe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hwe(n,e="binary",t=!1,s=.5){const r=oe(n,"image","threshold"),i=.2989,a=.587,o=.114,l=r.shape[0]*r.shape[1];let c=ye(Xi([s]),255),h,p,m,v;if(te(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),te(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),te(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),te(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[h,p,m]=Ia(r,[1,1,1],-1);const T=ye(h,i),E=ye(p,a),C=ye(m,o);v=Ke(Ke(T,E),C)}else v=n;if(e==="otsu"){const T=N_e(tt(cH(v),"int32"),P5([]),256);c=dwe(T,l)}const _=t?sg(v,c):$a(v,c);return tt(ye(_,255),"int32")}function dwe(n,e){let t=Xi([-1]),s=Xi([0]),r=Xi([0]),i,a,o,l,c,h;for(let p=0;p<n.size-1;p++){i=Un(n,0,p+1),a=Un(n,p+1),c=yt(pt(i),e),h=yt(pt(a),e);const m=pt(ye(i,uv(0,i.size)));o=yt(m,pt(i));const v=ST(a.shape,i.size),_=Ke(uv(0,a.size),v),w=ye(a,_);l=yt(pt(w),pt(a));const T=_t(o,l),E=_t(o,l),C=ye(c,h);r=ye(ye(C,T),E);const A=$a(r,s);s=mi(A,r,s),t=mi(A,Xi([p]),t)}return t}const fwe=xe({threshold_:hwe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pwe(n,e,t="nearest",s="constant",r=0,i){const a=oe(n,"image","transform","float32"),o=oe(e,"transforms","transform","float32");te(a.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`),te(o.rank===2&&(o.shape[0]===a.shape[0]||o.shape[0]===1)&&o.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),te(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:a,transforms:o},c={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return be.runKernel(N$,l,c)}const mwe=xe({transform_:pwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gwe(n,e,t){const s=oe(n,"a","bandPart");te(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,a]=s.shape.slice(-2);let o,l;typeof e=="number"?(te(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),te(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),o=oe(e<0?i:e,"numLower","bandPart")):(te(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),o=mi(s1(e,0),i,cv(e,i))),typeof t=="number"?(te(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),te(t<=a,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${a}).`),l=oe(t<0?a:t,"numUpper","bandPart")):(te(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=mi(s1(t,0),a,cv(t,a)));const c=_e(uv(0,i,1,"int32"),[-1,1]),h=uv(0,a,1,"int32"),p=_t(c,h),m=Zc(sg(p,o),Hf(p,Ts(l))),v=ur([i,a],s.dtype);return _e(Yc(Of(_e(s,[-1,i,a])).map(_=>mi(m,_,v))),r)}const ywe=xe({bandPart_:gwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vwe(n){let e;if(Array.isArray(n)){e=!1,te(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)te(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=Ia(n,n.shape[0],0).map(r=>Xb(r,[0]));te(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(be.tidy(()=>{let i=s[r];if(r>0)for(let a=0;a<r;++a){const o=ye(pt(ye(t[a],i)),t[a]);i=_t(i,o)}return yt(i,NT(i,"euclidean"))}));return e?Yc(t,0):t}const bwe=xe({gramSchmidt_:vwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _we(n,e=!1){if(te(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return n3(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),s=Of(_e(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[c,h]=n3(l,e);r.push(c),i.push(h)});const a=_e(Yc(r,0),n.shape),o=_e(Yc(i,0),n.shape);return[a,o]}}function n3(n,e=!1){return be.tidy(()=>{te(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=tH(t),i=lf(n);const a=dN([[1]],[1,1]);let o=lf(a);const l=t>=s?s:t;for(let c=0;c<l;++c){const h=i,p=o,m=r;[o,i,r]=be.tidy(()=>{const v=Un(i,[c,c],[t-c,1]),_=NT(v),w=Un(i,[c,c],[1,1]),T=mi($a(w,0),dN([[-1]]),dN([[1]])),E=_t(w,ye(T,_)),C=yt(v,E);C.shape[0]===1?o=lf(a):o=Ri([a,Un(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const A=Ts(yt(bn(T,E),_)),D=Un(i,[c,0],[t-c,s]),F=ye(A,o),W=on(o);if(c===0)i=_t(D,bn(F,bn(W,D)));else{const O=_t(D,bn(F,bn(W,D)));i=Ri([Un(i,[0,0],[c,s]),O],0)}const B=on(F),P=Un(r,[0,c],[t,r.shape[1]-c]);if(c===0)r=_t(P,bn(bn(P,o),B));else{const O=_t(P,bn(bn(P,o),B));r=Ri([Un(r,[0,0],[t,c]),O],1)}return[o,i,r]}),Ht([h,p,m])}return!e&&t>s&&(r=Un(r,[0,0],[t,s]),i=Un(i,[0,0],[s,s])),[r,i]})}const xwe=xe({qr_:_we});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fc={flipLeftRight:F1e,grayscaleToRGB:B1e,resizeNearestNeighbor:wH,resizeBilinear:xH,rgbToGrayscale:V1e,rotateWithOffset:G1e,cropAndResize:P1e,nonMaxSuppression:H1e,nonMaxSuppressionAsync:ewe,nonMaxSuppressionWithScore:nwe,nonMaxSuppressionWithScoreAsync:rwe,nonMaxSuppressionPadded:awe,nonMaxSuppressionPaddedAsync:lwe,threshold:fwe,transform:mwe},wwe={bandPart:ywe,gramSchmidt:bwe,qr:xwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Twe=new Map,Swe=new Map;class ig{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class so{constructor(){this.classNameMap={}}static getMap(){return so.instance==null&&(so.instance=new so),so.instance}static register(e){so.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function We(n,e,t){te(n.className!=null,()=>"Class being registered does not have the static className property defined."),te(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),te(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return so.register(n),Twe.set(r,n),Swe.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class id extends ig{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const a=s.map(o=>({name:o.name,tensor:i[o.name]}));this.applyGradients(a)}else this.applyGradients(i);return Ht(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return qxe(e,t)}dispose(){this.iterations_!=null&&Ht(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:_n(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(id,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TH extends id{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=be.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=be.registeredVariables[s],a=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ke(()=>ln(i).variable(a))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ke(()=>ln(i).variable(a))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;ke(()=>{const h=Ke(ye(l,this.rho),ye(Jn(o),1-this.rho)),p=ye(yt(Wr(Ke(c,this.epsilon)),Wr(Ke(l,this.epsilon))),o),m=Ke(ye(c,this.rho),ye(Jn(p),1-this.rho));l.assign(h),c.assign(m);const v=Ke(ye(p,-this.learningRate),i);i.assign(v)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ht(this.accumulatedGrads.map(e=>e.variable)),Ht(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SH extends id{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=be.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ke(()=>ST(i.shape,this.initialAccumulatorValue).variable(!1))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const o=this.accumulatedGrads[r].variable;ke(()=>{const l=Ke(o,Jn(a));o.assign(l);const c=Ke(ye(yt(a,Wr(Ke(l,be.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ht(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EH extends id{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ke(()=>{this.accBeta1=_n(t).variable(),this.accBeta2=_n(s).variable()}),r==null&&(this.epsilon=be.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ke(()=>{const s=_t(1,this.accBeta1),r=_t(1,this.accBeta2);t.forEach((i,a)=>{const o=be.registeredVariables[i],l=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${i}/m`,variable:ke(()=>ln(o).variable(l))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${i}/v`,variable:ke(()=>ln(o).variable(l))});const c=Array.isArray(e)?e[a].tensor:e[i];if(c==null)return;const h=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,m=Ke(ye(h,this.beta1),ye(c,1-this.beta1)),v=Ke(ye(p,this.beta2),ye(Jn(c),1-this.beta2)),_=yt(m,s),w=yt(v,r);h.assign(m),p.assign(v);const T=Ke(ye(yt(_,Ke(Wr(w),this.epsilon)),-this.learningRate),o);o.assign(T)}),this.accBeta1.assign(ye(this.accBeta1,this.beta1)),this.accBeta2.assign(ye(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ht(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ht(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ke(()=>{this.accBeta1.assign(Df(this.beta1,this.iterations_+1)),this.accBeta2.assign(Df(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NH extends id{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ke(()=>{this.iteration=_n(0).variable(),this.accBeta1=_n(t).variable()}),r==null&&(this.epsilon=be.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ke(()=>{const s=_t(1,this.accBeta1),r=yt(-this.learningRate,Ke(ye(this.iteration,this.decay),1));t.forEach((i,a)=>{const o=be.registeredVariables[i],l=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${i}/m`,variable:ln(o).variable(l)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${i}/v`,variable:ln(o).variable(l)});const c=Array.isArray(e)?e[a].tensor:e[i];if(c==null)return;const h=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,m=Ke(ye(h,this.beta1),ye(c,1-this.beta1)),v=ye(p,this.beta2),_=li(c),w=sd(v,_);h.assign(m),p.assign(w);const T=Ke(ye(yt(r,s),yt(m,Ke(w,this.epsilon))),o);o.assign(T)}),this.iteration.assign(Ke(this.iteration,1)),this.accBeta1.assign(ye(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ht(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ht(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iA extends id{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=be.registeredVariables[s];ke(()=>{const o=Ke(ye(this.c,i),a);a.assign(o)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Bl(_n(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IH extends iA{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=_n(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=be.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ke(()=>ln(i).variable(!1))});const a=this.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[s];o!=null&&ke(()=>{let l;const c=Ke(ye(this.m,a),o);this.useNesterov?l=Ke(ye(this.c,Ke(o,ye(c,this.m))),i):l=Ke(ye(this.c,c),i),a.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ht(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CH extends id{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=be.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=be.registeredVariables[s],a=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ke(()=>ln(i).variable(a))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ke(()=>ln(i).variable(a))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ke(()=>ln(i).variable(a))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;ke(()=>{const h=Ke(ye(l,this.decay),ye(Jn(o),1-this.decay));if(this.centered){const p=this.accumulatedMeanGrads[r].variable,m=Ke(ye(p,this.decay),ye(o,1-this.decay)),v=yt(ye(o,this.learningRate),Wr(_t(h,Ke(Jn(m),this.epsilon)))),_=Ke(ye(c,this.momentum),v);l.assign(h),p.assign(m),c.assign(_);const w=_t(i,_);i.assign(w)}else{const p=Ke(ye(l,this.decay),ye(Jn(o),1-this.decay)),m=Ke(ye(c,this.momentum),yt(ye(o,this.learningRate),Wr(Ke(p,this.epsilon))));l.assign(p),c.assign(m);const v=_t(i,m);i.assign(v)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ht(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ht(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ht(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ewe=[TH,SH,EH,NH,IH,CH,iA];function Nwe(){for(const n of Ewe)We(n)}function aA(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(Me(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let a=1;for(let p=0;p<r.length-1;++p)a*=r[p];const o=n.shape,l=r.slice();l.pop();let c=1;for(let p=i;p<t;++p)c*=o[p],l.push(o[p]);const h=[...ht(n.shape).map(p=>p/c),1].slice(0,i);return[l,a,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tC=-2,Iwe=-1;function oA(n,e,t){const s=n.shape.length;te(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),te(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)te(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function Cwe(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function lA(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function kH(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function $H(n,e,t){return t<=n?t:t-(e-1)}function AH(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function kwe(n,e,t,s,r,i,a,o,l){const c=n.length;let h=new Array(c),p=new Array(c),m=new Array(c);if(e.length&&t>0){const v=e[0],_=t+1;h=RH(a,v,_,s,n),p=DH(o,v,_,r,n),m=kH(i,v,_,n)}else for(let v=0;v<c;v++)h[v]=OH(a,s,i,n,v,l),p[v]=PH(o,r,i,n,v,l),m[v]=LH(i,v,l);return{begin:h,end:p,strides:m}}function RH(n,e,t,s,r){const i=[...r],a=AH(t,e);for(let o=0;o<i.length;o++)if(a.indexOf(o)>-1)i[o]=0;else{const l=$H(e,t,o);let c=s[l];n&1<<l&&(c=0),i[o]=c}return i}function DH(n,e,t,s,r){const i=[...r],a=AH(t,e);for(let o=0;o<i.length;o++)if(a.indexOf(o)>-1)i[o]=Number.MAX_SAFE_INTEGER;else{const l=$H(e,t,o);let c=s[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[o]=c}for(let o=0;o<i.length;o++){const l=r[o];i[o]<0&&(i[o]+=l),i[o]=Nf(0,i[o],r[o])}return i}function LH(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function OH(n,e,t,s,r,i){let a=e[r];const o=t[r]||1;(n&1<<r||i&1<<r||a==null)&&(o>0?a=Number.MIN_SAFE_INTEGER:a=Number.MAX_SAFE_INTEGER);const l=s[r];return a<0&&(a+=l),a=Nf(0,a,l-1),a}function PH(n,e,t,s,r,i){let a=e[r];const o=t[r]||1;(n&1<<r||i&1<<r||a==null)&&(o>0?a=Number.MAX_SAFE_INTEGER:a=Number.MIN_SAFE_INTEGER);const l=s[r];return a<0&&(a+=l),o>0?a=Nf(0,a,l):a=Nf(-1,a,l-1),a}function cA(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function uA(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function CT(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(a=>{te(a!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((a,o)=>a>=0?a:(te(a===-1,()=>`Negative size values should be exactly -1 but got ${a} for the slice() size at index ${o}.`),n.shape[o]-s[o])),[s,i]}function hA(n,e,t,s,r,i,a,o,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,a!=null&&(a&a-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const p={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:r,endMask:i,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};for(let A=0;A<p.dims;A++)h&&(1<<A&o)!==0&&p.numAddAxisAfterEllipsis++,1<<A&a&&(h=!0);h||(p.ellipsisMask|=1<<p.dims,p.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};$we(p,m);let v=!0,_=!0,w=!0;const T=[],E=[];for(let A=0;A<n.length;++A){if(m.strides[A]===0)throw Error(`strides[${A}] must be non-zero`);const D=!!(m.shrinkAxisMask&1<<A),F=n[A];if(F===-1){T.push(D?1:-1);continue}const W=[m.beginMask&1<<A,m.endMask&1<<A],B=[m.strides[A]>0?0:-1,m.strides[A]>0?F:F-1];if(D&&m.strides[A]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&m.strides[A]===1;const P=!!(m.beginMask&1<<A&&m.endMask&1<<A);if(m.beginValid&&m.endValid){if(D){const V=m.begin[A]<0?F+m.begin[A]:m.begin[A];if(m.begin[A]=V,m.end[A]=m.begin[A]+1,V<0||V>=F)throw Error(`slice index ${m.begin[A]} of dimension ${A} out of bounds.`)}else m.begin[A]=s3(m.begin[A],0,m.strides[A],F,W,B),m.end[A]=s3(m.end[A],1,m.strides[A],F,W,B);const k=m.strides[A]===1&&m.begin[A]===0&&m.end[A]===F;v=v&&k,_=_&&(A===0&&m.strides[A]===1||k)}else v=v&&m.strides[A]===1&&P,_=_&&(A===0&&m.strides[A]===1||P);let O,M=!1;if(m.beginValid&&m.endValid?(O=m.end[A]-m.begin[A],M=!0):D?(O=1,M=!0):P&&F>=0&&(m.strides[A]<0?O=-F:O=F,M=!0),M){let k;O===0||O<0!=m.strides[A]<0?k=0:k=Math.trunc(O/m.strides[A])+(O%m.strides[A]!==0?1:0),T.push(k)}else T.push(-1)}for(let A=0;A<m.finalShapeGatherIndices.length;++A){const D=m.finalShapeGatherIndices[A];D>=0?E.push(T[D]):D===tC&&E.push(1)}return{finalShapeSparse:E.filter((A,D)=>m.finalShapeGatherIndices[D]!==tC),finalShape:E,isIdentity:v,sliceDim0:_,isSimpleSlice:w,begin:m.begin,end:m.end,strides:m.strides}}function $we(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(tC),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(Iwe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function s3(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const a=n<0?s+n:n;return a<i[0]?i[0]:a>i[1]?i[1]:a}}const Awe=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:oA,computeFlatOffset:uA,computeOutShape:lA,getNormalizedAxes:kwe,isSliceContinous:cA,maskToAxes:Cwe,parseSliceParams:CT,sliceInfo:hA,startForAxis:OH,startIndicesWithElidedDims:RH,stopForAxis:PH,stopIndicesWithElidedDims:DH,stridesForAxis:LH,stridesWithElidedDims:kH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rwe{static sgd(e){return new iA(e)}static momentum(e,t,s=!1){return new IH(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new CH(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new EH(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new TH(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new NH(e,t,s,r,i)}static adagrad(e,t=.1){return new SH(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fp=Rwe;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dwe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function MH(){return new Promise(n=>Dwe(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n,e){const t=n[0].length;n.forEach((r,i)=>{te(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),te(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let a=0;a<t;a++)te(a===e||r[a]===s[a],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function zl(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fo;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Fo||(Fo={}));function FH(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],a=s[s.length-t.length+r],o=s[a];if(i>=0)if(o>=0){if(o!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${o}`)}else s[a]=i}return s}function jH(n){const e={FIRST_DIM_SIZE:Fo.FIRST_DIM_SIZE,VALUE_ROWIDS:Fo.VALUE_ROWIDS,ROW_LENGTHS:Fo.ROW_LENGTHS,ROW_SPLITS:Fo.ROW_SPLITS,ROW_LIMITS:Fo.ROW_LIMITS,ROW_STARTS:Fo.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function BH(n){return n.length===0?0:n[0]===Fo.FIRST_DIM_SIZE?n.length-1:n.length}function zH(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],a=e[r+1];if(i>=0&&a>=0&&i!==1&&i!==a)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${a}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fA=30;function kT(n){return n<=fA?n:jI(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yb(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let a=0;a<i;++a)r=r.concat([n[a+1]/e[a],e[a]]);r=r.concat(n.slice(i+1))}return r}function Qb(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let a=1;a<n;++a)a>=e*2+1||a%2===1?i.push(a):r.push(a);s.push(...r),s.push(0),s.push(...i)}return s}function Jb(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function mA(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function gA(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $T=1.7580993408473768,AT=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yA=.3275911,vA=.254829592,bA=-.284496736,_A=1.421413741,xA=-1.453152027,wA=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qc(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function VH(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function UH(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function GH(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function TA(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function WH(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function HH(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function qH(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fN="->",Lwe=/->/g,r3=",",i3="...";function SA(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Lwe,"").length)/fN.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${fN}").`);const[s,r]=n.split(fN);te(s.indexOf(i3)===-1,()=>`The ellipsis notation ("${i3}") is not supported yet.`);const i=s.split(r3),a=i.length;if(e!==a)throw new Error(`Expected ${a} input tensors, received ${e}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let m=0;m<r.length;++m){const v=r[m];if(!i.some(_=>_.indexOf(v)!==-1))throw new Error(`Output subscripts contain the label ${v} not present in the input subscripts.`);o.indexOf(v)===-1&&o.push(v)}for(let m=0;m<s.length;++m){const v=s[m];o.indexOf(v)===-1&&v!==r3&&o.push(v)}const l=new Array(i.length);for(let m=0;m<a;++m){if(new Set(i[m].split("")).size!==i[m].length)throw new Error(`Found duplicate axes in input component ${i[m]}. Support for duplicate axes in input is not implemented yet.`);l[m]=[];for(let v=0;v<i[m].length;++v)l[m].push(o.indexOf(i[m][v]))}const c=o.length,h=r.length,p=[];for(let m=h;m<c;++m)p.push(m);return{allDims:o,summedDims:p,idDims:l}}function EA(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function NA(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let a=0;a<e[r].length;++a)s[e[r][a]]===void 0?s[e[r][a]]=i[a]:te(s[e[r][a]]===i[a],()=>`Expected dimension ${s[e[r][a]]} at axis ${a} of input shaped ${JSON.stringify(i)}, but got dimension ${i[a]}`)}}function IA(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let a=0;a<r;++a)s.push([]);const i=[];for(let a=0;a<t.length;++a){const o=t[a],l=Owe(e,o);for(const c of l)i.indexOf(c)===-1&&(s[a].push(c),i.push(c))}return{path:t,steps:s}}function CA(n){return n.every((e,t)=>e===t)}function Owe(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function kA(n,e,t=0){let s=[];if(typeof e=="number")te(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((a,o)=>(o===-1&&(a+=1),a),0);te(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const a=e.reduce((o,l)=>l>0?o+l:o);e[i]=n.shape[t]-a}te(n.shape[t]===e.reduce((a,o)=>a+o),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KH(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function XH(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function ZH(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YH(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function QH(n,e){return`size ${n} must be non-negative, not ${e}`}function JH(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function eq(n,e){const t=Me(n),s=Me(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function tq(n,e){const t=Me(n),s=Me(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nC(){return"segment ids must be >= 0"}function nq(){return"segment ids are not increasing"}function sq(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function rq(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(n,e){let t=!1,s;for(n<=fA?(s=n,t=!0):s=jI(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=jI(n,s+1);return s}function aq(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function $A(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let p=0;p<s;++p)if(n.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${n.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);const a=n.shape[t],o=[];let l=1,c=1,h=1;for(let p=0;p<s;++p)o.push(n.shape[p]),l*=n.shape[p];for(let p=s;p<t;p++)o.push(n.shape[p]),c*=n.shape[p];for(let p=s;p<r;p++)o.push(e.shape[p]);for(let p=t+1;p<i;p++)o.push(n.shape[p]),h*=n.shape[p];return{batchSize:l,sliceSize:h,outerSize:c,dimSize:a,outputShape:o}}const Pwe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:$A,computeOutShape:aq,segOpComputeOptimalWindowSize:iq},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jc(n){try{return n.map(e=>Fh(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function oq(n){return n.map(e=>wh(e))}const Mwe=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:vA,ERF_A2:bA,ERF_A3:_A,ERF_A4:xA,ERF_A5:wA,ERF_P:yA,PARALLELIZE_THRESHOLD:fA,get RowPartitionType(){return Fo},SELU_SCALE:AT,SELU_SCALEALPHA:$T,applyActivation:J$,assertAndGetBroadcastShape:Dt,assertAxesAreInnerMostDims:Nr,assertParamsConsistent:dA,assignToTypedArray:WH,axesAreInnerMostDims:M$,calculateShapes:Kf,checkEinsumDimSizes:NA,checkPadOnDimRoundingMode:Oi,combineLocations:J5,combineRaggedTensorToTensorShapes:FH,complexWithEvenIndex:UH,complexWithOddIndex:GH,computeConv2DInfo:Er,computeConv3DInfo:td,computeDefaultPad:A$,computeDilation2DInfo:Hb,computeOptimalWindowSize:kT,computeOutAndReduceShapes:fr,computeOutShape:zl,computePool2DInfo:ho,computePool3DInfo:ru,convertConv2DDataFormat:iu,decodeEinsumEquation:SA,eitherStridesOrDilationsAreOne:qr,expandShapeToKeepDim:Bs,exponent:qH,exponents:HH,fromStringArrayToUint8:oq,fromUint8ToStringArray:Jc,getAxesPermutation:fs,getBroadcastDims:$m,getComplexWithIndex:TA,getEinsumComputePath:IA,getEinsumPermutation:EA,getFusedBiasGradient:Q$,getFusedDyActivation:Y$,getImageCenter:pA,getInnerMostAxes:Is,getPermuted:Qb,getRaggedRank:BH,getReductionAxes:tr,getReshaped:Yb,getReshapedPermuted:Jb,getRowPartitionTypesHelper:jH,getSliceBeginCoords:mA,getSliceSize:gA,getSparseFillEmptyRowsIndicesDenseShapeMismatch:KH,getSparseFillEmptyRowsNegativeIndexErrorMessage:XH,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:ZH,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:JH,getSparseReshapeInputOutputMismatchErrorMessage:tq,getSparseReshapeInputOutputMultipleErrorMessage:eq,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:YH,getSparseReshapeNegativeOutputDimErrorMessage:QH,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:rq,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:nC,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:nq,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:sq,getUndoAxesPermutation:nd,isIdentityPermutation:CA,log:Pve,mergeRealAndImagArrays:Qc,prepareAndValidate:aA,prepareSplitSize:kA,segment_util:Pwe,shouldFuse:eA,slice_util:Awe,splitRealAndImagArrays:VH,stridesOrDilationsArePositive:Af,tupleValuesAreOne:$f,upcastType:Qi,validateDefaultValueShape:zH,validateInput:p1e,validateUpdateShape:yH,warn:Ta},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Nwe();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq={kernelName:bw,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,Zb(tt(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fwe={kernelName:Yv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Jn(tt(t,"float32")),r=Wr(_t(_n(1),s));return Ts(yt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jwe={kernelName:Qv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Wr(_t(Jn(tt(t,"float32")),1));return yt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bwe={kernelName:eg,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{let o=n;const l=tr(t.shape,r);return l.length>0&&(o=pt(o,l)),_e(o,t.shape)},b:()=>{let o=n;const l=tr(s.shape,r);return l.length>0&&(o=pt(o,l)),_e(o,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zwe={kernelName:V2,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vwe={kernelName:_w,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uwe={kernelName:xw,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gwe={kernelName:Jv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,Wr(_t(_n(1),Jn(tt(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wwe={kernelName:eb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Wr(Ke(_n(1),Jn(tt(t,"float32"))));return yt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hwe={kernelName:sb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const o=Ke(Jn(t),Jn(s));let l=ye(n,yt(s,o));const c=tr(t.shape,r);return c.length>0&&(l=pt(l,c)),_e(l,t.shape)},b:()=>{const o=Ke(Jn(t),Jn(s));let l=Ts(ye(n,yt(t,o)));const c=tr(s.shape,r);return c.length>0&&(l=pt(l,c)),_e(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qwe={kernelName:tb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,Ke(Jn(tt(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kwe={kernelName:nb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,_t(_n(1),Jn(tt(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xwe(n,e,t,s,r,i){const a=oe(n,"dy","avgPool3dGrad"),o=oe(e,"input","avgPool3dGrad");let l=a,c=o,h=!1;o.rank===4&&(h=!0,l=_e(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),te(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),te(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Oi("avgPool3dGrad",r,i);const p={dy:l,input:c},m={filterSize:t,strides:s,pad:r,dimRoundingMode:i},v=be.runKernel(H2,p,m);return h?_e(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const Zwe=xe({avgPool3dGrad_:Xwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ywe={kernelName:Tw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:o}=t;return{x:()=>Zwe(n,s,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qwe(n,e,t,s,r){const i=oe(n,"dy","avgPoolGrad"),a=oe(e,"input","avgPoolGrad");te(a.rank===i.rank,()=>`Rank of input (${a.rank}) does not match rank of dy (${i.rank})`);let o=a,l=i,c=!1;a.rank===3&&(c=!0,o=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]])),te(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),te(o.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`);const h={dy:l,input:o},p={filterSize:t,strides:s,pad:r},m=be.runKernel(W2,h,p);return c?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Jwe=xe({avgPoolGrad_:Qwe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eTe={kernelName:ww,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:a}=t;return{x:()=>Jwe(n,s,r,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tTe={kernelName:Sw,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:a}=t;return!i&&!a?{a:()=>bn(n,r,!1,!0),b:()=>bn(s,n,!0,!1)}:!i&&a?{a:()=>bn(n,r,!1,!1),b:()=>bn(n,s,!0,!1)}:i&&!a?{a:()=>bn(r,n,!1,!0),b:()=>bn(s,n,!1,!1)}:{a:()=>bn(r,n,!0,!0),b:()=>bn(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nTe={kernelName:Ew,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>W$(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sTe={kernelName:Rve,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,a=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])a[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const o=[];for(let l=0;l<a.length;l++)a[l]>1&&o.push(l);return{x:()=>pt(n,o,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rTe={kernelName:rb,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iTe={kernelName:ib,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aTe={kernelName:ab,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>mi(Zc(Hf(s,r),sg(s,i)),n,ln(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oTe={kernelName:Nw,inputsToSave:["x"],gradFunc:lq.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lTe={kernelName:Iw,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=Vt(r,e[0].shape)[0],a=s.map(l=>l[i]);return Ia(n,a,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cTe={kernelName:Cw,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:a,pad:o,dataFormat:l}=t;return te($f(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>L$(s.shape,n,r,a,o,l),filter:()=>Z$(s,n,r.shape,a,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uTe={kernelName:kw,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:a,dataFormat:o,dimRoundingMode:l}=t;return{dy:()=>Rf(n,r,i,a,o,1,l),filter:()=>Z$(n,s,r.shape,i,a,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hTe(n,e,t,s,r){let i=n;n.rank===4&&(i=_e(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let a=e;a.rank===4&&(a=_e(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),te(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),te(a.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`),te(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),te(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),te(a.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${t[4]}).`);const o={x:i,dy:a},l={strides:s,pad:r,filterShape:t};return be.runKernel(Y2,o,l)}const dTe=xe({conv3DBackpropFilter_:hTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fTe={kernelName:$w,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;te($f(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[a,o]=e;return{x:()=>X5(a.shape,n,o,r,i),filter:()=>dTe(a,n,o.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pTe={kernelName:ob,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(Ts(fH(tt(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mTe={kernelName:lb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(pH(tt(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gTe={kernelName:Aw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:a}=t;return{x:()=>{const o=fs([r],s.rank);let l=Y5(n,r,i,!a);return o!=null&&(l=on(l,o)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yTe={kernelName:Rw,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:a}=t,o=s??[1,1];te($f(o),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);const[l,c]=e;return te(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),te(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),te(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),te(qr(r,o),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${o}'.`),Oi("depthwiseConv2d",i,a),{x:()=>D1e(l.shape,n,c,r,i,o,a),filter:()=>A1e(l,n,c.shape,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vTe={kernelName:Dw,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},a={x:s,filter:r,dy:n};return{x:()=>be.runKernel(BI,i,t),filter:()=>be.runKernel(zI,a,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bTe={kernelName:ub,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>be.runKernel(a$,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Te={kernelName:hb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ye(ec(Ts(Jn(t))),2/Math.sqrt(Math.PI));return{x:()=>ye(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xTe={kernelName:db,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wTe={kernelName:Ow,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>_e(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TTe={kernelName:fb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,ec(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const STe={kernelName:pb,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ETe={kernelName:mb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const o=yt(n,tt(s,"float32")),l=tr(t.shape,r);return l.length>0?_e(pt(o,l),t.shape):o},b:()=>{let o=ye(n,tt(t,"float32"));const l=tr(s.shape,r);l.length>0&&(o=_e(pt(o,l),s.shape));const c=Jn(s);return Ts(yt(o,tt(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NTe={kernelName:Pw,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,a,o]=e,l=o??_n(1),c=tr(i.shape,r.shape),h=[];if(i.rank===1){for(let D=0;D<r.shape.length-1;++D)h.push(r.shape[D]);h.push(1)}const p=_t(r,i),m=ye(n,l),v=uH(Ke(a,_n(s))),_=ye(ye(ye(v,v),v),_n(-.5));return{x:()=>i.rank===1?_e(ye(ye(n,Bo(_e(v,[1,1,1,i.shape[0]]),h)),l),r.shape):_e(ye(ye(n,v),l),r.shape),mean:()=>{let D=ye(ye(v,_n(-1)),m);return i.rank===1&&(D=pt(D,c)),_e(D,i.shape)},variance:()=>{let D=ye(ye(_,p),m);return i.rank===1&&(D=pt(D,c)),_e(D,i.shape)},scale:()=>{const D=ye(p,v);let F=ye(n,D);return i.rank===1&&(F=pt(F,c)),_e(F,i.shape)},offset:()=>{let D=n;return i.rank===1&&(D=pt(D,c)),_e(D,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ITe={kernelName:Mw,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:a}=t,o=Vt(i,s.shape)[0],l=(c,h,p)=>()=>{const m=c.shape,v=h.size,_=m.slice(0,o),w=_.length,T=m.slice(i,m.length).slice(1),E=T.length,C=a3(0,w),A=a3(w+1,w+1+E),D=o3([_,[v],T]),F=_e(p,D),W=_e(h,[v]),B=o3([[w],C,A]),P=on(F,B);let O=bH(P,W,c.shape[o]);const M=nd(B);return O=on(O,M),O};if(a===1){const c=s.shape[0],h=s.split(c,0);return{x:()=>Yc(h.map((v,_)=>l(v,r.slice(_,1),n.slice(_,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function a3(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function o3(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CTe={kernelName:gb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ln(t),b:()=>ln(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kTe={kernelName:yb,gradFunc:n=>({x:()=>tt(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Te={kernelName:vb,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ATe={kernelName:bb,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RTe={kernelName:_b,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DTe={kernelName:jw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=$a(s,0);return{x:()=>mi(i,n,ye(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LTe={kernelName:wb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,Ke(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OTe={kernelName:xb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,tt(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PTe={kernelName:Lve,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const a=ec(s);return _t(n,ye(pt(n,r,!0),a))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MTe(n,e,t,s=5,r=1,i=1,a=.5){const o={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:a};return be.runKernel(d$,o,l)}const FTe=xe({localResponseNormalizationBackprop_:MTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jTe={kernelName:Ww,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:a,alpha:o,beta:l}=t;return{x:()=>FTe(s,r,n,i,a,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cq(n,e,t,s){return e.rank<t.rank&&(e=_e(e,Bs(e.shape,s))),n.rank<t.rank&&(n=_e(n,Bs(n.shape,s))),{x:()=>ye(n,tt(Jl(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3={kernelName:Hw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],a=e[1],o=Vt(r,i.shape),l=cq(n,a,i,o);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BTe={kernelName:Tb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ye(n,tt(Hf(t,s),"float32")),b:()=>ye(n,tt(s1(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zTe(n,e,t,s,r,i,a){const o=oe(n,"dy","maxPool3dGrad"),l=oe(e,"input","maxPool3dGrad"),c=oe(t,"output","maxPool3dGrad");let h=o,p=l,m=c,v=!1;l.rank===4&&(v=!0,h=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),p=_e(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),m=_e(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),te(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),te(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),te(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Oi("maxPool3dGrad",i,a);const _={dy:h,input:p,output:m},w={filterSize:s,strides:r,pad:i,dimRoundingMode:a},T=be.runKernel(p$,_,w);return v?_e(T,[T.shape[1],T.shape[2],T.shape[3],T.shape[4]]):T}const VTe=xe({maxPool3dGrad_:zTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe={kernelName:Kw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:a,pad:o,dimRoundingMode:l}=t;return{x:()=>VTe(n,s,r,i,a,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GTe(n,e,t,s,r,i,a){const o=oe(n,"dy","maxPoolGrad"),l=oe(e,"input","maxPoolGrad"),c=oe(t,"output","maxPoolGrad");te(l.rank===o.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`),te(o.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`),te(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Oi("maxPoolGrad",i,a);const h={dy:o,input:l,output:c},p={filterSize:s,strides:r,pad:i,dimRoundingMode:a};return be.runKernel(f$,h,p)}const WTe=xe({maxPoolGrad_:GTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HTe={kernelName:qw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:a,pad:o}=t;return{x:()=>WTe(n,s,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qTe={kernelName:Xw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=Vt(r,s.shape),o=fr(s.shape,i)[1],l=Me(o);return{x:()=>{const h=s.shape.slice();i.forEach(v=>{h[v]=1});const p=_e(n,h);return yt(ye(p,rd(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KTe={kernelName:Zw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,a]=e,o=Vt(r,i.shape),l=cq(n,a,i,o);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XTe={kernelName:Sb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ye(n,tt(sg(t,s),"float32")),b:()=>ye(n,tt($a(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZTe={kernelName:Yw,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(a=>a[0]);return{x:()=>Un(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YTe={kernelName:Eb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const o=tr(t.shape,r);return o.length>0?_e(pt(n,o),t.shape):n},b:()=>{const o=ye(n,Ts(IT(yt(t,s)))),l=tr(s.shape,r);return l.length>0?_e(pt(o,l),s.shape):o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QTe={kernelName:Nb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const o=ye(n,tt(s,"float32")),l=tr(t.shape,r);return l.length>0?_e(pt(o,l),t.shape):o},b:()=>{const o=ye(n,tt(t,"float32")),l=tr(s.shape,r);return l.length>0?_e(pt(o,l),s.shape):o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JTe={kernelName:Qw,gradFunc:n=>({x:()=>Ts(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eSe={kernelName:tT,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>ur(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tSe={kernelName:eT,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nSe={kernelName:nT,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Of(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c3={kernelName:sT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(a=>a[0]);return{x:()=>Un(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sSe={kernelName:Ib,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,a=s,o=Dt(i.shape,a.shape);return{a:()=>{const h=tt(a,"float32");let p=ye(n,ye(h,Df(i,_t(h,_n(1)))));const m=tr(i.shape,o);return m.length>0&&(p=pt(p,m)),_e(p,i.shape)},b:()=>{const h=$a(i,0),p=mi(h,tc(i),ln(i));let m=ye(n,ye(r,p));const v=tr(a.shape,o);return v.length>0&&(m=pt(m,v)),_e(m,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rSe={kernelName:rT,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=$a(t,0);return{x:()=>mi(r,n,ye(n,s)),alpha:()=>{let i=mi(r,ln(n),ye(n,t));const a=tr(s.shape,n.shape);return a.length>0&&(i=pt(i,a)),_e(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(n,e,t){const s=n.shape.slice();s[t]=1;const r=_e(e,s),i=JI(n,t,!0,!1),a=JI(n,t,!0,!0),o=ye(i,a);return ye(r,o)}function aSe(n,e,t){const s=n.shape.length,r=s-t.length,i=fs(t,s);let a=n;i!=null&&(a=on(n,i));const o=a.shape.slice(),c=o.splice(s-t.length,t.length).reduce((m,v)=>m*v,1);o.push(c);const h=a.reshape(o);let p=iSe(h,e,r);if(p=p.reshape(a.shape),i!=null){const m=nd(i);p=on(p,m)}return p}const oSe={kernelName:iT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((a,o)=>o):typeof r=="number"?i=[r]:i=r,{x:()=>aSe(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lSe={kernelName:cb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const o=yt(n,tt(s,"float32")),l=tr(t.shape,r);return l.length>0?_e(pt(o,l),t.shape):o},b:()=>{let o=ye(n,tt(t,"float32"));const l=tr(s.shape,r);l.length>0&&(o=_e(pt(o,l),s.shape));const c=Jn(s);return Ts(yt(o,tt(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cSe={kernelName:Cb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,Ts(Jn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uSe={kernelName:$b,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ye(sg(t,6),Zb(t));return{x:()=>ye(n,tt(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hSe={kernelName:kb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,tt(Zb(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dSe={kernelName:aT,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>_e(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fSe={kernelName:lT,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>be.runKernel(x$,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pSe={kernelName:oT,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>be.runKernel(_$,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mSe={kernelName:cT,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Vt(s,n.shape);return{x:()=>Lf(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gSe={kernelName:Ab,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ySe={kernelName:Rb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ts(yt(n,ye(Df(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vSe={kernelName:uT,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>tt(ln(t),"float32"),t:()=>ye(n,tt(t,n.dtype)),e:()=>ye(n,tt(z$(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bSe={kernelName:Db,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=$a(t,_n(0)),r=_n($T),i=_n(AT),a=ye(n,i),o=ye(ye(n,r),ec(tt(t,"float32")));return mi(s,a,o)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Se={kernelName:Mb,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,ye(t,_t(_n(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xSe={kernelName:Pb,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wSe={kernelName:Lb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(O$(tt(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TSe={kernelName:Ob,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(Z5(tt(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SSe={kernelName:hT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,a=s.shape,[o,l]=CT(s,r,i),c=[];for(let h=0;h<n.rank;h++)c.push([o[h],a[h]-o[h]-l[h]]);return{x:()=>G$(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ESe={kernelName:mT,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,a=ye(n,s);return{logits:()=>_t(a,ye(pt(a,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NSe={kernelName:Fb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,ng(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3={kernelName:fT,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>D$(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h3={kernelName:pT,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Ri(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ISe={kernelName:jb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,ye(Wr(tt(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CSe={kernelName:w$,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,ye(tt(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kSe={kernelName:Bb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_n(2);return{a:()=>ye(n,ye(r,_t(t,s))),b:()=>ye(n,ye(r,_t(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Se={kernelName:Wb,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ASe={kernelName:zb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{let o=n;const l=tr(t.shape,r);return l.length>0&&(o=pt(o,l)),_e(o,t.shape)},b:()=>{let o=n;const l=tr(s.shape,r);return l.length>0&&(o=pt(o,l)),_e(Ts(o),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RSe={kernelName:dT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;Vt(i,s.shape).forEach(c=>{r[c]=1});const o=_e(n,r),l=ye(o,rd(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DSe={kernelName:Vb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yt(n,Jn(O$(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LSe={kernelName:Ub,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(_t(_n(1),Jn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OSe={kernelName:Gb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let a=ln(s);if(s.rank===1)for(let o=0;o<r[0];++o)a=Ke(a,Un(n,[o*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let o=0;o<r[0];++o)for(let l=0;l<r[1];++l)a=Ke(a,Un(n,[o*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let o=0;o<r[0];++o)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)a=Ke(a,Un(n,[o*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let o=0;o<r[0];++o)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let h=0;h<r[3];++h)a=Ke(a,Un(n,[o*s.shape[0],l*s.shape[1],c*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PSe={kernelName:um,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=nd(r);return{x:()=>on(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MSe={kernelName:gT,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Yc(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FSe={kernelName:yT,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>jSe(n,t)}}};function jSe(n,e){const t=sd(e,ln(e)),s=F$(n,t);let r=Hf(e,_n(0,"int32"));const i=s.rank-r.rank;for(let o=0;o<i;++o)r=$i(r,o+1);r=Zc(r,rd(s.shape,"bool"));const a=ln(s);return mi(r,s,a)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BSe={kernelName:vT,gradFunc:n=>({x:()=>ln(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zSe=[lq,Fwe,jwe,Bwe,zwe,Vwe,Uwe,Gwe,Wwe,Hwe,qwe,Kwe,Ywe,eTe,tTe,nTe,sTe,rTe,iTe,aTe,oTe,lTe,uTe,cTe,fTe,pTe,mTe,gTe,yTe,vTe,lSe,bTe,_Te,xTe,wTe,TTe,ETe,STe,NTe,ITe,CTe,kTe,$Te,ATe,RTe,DTe,LTe,OTe,PTe,jTe,l3,l3,BTe,UTe,HTe,qTe,KTe,XTe,ZTe,YTe,QTe,JTe,eSe,tSe,nSe,c3,c3,sSe,rSe,oSe,cSe,uSe,hSe,dSe,fSe,pSe,mSe,gSe,ySe,vSe,bSe,_Se,xSe,wSe,TSe,SSe,ESe,NSe,u3,u3,h3,h3,ISe,kSe,CSe,$Se,ASe,RSe,DSe,LSe,OSe,PSe,MSe,FSe,BSe];for(const n of zSe)Mve(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.abs=function(){return this.throwIfDisposed(),li(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.acos=function(){return this.throwIfDisposed(),jbe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.acosh=function(){return this.throwIfDisposed(),zbe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.add=function(n){return this.throwIfDisposed(),Ke(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.all=function(n,e){return this.throwIfDisposed(),H5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.any=function(n,e){return this.throwIfDisposed(),YI(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.argMax=function(n){return this.throwIfDisposed(),av(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.argMin=function(n){return this.throwIfDisposed(),Hbe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.asScalar=function(){return this.throwIfDisposed(),te(this.size===1,()=>"The array must have only 1 element."),_e(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.asType=function(n){return this.throwIfDisposed(),tt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.as1D=function(){return this.throwIfDisposed(),_e(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.as2D=function(n,e){return this.throwIfDisposed(),_e(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),_e(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),_e(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),_e(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.asin=function(){return this.throwIfDisposed(),Kbe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.asinh=function(){return this.throwIfDisposed(),Zbe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.atan=function(){return this.throwIfDisposed(),Qbe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.atan2=function(n){return this.throwIfDisposed(),e_e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.atanh=function(){return this.throwIfDisposed(),n_e(this)};Pe().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),R$(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),D$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),TT(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.broadcastTo=function(n){return this.throwIfDisposed(),My(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.cast=function(n){return this.throwIfDisposed(),tt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.ceil=function(){return this.throwIfDisposed(),k_e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ka(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Ks&&(n=[n]),Ri([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),q5(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),K5(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Rf(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.cos=function(){return this.throwIfDisposed(),O$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.cosh=function(){return this.throwIfDisposed(),Z5(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),JI(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),Y5(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),exe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),P$(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),sxe(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.divNoNan=function(n){return this.throwIfDisposed(),lxe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.div=function(n){return this.throwIfDisposed(),yt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.dot=function(n){return this.throwIfDisposed(),uxe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.elu=function(){return this.throwIfDisposed(),ET(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.equal=function(n){return this.throwIfDisposed(),Jl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.erf=function(){return this.throwIfDisposed(),Q5(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),wxe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.exp=function(){return this.throwIfDisposed(),ec(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.expandDims=function(n){return this.throwIfDisposed(),$i(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.expm1=function(){return this.throwIfDisposed(),Nxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.fft=function(){return this.throwIfDisposed(),gH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.flatten=function(){return this.throwIfDisposed(),_e(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.floor=function(){return this.throwIfDisposed(),IT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.floorDiv=function(n){return this.throwIfDisposed(),W5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.gather=function(n,e,t){return this.throwIfDisposed(),F$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Hf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.greater=function(n){return this.throwIfDisposed(),$a(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.ifft=function(){return this.throwIfDisposed(),eC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.irfft=function(){return this.throwIfDisposed(),t1e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.isFinite=function(){return this.throwIfDisposed(),Oxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.isInf=function(){return this.throwIfDisposed(),Mxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.isNaN=function(){return this.throwIfDisposed(),jxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.leakyRelu=function(n){return this.throwIfDisposed(),B$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.lessEqual=function(n){return this.throwIfDisposed(),sg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.less=function(n){return this.throwIfDisposed(),s1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),Gxe(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logSigmoid=function(){return this.throwIfDisposed(),Yxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logSoftmax=function(n){return this.throwIfDisposed(),sH(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),rH(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.log=function(){return this.throwIfDisposed(),tc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.log1p=function(){return this.throwIfDisposed(),nH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Zc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logicalNot=function(){return this.throwIfDisposed(),z$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logicalOr=function(n){return this.throwIfDisposed(),iH(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.logicalXor=function(n){return this.throwIfDisposed(),i0e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),bn(this,n,e,t)};Pe().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),V$(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.max=function(n,e){return this.throwIfDisposed(),Go(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.maximum=function(n){return this.throwIfDisposed(),sd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.mean=function(n,e){return this.throwIfDisposed(),Ps(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.min=function(n,e){return this.throwIfDisposed(),n1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.minimum=function(n){return this.throwIfDisposed(),cv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),f0e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.mod=function(n){return this.throwIfDisposed(),m0e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.mul=function(n){return this.throwIfDisposed(),ye(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.neg=function(){return this.throwIfDisposed(),Ts(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.norm=function(n,e,t){return this.throwIfDisposed(),NT(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.notEqual=function(n){return this.throwIfDisposed(),r1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),aH(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.onesLike=function(){return this.throwIfDisposed(),co(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.pad=function(n,e){return this.throwIfDisposed(),G$(this,n,e)};Pe().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),E0e(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.pow=function(n){return this.throwIfDisposed(),Df(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.prelu=function(n){return this.throwIfDisposed(),H$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.prod=function(n,e){return this.throwIfDisposed(),C0e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.reciprocal=function(){return this.throwIfDisposed(),O0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.relu=function(){return this.throwIfDisposed(),qf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.relu6=function(){return this.throwIfDisposed(),lH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.reshapeAs=function(n){return this.throwIfDisposed(),_e(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.reshape=function(n){return this.throwIfDisposed(),_e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),xH(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),wH(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.reverse=function(n){return this.throwIfDisposed(),Lf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.rfft=function(){return this.throwIfDisposed(),r1e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.round=function(){return this.throwIfDisposed(),cH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.rsqrt=function(){return this.throwIfDisposed(),uH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.selu=function(){return this.throwIfDisposed(),hH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),dH(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sigmoid=function(){return this.throwIfDisposed(),ng(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sign=function(){return this.throwIfDisposed(),G0e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sin=function(){return this.throwIfDisposed(),fH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sinh=function(){return this.throwIfDisposed(),pH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.slice=function(n,e){return this.throwIfDisposed(),Un(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.softmax=function(n){return this.throwIfDisposed(),X$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.softplus=function(){return this.throwIfDisposed(),qb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),W$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.split=function(n,e){return this.throwIfDisposed(),Ia(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sqrt=function(){return this.throwIfDisposed(),Wr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.square=function(){return this.throwIfDisposed(),Jn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.squaredDifference=function(n){return this.throwIfDisposed(),a1e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.squeeze=function(n){return this.throwIfDisposed(),Xb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Ks?[this,n]:[this,...n];return Yc(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.step=function(n){return this.throwIfDisposed(),Zb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.stridedSlice=function(n,e,t,s,r,i,a,o){return this.throwIfDisposed(),h1e(this,n,e,t,s,r,i,a,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sub=function(n){return this.throwIfDisposed(),_t(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.sum=function(n,e){return this.throwIfDisposed(),pt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.tan=function(){return this.throwIfDisposed(),f1e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.tanh=function(){return this.throwIfDisposed(),wT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.tile=function(n){return this.throwIfDisposed(),Bo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.toBool=function(){return this.throwIfDisposed(),tt(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.toFloat=function(){return this.throwIfDisposed(),tt(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.toInt=function(){return this.throwIfDisposed(),tt(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.topk=function(n,e){return this.throwIfDisposed(),g1e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.transpose=function(n){return this.throwIfDisposed(),on(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.unique=function(n){return this.throwIfDisposed(),b1e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),bH(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.unstack=function(n){return this.throwIfDisposed(),Of(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.where=function(n,e){return this.throwIfDisposed(),mi(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pe().prototype.zerosLike=function(){return this.throwIfDisposed(),ln(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class El extends Error{constructor(e){super(e),Object.setPrototypeOf(this,El.prototype)}}class io extends Error{constructor(e){super(e),Object.setPrototypeOf(this,io.prototype)}}class me extends Error{constructor(e){super(e),Object.setPrototypeOf(this,me.prototype)}}class Ot extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ot.prototype)}}class AA extends Error{constructor(e){super(e),Object.setPrototypeOf(this,AA.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class uq{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pf(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Nl(n,e){if(!n)throw new AA(e)}function d3(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Ai(n){return n.length===1?n[0]:n}function En(n){return Array.isArray(n)?n:[n]}function Rc(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Xd(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Ya={};function RA(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function sC(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>sC(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:sC(s))}}}function e_(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let a;if(i in t)a=t[i];else if(i in Ya)a=Ya[i];else if(a=e[i],a==null)throw new me(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return a}else{const i=n;if(i.className==null||i.config==null)throw new me(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const a=i.className;let o,l;if(a in t?[o,l]=t[a]:a in Ya?[o,l]=Ya.className:a in e&&([o,l]=e[a]),o==null)throw new me(`Unknown ${s}: ${a}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const v of Object.keys(Ya))c[v]=Ya[v];for(const v of Object.keys(t))c[v]=t[v];const h=i.config;h.customObjects=c;const p=Object.assign({},Ya);for(const v of Object.keys(t))Ya[v]=t[v];sC(i.config);const m=l(o,i.config,t,r);return Ya=Object.assign({},p),m}else{const c=Object.assign({},Ya);for(const p of Object.keys(t))Ya[p]=t[p];const h=new o(i.config);return Ya=Object.assign({},c),h}}}function VSe(n,e){return n<e?-1:n>e?1:0}function Cx(n,e){return-1*VSe(n,e)}function Th(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function USe(n){if(n==null)throw new me(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Xf(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new me(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function DA(n,e,t=0,s=1/0){return Nl(t>=0),Nl(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function hr(n,e){Array.isArray(n)?(te(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>hr(t,`element ${s+1} of ${e}`))):te(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${hq(n)}.`)}function hq(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>hq(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function GSe(n,e,t){let s=t!=null?t():ki(),r;return(...a)=>{const o=t!=null?t():ki();return o-s<e||(s=o,r=n(...a)),r}}function dq(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let WSe=0;function fq(){return WSe++}const kx={};function RT(n=""){return n in kx||(kx[n]=0),kx[n]+=1,n+kx[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const HSe=["channelsFirst","channelsLast"],qSe=["nearest","bilinear"],KSe=["valid","same","causal"],XSe=["max","avg"],ZSe=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jp=new Map;function Cs(n){Xf(HSe,"DataFormat",n)}function YSe(n){Xf(qSe,"InterpolationFormat",n)}function Aa(n){Xf(KSe,"PaddingMode",n)}function pq(n){Xf(XSe,"PoolMode",n)}const Fy=[],f3="/";function cf(n,e){Fy.push(n);try{const t=e();return Fy.pop(),t}catch(t){throw Fy.pop(),t}}function QSe(){return Fy.length===0?"":Fy.join(f3)+f3}function mq(n){if(!yq(n))throw new Error("Not a valid tensor name: '"+n+"'");return QSe()+n}function gq(n){if(!yq(n))throw new Error("Not a valid tensor name: '"+n+"'");jp.has(n)||jp.set(n,0);const e=jp.get(n);if(jp.set(n,jp.get(n)+1),e>0){const t=`${n}_${e}`;return jp.set(t,1),t}else return n}const JSe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function yq(n){return!!n.match(JSe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eEe(n){return n===parseInt(n.toString(),10)}function Sh(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function Rm(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function jh(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function Xo(n,e){if(e<n)throw new me(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let pN;function Ys(){return pN==null&&(pN=cbe().epsilon()),pN}function Zo(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vl(n,e){return tt(n,e)}function t_(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),_e(n,t)}function tEe(n,e){return ke(()=>{if(n.shape.length!==2)throw new me(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=t_(n,1);return rC(t,[1,e,1])})}function nEe(n){const e=[Sh(n.shape)];return _e(n,e)}function sEe(n){if(n.rank<=1)throw new me(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Sh(n.shape,1)];return _e(n,e)}function uf(n,e,t){return ke(()=>{switch(n.rank){case 1:return q$(n,e,t);case 2:return mH(n,[e,0],[t,n.shape[1]]);case 3:return K$(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return a1(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Un(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Un(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new me(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function mN(n,e,t){return ke(()=>{switch(n.rank){case 1:return q$(n,e,t);case 2:return mH(n,[0,e],[n.shape[0],t]);case 3:return K$(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return a1(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new me(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function $x(n,e,t,s){return ke(()=>{switch(n.rank){case 1:return q$(n,e,t);case 2:switch(s){case 1:return uf(n,e,t);case 2:return mN(n,e,t);default:throw new me(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return uf(n,e,t);case 2:return K$(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return mN(n,e,t);default:throw new me(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return uf(n,e,t);case 2:return a1(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return a1(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return mN(n,e,t);default:throw new me(`The axis is not within the rank of the tensor ${s}`)}default:throw new me(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function LA(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Ri(n,e)}function p3(n,e){switch(n.rank){case 1:return R_e([n,e]);case 2:return L_e([n,e],0);case 3:return P_e([n,e],0);case 4:return F_e([n,e],0);default:throw new me(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function rC(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new me(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Bo(n,e)}function DT(n,e=0,t=1,s,r){return A0e(n,e,t,s,r)}function Ul(n,e,t,s){if(n.rank<2||e.rank<2)throw new Ot(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new Ot(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return e3({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?iC(n.rank,s,Zo()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=_e(n,[-1,i]);const a=e.shape.slice(),o=a.pop(),l=a.pop(),c=[...a,o],h=Array.from({length:e.rank},(_,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=_e(on(e,h),[l,-1]);const p=[...r,...c];return _e(e3({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?iC(n.rank,s,Zo()):null,activation:t}),p)}}function vq(n,e,t){return ke(()=>(Array.isArray(e)?e=Xi(e,"int32"):e=tt(e,"int32"),F$(n,e,t)))}function n_(n){return ye(n,n)}function iC(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new me(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?_e(e,[1,s[0],1,1,1]):_e(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?_e(e,[1,1,1,1,s[0]]):_e(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?_e(e,[1,s[0],1,1]):_e(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?_e(e,[1,1,1,s[0]]):_e(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?_e(e,[1,s[0],1]):_e(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?_e(e,[1,1,s[0]]):_e(e,[1].concat(s))}else if(n<3)return e;throw new me(`Unsupported input rank by biasAdd: ${e.rank}`)}function Jo(n,e,t){return ke(()=>(t==null&&(t=Zo()),Cs(t),Ke(n,iC(n.rank,e,t))))}function rEe(n,e=1){if(e!==1)throw new Ot(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return ET(n)}function iEe(n){return ke(()=>yt(n,Ke(li(n),1)))}function bq(n,e,t,s){return ke(()=>N1e(n,e,t,s))}function aEe(n){return ke(()=>{const e=Ke(.5,ye(.2,n));return ka(e,0,1)})}function s_(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oEe=["fanIn","fanOut","fanAvg"],lEe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cEe(n){Xf(oEe,"FanMode",n)}function uEe(n){Xf(lEe,"Distribution",n)}class fo extends ig{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class _q extends fo{apply(e,t){return ur(e,t)}}_q.className="Zeros";We(_q);class OA extends fo{apply(e,t){return rd(e,t)}}OA.className="Ones";We(OA);class xq extends fo{constructor(e){if(super(),typeof e!="object")throw new me(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new me(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ke(()=>ye(_n(this.value),rd(e,t)))}getConfig(){return{value:this.value}}}xq.className="Constant";We(xq);class wq extends fo{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Kb(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}wq.className="RandomUniform";We(wq);class Tq extends fo{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`randomNormal does not support dType ${t}.`);return DT(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Tq.className="RandomNormal";We(Tq);class Sq extends fo{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`truncatedNormal does not support dType ${t}.`);return vH(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Sq.className="TruncatedNormal";We(Sq);class Eq extends fo{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ke(()=>{if(e.length!==2||e[0]!==e[1])throw new me("Identity matrix initializer can only be used for 2D square matrices.");return ye(this.gain,tH(e[0]))})}getConfig(){return{gain:this.gain}}}Eq.className="Identity";We(Eq);function hEe(n,e="channelsLast"){let t,s;if(Cs(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Sh(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Sh(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Sh(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Ji extends fo{constructor(e){if(super(),e.scale<0)throw new me(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,cEe(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,uEe(this.distribution),this.seed=e.seed}apply(e,t){const s=hEe(e),r=s[0],i=s[1];let a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,r):this.mode==="fanOut"?a/=Math.max(1,i):a/=Math.max(1,(r+i)/2),this.distribution==="normal"){const o=Math.sqrt(a);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`${this.getClassName()} does not support dType ${t}.`);return vH(e,0,o,t,this.seed)}else{const o=Math.sqrt(3*a);return Kb(e,-o,o,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ji.className="VarianceScaling";We(Ji);class PA extends Ji{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ji.className}}PA.className="GlorotUniform";We(PA);class MA extends Ji{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ji.className}}MA.className="GlorotNormal";We(MA);class FA extends Ji{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ji.className}}FA.className="HeNormal";We(FA);class jA extends Ji{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ji.className}}jA.className="HeUniform";We(jA);class BA extends Ji{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ji.className}}BA.className="LeCunNormal";We(BA);class zA extends Ji{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ji.className}}zA.className="LeCunUniform";We(zA);class Nq extends fo{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ke(()=>{if(e.length<2)throw new Ot("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=Me(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const a=[Math.max(r,s),Math.min(r,s)],o=DT(a,0,1,t,this.seed),l=wwe.qr(o,!1);let c=l[0];const p=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return c=ye(c,p.sign()),s<r&&(c=c.transpose()),ye(_n(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}Nq.className="Orthogonal";We(Nq);const m3={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function g3(n,e={}){return e_(n,so.getMap().classNameMap,e,"initializer")}function hs(n){return RA(n)}function rs(n){if(typeof n=="string"){const e=n in m3?m3[n]:n;if(e==="GlorotNormal")return new MA;if(e==="GlorotUniform")return new PA;if(e==="HeNormal")return new FA;if(e==="HeUniform")return new jA;if(e==="LeCunNormal")return new BA;if(e==="LeCunUniform")return new zA;{const t={};return t.className=e,t.config={},g3(t)}}else return n instanceof fo?n:g3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aC(n){return Array.isArray(n)&&Array.isArray(n[0])}function o1(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function wt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new me(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function mn(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new me(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l1(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const y3="Variable";class dEe{constructor(e,t="float32",s=y3,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=fq(),s=s??y3,this.originalName=mq(s),this.name=gq(this.originalName),this.trainable_=r,this.constraint=i,this.val=w1e(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),fEe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function fEe(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function oC(n){return n.map(e=>e.read())}function VA(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Qs{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class nc{constructor(e,t,s,r,i,a,o){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=fq(),a!=null&&(this.originalName=mq(a),this.name=gq(this.originalName)),this.rank=t.length}}let pEe=0;class LT{constructor(e,t){this.callArgs=t,this.id=pEe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let mEe=0;class Ut extends ig{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=mEe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Rc(s)+"_"+RT(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new io(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new me(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Ai(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Ai(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new El(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new El(`Layer ${this.name} is not connected, no input to return.`);return Ai(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new El(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new El(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ai(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=En(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=En(this.inputSpec);if(t.length!==s.length)throw new me(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],a=s[r];if(a==null)continue;const o=i.rank;if(a.ndim!=null&&o!==a.ndim)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${a.ndim}, found ndim=${o}`);if(a.maxNDim!=null&&o>a.maxNDim)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${a.maxNDim}, found ndim=${o}`);if(a.minNDim!=null&&o<a.minNDim)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${a.minNDim}, found ndim=${o}.`);if(a.dtype!=null&&i.dtype!==a.dtype)throw new me(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${a.dtype}, found dtype=${i.dtype}.`);if(a.axes){const l=i.shape;for(const c in a.axes){const h=Number(c),p=a.axes[c],m=h>=0?l[h]:l[l.length+h];if(p!=null&&[p,null].indexOf(m)===-1)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${p} but got shape ${l}.`)}}if(a.shape!=null)for(let l=0;l<a.shape.length;++l){const c=a.shape[l],h=i.shape[l];if(c!=null&&h!=null&&c!==h)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected shape=${a.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=En(e),r=vEe(e),i=bEe(e);if(r===i)throw new me("Arguments to apply() must be all SymbolicTensors or all Tensors");return cf(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const a=[];for(const o of En(e))a.push(o.shape);this.build(Ai(a)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let a=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,a);const o=En(a),l=[];for(let c of o)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(a=Ai(l),this.activityRegularizer!=null)throw new Ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}else{const a=gEe(e),o=this.computeOutputShape(a);let l;const c=yEe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?a[0]:a),o!=null&&o.length>0&&Array.isArray(o[0])?l=o.map((h,p)=>new nc(c,h,this,En(e),t,this.name,p)):l=new nc(c,o,this,En(e),t,this.name),this.addInboundNode(e,l,null,null,a,o,t),this._refCount++,this.activityRegularizer!=null)throw new Ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new El(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new El(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new io(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return l1(this.weights)}build(e){this.built=!0}getWeights(e=!1){return oC(e?this.trainableWeights:this.weights)}setWeights(e){ke(()=>{const t=this.weights;if(t.length!==e.length)throw new me(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=oC(t);for(let i=0;i<r.length;++i){const a=r[i],o=t[i],l=e[i];if(!xn(a.shape,l.shape))throw new me(`Layer weight shape ${a.shape} not compatible with provided weight shape ${l.shape}`);s.push([o,l])}VA(s)})}addWeight(e,t,s,r,i,a,o,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new me(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():rs("zeros"));const c=r.apply(t,s),h=new dEe(c,s,e,a,o);return c.dispose(),i!=null&&this.addLoss(()=>i.apply(h.read())),a==null&&(a=!0),a?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=En(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=En(t),a=En(r);if(i.length!==a.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let o=0;o<i.length;o++)i[o].kerasMask=a[o]}addInboundNode(e,t,s,r,i,a,o=null){const l=En(e);t=En(t),s=En(s),r=En(r),i=o1(i),a=o1(a);const c=[],h=[],p=[];for(const m of l)c.push(m.sourceLayer),h.push(m.nodeIndex),p.push(m.tensorIndex);new LT({outboundLayer:this,inboundLayers:c,nodeIndices:h,tensorIndices:p,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:a},o);for(let m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function gEe(n){n=En(n);const e=[];for(const t of n)e.push(t.shape);return Ai(e)}function yEe(n){return"float32"}function Iq(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const a=s.inputTensors[i],o=s.inboundLayers[i],l=s.nodeIndices[i],c=Iq(a,o,l);for(const h of c)r.indexOf(h)===-1&&r.push(h)}return r}}}function vEe(n){let e=!0;for(const t of En(n))if(!(t instanceof nc)){e=!1;break}return e}function bEe(n){let e=!0;for(const t of En(n))if(t instanceof nc){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class r_ extends Ut{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:RT("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new me("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new me("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new me("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new nc(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new LT({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new me(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}r_.className="InputLayer";We(r_);function _Ee(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new me("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new r_({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xEe(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return tt(e,n.dtype)}catch{throw new me(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class ph{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ph)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=xEe(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new me(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof nc){if(this.id2Value[e.id]==null)throw new me(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new me(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof nc){if(this.id2Value[e.id]==null)throw new me(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new me(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Ht(this.id2Mask)}}const c1=new uq,u1=new uq;function wEe(n){c1?.setMaxEntries(n),u1?.setMaxEntries(n)}function Sy(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),a=i?n:[n],o=a.map(_=>_.name),l=[],c=e.names();for(const _ of o)c.indexOf(_)!==-1?l.push(e.getValue(_)):l.push(null);const h=o.join(",")+"|"+e.names().sort().join(",");let p=c1.get(h),m;if(p==null){const _=TEe(a,e);p=_.sorted,m=_.recipientCounts,c1.put(h,p),u1.put(h,m)}m={},r||Object.assign(m,u1.get(h));const v=new ph(e);for(let _=0;_<p.length;++_){const w=p[_],T=w.sourceLayer;if(T instanceof r_)continue;const E=[],C=[],A=[];let D=!1;for(const O of w.inputs){const M=v.getValue(O),k=v.getMask(O);E.push(M),C.push(k),k!=null&&(D=!0),r||(m[O.name]--,m[O.name]===0&&!e.hasKey(O)&&o.indexOf(O.name)===-1&&!M.isDisposed&&O.sourceLayer.stateful!==!0&&A.push(M))}D&&(t=t||{},t.mask=C[0]);const F=En(T.apply(E,t));let W=null;T.supportsMasking&&(W=T.computeMask(E,C));const B=EEe(w),P=Array.isArray(B)?B:[B];for(let O=0;O<P.length;++O){v.hasKey(P[O])||v.add(P[O],F[O],Array.isArray(W)?W[0]:W);const M=o.indexOf(P[O].name);M!==-1&&(l[M]=F[O])}r||Ht(A)}return v.disposeMasks(),i?l:l[0]}function TEe(n,e){te(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=v3(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:a,recipientMap:o}=v3(i,e);for(const l of a)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in o)s[l]==null&&(s[l]=new Set),o[l].forEach(c=>s[l].add(c))}}return{sorted:t,recipientCounts:SEe(s)}}function SEe(n){const e={};for(const t in n)e[t]=n[t].size;return e}function v3(n,e){const t=new Set,s=[],r={};for(const o of e.names())t.add(o);const i=[],a=[];for(i.push(n);i.length>0;){const o=i[i.length-1];if(t.has(o.name)){i.pop();continue}const l=a[a.length-1]===i.length-1;if(o.inputs.length===0||l)i.pop(),s.push(o),t.add(o.name),l&&a.pop();else{a.push(i.length-1);for(const c of o.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(o.name),!t.has(c.name)&&i.push(c)}}return{sorted:s,recipientMap:r}}function EEe(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NEe=Re();NEe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,wEe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UA(n,e){return ke(()=>Wr(pt(ye(n,n),e,!0)))}class i_ extends ig{getConfig(){return{}}}class Cq extends i_{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ke(()=>{const t=UA(e,this.axis),s=ka(t,0,this.maxValue);return ye(e,yt(s,Ke(Ys(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Cq.className="MaxNorm";We(Cq);class kq extends i_{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ke(()=>yt(e,Ke(Ys(),UA(e,this.axis))))}getConfig(){return{axis:this.axis}}}kq.className="UnitNorm";We(kq);class $q extends i_{apply(e){return qf(e)}}$q.className="NonNeg";We($q);class Aq extends i_{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ke(()=>{const t=UA(e,this.axis),s=Ke(ye(this.rate,ka(t,this.minValue,this.maxValue)),ye(1-this.rate,t));return ye(e,yt(s,Ke(Ys(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Aq.className="MinMaxNorm";We(Aq);const b3={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Js(n){return RA(n)}function _3(n,e={}){return e_(n,so.getMap().classNameMap,e,"constraint")}function er(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in b3?b3[n]:n,config:{}};return _3(t)}else return n instanceof i_?n:_3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Vd(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const a=i;e.push(a.data()),t.push(r),s.push(a)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];Ht(s)}}function Rq(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var x3;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(x3||(x3={}));const IEe=125;class hv{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class CEe{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class kEe extends hv{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let a;r in this.totals?a=this.totals[r]:this.totals[r]=0;const o=ke(()=>Ke(this.totals[r],ye(i,s)));this.totals[r]=o,a?.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ke(()=>{const r=ye(yt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Bl(t[s])}))}}class $Ee extends hv{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const a=this.history[i];for(let o=0;o<a.length;++o)if(typeof a[o]!="number"){const l=a[o];e.push(l.data()),t.push(i),s.push(o)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class AEe extends hv{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||MH,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=IEe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");MI(this.yieldEvery)&&(this.maybeWait=GSe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Vd(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Vd(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Vd(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Vd(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Vd(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):MI(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Vd(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Vd(e),await this.trainEnd(e))}}function Dq(n,e){return n==null&&(n={}),n instanceof hv?[n]:Array.isArray(n)&&n[0]instanceof hv?n:En(n).map(s=>new AEe(s,e))}class eo{constructor(){}static registerCallbackConstructor(e,t){te(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),eo.checkForDuplicate(t),eo.constructors[e]==null&&(eo.constructors[e]=[]),eo.constructors[e].push(t)}static checkForDuplicate(e){for(const t in eo.constructors)eo.constructors[+t].forEach(r=>{if(r===e)throw new me("Duplicate callback constructor.")})}static clear(){eo.constructors={}}static createCallbacks(e){const t=[];for(const s in eo.constructors){const r=+s;e>=r&&t.push(...eo.constructors[r])}return t.map(s=>new s)}}eo.constructors={};function Lq(n,e,t,s,r,i,a,o,l){const c=new $Ee,h=[new kEe,...eo.createCallbacks(e)];n!=null&&h.push(...n),h.push(c);const p=new CEe(h);return p.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:a,verbose:e,doValidation:o,metrics:l}),{callbackList:p,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uc(n,e={},t=!1){return e_(n,so.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function h1(n,e){return ke(()=>{n.dtype!=="float32"&&(n=tt(n,"float32"));const t=pt(n_(n),e,!0),s=ST(t.shape,Ys()),r=Wr(sd(t,s));return yt(n,r)})}function OT(n,e){return ke(()=>Ps(n_(_t(e,n)),-1))}function GA(n,e){return ke(()=>Ps(li(_t(e,n)),-1))}function WA(n,e){return ke(()=>{const t=_t(n,e),s=ka(li(n),Ys(),Number.MAX_VALUE),r=li(yt(t,s));return ye(100,Ps(r,-1))})}function REe(n,e){return ke(()=>{const t=ka(e,Ys(),Number.MAX_VALUE),s=tc(Ke(1,t)),r=ka(n,Ys(),Number.MAX_VALUE),i=tc(Ke(1,r));return Ps(n_(_t(s,i)),-1)})}function DEe(n,e){return ke(()=>{const t=sd(0,_t(1,ye(n,e)));return Ps(n_(t),-1)})}function LEe(n,e){return ke(()=>{const t=sd(0,_t(1,ye(n,e)));return Ps(t,-1)})}function OEe(n,e){return ke(()=>{const t=pt(ye(n,e),-1),s=Go(ye(_t(1,n),e),-1);return sd(0,Ke(1,_t(s,t)))})}function PEe(n,e){return ke(()=>{const t=Math.log(2),s=_t(e,n),r=_t(Ke(s,qb(ye(-2,s))),t);return Ps(r,-1)})}function dv(n,e,t=!1){return ke(()=>{if(t)e=X$(e);else{const s=pt(e,e.shape.length-1,!0);e=yt(e,s)}return e=ka(e,Ys(),1-Ys()),Ts(pt(ye(tt(n,"float32"),tc(e)),e.shape.length-1))})}function d1(n,e,t=!1){return ke(()=>{const s=tt(IT(nEe(n)),"int32");e=ka(e,Ys(),1-Ys());const r=e.shape,i=_e(aH(s,r[r.length-1]),r);return dv(i,e,t)})}function MEe(n,e){if(!xn(n.shape,e.shape))throw new me(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ke(()=>{const t=qf(e),s=Ts(li(e));return Ke(_t(t,ye(e,n)),nH(ec(s)))})}function PT(n,e){return ke(()=>{let t;return t=ka(e,Ys(),1-Ys()),t=tc(yt(t,_t(1,t))),Ps(MEe(n,t),-1)})}function FEe(n,e){return ke(()=>{const t=ka(n,Ys(),1),s=ka(e,Ys(),1);return pt(ye(n,tc(yt(t,s))),-1)})}function jEe(n,e){return ke(()=>{const t=tc(Ke(Ys(),e));return Ps(_t(e,ye(n,t)),-1)})}function Oq(n,e){return ke(()=>{const t=h1(n,-1),s=h1(e,-1),r=ye(t,s);return Ts(pt(r,-1))})}const f1={meanSquaredError:OT,meanAbsoluteError:GA,meanAbsolutePercentageError:WA,meanSquaredLogarithmicError:REe,squaredHinge:DEe,hinge:LEe,categoricalHinge:OEe,logcosh:PEe,categoricalCrossentropy:dv,sparseCategoricalCrossentropy:d1,binaryCrossentropy:PT,kullbackLeiblerDivergence:FEe,poisson:jEe,cosineProximity:Oq};function gN(n){if(typeof n=="string"){if(n in f1)return f1[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new me(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pq(n,e){return ke(()=>{const t=ye(.5,co(e)),s=Vl($a(e,t),n.dtype);return Ps(Jl(n,s),-1)})}function Mq(n,e){return ke(()=>Vl(Jl(av(n,-1),av(e,-1)),"float32"))}function BEe(n,e){return ke(()=>tt(pt(Zc(Jl(n,1),Jl(e,1))),"float32"))}function zEe(n,e){return ke(()=>tt(pt(Zc(Jl(n,0),Jl(e,1))),"float32"))}function VEe(n,e){return ke(()=>{const t=BEe(n,e),s=zEe(n,e),r=Ke(t,s);return tt(mi($a(r,0),yt(t,r),0),"float32")})}function UEe(n,e){return PT(n,e)}function GEe(n,e){return n.rank===e.rank&&(n=Xb(n,[n.rank-1])),e=av(e,-1),e.dtype!==n.dtype&&(e=tt(e,n.dtype)),tt(Jl(n,e),"float32")}const WEe=OT,HEe=OT,qEe=GA,KEe=GA,XEe=WA,ZEe=WA,Fq=dv,YEe=Oq,jq=d1,p1={binaryAccuracy:Pq,categoricalAccuracy:Mq,precision:VEe,categoricalCrossentropy:Fq,sparseCategoricalCrossentropy:jq,mse:WEe,MSE:HEe,mae:qEe,MAE:KEe,mape:XEe,MAPE:ZEe,cosine:YEe};function QEe(n){if(typeof n=="string"&&n in p1)return p1[n];if(typeof n!="string"&&n!=null)return n;throw new me(`Unknown metric ${n}`)}function Ax(n){if(Nl(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(f1))if(f1[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(p1))if(p1[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function JEe(n){const e={Adagrad:()=>Fp.adagrad(.01),Adadelta:()=>Fp.adadelta(1,.95,Ys()),Adam:()=>Fp.adam(.001,.9,.999,Ys()),Adamax:()=>Fp.adamax(.002,.9,.999,Ys(),0),RMSProp:()=>Fp.rmsprop(.001,.9,0,Ys()),SGD:()=>Fp.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new me(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const w3=1*1024*1024;function T3(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!lC(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>w3&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${w3}.`)}}function lC(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!lC(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!lC(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eNe(n,e,t,s=console.log){const r=nNe(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(h=>Math.floor(e*h)));let a;if(!r){i.push("Receives inputs"),a=[];for(const h in n.nodesByDepth)a.push(...n.nodesByDepth[h])}s("_".repeat(e)),m1(i,t,s),s("=".repeat(e));const o=n.layers;for(let h=0;h<o.length;++h)r?sNe(o[h],t,s):rNe(o[h],t,a,s),s((h===o.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=tNe(n),c=l1(n.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function tNe(n){let e;return n.collectedTrainableWeights!=null?e=l1(n.collectedTrainableWeights):e=l1(n.trainableWeights),e}function nNe(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const a of r.inboundNodes)if(s.indexOf(a)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function m1(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function sNe(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,a=n.getClassName(),o=[`${i} (${a})`,r,s,n.countParams().toString()];m1(o,e,t)}function rNe(n,e,t,s){let r,i;try{i=n.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const a=[];for(const p of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(p)===-1))for(let m=0;m<p.inboundLayers.length;++m){const v=p.inboundLayers[m].name,_=p.nodeIndices[m],w=p.tensorIndices[m];a.push(`${v}[${_}][${w}]`)}const o=n.name,l=n.getClassName(),c=a.length===0?"":a[0],h=[`${o} (${l})`,i,r,n.countParams().toString(),c];m1(h,e,s);for(let p=1;p<a.length;++p)m1(["","","","",a[p]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bq(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function cC(n,e){if(n===null)return null;if(typeof n=="string")return Xd(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];Bq(e,r,i)?t.push(i):t.push(cC(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=Xd(s);t[i]=cC(r,i)}}return t}}function uC(n,e){if(n==null)return null;if(typeof n=="string")return Rc(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];Bq(e,r,i)?t.push(i):t.push(uC(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=Rc(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=uC(r,s)}return t}}/** @license See the LICENSE file. */const zq="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iNe=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Oo extends Ut{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=RT(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Th(this.inputs).length!==this.inputs.length)throw new me(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);Th(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const A=C.sourceLayer,D=C.nodeIndex,F=C.tensorIndex;this.outputLayers.push(A),this.outputLayersNodeIndices.push(D),this.outputLayersTensorIndices.push(F)}for(const C of this.inputs){const A=C.sourceLayer,D=C.nodeIndex,F=C.tensorIndex;Nl(D===0,"input layer has >1 nodes"),Nl(F===0,"input layer has >1 tensors"),this.inputLayers.push(A),this.inputLayersNodeIndices.push(D),this.inputLayersTensorIndices.push(F)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const A=this.inputLayers[C];if(!(A instanceof r_))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${A.getClassName()}.`);this.inputNames.push(A.name),this.feedInputShapes.push(A.batchInputShape),this.feedInputNames.push(A.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},s={},r={},i={},a={},o=[],l=(C,A,D,F,W,B)=>{(F==null||W==null||B==null)&&(F=C.sourceLayer,W=C.nodeIndex,B=C.tensorIndex);const P=F.inboundNodes[W];if(D.indexOf(P)!==-1)throw new io(`The tensor ${C.name} at layer "${F.name}" is part of a cycle.`);if(A.indexOf(P)!==-1)return;this.containerNodes.add(Oo.nodeKey(F,W)),F.id in a||(a[F.id]=Object.keys(a).length),D.indexOf(P)===-1&&D.push(P);const O=P.inboundLayers.length;for(let M=0;M<O;M++){const k=P.inputTensors[M],V=P.inboundLayers[M],G=P.nodeIndices[M],ae=P.tensorIndices[M];l(k,A,D,V,G,ae)}for(A.push(P);D.indexOf(P)>=0;)D.splice(D.indexOf(P),1);o.push(P)},c=[],h=[];for(const C of this.outputs)l(C,c,h);const p=o.slice().reverse();for(const C of p){s[C.id]=C,C.id in t||(t[C.id]=0);let A=t[C.id];const D=r[C.outboundLayer.id]==null?0:r[C.outboundLayer.id];A=Math.max(A,D),r[C.outboundLayer.id]=A,i[C.outboundLayer.id]=C.outboundLayer,t[C.id]=A;for(let F=0;F<C.inboundLayers.length;F++){const W=C.inboundLayers[F],B=C.nodeIndices[F],P=W.inboundNodes[B],O=t[P.id]==null?0:t[P.id];t[P.id]=Math.max(A+1,O),s[P.id]=P}}const m={};for(const C in t){const A=t[C];A in m||(m[A]=[]),m[A].push(s[C])}const v={};for(const C in r){const A=r[C];A in v||(v[A]=[]),v[A].push(i[C])}let _=Object.keys(v).map(C=>parseInt(C,10)).sort(Cx);this.layers=[];for(const C of _){const A=v[C];A.sort((D,F)=>{const W=a[D.id],B=a[F.id];return W<B?-1:W>B?1:0});for(const D of A)D instanceof Oo&&this.internalContainerRefs.push(D),this.layers.push(D)}this.layersByDepth=v,_=Object.keys(m).map(C=>parseInt(C,10)).sort(Cx);const w=this.inputs.slice(),T=[];for(const C of _)for(const A of m[C]){const D=A.outboundLayer;if(D!=null){for(const F of A.inputTensors)if(w.indexOf(F)===-1)throw new io(`Graph disconnected: cannot obtain value for tensor ${F} at layer "${D.name}". The following previous layers were accessed without issue: ${T}`);for(const F of A.outputTensors)w.push(F);T.push(D.name)}}this.nodesByDepth=m;const E=this.layers.map(C=>C.name);for(const C of E){const A=E.filter(D=>D===C).length;if(A!==1)throw new io(`The name "${C}" is used ${A} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(E))}this.outboundNodes=[],this.inboundNodes=[],new LT({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new me("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=iNe(e);i&&this.parseWeights(e);for(const o of this.layers)for(const[l,c]of o.weights.entries()){const h=i?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[h]!=null)throw new me(`Duplicate weight name: ${h}`);s[h]=c,r++}const a=[];for(const o in e){let l=o;if(s[o]==null){const c=o.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)a.push([s[l],e[o]]);else if(t)throw new me(`Provided weight data has no target variable: ${o}`);delete s[l]}if(t){const o=[];for(const l in s)o.push(l);if(o.length>0)throw new me(`${o.length} of ${r} weights are not set: ${o}`)}VA(a)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(a=>a.startsWith("_")?a.slice(1):a).filter(a=>!r.includes(a)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${zq}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=uC(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ke(()=>{e=En(e);const s=new ph;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Sy(this.outputs,s,t)})}computeMask(e,t){return ke(()=>{e=En(e);let s;return t==null?s=Pf(null,e.length):s=En(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=o1(e);if(t.length!==this.inputLayers.length)throw new me(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let o=0;o<t.length;o++){const l=this.inputLayers[o],c=t[o],h=l.name+"_0_0";s[h]=c}const r=Object.keys(this.nodesByDepth).map(o=>parseInt(o,10)).sort(Cx);if(r.length>1)for(const o of r){const l=this.nodesByDepth[o];for(const c of l){const h=c.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(h.id)!==-1)continue;const p=[];for(let w=0;w<c.inboundLayers.length;w++){const T=c.inboundLayers[w],E=c.nodeIndices[w],C=c.tensorIndices[w],A=`${T.name}_${E}_${C}`,D=s[A];p.push(D)}const m=h.computeOutputShape(Ai(p)),v=o1(m),_=h.inboundNodes.indexOf(c);for(let w=0;w<v.length;w++){const T=`${h.name}_${_}_${w}`;s[T]=v[w]}}}const i=[],a=[];for(let o=0;o<this.outputLayers.length;o++){const l=this.outputLayers[o],c=this.outputLayersNodeIndices[o],h=this.outputLayersTensorIndices[o],p=`${l.name}_${c}_${h}`;a.push(p)}for(let o=0;o<a.length;o++){const l=a[o];Nl(l in s),i.push(s[l])}return Ai(i)}runInternalGraph(e,t){t==null&&(t=Pf(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],h=e[l],p=t[l];s[c.id]=[h,p]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Cx);for(const l of r){const c=this.nodesByDepth[l];for(const h of c){const p=h.outboundLayer,m=h.inputTensors,v=h.outputTensors,_=new Array;for(const w of m)w.id in s&&_.push(s[w.id]);if(_.length===m.length){let w={},T,E,C,A;if(h.callArgs!=null&&(w=h.callArgs),_.length===1){const[D,F]=_[0];w.mask==null&&(w.mask=F),C=En(p.call(D,w)),A=En(p.computeMask(D,F)),T=[D],E=[F]}else T=_.map(D=>D[0]),E=_.map(D=>D[1]),w.mask==null&&(w.mask=E),C=En(p.call(T,w)),A=En(p.computeMask(T,E));if(p.activityRegularizer)throw new Ot("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let D=0;D<v.length;++D){const F=v[D],W=C[D],B=A[D];s[F.id]=[W,B]}}}}const i=[],a=[],o=[];for(const l of this.outputs){Nl(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,h]=s[l.id];o.push(c.shape),i.push(c),a.push(h)}return[i,a,o]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Oo?1:0;for(let i=0;i<r.inboundNodes.length;i++){const a=Oo.nodeKey(r,i);this.containerNodes.has(a)&&(t[a]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new me("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new me(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new me(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ke(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Oo.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const a of this.layers){const o=a.getClassName(),l=a.getConfig(),c=[];for(let p=0;p<a.inboundNodes.length;p++){const m=a.inboundNodes[p],v=Oo.nodeKey(a,p);let _={};if(this.containerNodes.has(v)){if(m.callArgs)try{JSON.stringify(m.callArgs),_=m.callArgs}catch{console.warn(`Layer ${a.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),_={}}if(m.inboundLayers.length>0){const w=[];for(let T=0;T<m.inboundLayers.length;T++){const E=m.inboundLayers[T],C=m.nodeIndices[T],A=m.tensorIndices[T],D=Oo.nodeKey(E,C);let F=t[D];F==null&&(F=0),w.push([E.name,F,A,_])}c.push(w)}}}const h={};h.name=a.name,h.className=o,h.config=l,h.inboundNodes=c,s.push(h)}e.layers=s;const r=[];for(let a=0;a<this.inputLayers.length;a++){const o=this.inputLayers[a],l=this.inputLayersNodeIndices[a],c=Oo.nodeKey(o,l);if(!this.containerNodes.has(c))continue;let h=t[c];h==null&&(h=0);const p=this.inputLayersTensorIndices[a];r.push([o.name,h,p])}e.inputLayers=r;const i=[];for(let a=0;a<this.outputLayers.length;a++){const o=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=Oo.nodeKey(o,l);if(!this.containerNodes.has(c))continue;let h=t[c];h==null&&(h=0);const p=this.outputLayersTensorIndices[a];i.push([o.name,h,p])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},a={};function o(T,E){T.name in a?a[T.name].push(E):a[T.name]=[E]}function l(T,E){const C=[];let A;for(const D of E){const F=D[0],W=D[1],B=D[2];if(A=D[3]==null?{}:D[3],!(F in i)){o(T,E);return}const P=i[F];if(P.inboundNodes.length<=W){o(T,E);return}const O=P.inboundNodes[W];C.push(O.outputTensors[B])}C.length>0&&T.apply(Ai(C),A)}function c(T){const E=T.name,C=Uc(T,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(r),i[E]=C,T.inboundNodes.forEach(D=>{if(!(D instanceof Array))throw new me(`Corrupted configuration, expected array for nodeData: ${D}`);o(C,D)})}const h=t.name,p=t.layers;for(const T of p)c(T);for(;!USe(a);)for(const T of p){const E=i[T.name];if(E.name in a){const C=a[E.name];delete a[E.name];for(const A of C)l(E,A)}}const m=[],v=[],_=t.inputLayers;for(const T of _){const E=T[0],C=T[1],A=T[2];Nl(E in i);const F=i[E].inboundNodes[C].outputTensors;m.push(F[A])}const w=t.outputLayers;for(const T of w){const E=T[0],C=T[1],A=T[2];Nl(E in i);const F=i[E].inboundNodes[C].outputTensors;v.push(F[A])}return new e({inputs:m,outputs:v,name:h})}get stateful(){if(this._stateful)throw new me("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ke(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aNe(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function Vq(n,e){return aNe(n,e,"classWeight")}async function Uq(n,e,t,s){if(t!=null){const r=ke(()=>{if(n.shape.length===1)return lf(n);if(n.shape.length===2){if(n.shape[1]>1)return av(n,1);if(n.shape[1]===1)return _e(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());Ht(r);const a=[];return i.forEach(o=>{if(t[o]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${o} exists in the data but not in classWeight`);a.push(t[o])}),Xi(a,"float32")}else return null}function oNe(n,e){return ye(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const lNe=32;function Gq(n,e){let t,s;const r=e;t=r.xs,s=r.ys,te(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=S3("input",n.inputNames,t),a=S3("output",n.outputNames,s),o=i[0].shape[0];te(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),te(a.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)te(i[l].shape[0]===o,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${o} based on input ${n.inputNames[0]}.`);for(let l=0;l<a.length;l++)te(a[l].shape[0]===o,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${a[l].shape[0]}; expected  ${o} based on input ${n.inputNames[0]}.`);return{xs:i,ys:a}}function S3(n,e,t){if(t instanceof Ks)return[t];if(Array.isArray(t))return te(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new me(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function cNe(n){if(n.length===3)throw new Ot("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function uNe(n,e,t){const s=t.batchesPerEpoch!=null;if(te(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),te(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),te(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),te(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),te(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,a;if(r)if(E3(t.validationData))te(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const T=cNe(t.validationData);i=T.xs,a=T.ys}const o=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(T=>"val_"+T)):c=l.slice();const h=Dq(t.callbacks,t.yieldEvery),p=t.verbose==null?1:t.verbose,{callbackList:m,history:v}=Lq(h,p,t.epochs,null,null,hNe(e,t),null,r,c);m.setModel(n),n.history=v,await m.onTrainBegin(),n.stopTraining_=!1;let _=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;_<t.epochs;){const T={};await m.onEpochBegin(_);let E=0,C=0;for(s||(w=await e.iterator());!s||E<t.batchesPerEpoch;){const A=await w.next();if(s&&A.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${E} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(A.value!=null){const{xs:D,ys:F}=Gq(n,A.value),W={};W.batch=C,W.size=D[0].shape[0],await m.onBatchBegin(C,W);const B=[];if(t.classWeight!=null){const M=Vq(t.classWeight,n.outputNames);for(let k=0;k<M.length;++k)B.push(await Uq(F[k],null,M[k]))}const P=D.concat(F).concat(B),O=o(P);Ht(P);for(let M=0;M<l.length;++M){const k=l[M],V=O[M];W[k]=V,Bl(V)}await m.onBatchEnd(C,W),Rq(W),C++,E++}if(s?E>=t.batchesPerEpoch:A.done){if(r){let D;E3(t.validationData)?D=En(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):D=En(n.evaluate(i,a,{batchSize:t.validationBatchSize==null?lNe:t.validationBatchSize,verbose:0}));for(let F=0;F<n.metricsNames.length;++F)T[`val_${n.metricsNames[F]}`]=D[F]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(_,T),_++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function hNe(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function E3(n){return typeof n.iterator=="function"}function dNe(n){return typeof n.next=="function"}async function fNe(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new Ot("Verbose mode is not implemented yet.");te(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const a=dNe(e)?e:await e.iterator();let o=0,l=0;for(;!s||l<t.batches;){const c=await a.next();if(i=ke(()=>{if(c.value){const{xs:h,ys:p}=Gq(n,c.value),m=h.concat(p),v=ke(()=>r(m));if(Ht(m),l===0)for(let w=0;w<v.length;++w)i.push(_n(0));const _=m[0].shape[0];for(let w=0;w<v.length;++w){const T=v[w],E=i[w];i[w]=ke(()=>Ke(i[w],ye(_,T))),l>0&&Ht(E)}Ht(v),o+=_,++l}return i}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){const h=i[c];i[c]=yt(i[c],o),Ht(h)}return Ai(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yN(n){te(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function hy(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>uf(s,e,t-e)):uf(n,e,t-e)}function hC(n,e){return ke(()=>n==null?null:Array.isArray(n)?n.map(t=>hC(t,e)):vq(n,e.dtype==="int32"?e:tt(e,"int32")))}function vN(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function Wq(n){const e=[];n instanceof Ks&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(t_(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Do(n,e){if(n==null)return;const t=[];if(e instanceof Ks)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof Ks)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pNe(n){return n instanceof Ks}function dC(n){return Array.isArray(n)}function N3(n){return!pNe(n)&&!dC(n)}function I3(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let a=!1;if(dC(n)&&n.length>0)a=!0;else if(N3(n)){for(const o in n)if(n.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new me(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(a=>null);let i;if(N3(n)){n=n,i=[];for(const a of e){if(n[a]==null)throw new me(`No data provided for "${a}". Need data for each key in: ${e}`);i.push(n[a])}}else if(dC(n)){if(n=n,n.length!==e.length)throw new me(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new me(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=Wq(i),t!=null)for(let a=0;a<e.length;++a){if(t[a]==null)continue;const o=i[a];if(o.shape.length!==t[a].length)throw new me(`Error when checking ${r}: expected ${e[a]} to have ${t[a].length} dimension(s). but got array with shape ${o.shape}`);for(let l=0;l<t[a].length;++l){if(l===0&&!s)continue;const c=o.shape[l],h=t[a][l];if(h!=null&&h>=0&&c!==h)throw new me(`${r} expected a batch of elements where each example has shape [${t[a].slice(1,t[a].length)}] (i.e.,tensor shape [*,${t[a].slice(1,t[a].length)}]) but the ${r} received an input with ${o.shape[0]} examples, each with shape [${o.shape.slice(1,o.shape.length)}] (tensor shape [${o.shape}])`)}}return i}function mNe(n,e,t){const s=Th(n.map(i=>i.shape[0]));s.sort();const r=Th(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new me(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new me(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!xn(s,r))throw new me(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function gNe(n,e,t){const s=[OT,PT,dv];for(let r=0;r<n.length;++r){const i=n[r],a=e[r],o=t[r];if(a!=null){if(a===dv&&i.shape[i.shape.length-1]===1)throw new me(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(a)!==-1){const l=i.shape.slice(1),c=o.slice(1);for(let h=0;h<l.length;++h){const p=l[h],m=c[h];if(m!=null&&p!==m)throw new me(`A target Tensor with shape ${i.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function C3(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new me(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new me(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let a=0;a<e.length;++a){if(t[a]==null)continue;const o=i[a];if(o.shape.length!==t[a].length)throw new me(`Error when checking ${r}: expected ${e[a]} to have ${t[a].length} dimension(s), but got array with shape ${JSON.stringify(o.shape)}`);for(let l=0;l<t[a].length;++l){if(l===0&&!s)continue;const c=o.shape[l],h=t[a][l];if(h!=null&&h!==c)throw new me(`Error when checking ${r}: expected ${e[a]} to have shape ${JSON.stringify(t[a])} but got array with shape ${JSON.stringify(o.shape)}.`)}}}function yNe(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const vNe="layers-model";class dm extends Oo{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new me("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");eNe(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=JEe(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof id))throw new me("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new me(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(const a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),t.push(gN(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new me(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(o=>gN(o))}else{const a=gN(e.loss);this.outputs.forEach(o=>{t.push(a)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const o=this.internalOutputShapes[a],l=this.outputNames[a];this.feedOutputNames.push(l),this.feedOutputShapes.push(o),this.feedLossFns.push(this.lossFunctions[a])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],cf("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(s.indexOf(a)!==-1)continue;const o=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([o,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});const r=yNe(e.metrics,this.outputNames),i=(a,o,l)=>{this.outputNames.length>1&&(o=this.outputNames[a]+"_"+o),this.metricsNames.push(o),this.metricsTensors.push([l,a])};cf("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(s.indexOf(a)!==-1)continue;const o=r[a];(c=>{let p,m,v;for(const _ of c){if(typeof _=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(_)!==-1){const T=this.internalOutputShapes[a];T[T.length-1]===1||this.lossFunctions[a]===PT?["accuracy","acc"].indexOf(_)!==-1?m=Pq:["crossentropy","ce"].indexOf(_)!==-1&&(m=UEe):this.lossFunctions[a]===d1?["accuracy","acc"].indexOf(_)!==-1?m=GEe:["crossentropy","ce"].indexOf(_)!==-1&&(m=jq):["accuracy","acc"].indexOf(_)!==-1?m=Mq:["crossentropy","ce"].indexOf(_)!==-1&&(m=Fq);let E;["accuracy","acc"].indexOf(_)!==-1?E="acc":["crossentropy","ce"].indexOf(_)!==-1&&(E="ce"),v=m,p=""+E}else v=QEe(_),p=""+Ax(_);let w;cf(p,()=>{w=v}),i(a,p,w)}})(o)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;yN(r);const a=this.standardizeUserDataXY(e,t,!0,r);try{const o=a[0].concat(a[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,o,r,s.verbose,s.steps);return Ai(c)}finally{Do(a[0],e),Do(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),fNe(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new me(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new me(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new me("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),a=new ph;if(e instanceof Ks&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new me(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)a.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new me(`No value is provided for the model's input ${l.name}`);a.add(l,c)}const o=Sy(i,a);return s?o:o[0]}retrieveSymbolicTensors(e){const t=Pf(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],a=i.map(o=>o.name);for(let o=0;o<e.length;++o){const l=a.indexOf(e[o]);if(l!==-1&&(t[o]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,a)=>{i==null&&r.push(e[a])}),new me(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ke(()=>{const r=this.checkNumSamples(e);if(s)throw new Ot("Verbose predictLoop() is not implemented yet.");const i=vN(r,t),a=this.outputs.map(o=>[]);for(let o=0;o<i.length;++o)ke(()=>{const c=i[o][0],h=i[o][1],p=hy(e,c,h),m=[];if(Array.isArray(p))for(let _=0;_<p.length;++_)m.push({key:this.inputs[_],value:p[_]});else m.push({key:this.inputs[0],value:p});const v=new ph(m);return Sy(this.outputs,v)}).forEach((c,h)=>a[h].push(c));return Ai(a.map(o=>Ri(o,0)))})}predict(e,t={}){const s=Wq(e);C3(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return yN(r),this.predictLoop(s,r)}finally{Do(s,e)}}predictOnBatch(e){C3(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new io("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let a=0;a<this.feedOutputShapes.length;++a){const o=this.feedOutputShapes[a];this.feedLossFns[a]===d1?i.push(o.slice(0,o.length-1).concat([1])):i.push(o)}if(e=I3(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=I3(t,this.feedOutputNames,i,!1,"target"),mNe(e,t),gNe(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new me(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,a){const[o,l]=this.standardizeUserDataXY(e,t,i,a);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const h=Vq(r,this.outputNames);c=[];for(let p=0;p<h.length;++p)c.push(await Uq(l[p],null,h[p]))}return[o,l,c]}testLoop(e,t,s,r=0,i){return ke(()=>{const a=this.checkNumSamples(t,s,i,"steps"),o=[];if(r>0)throw new Ot("Verbose mode is not implemented yet.");if(i!=null)throw new Ot("steps mode in testLoop() is not implemented yet");{const l=vN(a,s),c=Xi(Xo(0,a));for(let h=0;h<l.length;++h){const p=l[h][0],m=l[h][1],v=uf(c,p,m-p),_=hC(t,v),w=e(_);if(h===0)for(let T=0;T<w.length;++T)o.push(_n(0));for(let T=0;T<w.length;++T){const E=w[T];o[T]=Ke(o[T],ye(m-p,E))}}for(let h=0;h<o.length;++h)o[h]=yt(o[h],a)}return o})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(d3(e,r)>1){const a=d3(e.slice(0,s),r);i+=`_${a}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],o=()=>{const p=[];for(let w=0;w<this.inputs.length;++w)p.push({key:this.inputs[w],value:s[w]});const m=new ph(p),v=Sy(this.outputs,m,{training:!0});let _;for(let w=0;w<this.lossFunctions.length;++w){const T=this.lossFunctions[w];let E=T(r[w],v[w]);i[w]!=null&&(E=oNe(E,i[w]));const C=Ps(E);t.push(C),w===0?_=E:_=Ke(_,E)}for(let w=0;w<this.metricsTensors.length;++w){let T;if(this.outputs.length>1&&w<this.outputs.length)T=t[w];else{const E=this.metricsTensors[w][0],C=this.metricsTensors[w][1];T=Ps(E(r[C],v[C]))}Bl(T),a.push(T)}return _=Ps(_),this.calculateLosses().forEach(w=>{_=Ke(_,w)}),_},l=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(o,!0,l)].concat(a)}}makeTestFunction(){this.testFunction=e=>ke(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let c=0;c<this.inputs.length;++c)a.push({key:this.inputs[c],value:r[c]});const o=new ph(a),l=Sy(this.outputs,o);for(let c=0;c<this.lossFunctions.length;++c){const h=this.lossFunctions[c],p=Ps(h(i[c],l[c]));c===0?s=p:s=Ke(s,p),t.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const h=this.metricsTensors[c][0],p=this.metricsTensors[c][1],m=Ps(h(i[p],l[p]));t.push(m)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,a,o,l,c,h,p,m;try{const v=s.batchSize==null?32:s.batchSize;yN(v);const w=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,v);r=w[0],i=w[1],m=w[2];let T=!1,E;if(s.validationData!=null&&s.validationData.length>0){if(T=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new Ot("validationData including sample weights is not supported yet."):new me(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const M=await this.standardizeUserData(l,c,null,null,!0,v);h=M[0],p=M[1],E=h.concat(p)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){T=!0;const O=Math.floor(r[0].shape[0]*(1-s.validationSplit)),M=r[0].shape[0];h=hy(r,O,M),a=r,r=hy(r,0,O),p=hy(i,O,M),o=i,i=hy(i,0,O),E=h.concat(p)}else s.validationSteps!=null&&(T=!0);const C=r.concat(i).concat(m);this.checkTrainableWeightsConsistency();const A=this.makeTrainFunction(),D=this.getDedupedMetricsNames();let F,W;T?(this.makeTestFunction(),F=this.testFunction,W=D.slice().concat(D.map(O=>"val_"+O))):(F=null,E=[],W=D.slice());const B=Dq(s.callbacks,s.yieldEvery);return await this.fitLoop(A,C,D,v,s.epochs,s.verbose,B,F,E,s.shuffle,W,s.initialEpoch,null,null)}finally{this.isTraining=!1,Do(r,e),Do(i,t),Do(a,e),Do(o,t),Do(h,l),Do(p,c),m!=null&&Ht(m)}}async fitLoop(e,t,s,r,i,a,o,l,c,h,p,m,v,_){r==null&&(r=32),i==null&&(i=1),h==null&&(h=!0),m==null&&(m=0);let w=!1;if(l!=null&&c!=null&&(w=!0),_!=null&&(w=!0,v==null))throw new me("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const T=this.checkNumSamples(t,r,v,"steps_per_epoch");let E;T!=null&&(E=Xo(0,T)),a==null&&(a=1);const{callbackList:C,history:A}=Lq(o,a,i,m,T,v,r,w,p);C.setModel(this),this.history=A,await C.onTrainBegin(),this.stopTraining_=!1;for(let D=m;D<i;++D){await C.onEpochBegin(D);const F={};if(v!=null)throw new Ot("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Ot("batch shuffling is not implemneted yet");h&&bve(E);const W=Xi(E),B=vN(T,r);for(let P=0;P<B.length;++P){const O={};if(await C.onBatchBegin(P,O),ke(()=>{const M=B[P][0],k=B[P][1],V=uf(W,M,k-M);O.batch=P,O.size=k-M;const G=hC(t,V),ae=e(G);for(let J=0;J<s.length;++J){const X=s[J],se=ae[J];O[X]=se,Bl(se)}if(P===B.length-1&&w){const J=this.testLoop(l,c,r);for(let X=0;X<s.length;++X){const se=s[X],ne=J[X];Bl(ne),F["val_"+se]=ne}}}),await C.onBatchEnd(P,O),Rq(O),this.stopTraining_)break}W.dispose()}if(await C.onEpochEnd(D,F),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return uNe(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],o=this.makeTrainFunction()(r.concat(i)),l=[];for(const c of o){const h=await c.data();l.push(h[0])}return Ht(o),Do(s[0],e),Do(s[1],t),Ai(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let a=0;a<r.length;++a)s&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=KM().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-KM().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Rc(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Rc(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Rc(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Rc(Ax(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Rc(Ax(e)));{const e={};for(const t in this.metrics)e[t]=Rc(Ax(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=cC(e.optimizer_config),s=Uc(t);let r;if(typeof e.loss=="string")r=Xd(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(a=>Xd(a));else if(e.loss!=null){r={};for(const a in e.loss)r[a]=Xd(e.loss[a])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(a=>Xd(a));else if(e.metrics!=null){i={};for(const a in e.metrics)i[a]=Xd(e.metrics[a])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const c=pbe(e);if(c.length===0)throw new me(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new me(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new me("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await ZM(this.getNamedWeights(t)),o={modelTopology:this.toJSON(null,!1),format:vNe,generatedBy:`TensorFlow.js tfjs-layers v${zq}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){o.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:h,specs:p}=await ZM(await this.optimizer.getWeights(),c);s.specs.push(...p),s.data=fbe([s.data,h])}return this.userDefinedMetadata!=null&&(T3(this.userDefinedMetadata,this.name,!0),o.userDefinedMetadata=this.userDefinedMetadata),o.weightData=s.data,o.weightSpecs=s.specs,e.save(o)}setUserDefinedMetadata(e){T3(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}dm.className="Model";We(dm);class Hq extends dm{}Hq.className="Functional";We(Hq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fv extends dm{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:RT("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new me(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof fv||e instanceof dm;let s;if(t){if(s=e,s.outputs.length!==1)throw new me("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new me("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new me("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=_Ee({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new me(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new me("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Iq(this.outputs[0])}this.inboundNodes=[],new LT({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Pf(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(mn(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new dm({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new io("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new io("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new io("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new io("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,a={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new me("Legacy serialization format not supported yet.");i=t}else te(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,a=t;const o=new e(a);if(!(o instanceof fv))throw new Ot(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const l of i){const h=Uc(l,void 0,r);r&&h.setFastWeightInitDuringBuild(!0),o.add(h)}return o}set stopTraining(e){if(this.model==null)throw new me("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new me("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}fv.className="Sequential";We(fv);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Kr=class extends ig{getConfig(){return{}}};class qq extends Kr{apply(e,t=1){return rEe(e,t)}}qq.className="elu";We(qq);class Kq extends Kr{apply(e){return hH(e)}}Kq.className="selu";We(Kq);class Xq extends Kr{apply(e){return qf(e)}}Xq.className="relu";We(Xq);class Zq extends Kr{apply(e){return ke(()=>cv(6,qf(e)))}}Zq.className="relu6";We(Zq);class Yq extends Kr{apply(e){return e}}Yq.className="linear";We(Yq);class Qq extends Kr{apply(e){return ng(e)}}Qq.className="sigmoid";We(Qq);class Jq extends Kr{apply(e){return aEe(e)}}Jq.className="hardSigmoid";We(Jq);class e9 extends Kr{apply(e){return qb(e)}}e9.className="softplus";We(e9);class t9 extends Kr{apply(e){return iEe(e)}}t9.className="softsign";We(t9);class n9 extends Kr{apply(e){return wT(e)}}n9.className="tanh";We(n9);let HA=class extends Kr{apply(e,t=-1){return X$(e,t)}};HA.className="softmax";We(HA);class s9 extends Kr{apply(e,t=-1){return sH(e,t)}}s9.className="logSoftmax";We(s9);class r9 extends Kr{apply(e){return ke(()=>ke(()=>{const t=Math.sqrt(2),s=ye(.5,Ke(1,Q5(yt(e,t))));return ye(e,s)}))}}r9.className="gelu";We(r9);class i9 extends Kr{apply(e){return ke(()=>ye(.5,ye(e,Ke(1,wT(ye(Wr(yt(2,Math.PI)),Ke(e,ye(.044715,Df(e,3)))))))))}}i9.className="gelu_new";We(i9);class a9 extends Kr{apply(e){return ke(()=>ye(e,wT(qb(e))))}}a9.className="mish";We(a9);class o9 extends Kr{apply(e,t=1){return ke(()=>ye(ng(ye(e,t)),e))}}o9.className="swish";We(o9);function Bh(n){return n.getClassName()}function bN(n,e={}){return e_(n,so.getMap().classNameMap,e,"activation")}function zh(n){if(n==null){const e={};return e.className="linear",e.config={},bN(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},bN(e)}else return n instanceof Kr?n:bN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bNe(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class l9 extends ig{}class c9 extends l9{constructor(e){super(),bNe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ke(()=>{let t=ur([1]);return this.hasL1&&(t=Ke(t,pt(ye(this.l1,li(e))))),this.hasL2&&(t=Ke(t,pt(ye(this.l2,n_(e))))),_e(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}c9.className="L1L2";We(c9);const k3={l1l2:"L1L2"};function Fn(n){return RA(n)}function $3(n,e={}){return e_(n,so.getMap().classNameMap,e,"regularizer")}function as(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in k3?k3[n]:n,config:{}};return $3(t)}else return n instanceof l9?n:$3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class u9 extends Ut{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=wt(e);let s=qf(e);return this.maxValue!=null&&(s=ka(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}u9.className="ReLU";We(u9);class h9 extends Ut{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=wt(e);return B$(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}h9.className="LeakyReLU";We(h9);class d9 extends Ut{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=rs(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=as(e.alphaRegularizer),this.alphaConstraint=er(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new me(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=mn(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Qs({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=wt(e),H$(e,this.alpha.read())}getConfig(){const e={alphaInitializer:hs(this.alphaInitializer),alphaRegularizer:Fn(this.alphaRegularizer),alphaConstraint:Js(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}d9.className="PReLU";We(d9);let f9=class extends Ut{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ot(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=wt(e);return ET(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};f9.className="ELU";We(f9);class p9 extends Ut{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=wt(e);return ye(s,tt($a(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}p9.className="ThresholdedReLU";We(p9);class m9 extends Ut{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new HA().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ke(()=>{let s=wt(e);const r=t.mask;if(r!=null){const i=ye(_t(rd(s.shape),tt(r,s.dtype)),_n(-1e9));s=Ke(s,i)}return this.axis instanceof Array?this.axis.length>1?ec(_t(s,rH(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}m9.className="Softmax";We(m9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fm(n,e,t){if(typeof n=="number")return Pf(n,e);if(n.length!==e)throw new me(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!eEe(r))throw new me(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Wo(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let a;return t==="same"?a=n:a=n-i+1,Math.floor((a+s-1)/s)}function Il(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+jh([t-e,0]);else if(s==="same")n=n*e;else throw new me(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qA(n,e){return ke(()=>(Cs(e),e==="channelsFirst"?on(n,[0,2,3,1]):n))}function g9(n,e){return ke(()=>(Cs(e),e==="channelsFirst"?on(n,[0,2,3,4,1]):n))}function _Ne(n,e,t,s=1,r="valid",i,a=1){return ke(()=>{if(i==null&&(i=Zo()),Cs(i),n.shape.length!==3)throw new me(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new me(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new me(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=on(n,[0,2,1])),r==="causal")throw new Ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=q5(n,e,s,r==="same"?"same":"valid","NWC",a);return t!=null&&(o=Jo(o,t)),o})}function A3(n,e,t,s=[1,1],r="valid",i,a,o=null){return ke(()=>{if(i==null&&(i=Zo()),Cs(i),n.rank!==3&&n.rank!==4)throw new me(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new me(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=qA(n,i);if(r==="causal")throw new Ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=k1e({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:a,dataFormat:"NHWC",bias:t,activation:o}),i==="channelsFirst"&&(l=on(l,[0,3,1,2])),l})}function xNe(n,e,t,s=[1,1,1],r="valid",i,a){return ke(()=>{if(i==null&&(i=Zo()),Cs(i),n.rank!==4&&n.rank!==5)throw new me(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new me(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let o=g9(n,i);if(r==="causal")throw new Ot("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=G_e(o,e,s,r==="same"?"same":"valid","NDHWC",a),t!=null&&(o=Jo(o,t)),i==="channelsFirst"&&(o=on(o,[0,4,1,2,3])),o})}class MT extends Ut{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",MT.verifyArgs(t),this.rank=e,hr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ot(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=fm(t.kernelSize,e,"kernelSize"),this.strides=fm(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Aa(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Cs(this.dataFormat),this.activation=zh(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=rs(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=er(t.biasConstraint),this.biasRegularizer=as(t.biasRegularizer),this.activityRegularizer=as(t.activityRegularizer),this.dilationRate=fm(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new me(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new me(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new me(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Nl("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!DA(e.kernelSize,"number",1,3))throw new me(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Bh(this.activation),useBias:this.useBias,biasInitializer:hs(this.biasInitializer),biasRegularizer:Fn(this.biasRegularizer),activityRegularizer:Fn(this.activityRegularizer),biasConstraint:Js(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class ag extends MT{constructor(e,t){super(e,t),this.kernel=null,ag.verifyArgs(t),this.filters=t.filters,hr(this.filters,"filters"),this.kernelInitializer=rs(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=er(t.kernelConstraint),this.kernelRegularizer=as(t.kernelRegularizer)}build(e){e=mn(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new me(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ke(()=>{e=wt(e);let s;const r=this.bias==null?null:this.bias.read(),i=dq(this.activation.getClassName());if(i!=null&&this.rank===2)s=A3(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=_Ne(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=A3(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=xNe(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ot("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=mn(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const a=Wo(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(a)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:hs(this.kernelInitializer),kernelRegularizer:Fn(this.kernelRegularizer),kernelConstraint:Js(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new me(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class a_ extends ag{constructor(e){super(2,e),a_.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!DA(e.kernelSize,"number",1,2))throw new me(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}a_.className="Conv2D";We(a_);class o_ extends ag{constructor(e){super(3,e),o_.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new me(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}o_.className="Conv3D";We(o_);class y9 extends a_{constructor(e){if(super(e),this.inputSpec=[new Qs({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new me(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=mn(e),e.length!==4)throw new me("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new me("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Qs({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ke(()=>{let s=wt(e);if(s.shape.length!==4)throw new me(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let a,o;this.dataFormat==="channelsFirst"?(a=2,o=3):(a=1,o=2);const l=r[a],c=r[o],h=this.kernelSize[0],p=this.kernelSize[1],m=this.strides[0],v=this.strides[1],_=Il(l,m,h,this.padding),w=Il(c,v,p,this.padding),T=[i,_,w,this.filters];this.dataFormat!=="channelsLast"&&(s=on(s,[0,2,3,1]));let E=K5(s,this.kernel.read(),T,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(E=on(E,[0,3,1,2])),this.bias!=null&&(E=Jo(E,this.bias.read(),this.dataFormat)),this.activation!=null&&(E=this.activation.apply(E)),E})}computeOutputShape(e){e=mn(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const a=this.kernelSize[0],o=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[s]=this.filters,t[r]=Il(t[r],l,a,this.padding),t[i]=Il(t[i],c,o,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}y9.className="Conv2DTranspose";We(y9);class v9 extends o_{constructor(e){if(super(e),this.inputSpec=[new Qs({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new me(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=mn(e),e.length!==5)throw new me("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new me("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Qs({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ke(()=>{let s=wt(e);if(s.shape.length!==5)throw new me(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let a,o,l;this.dataFormat==="channelsFirst"?(l=2,a=3,o=4):(l=1,a=2,o=3);const c=r[l],h=r[a],p=r[o],m=this.kernelSize[0],v=this.kernelSize[1],_=this.kernelSize[2],w=this.strides[0],T=this.strides[1],E=this.strides[2],C=Il(c,w,m,this.padding),A=Il(h,T,v,this.padding),D=Il(p,E,_,this.padding),F=[i,C,A,D,this.filters];this.dataFormat!=="channelsLast"&&(s=on(s,[0,2,3,4,1]));let W=q_e(s,this.kernel.read(),F,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(W=on(W,[0,4,1,2,3])),this.bias!==null&&(W=Jo(W,this.bias.read(),this.dataFormat)),this.activation!==null&&(W=this.activation.apply(W)),W})}computeOutputShape(e){e=mn(e);const t=e.slice();let s,r,i,a;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,a=4):(s=4,r=1,i=2,a=3);const o=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],h=this.strides[0],p=this.strides[1],m=this.strides[2];return t[s]=this.filters,t[r]=Il(t[r],h,o,this.padding),t[i]=Il(t[i],p,l,this.padding),t[a]=Il(t[a],m,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}v9.className="Conv3DTranspose";We(v9);class b9 extends ag{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new me("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new me("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new me(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=rs(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=as(t.depthwiseRegularizer),this.depthwiseConstraint=er(t.depthwiseConstraint),this.pointwiseInitializer=rs(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=as(t.pointwiseRegularizer),this.pointwiseConstraint=er(t.pointwiseConstraint)}build(e){if(e=mn(e),e.length<this.rank+2)throw new me(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new me(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let o=0;o<this.rank;++o)i.push(1);i.push(s*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Qs({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ke(()=>{e=wt(e);let s;if(this.rank===1)throw new Ot("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=on(e,[0,2,3,1])),s=dH(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Jo(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=on(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=hs(this.depthwiseInitializer),e.pointwiseInitializer=hs(this.pointwiseInitializer),e.depthwiseRegularizer=Fn(this.depthwiseRegularizer),e.pointwiseRegularizer=Fn(this.pointwiseRegularizer),e.depthwiseConstraint=Js(this.depthwiseConstraint),e.pointwiseConstraint=Js(this.pointwiseConstraint),e}}b9.className="SeparableConv";class _9 extends b9{constructor(e){super(2,e)}}_9.className="SeparableConv2D";We(_9);class FT extends ag{constructor(e){super(1,e),FT.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!DA(e.kernelSize,"number",1,1))throw new me(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}FT.className="Conv1D";We(FT);class x9 extends Ut{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ke(()=>{if(e=wt(e),this.dataFormat==="channelsLast"){const s=$x(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return $x(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=$x(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return $x(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}x9.className="Cropping2D";We(x9);class w9 extends Ut{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Cs(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,YSe(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ke(()=>{let s=wt(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=on(s,[0,2,3,1]);const i=this.size[0]*r[2],a=this.size[1]*r[3],o=this.interpolation==="nearest"?Fc.resizeNearestNeighbor(s,[i,a]):Fc.resizeBilinear(s,[i,a]);return on(o,[0,3,1,2])}else{const i=this.size[0]*r[1],a=this.size[1]*r[2];return this.interpolation==="nearest"?Fc.resizeNearestNeighbor(s,[i,a]):Fc.resizeBilinear(s,[i,a])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}w9.className="UpSampling2D";We(w9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wNe(n,e,t=[1,1],s="valid",r,i){return ke(()=>{r==null&&(r=Zo()),Cs(r);let a=qA(n,r);if(n.rank!==4)throw new me(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new me(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return a=P$(a,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(a=on(a,[0,3,1,2])),a})}class T9 extends MT{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=rs(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=er(e.depthwiseConstraint),this.depthwiseRegularizer=as(e.depthwiseRegularizer)}build(e){if(e=mn(e),e.length<4)throw new me(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new me(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ke(()=>{e=wt(e);let s=wNe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Jo(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=mn(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Wo(t,this.kernelSize[0],this.padding,this.strides[0]),a=Wo(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,a]:[e[0],i,a,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=hs(this.depthwiseInitializer),e.depthwiseRegularizer=Fn(this.depthwiseRegularizer),e.depthwiseConstraint=Js(this.depthwiseRegularizer),e}}T9.className="DepthwiseConv2D";We(T9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function S9(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new me("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function E9(n,e,t,s=!1,r,i,a=!1,o=!1){return ke(()=>{const l=e.shape.length;if(l<3)throw new me(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Xo(2,l));e=on(e,c),a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=tt(tt(r,"bool"),"float32"),r.rank===l-1&&(r=$i(r,-1)),r=on(r,c)),s&&(e=Lf(e,0),r!=null&&(r=Lf(r,0)));const h=[];let p,m=t;const v=e.shape[0],_=Of(e);let w;r!=null&&(w=Of(r));for(let E=0;E<v;++E){const C=_[E],A=ke(()=>n(C,m));if(r==null)p=A[0],m=A[1];else{const D=ke(()=>{const F=w[E],W=_t(co(F),F),B=Ke(ye(A[0],F),ye(m[0],W)),P=m.map((O,M)=>Ke(ye(A[1][M],F),ye(O,W)));return{output:B,newStates:P}});p=D.output,m=D.newStates}o&&h.push(p)}let T;return o&&(T=Yc(h,1)),[p,T,m]})}class ad extends Ut{constructor(e){super(e);let t;if(e.cell==null)throw new me("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new ZA({cells:e.cell}):t=e.cell,t.stateSize==null)throw new me("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Qs({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Xo(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){aC(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const a of t)i.push([e[0],a]);return[r].concat(i)}else return r}computeMask(e,t){return ke(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ot("Constants support is not implemented in RNN yet.");aC(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Qs({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!xn(this.stateSpec.map(a=>a.shape[a.shape.length-1]),i))throw new me(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(a=>new Qs({shape:[null,a]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ke(()=>{if(!this.stateful)throw new El("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new me("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>ur([s,r])):this.states_=[ur([s,this.cell.stateSize])];else if(e==null)Ht(this.states_),this.keptStates!=null&&(Ht(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>ur([s,r])):this.states_[0]=ur([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new me(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Ht(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,o=[s,a];if(!xn(i.shape,o))throw new me(`State ${r} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>Bl(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=S9(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let a=[],o=[];if(s!=null){t.initialState=s,a=a.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new Qs({shape:c.shape}));o=o.concat(this.stateSpec)}if(r!=null&&(t.constants=r,a=a.concat(r),this.numConstants=r.length),a[0]instanceof nc){const c=[e].concat(a),h=this.inputSpec.concat(o),p=this.inputSpec;this.inputSpec=h;const m=super.apply(c,t);return this.inputSpec=p,m}else return super.apply(e,t)}call(e,t){return ke(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=wt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new me(`RNN Layer has ${a} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},c=E9((_,w)=>{const T=this.cell.call([_].concat(w),o);return[T[0],T.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),h=c[0],p=c[1],m=c[2];this.stateful&&this.resetStates(m,r);const v=this.returnSequences?p:h;return this.returnState?[v].concat(m):v})}getInitialState(e){return ke(()=>{let t=ur(e.shape);return t=pt(t,[1,2]),t=t_(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?rC(t,[1,s]):t):this.cell.stateSize>1?[rC(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ad.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=Uc(r,s);return new e(Object.assign(t,{cell:i}))}}ad.className="RNN";We(ad);class jT extends Ut{}class KA extends jT{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,hr(this.units,"units"),this.activation=zh(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=rs(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rs(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rs(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=as(e.kernelRegularizer),this.recurrentRegularizer=as(e.recurrentRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.kernelConstraint=er(e.kernelConstraint),this.recurrentConstraint=er(e.recurrentConstraint),this.biasConstraint=er(e.biasConstraint),this.dropout=Rm([1,jh([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Rm([1,jh([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=mn(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ke(()=>{if(e=e,e.length!==2)throw new me(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vh({ones:()=>co(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vh({ones:()=>co(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const a=this.dropoutMask,o=this.recurrentDropoutMask;a!=null?i=Ul(ye(e,a),this.kernel.read()):i=Ul(e,this.kernel.read()),this.bias!=null&&(i=Jo(i,this.bias.read())),o!=null&&(s=ye(s,o));let l=Ke(i,Ul(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Bh(this.activation),useBias:this.useBias,kernelInitializer:hs(this.kernelInitializer),recurrentInitializer:hs(this.recurrentInitializer),biasInitializer:hs(this.biasInitializer),kernelRegularizer:Fn(this.kernelRegularizer),recurrentRegularizer:Fn(this.recurrentRegularizer),biasRegularizer:Fn(this.biasRegularizer),activityRegularizer:Fn(this.activityRegularizer),kernelConstraint:Js(this.kernelConstraint),recurrentConstraint:Js(this.recurrentConstraint),biasConstraint:Js(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}KA.className="SimpleRNNCell";We(KA);class N9 extends ad{constructor(e){e.cell=new KA(e),super(e)}call(e,t){return ke(()=>{this.cell.dropoutMask!=null&&(Ht(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ht(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}N9.className="SimpleRNN";We(N9);class XA extends jT{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new me("GRUCell does not support reset_after parameter set to true.");this.units=e.units,hr(this.units,"units"),this.activation=zh(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=zh(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=rs(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rs(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rs(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=as(e.kernelRegularizer),this.recurrentRegularizer=as(e.recurrentRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.kernelConstraint=er(e.kernelConstraint),this.recurrentConstraint=er(e.recurrentConstraint),this.biasConstraint=er(e.biasConstraint),this.dropout=Rm([1,jh([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Rm([1,jh([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=mn(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ke(()=>{if(e=e,e.length!==2)throw new me(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vh({ones:()=>co(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vh({ones:()=>co(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let o,l,c;0<this.dropout&&this.dropout<1&&(e=ye(e,i[0]));let h=Ul(e,this.kernel.read());this.useBias&&(h=Jo(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ye(r,a[0]));const p=this.recurrentKernel.read(),[m,v]=Ia(p,[2*this.units,this.units],p.rank-1),_=Ul(r,m),[w,T,E]=Ia(h,3,h.rank-1),[C,A]=Ia(_,2,_.rank-1);o=this.recurrentActivation.apply(Ke(w,C)),l=this.recurrentActivation.apply(Ke(T,A));const D=Ul(ye(l,r),v);c=this.activation.apply(Ke(E,D));const F=Ke(ye(o,r),ye(Ke(1,Ts(o)),c));return[F,F]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Bh(this.activation),recurrentActivation:Bh(this.recurrentActivation),useBias:this.useBias,kernelInitializer:hs(this.kernelInitializer),recurrentInitializer:hs(this.recurrentInitializer),biasInitializer:hs(this.biasInitializer),kernelRegularizer:Fn(this.kernelRegularizer),recurrentRegularizer:Fn(this.recurrentRegularizer),biasRegularizer:Fn(this.biasRegularizer),activityRegularizer:Fn(this.activityRegularizer),kernelConstraint:Js(this.kernelConstraint),recurrentConstraint:Js(this.recurrentConstraint),biasConstraint:Js(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}XA.className="GRUCell";We(XA);class I9 extends ad{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new XA(e),super(e)}call(e,t){return ke(()=>{this.cell.dropoutMask!=null&&(Ht(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ht(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}I9.className="GRU";We(I9);class BT extends jT{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,hr(this.units,"units"),this.activation=zh(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=zh(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=rs(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rs(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rs(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=as(e.kernelRegularizer),this.recurrentRegularizer=as(e.recurrentRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.kernelConstraint=er(e.kernelConstraint),this.recurrentConstraint=er(e.recurrentConstraint),this.biasConstraint=er(e.biasConstraint),this.dropout=Rm([1,jh([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Rm([1,jh([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=mn(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,a=this.units;r=new(t=class extends fo{apply(l,c){const h=i.apply([a]),p=new OA().apply([a]),m=i.apply([a*2]);return p3(p3(h,p),m)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ke(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new me(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vh({ones:()=>co(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vh({ones:()=>co(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=this.recurrentDropoutMask;let l,c,h,p;0<this.dropout&&this.dropout<1&&(e=ye(e,a[0]));let m=Ul(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ye(r,o[0])),m=Ke(m,Ul(r,this.recurrentKernel.read())),this.useBias&&(m=Jo(m,this.bias.read()));const[v,_,w,T]=Ia(m,4,m.rank-1);l=this.recurrentActivation.apply(v),c=this.recurrentActivation.apply(_),h=Ke(ye(c,i),ye(l,this.activation.apply(w))),p=this.recurrentActivation.apply(T);const E=ye(p,this.activation.apply(h));return[E,E,h]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Bh(this.activation),recurrentActivation:Bh(this.recurrentActivation),useBias:this.useBias,kernelInitializer:hs(this.kernelInitializer),recurrentInitializer:hs(this.recurrentInitializer),biasInitializer:hs(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Fn(this.kernelRegularizer),recurrentRegularizer:Fn(this.recurrentRegularizer),biasRegularizer:Fn(this.biasRegularizer),activityRegularizer:Fn(this.activityRegularizer),kernelConstraint:Js(this.kernelConstraint),recurrentConstraint:Js(this.recurrentConstraint),biasConstraint:Js(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}BT.className="LSTMCell";We(BT);class C9 extends ad{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new BT(e),super(e)}call(e,t){return ke(()=>{this.cell.dropoutMask!=null&&(Ht(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ht(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}C9.className="LSTM";We(C9);class ZA extends jT{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ke(()=>{e=e;let s=e.slice(1);const r=[];for(const o of this.cells.slice().reverse())Array.isArray(o.stateSize)?r.push(s.splice(0,o.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let a;for(let o=0;o<this.cells.length;++o){const l=this.cells[o];s=r[o],o===0?a=[e[0]].concat(s):a=[a[0]].concat(s),a=l.call(a,t),i.push(a.slice(1))}s=[];for(const o of i.slice().reverse())s.push(...o);return[a[0]].concat(s)})}build(e){aC(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{cf(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(Uc(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return oC(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let a=0;a<s.weights.length;++a)t.push([s.weights[a],i[a]])}VA(t)}}ZA.className="StackedRNNCells";We(ZA);function Vh(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,a=()=>i!=null?i(e(),t):bq(e(),t),o=()=>s_(a,e,s);return!r||r<=1?Bl(o().clone()):Array(r).fill(void 0).map(o).map(c=>Bl(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var TNe=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class k9 extends ad{constructor(e){if(e.unroll)throw new Ot("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ot("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Qs({ndim:5})]}call(e,t){return ke(()=>{if(this.cell.dropoutMask!=null&&(Ht(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ht(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new me("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ke(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],a=ur(i);return Array.isArray(t)?Array(t.length).fill(a):[a]})}resetStates(e,t=!1){ke(()=>{if(!this.stateful)throw new El("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new me("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>ur(i)):this.states_=[ur(i)];else if(e==null)Ht(this.states_),this.keptStates!=null&&(Ht(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>ur(i)):this.states_[0]=ur(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new me(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Ht(this.states_);for(let o=0;o<this.states_.length;++o){const l=e[o],c=i;if(!xn(l.shape,c))throw new me(`State ${o} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[o]=l}}this.states_=this.states_.map(o=>Bl(o.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:a,dilationRate:o}=this.cell,l=t==="channelsFirst",c=e[l?3:2],h=e[l?4:3],p=Wo(c,r[0],i,a[0],o[0]),m=Wo(h,r[1],i,a[1],o[1]);return[...e.slice(0,2),...l?[s,p,m]:[p,m,s]]}}k9.className="ConvRNN2D";class YA extends BT{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:a,dilationRate:o}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,hr(this.filters,"filters"),this.kernelSize=fm(s,2,"kernelSize"),this.kernelSize.forEach(l=>hr(l,"kernelSize")),this.strides=fm(r||1,2,"strides"),this.strides.forEach(l=>hr(l,"strides")),this.padding=i||"valid",Aa(this.padding),this.dataFormat=a||"channelsLast",Cs(this.dataFormat),this.dilationRate=fm(o||1,2,"dilationRate"),this.dilationRate.forEach(l=>hr(l,"dilationRate"))}build(e){var t;e=mn(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new me(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,a=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const o=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,h=this.filters;l=new(t=class extends fo{apply(m,v){const _=c.apply([h]),w=rd([h]),T=c.apply([h*2]);return LA([_,w,T])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ke(()=>{if(e.length!==3)throw new me(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],a=e[2],o=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vh({ones:()=>co(r),rate:this.dropout,training:s,count:o,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(K,ie,de)=>!ie||!ie[de]?K:ye(ie[de],K);let h=c(r,l,0),p=c(r,l,1),m=c(r,l,2),v=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vh({ones:()=>co(i),rate:this.recurrentDropout,training:s,count:o,dropoutFunc:this.dropoutFunc}));const _=this.recurrentDropoutMask;let w=c(i,_,0),T=c(i,_,1),E=c(i,_,2),C=c(i,_,3);const A=3,[D,F,W,B]=Ia(this.kernel.read(),o,A),[P,O,M,k]=this.useBias?Ia(this.bias.read(),o):[null,null,null,null];h=this.inputConv(h,D,P,this.padding),p=this.inputConv(p,F,O,this.padding),m=this.inputConv(m,W,M,this.padding),v=this.inputConv(v,B,k,this.padding);const[V,G,ae,J]=Ia(this.recurrentKernel.read(),o,A);w=this.recurrentConv(w,V),T=this.recurrentConv(T,G),E=this.recurrentConv(E,ae),C=this.recurrentConv(C,J);const X=this.recurrentActivation.apply(Ke(h,w)),se=this.recurrentActivation.apply(Ke(p,T)),ne=Ke(ye(se,a),ye(X,this.activation.apply(Ke(m,E)))),le=ye(this.recurrentActivation.apply(Ke(v,C)),this.activation.apply(ne));return[le,le,ne]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=TNe(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Rf(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Jo(i,s,this.dataFormat):i}recurrentConv(e,t){return Rf(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}YA.className="ConvLSTM2DCell";We(YA);class $9 extends k9{constructor(e){const t=new YA(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}$9.className="ConvLSTM2D";We($9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class QA extends Ut{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return s_(()=>bq(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}QA.className="Dropout";We(QA);class A9 extends QA{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}A9.className="SpatialDropout1D";We(A9);class R9 extends Ut{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,hr(this.units,"units"),this.activation=zh(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=rs(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=rs(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=er(e.kernelConstraint),this.biasConstraint=er(e.biasConstraint),this.kernelRegularizer=as(e.kernelRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.activityRegularizer=as(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=mn(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=mn(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e),r=dq(this.activation.getClassName());let i;return r!=null?i=Ul(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Ul(s,this.kernel.read()),this.bias!=null&&(i=Jo(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Bh(this.activation),useBias:this.useBias,kernelInitializer:hs(this.kernelInitializer),biasInitializer:hs(this.biasInitializer),kernelRegularizer:Fn(this.kernelRegularizer),biasRegularizer:Fn(this.biasRegularizer),activityRegularizer:Fn(this.activityRegularizer),kernelConstraint:Js(this.kernelConstraint),biasConstraint:Js(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}R9.className="Dense";We(R9);class D9 extends Ut{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=mn(e);for(const t of e.slice(1))if(t==null)throw new me(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Sh(e,1)]}call(e,t){return ke(()=>{this.invokeCallHook(e,t);let s=wt(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=on(s,r)}return sEe(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}D9.className="Flatten";We(D9);class L9 extends Ut{constructor(e){super(e),this.supportsMasking=!0,this.activation=zh(e.activation)}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e);return this.activation.apply(s)})}getConfig(){const e={activation:Bh(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}L9.className="Activation";We(L9);class O9 extends Ut{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ke(()=>(e=wt(e),tEe(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}O9.className="RepeatVector";We(O9);class P9 extends Ut{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,a=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(a===null)a=l;else throw new me("Can only specifiy one unknown dimension.");else i*=c}const o=Sh(e);if(a!==null){if(i===0||o%i!==0)throw new me(s);r[a]=o/i}else if(o!==i)throw new me(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return _e(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}P9.className="Reshape";We(P9);class M9 extends Ut{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Xo(1,e.dims.length+1);if(!xn(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Qs({ndim:this.dims.length+1})]}computeOutputShape(e){e=mn(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return on(wt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}M9.className="Permute";We(M9);class F9 extends Ut{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=wt(e);return YI(r1(s,this.maskValue),-1)}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e),a=YI(r1(s,this.maskValue),-1,!0);return ye(s,tt(a,s.dtype))})}}F9.className="Masking";We(F9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class j9 extends Ut{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(En(e.inputLength))}this.inputDim=e.inputDim,hr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,hr(this.outputDim,"outputDim"),this.embeddingsInitializer=rs(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=as(e.embeddingsRegularizer),this.activityRegularizer=as(e.activityRegularizer),this.embeddingsConstraint=er(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ke(()=>this.maskZero?(e=wt(e),r1(e,ln(e))):null)}computeOutputShape(e){if(e=mn(e),this.inputLength==null)return[...e,this.outputDim];const t=En(this.inputLength);if(t.length!==e.length-1)throw new me(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],a=e[r+1];if(i!=null&&a!=null&&i!==a)throw new me(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=a),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ke(()=>{this.invokeCallHook(e,t);let s=wt(e);s.dtype!=="int32"&&(s=Vl(s,"int32"));const r=vq(this.embeddings.read(),_e(s,[s.size]));return _e(r,mn(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:hs(this.embeddingsInitializer),embeddingsRegularizer:Fn(this.embeddingsRegularizer),activityRegularizer:Fn(this.activityRegularizer),embeddingsConstraint:Js(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}j9.className="Embedding";We(j9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zf extends Ut{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ot}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],a=t[r];if(i==null||a==null||i<0||a<0)s.push(null);else if(i===1)s.push(a);else if(a===1)s.push(i);else{if(i!==a)throw new me("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[mn(e)]),e=e,e.length<2)throw new me(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Th(t),t.length>1)throw new me(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const a=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,a)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Th(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ke(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=jh(r);for(let a of e){const o=a.rank;for(let l=0;l<i-o;++l)a=t_(a,1);s.push(a)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const c=l.rank;if(c==null){const h=l.shape,p=h[0],m=h.slice(1).concat([p]);let v=_e(l,[p].concat(Sh(h.slice(1))));v=on(v,[1,0]),v=_e(v,m),s.push(v),i=!0}else if(c>1){const h=Xo(1,c).concat([0]);s.push(on(l,h)),i=!0}else s.push(l)}let a=this.mergeFunction(s);const o=a.rank;if(i){if(o==null){const l=a.shape,c=l.length,h=l[c-1],p=[h].concat(l.slice(0,l.length-1));a=_e(on(_e(a,[-1,h]),[1,0]),p)}else if(o>1){const l=[o-1].concat(Xo(0,o-1));a=on(a,l)}}return a}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Th(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ke(()=>{if(t==null)return null;if(!Array.isArray(t))throw new me("`mask` should be an Array");if(!Array.isArray(e))throw new me("`inputs` should be an Array");if(t.length!==e.length)throw new me(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:$i(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=Zc(s,t[r]);return s})}}class B9 extends Zf{constructor(e){super(e)}mergeFunction(e){return ke(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ke(t,e[s]);return t})}}B9.className="Add";We(B9);class z9 extends Zf{constructor(e){super(e)}mergeFunction(e){return ke(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ye(t,e[s]);return t})}}z9.className="Multiply";We(z9);class V9 extends Zf{constructor(e){super(e)}mergeFunction(e){return ke(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ke(t,e[s]);return ye(1/e.length,t)})}}V9.className="Average";We(V9);class U9 extends Zf{constructor(e){super(e)}mergeFunction(e){return ke(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=sd(t,e[s]);return t})}}U9.className="Maximum";We(U9);class G9 extends Zf{constructor(e){super(e)}mergeFunction(e){return ke(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=cv(t,e[s]);return t})}}G9.className="Minimum";We(G9);class W9 extends Zf{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new me("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let a=!1;for(const o of s)if(xn(o,i)){a=!0;break}a||s.push(i)}if(s.length>1)throw new me("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ke(()=>LA(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new me("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new me("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new me("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new me(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ke(()=>{let s=!0;if(t.forEach(a=>{if(a!=null){s=!1;return}}),s)return null;const r=[];for(let a=0;a<e.length;++a)t[a]==null?r.push(tt(co(e[a]),"bool")):t[a].rank<e[a].rank?r.push($i(t[a],-1)):r.push(t[a]);const i=Ri(r,this.axis);return H5(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}W9.className="Concatenate";We(W9);function dy(n,e){for(;n<0;)n+=e;return n}function SNe(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Ot("batchDot is not implemented for tensors of 4D or higher rank yet");if(te(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),te(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Ot("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return ke(()=>{let a;if(s>r){a=s-r;const l=[];for(let c=0;c<a;++c)l.push(1);e=_e(e,e.shape.concat(l))}else if(r>s){a=r-s;const l=[];for(let c=0;c<a;++c)l.push(1);n=_e(n,n.shape.concat(l))}else a=0;let o;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?o=pt(ye(n,e),i[0]):o=pt(ye(on(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,c=i[1]===e.shape.length-1;o=bn(n,e,l,c)}if(a>0){let l;s>r?l=s+r-3:l=s-1;const c=[];for(let h=l;h<l+a;++h)c.push(h);o=Xb(o,c)}return o.shape.length===1&&(o=$i(o,1)),o})}class H9 extends Zf{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){te(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new Ot("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new me(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new me(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,a)=>dy(i,e[a].shape.length)):r=[dy(this.axes,t.shape.length),dy(this.axes,s.shape.length)],this.normalize&&(t=h1(t,r[0]),s=h1(s,r[1])),SNe(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[dy(this.axes,e.length),dy(this.axes,t.length)],s}computeOutputShape(e){te(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new Ot("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}H9.className="Dot";We(H9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class q9 extends Ut{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e);return s_(()=>Ke(DT(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}q9.className="GaussianNoise";We(q9);class K9 extends Ut{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ke(()=>{this.invokeCallHook(e,t);const s=wt(e);return this.rate>0&&this.rate<1?s_(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ye(s,DT(s.shape,1,i))},()=>s,t.training||!1):s})}}K9.className="GaussianDropout";We(K9);class X9 extends Ut{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||wt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ke(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return s_(()=>{const i=wt(e),o=-1.6732632423543772*1.0507009873554805;let l=Hf(Kb(s),this.rate);l=Vl(l,"float32");const c=((1-this.rate)*(1+this.rate*o**2))**-.5,h=-c*o*this.rate,p=Ke(ye(i,l),ye(Ke(l,-1),o));return Ke(ye(p,c),h)},()=>wt(e),t.training||!1)}return e})}}X9.className="AlphaDropout";We(X9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pv(n,e,t,s,r,i=.001){let a;if(n.rank===2)a=__e(n,e,t,s,r,i);else if(n.rank===3)a=w_e(n,e,t,s,r,i);else if(n.rank===4)a=S_e(n,e,t,s,r,i);else throw new Ot(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return a}function ENe(n,e,t,s,r=.001){return ke(()=>{const i=U$(n,s),a=i.mean,o=i.variance;return[pv(n,a,o,t,e,r),a,o]})}function NNe(n,e,t,s,r=.001){return ke(()=>{const i=U$(n,s),a=i.mean,o=i.variance,l=[];for(const _ of Xo(0,n.rank))s.indexOf(_)!==-1?l.push(1):l.push(n.shape[_]);const c=_e(a,l),h=_e(o,l),p=e==null?null:_e(e,l),m=t==null?null:_e(t,l);return[pv(n,c,h,m,p,r),a,o]})}function INe(n,e,t,s,r=.001){return xn(s.slice().sort(),Xo(0,n.rank-1))?ENe(n,e,t,s,r):NNe(n,e,t,s,r)}class Z9 extends Ut{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=rs(e.betaInitializer||"zeros"),this.gammaInitializer=rs(e.gammaInitializer||"ones"),this.movingMeanInitializer=rs(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=rs(e.movingVarianceInitializer||"ones"),this.betaConstraint=er(e.betaConstraint),this.gammaConstraint=er(e.gammaConstraint),this.betaRegularizer=as(e.betaRegularizer),this.gammaRegularizer=as(e.gammaRegularizer)}build(e){e=mn(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new me(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Qs({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ke(()=>{const s=t.training==null?!1:t.training,r=wt(e),i=r.shape,a=i.length,o=Xo(0,a),l=this.axis>=0?this.axis:this.axis+a;o.splice(l,1);const c=Pf(1,a);c[l]=i[l];const h=o.slice();h.sort();const p=!xn(h,Xo(0,a).slice(0,a-1)),m=()=>{if(p){const C=_e(this.movingMean.read(),c),A=_e(this.movingVariance.read(),c),D=this.center?_e(this.beta.read(),c):null,F=this.scale?_e(this.gamma.read(),c):null;return pv(r,C,A,D,F,this.epsilon)}else return pv(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[v,_,w]=INe(r,this.gamma.read(),this.beta.read(),o,this.epsilon),T=(C,A,D)=>{ke(()=>{const F=1-D,W=C.read(),B=ye(_t(W,A),F);C.write(_t(W,B))})};return(()=>{T(this.movingMean,_,this.momentum),T(this.movingVariance,w,this.momentum)})(),v})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:hs(this.betaInitializer),gammaInitializer:hs(this.gammaInitializer),movingMeanInitializer:hs(this.movingMeanInitializer),movingVarianceInitializer:hs(this.movingVarianceInitializer),betaRegularizer:Fn(this.betaRegularizer),gammaRegularizer:Fn(this.gammaRegularizer),betaConstraint:Js(this.betaConstraint),gammaConstraint:Js(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Z9.className="BatchNormalization";We(Z9);class Y9 extends Ut{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=rs(e.betaInitializer||"zeros"),this.gammaInitializer=rs(e.gammaInitializer||"ones"),this.betaRegularizer=as(e.betaRegularizer),this.gammaRegularizer=as(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=mn(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Th(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=wt(e),r=s.shape,i=r.length;return ke(()=>{let{mean:o,variance:l}=U$(s,this.axis,!0);const c=Pf(1,i);for(const w of this.axis)c[w]=r[w];const h=w=>w!=null&&w.shape.length!==i?_e(w,c):w;let p=this.scale?h(this.gamma.read()):null,m=this.center?h(this.beta.read()):null;const v=[],_=[];for(let w=0;w<i;++w)this.axis.indexOf(w)!==-1?(v.push(r[w]),_.push(1)):(v.push(1),_.push(r[w]));return o=Bo(o,v),l=Bo(l,v),p!=null&&(p=Bo(p,_)),m!=null&&(m=Bo(m,_)),pv(s,o,l,m,p,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:hs(this.betaInitializer),gammaInitializer:hs(this.gammaInitializer),betaRegularizer:Fn(this.betaRegularizer),gammaRegularizer:Fn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}Y9.className="LayerNormalization";We(Y9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CNe(n,e,t){return ke(()=>{if(n.rank!==4)throw new me(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new me("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Zo()),t!=="channelsLast"&&t!=="channelsFirst")throw new me(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],G$(n,s)})}class Q9 extends Ut{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Zo():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new me(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new me(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new me(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Qs({ndim:4})]}computeOutputShape(e){e=mn(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ke(()=>CNe(wt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Q9.className="ZeroPadding2D";We(Q9);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zT(n,e,t,s,r,i){return ke(()=>{Cs(r),pq(i),Aa(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=Zo()),i==null&&(i="max"),n=qA(n,r);let a;const o=s==="same"?"same":"valid";return i==="max"?a=V$(n,e,t,o):a=R$(n,e,t,o),r==="channelsFirst"&&(a=on(a,[0,3,1,2])),a})}function J9(n,e,t,s,r,i){return ke(()=>{Cs(r),pq(i),Aa(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Zo()),i==null&&(i="max"),n=g9(n,r);let a;const o=s==="same"?"same":"valid";return i==="max"?a=l0e(n,e,t,o):a=u_e(n,e,t,o),r==="channelsFirst"&&(a=on(a,[0,4,1,2,3])),a})}class e8 extends Ut{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new me(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(hr(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new me(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);hr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Aa(this.padding),this.inputSpec=[new Qs({ndim:3})]}computeOutputShape(e){e=mn(e);const t=Wo(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ke(()=>{this.invokeCallHook(e,t),e=t_(wt(e),2);const s=this.poolingFunction(wt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Xb(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class t8 extends e8{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Cs(i),Aa(r),zT(e,t,s,r,i,"max")}}t8.className="MaxPooling1D";We(t8);class n8 extends e8{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Cs(i),Aa(r),zT(e,t,s,r,i,"avg")}}n8.className="AveragePooling1D";We(n8);class s8 extends Ut{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new me(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];hr(this.poolSize,"poolSize"),hr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Cs(this.dataFormat),Aa(this.padding),this.inputSpec=[new Qs({ndim:4})]}computeOutputShape(e){e=mn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Wo(t,this.poolSize[0],this.padding,this.strides[0]),s=Wo(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ke(()=>(this.invokeCallHook(e,t),this.poolingFunction(wt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class r8 extends s8{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Cs(i),Aa(r),zT(e,t,s,r,i,"max")}}r8.className="MaxPooling2D";We(r8);class i8 extends s8{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Cs(i),Aa(r),zT(e,t,s,r,i,"avg")}}i8.className="AveragePooling2D";We(i8);class a8 extends Ut{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new me(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];hr(this.poolSize,"poolSize"),hr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Cs(this.dataFormat),Aa(this.padding),this.inputSpec=[new Qs({ndim:5})]}computeOutputShape(e){e=mn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Wo(t,this.poolSize[0],this.padding,this.strides[0]),s=Wo(s,this.poolSize[1],this.padding,this.strides[1]),r=Wo(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ke(()=>(this.invokeCallHook(e,t),this.poolingFunction(wt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class o8 extends a8{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Cs(i),Aa(r),J9(e,t,s,r,i,"max")}}o8.className="MaxPooling3D";We(o8);class l8 extends a8{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Cs(i),Aa(r),J9(e,t,s,r,i,"avg")}}l8.className="AveragePooling3D";We(l8);class c8 extends Ut{constructor(e){super(e),this.inputSpec=[new Qs({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Ot}}class u8 extends c8{constructor(e){super(e||{})}call(e,t){return ke(()=>{const s=wt(e);return Ps(s,1)})}}u8.className="GlobalAveragePooling1D";We(u8);class h8 extends c8{constructor(e){super(e||{})}call(e,t){return ke(()=>{const s=wt(e);return Go(s,1)})}}h8.className="GlobalMaxPooling1D";We(h8);class d8 extends Ut{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Cs(this.dataFormat),this.inputSpec=[new Qs({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Ot}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class f8 extends d8{call(e,t){return ke(()=>{const s=wt(e);return this.dataFormat==="channelsLast"?Ps(s,[1,2]):Ps(s,[2,3])})}}f8.className="GlobalAveragePooling2D";We(f8);class p8 extends d8{call(e,t){return ke(()=>{const s=wt(e);return this.dataFormat==="channelsLast"?Go(s,[1,2]):Go(s,[2,3])})}}p8.className="GlobalMaxPooling2D";We(p8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class m8 extends Ut{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=Uc(r,s);delete t.layer;const a={layer:i};return Object.assign(a,t),new e(a)}}class g8 extends m8{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=mn(e),e.length<3)throw new me(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=mn(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ke(()=>(e=wt(e),E9((a,o)=>[wt(this.layer.call(a,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}g8.className="TimeDistributed";We(g8);function kNe(n){Xf(ZSe,"BidirectionalMergeMode",n)}const $Ne="concat";class y8 extends m8{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Uc(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Uc(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?$Ne:e.mergeMode,kNe(this.mergeMode),e.weights)throw new Ot("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Ai(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=S9(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const a=[],o=[];if(s!=null){const c=s.length;if(c%2>0)throw new me("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,a.push(...s);const h=s.map(p=>new Qs({shape:p.shape}));this.forwardLayer.stateSpec=h.slice(0,c/2),this.backwardLayer.stateSpec=h.slice(c/2),o.push(...h)}if(r!=null)throw new Ot("Support for constants in Bidirectional layers is not implemented yet.");const l=a[0]instanceof nc;for(const c of a)if(c instanceof nc!==l)throw new me("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(a),h=this.inputSpec.concat(o),p=this.inputSpec;this.inputSpec=h;const m=super.apply(c,t);return this.inputSpec=p,m}else return super.apply(e,t)}call(e,t){return ke(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let a;this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Lf(i,1));let o;return this.mergeMode==="concat"?o=LA([r,i]):this.mergeMode==="sum"?o=Ke(r,i):this.mergeMode==="ave"?o=ye(.5,Ke(r,i)):this.mergeMode==="mul"?o=ye(r,i):this.mergeMode==null&&(o=[r,i]),this.returnState?this.mergeMode==null?o.concat(a):[o].concat(a):o})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){cf(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),cf(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(a=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Uc(t.layer);if(delete t.layer,t.numConstants!=null)throw new Ot("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}y8.className="Bidirectional";We(y8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class v8 extends Ut{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ke(()=>(e=wt(e),e.dtype!=="float32"&&(e=Vl(e,"float32")),Ke(ye(e,this.scale),this.offset)))}}v8.className="Rescaling";We(v8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:ANe,cropAndResize:RNe}=Fc;class b8 extends Ut{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,a,o,l){return ke(()=>{let c,h=!1;const p=t/a,m=s/o,v=(r+t)/a,_=(i+s)/o,w=[p,m,v,_],T=[];e.rank===3?(h=!0,c=Yc([e])):c=e;for(let F=0;F<c.shape[0];F++)T.push(w);const E=P5(T,[T.length,4]),C=uv(0,T.length,1,"int32"),D=RNe(c,E,C,[r,i],"nearest");return Vl(h?wt(Of(D)):D,l)})}upsize(e,t,s,r){return ke(()=>{const i=ANe(e,[t,s]);return Vl(i,r)})}call(e,t){return ke(()=>{const s=wt(e),r=s.dtype,i=s.shape,a=i[i.length-3],o=i[i.length-2];let l=0;a!==this.height&&(l=Math.floor((a-this.height)/2));let c=0;return o!==this.width&&(c=Math.floor((o-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,a,o,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=mn(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}b8.className="CenterCrop";We(b8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DNe(n,e,t,s){let r=wt(n);if(r.dtype!=="int32"&&(r=Vl(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=$i(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=$i(r,-1)),r.rank>2)throw new me(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const a=["multiHot","oneHot"].includes(e),o=r;let l;if(typeof s<"u"&&e==="count"?l=JM(o,s,t,a):l=JM(o,[],t,a),e!=="tfIdf")return l;if(s)return ye(l,s);throw new me("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _8 extends Ut{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=mn(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ke(()=>{e=wt(e),e.dtype!=="int32"&&(e=Vl(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new me(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=wt(t.countWeights)}const r=Go(e),i=n1(e),a=$a(this.numTokens,r).bufferSync().get(0),o=Hf(i,0).bufferSync().get(0);if(!(a&&o))throw new me(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return DNe(e,this.outputMode,this.numTokens,s)})}}_8.className="CategoryEncoding";We(_8);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const LNe=["bilinear","nearest"],R3=new Set(LNe);class x8 extends Ut{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(R3.has(e.interpolation))this.interpolation=e.interpolation;else throw new me(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=mn(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ke(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Fc.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Fc.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...R3]} are supported`)})}}x8.className="Resizing";We(x8);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class w8{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}w8.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class T8 extends Ut{constructor(e){super(e),this.randomGenerator=new w8(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}T8.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ONe=["bilinear","nearest"],D3=new Set(ONe);class S8 extends T8{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new me(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new me(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new me(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(D3.has(s))this.interpolation=s;else throw new me(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=mn(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ke(()=>{const s=wt(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Kb([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const a=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Fc.resizeBilinear(e,a);case"nearest":return Fc.resizeNearestNeighbor(e,a);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...D3]} are supported`)}})}}S8.className="RandomWidth";We(S8);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PNe=Re();PNe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var L3;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(L3||(L3={}));var O3;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(O3||(O3={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var P3;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(P3||(P3={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function it(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&te(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MNe=_H;class VT extends P2{nextDataId(){return VT.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new GW(this,_l())}write(e,t,s){this.firstUse&&(this.firstUse=!1,Re().get("IS_NODE")&&Ta(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Zv(s[0])){const i=s.map(a=>wh(a));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Qc(r,i)}return Eve(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Fh(r));return zt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return zt(e.shape,e.dtype,t)}makeOutput(e,t,s){return _l().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=ki();return e(),{kernelMs:ki()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){it([e],"where");const t=this.readSync(e.dataId);return MNe(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}VT.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const FNe=n=>{const{x:e}=n.inputs,t=n.backend;it(e,"abs");let s=new Float32Array(Me(e.shape));const r=t.data.get(e.dataId).values;return s=E8(r),t.makeOutput(s,e.shape,e.dtype)},jNe={kernelName:bw,backendName:"cpu",kernelFunc:FNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(n){return(e,t,s,r,i)=>{const a=Dt(e,t),o=a.length,l=ht(a),c=Me(a),h=Ur(i,c),p=e.length,m=t.length,v=ht(e),_=ht(t),w=$m(e,a),T=$m(t,a);if(w.length+T.length===0)for(let E=0;E<h.length;++E)h[E]=n(s[E%s.length],r[E%r.length]);else for(let E=0;E<h.length;++E){const C=Jm(E,o,l),A=C.slice(-p);w.forEach(B=>A[B]=0);const D=jl(A,p,v),F=C.slice(-m);T.forEach(B=>F[B]=0);const W=jl(F,m,_);h[E]=n(s[D],r[W])}return[h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ki(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,o=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(o.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",a)},o}const BNe={kernelName:X2,backendName:"cpu",kernelFunc:Ki};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g1(n,e,t="float32"){if(t==="complex64"){const r=g1(n,e,"float32"),i=g1(n,e,"float32");return Ki({inputs:{real:r,imag:i},backend:n})}const s=Gr(Me(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sc(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const zNe={kernelName:yb,backendName:"cpu",kernelFunc:sc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mf(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const VNe={kernelName:b$,backendName:"cpu",kernelFunc:Mf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=Wf([0],t),[i,a]=ks((o,l)=>o!==l?1:0)(e,[],n,r,"bool");return[a,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Uh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return sc({inputs:{x:r},backend:t});const h=g1(t,r.shape,r.dtype),p=Uh({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),m=Ki({inputs:{real:p,imag:h},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),m}if(r.dtype==="complex64"){const h=Mf({inputs:{input:r},backend:t}),p=Uh({inputs:{x:h},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(h),p}if(!qW(r.dtype,i)){const h=sc({inputs:{x:r},backend:t});return{dataId:h.dataId,shape:h.shape,dtype:i}}const a=t.data.get(r.dataId).values,[o,l,c]=N8(a,r.shape,r.dtype,i);return t.makeTensorInfo(o,l,c)}const UNe={kernelName:rb,backendName:"cpu",kernelFunc:Uh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nr(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a,b:o}=r,l=i;it([a,o],n);const c=l.data.get(a.dataId).values,h=l.data.get(o.dataId).values,p=a.dtype==="string"?Jc(c):c,m=a.dtype==="string"?Jc(h):h,v=s||a.dtype,[_,w]=e(a.shape,o.shape,p,m,v);return l.makeTensorInfo(w,v,_)}:({inputs:r,backend:i})=>{const{a,b:o}=r,l=i;if(a.dtype==="complex64"||o.dtype==="complex64"){const c=Uh({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(c.dataId),p=h.complexTensorInfos.real,m=h.complexTensorInfos.imag,v=l.data.get(p.dataId).values,_=l.data.get(m.dataId).values,w=Uh({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),T=l.data.get(w.dataId),E=T.complexTensorInfos.real,C=T.complexTensorInfos.imag,A=l.data.get(E.dataId).values,D=l.data.get(C.dataId).values,[F,W,B]=t(a.shape,o.shape,v,_,A,D),P=l.makeTensorInfo(B,"float32",F),O=l.makeTensorInfo(B,"float32",W),M=Ki({inputs:{real:P,imag:O},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(P),l.disposeIntermediateTensorInfo(O),M}else{const c=l.data.get(a.dataId).values,h=l.data.get(o.dataId).values,p=s||a.dtype,[m,v]=e(a.shape,o.shape,c,h,p);return l.makeTensorInfo(v,p,m)}}}function JA(n){return(e,t,s,r,i,a)=>{const o=Dt(e,t),l=Me(o),c=o.length,h=ht(o),p=Ur("float32",l),m=Ur("float32",l),v=$m(e,o),_=$m(t,o),w=Qc(s,r),T=Qc(i,a),E=e.length,C=ht(e),A=t.length,D=ht(t);if(v.length+_.length===0)for(let F=0;F<p.length;F++){const W=F%w.length,B=F%T.length,P=n(w[W*2],w[W*2+1],T[B*2],T[B*2+1]);p[F]=P.real,m[F]=P.imag}else for(let F=0;F<p.length;F++){const W=Jm(F,c,h),B=W.slice(-E);v.forEach(V=>B[V]=0);const P=jl(B,E,C),O=W.slice(-A);_.forEach(V=>O[V]=0);const M=jl(O,A,D),k=n(w[P*2],w[P*2+1],T[M*2],T[M*2+1]);p[F]=k.real,m[F]=k.imag}return[p,m,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I8=ks(((n,e)=>n+e)),GNe=JA(((n,e,t,s)=>({real:n+t,imag:e+s}))),Dm=nr(eg,I8,GNe),WNe={kernelName:eg,backendName:"cpu",kernelFunc:Dm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(n,e,t,s,r){const i=Me(s),a=Gr(r,t);for(let o=0;o<n.length;o++){const l=n[o];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?a[l]+=e[o]:a[l]+=1)}return a}function C8(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],a=zt([r,t],e.dtype);for(let o=0;o<r;o++)for(let l=0;l<i;l++){const c=n.get(o,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(s?a.set(1,o,c):e.size>0?a.set(a.get(o,c)+e.get(o,l),o,c):a.set(a.get(o,c)+1,o,c))}return a}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8=ks(((n,e)=>n&e)),HNe=nr(K2,k8),qNe={kernelName:K2,backendName:"cpu",kernelFunc:HNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ac(n){return(e,t,s)=>{const r=ws(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function In(n,e,t){const s=ac(e);return od(n,s,t)}function od(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:a}=s;it(a,n);const o=i,l=o.data.get(a.dataId).values;let c;if(a.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=Jc(l)}else c=l;const h=t||a.dtype,p=e(c,h,r);return o.makeTensorInfo(a.shape,h,p)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8=ac(n=>Math.ceil(n)),KNe=od(ib,$8),XNe={kernelName:ib,backendName:"cpu",kernelFunc:KNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(n,e,t,s){const r=ws(t,Me(e));if(s&&t!=="string"){let i=0;n.forEach(a=>{const o=Me(a.shape);r.set(a.vals,i),i+=o})}else{let i=0;n.forEach(a=>{const o=t==="string"?Jc(a.vals):a.vals;let l=0;for(let c=0;c<a.shape[0];++c){const h=c*e[1]+i;for(let p=0;p<a.shape[1];++p)r[h+p]=o[l++]}i+=a.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8=ks((n,e)=>n===e?1:0),D8=nr(Lw,R8,null,"bool"),ZNe={kernelName:Lw,backendName:"cpu",kernelFunc:D8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8=ac(n=>Math.exp(n)),O8=od(db,L8,"float32"),YNe={kernelName:db,backendName:"cpu",kernelFunc:O8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8=ac(n=>Math.expm1(n)),QNe=od(fb,P8),JNe={kernelName:fb,backendName:"cpu",kernelFunc:QNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8=ac(n=>Math.floor(n)),eIe=od(pb,M8),tIe={kernelName:pb,backendName:"cpu",kernelFunc:eIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8=ks((n,e)=>Math.floor(n/e)),nIe=nr(mb,F8,null,"int32"),sIe={kernelName:mb,backendName:"cpu",kernelFunc:nIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(n,e,t,s,r,i,a,o,l){const c=zt([s,i],t);for(let h=0;h<s;h++){const p=[];let m=0;for(let v=0;v<r;v++){const _=n[h*r+v];m+=_*a[v],p.push(_)}if(m<0||m>=l/i)throw new Error(`Invalid indices: ${p} does not index into ${o}`);for(let v=0;v<i;v++)c.values[h*i+v]=e.get(...e.indexToLoc(m*i+v))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B8(n,e,t){const s=zt(t,n.dtype);for(let r=0;r<s.size;++r){const a=s.indexToLoc(r).slice(),o=a[0],l=a[2],c=e.locToIndex([o,l]);a[2]=e.values[c];const h=n.locToIndex(a);0<=h&&h<n.values.length&&(s.values[r]=n.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8=ks((n,e)=>n>e?1:0),rIe=nr(Fw,z8,null,"bool"),iIe={kernelName:Fw,backendName:"cpu",kernelFunc:rIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8=ks((n,e)=>n>=e?1:0),aIe=nr(gb,V8,null,"bool"),oIe={kernelName:gb,backendName:"cpu",kernelFunc:aIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8=ks((n,e)=>n<e?1:0),lIe=nr(Bw,U8,null,"bool"),cIe={kernelName:Bw,backendName:"cpu",kernelFunc:lIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8=ks((n,e)=>n<=e?1:0),uIe=nr(zw,G8,null,"bool"),hIe={kernelName:zw,backendName:"cpu",kernelFunc:uIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8(n,e,t){const s=(e-n)/(t-1),r=Gr(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8=ac(n=>Math.log(n)),dIe=od(xb,H8),fIe={kernelName:xb,backendName:"cpu",kernelFunc:dIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(n,e,t,s){const r=Ur(s,Me(t));for(let i=0;i<r.length;++i){const a=i*e;let o=n[a];for(let l=0;l<e;++l){const c=n[a+l];(Number.isNaN(c)||c>o)&&(o=c)}r[i]=o}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8=ks(((n,e)=>Math.max(n,e))),pIe=nr(Tb,K8),mIe={kernelName:Tb,backendName:"cpu",kernelFunc:pIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8=ks(((n,e)=>Math.min(n,e))),gIe=nr(Sb,X8),yIe={kernelName:Sb,backendName:"cpu",kernelFunc:gIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tR=ks(((n,e)=>n*e)),vIe=JA(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),UT=nr(Nb,tR,vIe),bIe={kernelName:Nb,backendName:"cpu",kernelFunc:UT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z8(n,e,t){const s=ed(-1,t);return tR([],e,s,n,t)}function _Ie(n){const{inputs:e,backend:t}=n,{x:s}=e;it(s,"neg");const r=t.data.get(s.dataId).values,[i,a]=Z8(r,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}const xIe={kernelName:Qw,backendName:"cpu",kernelFunc:_Ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8=ks(((n,e)=>n!==e?1:0)),wIe=nr(Jw,Y8,null,"bool"),TIe={kernelName:Jw,backendName:"cpu",kernelFunc:wIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n,e,t,s,r){const i=e.length,a=Me(e),o=ht(e),l=ht(r),c=Ur(t,Me(r));for(let h=0;h<a;++h){const p=Jm(h,i,o),m=new Array(p.length);for(let _=0;_<m.length;_++)m[_]=p[s[_]];const v=jl(m,i,l);c[v]=n[h]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;it(r,"transpose");const a=r.shape.length,o=new Array(a);for(let p=0;p<o.length;p++)o[p]=r.shape[i[p]];const l=s.data.get(r.dataId).values,c=nR(l,r.shape,r.dtype,i,o);return{dataId:s.write(c,o,r.dtype),shape:o,dtype:r.dtype}}const SIe={kernelName:um,backendName:"cpu",kernelFunc:Li};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(n,e,t,s){const[r,i]=fr(n,s),a=Qi(e,"int32"),o=Gr(Me(r),a),l=Me(i);for(let c=0;c<o.length;++c){const h=c*l;let p=1;for(let m=0;m<l;++m)p*=t[h+m];o[c]=p}return{outVals:o,outShape:r,outDtype:a}}function EIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s;it(r,"prod");const o=r.shape.length,l=Vt(i,r.shape),c=fs(l,o);let h=l,p=r;const m=[];c!=null&&(p=Li({inputs:{x:r},backend:t,attrs:{perm:c}}),m.push(p),h=Is(h.length,o));const v=t.data.get(p.dataId).values,{outVals:_,outShape:w,outDtype:T}=Q8(p.shape,p.dtype,v,h);let E=w;return a&&(E=Bs(w,l)),m.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(E,T,_)}const NIe={kernelName:iT,backendName:"cpu",kernelFunc:EIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IIe(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Jm(r,e.length,ht(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function CIe(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function kIe(n,e,t,s){const r=[];let i=0;const a=e.length-1+t.length,o=new Array(a).fill(null).map(()=>[0]);CIe(t,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const h=e[c+1];for(let p=1;p<l+1;++p)o[c].push(p*h)}for(let c=0;c<n.length;++c){let h=n[c],p=n[c]+1;for(let m=0;m<t.length;++m){const v=t[m],_=m+e.length-1;if(_>=0){const w=o[_],T=w[w.length-1]-v[h];for(let E=h;E<p;++E)o[_].push(v[E+1]+T)}h=v[h],p=v[p]}p!==h&&(r.push([h,p]),i+=p-h)}return{outSplits:o,valueSlices:r,numValues:i}}function $Ie(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=ws("int32",s);e.push(r),n[t].forEach((i,a)=>r[a]=i)}return e}function M3(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function AIe(n,e,t,s,r,i){const a=M3(e,2)[1],o=M3(i,2)[1];let l=0;for(const c of t)for(let h=c[0];h<c[1];++h){for(let p=0;p<s;++p)r[l*o+p]=n[h*a+p];++l}}function RIe(n,e,t,s,r){const i=e.slice();i[0]=r;const a=ws(t,Me(i)),o=n.length,l=o===0?0:o/e[0];return AIe(n,e,s,l,a,i),[a,i]}function J8(n,e,t,s,r,i,a,o){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(IIe(i,a,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:h,valueSlices:p,numValues:m}=kIe(i,a,n,c),v=$Ie(h),_=RIe(t,s,r,p,m);return[v,_[0],_[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3=2147483647;function eK(n,e,t,s,r,i,a){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(a.length>1)throw new Error("deltas must be a scalar or vector");const o=e.length===0,l=r.length===0,c=a.length===0,h=[];o||h.push(e[0]),l||h.push(r[0]),c||h.push(a[0]);for(let T=1;T<h.length;++T)if(h[T]!==h[T-1])throw new Error("starts, limits, and deltas must have the same shape");const p=h.length===0?1:h[0],m=ws("int32",p+1);m[0]=0;for(let T=0;T<p;++T){const E=o?n[0]:n[T],C=l?s[0]:s[T],A=c?i[0]:i[T];if(A===0)throw new Error("Requires delta != 0");let D;if(A>0&&C<E||A<0&&C>E)D=0;else if(D=Math.ceil(Math.abs((C-E)/A)),D>F3)throw new Error(`Requires ((limit - start) / delta) <= ${F3}`);m[T+1]=m[T]+D}const v=m[p],_=ws(t,v);let w=0;for(let T=0;T<p;++T){const E=m[T+1]-m[T];let C=o?n[0]:n[T];const A=c?i[0]:i[T];for(let D=0;D<E;++D)_[w++]=C,C+=A}return[m,_]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Qa=Fo;class y1{constructor(e,t,s,r,i,a,o,l,c,h){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=a,this.defaultValueShape=o,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=jH(h),this.raggedRank=BH(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Qa.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Qa.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Qa.VALUE_ROWIDS:return y1.getMaxWidthValueRowID(t);case Qa.ROW_SPLITS:return y1.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Qa[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let a=1;a<t;++a){const o=e[a];o!==r&&(r=o,i=Math.max(a-s,i),s=a)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return B3(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;zH(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=FH(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(let o=1;o<=this.raggedRank;++o)a[o]<0&&(a[o]=this.getMaxWidth(o));return a}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let a=0;for(let o=0;o<r;++o,a+=t)i.push(a);for(let o=r;o<e;++o)i.push(-1);return te(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,a=[];for(let o=0;o<i-1;++o){const l=e[o+1]-e[o];let c=Math.min(r,l),h=t[o];h===-1&&(c=0);for(let p=0;p<c;++p)a.push(h),h+=s;for(let p=0;p<l-c;++p)a.push(-1)}if(i>0&&a.length!==e[i-1])throw new Error("Invalid row split size.");return a}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,a=[];if(i===0)return[];let o=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];a.push(c);for(let h=1;h<i;++h){const p=e[h];if(p===l)c>=0&&(++o,o<r?c+=s:c=-1);else{if(o=0,l=p,p>=t.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${t.length}`);c=t[p]}a.push(c)}if(a.length!==e.length)throw new Error("Invalid row ids.");return a}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),a=this.getRowPartitionTypeByDimension(e);switch(a){case Qa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case Qa.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${Qa[a]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Qa.FIRST_DIM_SIZE:return e[0];case Qa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Qa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Qa[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=B3(s,!1),a=ws(this.valuesDType,Me(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,a,i)}return[i,a]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,a=s;let o=r.slice();o=o.slice(e+1);const l=Me(o),c=t.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const _=this.defaultValueShape;ke(()=>{const w=_e(h,_);h=My(w,o).dataSync()})}let p=0,m=0,v=0;for(let _=0;_<=c;++_){let w=_<c?t[_]:-1;if(w===v){++v;continue}if(m<v){const T=i.subarray(p*l),E=a.subarray(m*l),C=(v-m)*l;j3(E,T,C)}if(_>=c){const T=s.length;w=Math.floor(T/l)}if(w>v)if(this.defaultValue.length===1)a.subarray(v*l,w*l).fill(this.defaultValue[0]),v=w;else for(;w>v;){const T=a.slice(v*l);j3(T,h,l),++v}w<0?(p=_+1,m=v):(p=_,m=v,v=m+1)}}}function j3(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function B3(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function tK(n,e,t,s,r,i,a,o,l,c){return new y1(n,e,t,s,r,i,a,o,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n,e,t,s){const r=n===e,i=n<e&&t<0,a=e<n&&t>1;if(r||i||a)return Gr(0,s);const o=Math.abs(Math.ceil((e-n)/t)),l=Gr(o,s);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK=ac(n=>1/Math.sqrt(n)),DIe=od(Rb,sK),LIe={kernelName:Rb,backendName:"cpu",kernelFunc:DIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ef(n,e,t,s,r,i,a,o,l,c){const h=[s/r,r],p=n.values,m=e.values;if(s===0)return zt(t,e.dtype);const v=l instanceof Sr?l:zt(h,e.dtype);typeof l=="string"||typeof l=="number"?v.values.fill(l):typeof l=="boolean"&&v.values.fill(+l);for(let _=0;_<i;_++){const w=[];let T=0;for(let E=0;E<a;E++){const C=p[_*a+E];w.push(C),T+=C*o[E]}if(T<0||T>=s/r)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let E=0;E<r;E++)c?v.values[T*r+E]+=m[_*r+E]:v.values[T*r+E]=e.rank===0?m[0]:m[_*r+E]}return v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OIe=ac(n=>1/(1+Math.exp(-n))),rK=In(Mb,n=>1/(1+Math.exp(-n))),PIe={kernelName:Mb,backendName:"cpu",kernelFunc:rK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(n,e,t,s,r){const i=cA(s,e,t),a=Me(t),o=ht(s);if(i){const p=uA(e,o);return r==="string"?n.slice(p,p+a):n.subarray(p,p+a)}const l=r==="string"?Jc(n):n,c=zt(s,r,l),h=zt(t,r);for(let p=0;p<h.size;++p){const m=h.indexToLoc(p),v=m.map((_,w)=>_+e[w]);h.set(c.get(...v),...m)}return r==="string"?oq(h.values):h.values}function Ff(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:a}=s;it(r,"slice");const[o,l]=CT(r,i,a);oA(r,o,l);const c=t.data.get(r.dataId).values,h=iK(c,o,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,h)}const MIe={kernelName:hT,backendName:"cpu",kernelFunc:Ff};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n,e,t,s,r,i,a){const o=e[0],l=i[0],c=new Array(l),h=new Array(o),p=e[1];if(l===0){if(o!==0)throw new Error(KH(o));const T=ws(t,0),E=ws(r,0);return[T,[0,p],E,c,h]}let m=!0,v=0;const _=new Array(l).fill(0);for(let T=0;T<o;++T){const E=n[T*p];if(E<0)throw new Error(XH(T,E));if(E>=l)throw new Error(ZH(T,E,l));++_[E],m=m&&E>=v,v=E}let w=!0;for(let T=0;T<l;++T){const E=_[T]===0;c[T]=E,w=w&&!E,_[T]=Math.max(_[T],1),T>0&&(_[T]+=_[T-1])}if(w&&m){const T=n,E=s;for(let C=0;C<o;++C)h[C]=C;return[T,[o,p],E,c,h]}else{const T=_[l-1],E=ws(t,T*p),C=ws(r,T),A=new Array(l).fill(0);for(let D=0;D<o;++D){const F=n[D*p],W=A[F],B=(F===0?0:_[F-1])+W;A[F]++;for(let P=0;P<p;++P)E[B*p+P]=n[D*p+P];C[B]=s[D],h[D]=B}for(let D=0;D<l;++D)if(A[D]===0){const W=D===0?0:_[D-1];E[W*p+0]=D;for(let B=1;B<p;++B)E[W*p+B]=0;C[W]=a}return[E,[T,p],C,c,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(n,e,t,s,r){const i=Me(s),a=e[0],o=r.length,l=[];let c=1,h=-1;for(let T=0;T<o;++T){const E=r[T];if(E===-1){if(h!==-1)throw new Error(YH(h,T));h=T,l.push(1)}else{if(E<0)throw new Error(QH(T,E));c*=E,l.push(E)}}if(h!==-1){if(c<=0)throw new Error(JH());const T=Math.trunc(i/c);if(c*T!==i)throw new Error(eq(s,l));l[h]=T}if(Me(l)!==i)throw new Error(tq(s,l));const m=s.length,v=[];if(m>0){v[m-1]=1;for(let T=m-2;T>=0;--T)v[T]=v[T+1]*s[T+1]}const _=[];if(o>0){_[o-1]=1;for(let T=o-2;T>=0;--T)_[T]=_[T+1]*l[T+1]}const w=ws(t,a*o);for(let T=0;T<a;++T){let E=0;for(let C=0;C<m;++C)E+=n[T*m+C]*v[C];for(let C=0;C<o;++C)w[T*o+C]=Math.trunc(E/_[C]),E%=_[C]}return[w,[a,o],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR(n,e,t,s,r,i=!1,a=0){const o=s.length,l=[e[0],n.length/e[0]],c=l[1],p=o>0?r[o-1]+1:0;if(p<0)throw new Error(nC());const m=e.slice();m[0]=p;const v=m.reduce((A,D)=>A*D,1),_=ws(t,v);if(o===0)return p>0&&_.fill(a),[_,m];if(p<=0)throw new Error(nC());let w=0,T=1,E=0,C=r[w];for(;;){let A=0;if(T<o){if(A=r[T],C===A){++T;continue}if(C>=A)throw new Error(nq())}if(C<0||C>=p)throw new Error(sq(C,p));C>E&&_.fill(a,E*c,C*c);for(let D=w;D<T;++D){const F=s[D];if(F<0||F>=l[0])throw new Error(rq(D,s[D],l[0]));for(let W=0;W<c;W++)_[C*c+W]+=n[F*c+W]}if(i)for(let D=0;D<c;D++)_[C*c+D]/=T-w;if(w=T,++T,E=C+1,C=A,T>o)break}return E<p&&_.fill(a,E*c,p*c),[_,m]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FIe=ac(n=>Math.sqrt(n)),jIe=In(jb,n=>Math.sqrt(n)),BIe={kernelName:jb,backendName:"cpu",kernelFunc:jIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK=ks(((n,e)=>{const t=n-e;return t*t})),zIe=nr(Bb,lK),VIe={kernelName:Bb,backendName:"cpu",kernelFunc:zIe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK=ac((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),UIe=od(T$,cK),GIe={kernelName:T$,backendName:"cpu",kernelFunc:UIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uK(n,e,t,s){const r=zt(n,e.dtype);for(let i=0;i<r.size;i++){const a=r.indexToLoc(i),o=new Array(a.length);for(let l=0;l<o.length;l++)o[l]=a[l]*t[l]+s[l];r.set(e.get(...o),...a)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WIe{constructor(e,t,s,r,i,a){this.separator=wh(e),this.nGramWidths=t,this.leftPad=wh(s),this.rightPad=wh(r),this.padWidth=i,this.preserveShort=a}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,a){for(let o=0;o<i;++o){const l=this.getPadWidth(a),c=Math.max(0,l-o),h=Math.max(0,l-(i-(o+1))),p=a-(c+h),m=t+(c>0?0:o-l);let v=0;v+=c*this.leftPad.length;for(let C=0;C<p;++C)v+=e[m+C].length;v+=h*this.rightPad.length;const _=c+h+p-1;v+=_*this.separator.length,s[r+o]=new Uint8Array(v);const w=s[r+o];let T=0;const E=C=>C.forEach(A=>w[T++]=A);for(let C=0;C<c;++C)E(this.leftPad),E(this.separator);for(let C=0;C<p-1;++C)E(e[m+C]),E(this.separator);if(p>0){E(e[m+p-1]);for(let C=0;C<h;++C)E(this.separator),E(this.rightPad)}else{for(let C=0;C<h-1;++C)E(this.rightPad),E(this.separator);E(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let h=t[c]>=l;if(h=h&&t[c]<=s,!h)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${s}]`);l=t[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,a=ws("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=i;++c)a[c]=0;return[l,a]}a[0]=0;for(let l=1;l<=i;++l){const c=t[l]-t[l-1];let h=0;this.nGramWidths.forEach(p=>{h+=this.getNumNGrams(c,p)}),this.preserveShort&&c>0&&h===0&&(h=1),a[l]=a[l-1]+h}const o=new Array(a[i]);for(let l=0;l<i;++l){const c=t[l];let h=a[l];if(this.nGramWidths.forEach(p=>{const m=t[l+1]-t[l],v=this.getNumNGrams(m,p);this.createNGrams(e,c,o,h,v,p),h+=v}),this.preserveShort&&h===a[l]){const p=t[l+1]-t[l];if(p===0)continue;const m=p+2*this.padWidth;this.createNGrams(e,c,o,h,1,m)}}return[o,a]}}function hK(n,e,t,s,r,i,a,o){return new WIe(t,s,r,i,a,o).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HIe(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let a=n.indexOf(i);for(;a!==-1;){const o=n.subarray(0,a);(!t||o.length!==0)&&s.push(o),n=n.subarray(a+1),a=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const a=n.subarray(r,i);(!t||a.length!==0)&&s.push(a),r=i+1}}function dK(n,e,t){const s=n.length,r=[];let i=0,a=0;const o=new Array(s);for(let m=0;m<s;++m){const v=r.length;HIe(n[m],e,t,r);const _=r.length-v;o[m]=_,i+=_,a=Math.max(a,_)}const l=ws("int32",i*2),c=new Array(i),h=[s,a];let p=0;for(let m=0;m<s;++m)for(let v=0;v<o[m];++v)l[p*2]=m,l[p*2+1]=v,c[p]=r[p],++p;return[l,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n,e){const t=ws("int32",n.length);for(let s=0;s<n.length;++s)t[s]=Gve(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pK=ks(((n,e)=>n-e)),qIe=JA(((n,e,t,s)=>({real:n-t,imag:e-s}))),rR=nr(zb,pK,qIe),KIe={kernelName:zb,backendName:"cpu",kernelFunc:rR};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=zt(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),a=new Array(n.rank);for(let l=0;l<a.length;l++)a[l]=i[l]%n.shape[l];const o=n.locToIndex(a);s.values[r]=n.values[o]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ey=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function gK(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const o=s-t+1,l=e-t+1,c=Math.log(o),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(o-h)/o)*Math.sign(l-o/2),m=Math.max(t,Math.floor(e-l*h/o+p)),v=Math.min(s,Math.floor(e+(o-l)*h/o+p));gK(n,e,m,v)}const r=n[e];let i=t,a=s;for(Kp(n,t,e),Ey(n[s],r)>0&&Kp(n,t,s);i<a;){for(Kp(n,i,a),i++,a--;Ey(n[i],r)<0;)i=i+1;for(;Ey(n[a],r)>0;)a=a-1}Ey(n[t],r)===0?Kp(n,t,a):(a=a+1,Kp(n,a,s)),a<=e&&(t=a+1),e<=a&&(s=a-1)}}function yK(n,e,t,s,r){const i=e[e.length-1],[a,o]=[n.length/i,i],l=Ur(t,a*s),c=Ur("int32",a*s);for(let p=0;p<a;p++){const m=p*o,v=n.subarray(m,m+o);let _=new Array(v.length);v.forEach((C,A)=>_[A]={value:C,index:A}),s<_.length&&(gK(_,s),_=_.slice(0,s)),r&&_.sort(Ey);const w=p*s,T=l.subarray(w,w+s),E=c.subarray(w,w+s);for(let C=0;C<s;C++)T[C]=_[C].value,E[C]=_[C].index}const h=e.slice();return h[h.length-1]=s,[zt(h,t,l),zt(h,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(n,e,t,s){const r=Vt(e,t)[0],i=[1,t[0],1];for(let _=0;_<r;_++)i[0]*=t[_];i[1]=t[r];for(let _=r+1;_<t.length;_++)i[2]*=t[_];const a=new Map,o=new Int32Array(t[r]),l=new Sr(i,s,n),c=[],h=i[0]===1&&i[2]===1;for(let _=0;_<t[r];_++){let w;if(h)w=n[_].toString();else{const E=[];for(let C=0;C<i[0];C++)for(let A=0;A<i[2];A++)E.push(l.get(C,_,A));w=E.join(",")}const T=a.get(w);if(T!=null)o[_]=T;else{const E=a.size;a.set(w,E),o[_]=E,c.push(_)}}const p=i.slice();p[1]=a.size;const m=new Sr(p,s);c.forEach((_,w)=>{for(let T=0;T<i[0];T++)for(let E=0;E<i[2];E++)m.set(l.get(T,_,E),T,w,E)});const v=t.slice();return v[r]=p[1],{outputValues:m.values,outputShape:v,indices:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XIe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:I8,bincountImpl:eR,bincountReduceImpl:C8,bitwiseAndImpl:k8,castImpl:N8,ceilImpl:$8,concatImpl:A8,equalImpl:R8,expImpl:L8,expm1Impl:P8,floorDivImpl:F8,floorImpl:M8,gatherNdImpl:j8,gatherV2Impl:B8,greaterEqualImpl:V8,greaterImpl:z8,lessEqualImpl:G8,lessImpl:U8,linSpaceImpl:W8,logImpl:H8,maxImpl:q8,maximumImpl:K8,minimumImpl:X8,multiplyImpl:tR,negImpl:Z8,notEqualImpl:Y8,prodImpl:Q8,raggedGatherImpl:J8,raggedRangeImpl:eK,raggedTensorToTensorImpl:tK,rangeImpl:nK,rsqrtImpl:sK,scatterImpl:ef,sigmoidImpl:OIe,simpleAbsImpl:E8,sliceImpl:iK,sparseFillEmptyRowsImpl:aK,sparseReshapeImpl:oK,sparseSegmentReductionImpl:sR,sqrtImpl:FIe,squaredDifferenceImpl:lK,staticRegexReplaceImpl:cK,stridedSliceImpl:uK,stringNGramsImpl:hK,stringSplitImpl:dK,stringToHashBucketFastImpl:fK,subImpl:pK,tileImpl:mK,topKImpl:yK,transposeImpl:nR,uniqueImpl:vK},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */M5("cpu",()=>new VT,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK=In(ub,n=>n>=0?n:Math.exp(n)-1),ZIe={kernelName:ub,backendName:"cpu",kernelFunc:bK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;it([r],"leakyRelu");const a=Me(r.shape),o=t.data.get(r.dataId).values,l=Ur("float32",a);for(let c=0;c<o.length;c++)l[c]=o[c]<0?i*o[c]:o[c];return t.makeTensorInfo(r.shape,"float32",l)}const YIe={kernelName:jw,backendName:"cpu",kernelFunc:_K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QIe=ks((n,e)=>n<0?e*n:n);function xK(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;it([s,r],"prelu");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,[o,l]=QIe(s.shape,r.shape,i,a,"float32");return t.makeTensorInfo(l,"float32",o)}const JIe={kernelName:rT,backendName:"cpu",kernelFunc:xK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK=In(kb,n=>Math.max(0,n)),eCe={kernelName:kb,backendName:"cpu",kernelFunc:wK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK=In($b,n=>Math.min(Math.max(0,n),6)),tCe={kernelName:$b,backendName:"cpu",kernelFunc:TK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1(n,e,t,s,r){if(t==="linear")return sc({inputs:{x:e},backend:n});if(t==="relu")return wK({inputs:{x:e},backend:n});if(t==="elu")return bK({inputs:{x:e},backend:n});if(t==="relu6")return TK({inputs:{x:e},backend:n});if(t==="prelu")return xK({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return _K({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return rK({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,a=Me(r.shape),o=HW(i,a),l=Me(o);te(a===l,()=>`The new shape (${o}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const c=t.data.get(r.dataId);if(c.complexTensorInfos!=null){const h=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;h.shape=o,p.shape=o}return{dataId:r.dataId,shape:o,dtype:r.dtype}}const nCe={kernelName:aT,backendName:"cpu",kernelFunc:Hn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:a,transposeB:o}=s;it([r,i],"matMul");const l=r.shape.length,c=i.shape.length,h=a?r.shape[l-2]:r.shape[l-1],p=o?i.shape[c-1]:i.shape[c-2],m=a?r.shape[l-1]:r.shape[l-2],v=o?i.shape[c-2]:i.shape[c-1],_=r.shape.slice(0,-2),w=i.shape.slice(0,-2),T=Me(_),E=Me(w),A=Dt(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([m,v]);te(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${a} and transposeB=${o} must match.`);const D=a?[T,h,m]:[T,m,h],F=o?[E,v,p]:[E,p,v],W=Hn({inputs:{x:r},backend:t,attrs:{shape:D}}),B=Hn({inputs:{x:i},backend:t,attrs:{shape:F}}),P=a?W.shape[1]:W.shape[2],O=a?W.shape[2]:W.shape[1],M=o?B.shape[1]:B.shape[2],k=Math.max(T,E),V=t.data.get(W.dataId).values,G=t.data.get(B.dataId).values,ae=ht(W.shape),J=ht(B.shape),[X,se,ne]=a?[ae[0],1,ae[1]]:[ae[0],ae[1],1],[le,K,ie]=o?[1,J[1],J[0]]:[J[1],1,J[0]],de=O*M,ce=zt([k,O,M],W.dtype),Se=ce.values,Te=t.blockSize;for(let Ie=0;Ie<k;Ie++){const He=Ie%T,qe=Ie%E;for(let Qe=0;Qe<O;Qe+=Te){const ut=Math.min(Qe+Te,O);for(let mt=0;mt<M;mt+=Te){const At=Math.min(mt+Te,M);for(let Gt=0;Gt<P;Gt+=Te){const gn=Math.min(Gt+Te,P);for(let Jt=Qe;Jt<ut;Jt++)for(let Zt=mt;Zt<At;Zt++){let Pt=0;for(let un=Gt;un<gn;un++){const Cr=V[He*X+Jt*se+un*ne],Rn=G[un*le+Zt*K+qe*ie];Pt+=Cr*Rn}Se[Ie*de+(Jt*M+Zt)]+=Pt}}}}}return t.disposeIntermediateTensorInfo(W),t.disposeIntermediateTensorInfo(B),t.makeTensorInfo(A,ce.dtype,ce.values)}const sCe={kernelName:Sw,backendName:"cpu",kernelFunc:SK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rCe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:a,preluActivationWeights:o}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:p}=s;let m,v,_;const w=[];m=SK({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:c},backend:t}),a&&(v=Dm({inputs:{a:m,b:a},backend:t}),w.push(m),m=v),h&&(_=v1(t,m,h,o,p),w.push(m),m=_);for(const E of w)t.disposeIntermediateTensorInfo(E);return m}const iCe={kernelName:Q0,backendName:"cpu",kernelFunc:rCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aCe=In(Yv,n=>Math.acos(n)),oCe={kernelName:Yv,backendName:"cpu",kernelFunc:aCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lCe=In(Qv,n=>Math.acosh(n)),cCe={kernelName:Qv,backendName:"cpu",kernelFunc:lCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uCe(n){const{inputs:e,backend:t}=n,s=e;it(e,"addN");const r=s.map(o=>t.data.get(o.dataId).values),i=zt(s[0].shape,s[0].dtype),a=i.values;for(let o=0;o<s.length;o++){const l=r[o];for(let c=0;c<a.length;c++)a[c]+=l[c]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const hCe={kernelName:V2,backendName:"cpu",kernelFunc:uCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s;it(r,"all");const o=Vt(i,r.shape);let l=o;const c=fs(l,r.shape.length);let h=r;c!=null&&(h=Li({inputs:{x:r},backend:t,attrs:{perm:c}}),l=Is(l.length,r.shape.length)),Nr("all",l,h.shape.length);const[p,m]=fr(h.shape,l),v=Me(m),_=Gr(Me(p),h.dtype),w=t.data.get(h.dataId).values;for(let E=0;E<_.length;++E){const C=E*v;let A=w[C];for(let D=0;D<v;++D){const F=w[C+D];A=A&&F}_[E]=A}c!=null&&t.disposeIntermediateTensorInfo(h);const T=t.makeTensorInfo(p,h.dtype,_);if(a){const E=Bs(p,o),C=Hn({inputs:{x:T},backend:t,attrs:{shape:E}});return t.disposeIntermediateTensorInfo(T),C}return T}const fCe={kernelName:U2,backendName:"cpu",kernelFunc:dCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s;it(r,"any");const o=Vt(i,r.shape);let l=o;const c=fs(l,r.shape.length);let h=r;c!=null&&(h=Li({inputs:{x:r},backend:t,attrs:{perm:c}}),l=Is(l.length,r.shape.length)),Nr("any",l,h.shape.length);const[p,m]=fr(h.shape,l),v=Me(m),_=Gr(Me(p),h.dtype),w=t.data.get(h.dataId).values;for(let E=0;E<_.length;++E){const C=E*v;let A=w[C];for(let D=0;D<v;++D){const F=w[C+D];A=A||F}_[E]=A}c!=null&&t.disposeIntermediateTensorInfo(h);const T=t.makeTensorInfo(p,h.dtype,_);if(a){const E=Bs(p,o),C=Hn({inputs:{x:T},backend:t,attrs:{shape:E}});return t.disposeIntermediateTensorInfo(T),C}return T}const mCe={kernelName:G2,backendName:"cpu",kernelFunc:pCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;it(r,"argMax");let a=Vt(i,r.shape);const o=fs(a,r.shape.length);let l=r;const c=[];o!=null&&(l=Li({inputs:{x:r},backend:t,attrs:{perm:o}}),c.push(l),a=Is(a.length,l.shape.length)),a=[a[0]],Nr("argMax",a,l.shape.length);const[h,p]=fr(l.shape,a),m=Me(h),v=Gr(m,"int32"),_=Me(p),w=t.data.get(l.dataId).values;for(let T=0;T<v.length;++T){const E=T*_;let C=w[E],A=0;for(let D=0;D<_;++D){const F=w[E+D];F>C&&(C=F,A=D)}v[T]=A}return c.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(h,"int32",v)}const yCe={kernelName:_w,backendName:"cpu",kernelFunc:gCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;it(r,"argMin");let a=Vt(i,r.shape);const o=fs(a,r.shape.length);let l=r;const c=[];o!=null&&(l=Li({inputs:{x:r},backend:t,attrs:{perm:o}}),c.push(l),a=Is(a.length,l.shape.length)),a=[a[0]],Nr("argMin",a,l.shape.length);const[h,p]=fr(l.shape,a),m=Me(h),v=Gr(m,"int32"),_=Me(p),w=t.data.get(l.dataId).values;for(let T=0;T<v.length;++T){const E=T*_;let C=w[E],A=0;for(let D=0;D<_;++D){const F=w[E+D];F<C&&(C=F,A=D)}v[T]=A}return c.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(h,"int32",v)}const bCe={kernelName:xw,backendName:"cpu",kernelFunc:vCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ce=In(Jv,n=>Math.asin(n)),xCe={kernelName:Jv,backendName:"cpu",kernelFunc:_Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wCe=In(eb,n=>Math.asinh(n)),TCe={kernelName:eb,backendName:"cpu",kernelFunc:wCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SCe=In(tb,n=>Math.atan(n)),ECe={kernelName:tb,backendName:"cpu",kernelFunc:SCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NCe=ks((n,e)=>Math.atan2(n,e)),ICe=nr(sb,NCe),CCe={kernelName:sb,backendName:"cpu",kernelFunc:ICe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kCe=In(nb,n=>Math.atanh(n)),$Ce={kernelName:nb,backendName:"cpu",kernelFunc:kCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n,e,t,s,r,i){const a=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,v=r.padInfo.left,_=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=zt(r.outShape,t),T=w.values,E=r.outShape[1]*r.outShape[2]*r.outShape[3],C=r.outShape[2]*r.outShape[3],A=r.outShape[3];for(let D=0;D<r.batchSize;++D){const F=D*E,W=D*s[0];for(let B=0;B<r.inChannels;++B)for(let P=0;P<r.outHeight;++P){const O=P*a-m,M=Math.max(0,O),k=Math.min(r.inHeight,h+O),V=F+P*C;for(let G=0;G<r.outWidth;++G){const ae=G*o-v,J=Math.max(0,ae),X=Math.min(r.inWidth,p+ae);let se=_,ne=0,le=0;for(let ie=M;ie<k;ie+=l){const de=W+ie*s[1];for(let ce=J;ce<X;ce+=c){const Se=de+ce*s[2],Te=n[Se+B];i==="max"&&Te>se?se=Te:i==="avg"&&(ne+=Te,le++)}if(isNaN(se))break}const K=V+G*A+B;T[K]=i==="avg"?ne/le:se}}}return w}function EK(n,e,t,s,r=!1,i=!1){const a=zt(s.outShape,"int32"),o=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,h=s.dilationWidth,p=s.effectiveFilterHeight,m=s.effectiveFilterWidth,v=s.padInfo.top,_=s.padInfo.left,w=zt(e,t,n);for(let T=0;T<s.batchSize;++T)for(let E=0;E<s.inChannels;++E)for(let C=0;C<s.outHeight;++C){const A=C*o-v;let D=A;for(;D<0;)D+=c;const F=Math.min(s.inHeight,p+A);for(let W=0;W<s.outWidth;++W){const B=W*l-_;let P=B;for(;P<0;)P+=h;const O=Math.min(s.inWidth,m+B);let M=Number.NEGATIVE_INFINITY,k=-1;for(let V=D;V<F;V+=c){const G=V-A;for(let ae=P;ae<O;ae+=h){const J=ae-B,X=w.get(T,V,ae,E);X>M&&(M=X,r?k=i?((T*s.inHeight+V)*s.inWidth+ae)*s.inChannels+E:(V*s.inWidth+ae)*s.inChannels+E:k=G*m+J)}}a.set(k,T,C,W,E)}}return a}function NK(n,e,t,s,r,i){const a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,h=r.dilationHeight,p=r.dilationWidth,m=r.effectiveFilterDepth,v=r.effectiveFilterHeight,_=r.effectiveFilterWidth,w=r.padInfo.front,T=r.padInfo.top,E=r.padInfo.left,C=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,A=zt(r.outShape,t),D=A.values,F=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],W=r.outShape[2]*r.outShape[3]*r.outShape[4],B=r.outShape[3]*r.outShape[4],P=r.outShape[4];for(let O=0;O<r.batchSize;++O){const M=O*F,k=O*s[0];for(let V=0;V<r.inChannels;++V)for(let G=0;G<r.outDepth;++G){const ae=G*a-w;let J=ae;for(;J<0;)J+=c;const X=Math.min(r.inDepth,m+ae),se=M+G*W;for(let ne=0;ne<r.outHeight;++ne){const le=ne*o-T;let K=le;for(;K<0;)K+=h;const ie=Math.min(r.inHeight,v+le),de=se+ne*B;for(let ce=0;ce<r.outWidth;++ce){const Se=ce*l-E;let Te=Se;for(;Te<0;)Te+=p;const Ie=Math.min(r.inWidth,_+Se),He=de+ce*P;let qe=C,Qe=0,ut=0;for(let At=J;At<X;At+=c){const Gt=k+At*s[1];for(let gn=K;gn<ie;gn+=h){const Jt=Gt+gn*s[2];for(let Zt=Te;Zt<Ie;Zt+=p){const Pt=Jt+Zt*s[3],un=n[Pt+V];if(i==="max"&&un>qe?qe=un:i==="avg"&&(Qe+=un,ut++),isNaN(qe))break}if(isNaN(qe))break}if(isNaN(qe))break}const mt=He+V;D[mt]=i==="avg"?Qe/Math.max(ut,1):qe}}}}return A}function ACe(n,e){const t=zt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,v=e.padInfo.top,_=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let T=0;T<e.inChannels;++T)for(let E=0;E<e.outDepth;++E){const C=E*s-m;let A=C;for(;A<0;)A+=a;const D=Math.min(e.inDepth,c+C);for(let F=0;F<e.outHeight;++F){const W=F*r-v;let B=W;for(;B<0;)B+=o;const P=Math.min(e.inHeight,h+W);for(let O=0;O<e.outWidth;++O){const M=O*i-_;let k=M;for(;k<0;)k+=l;const V=Math.min(e.inWidth,p+M);let G=Number.NEGATIVE_INFINITY,ae=-1;for(let J=A;J<D;J+=a){const X=J-C;for(let se=B;se<P;se+=o){const ne=se-W;for(let le=k;le<V;le+=l){const K=le-M,ie=n.get(w,J,se,le,T);ie>=G&&(G=ie,ae=X*h*p+ne*h+K)}}}t.set(ae,w,E,F,O,T)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;it(r,"avgPool");const{filterSize:i,strides:a,pad:o,dimRoundingMode:l}=s,c=1;te(qr(a,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=ho(r.shape,i,a,c,o,l);let p;if(h.filterWidth===1&&h.filterHeight===1&&xn(h.inShape,h.outShape))p=sc({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,v=ht(r.shape),_=iR(m,r.shape,r.dtype,v,h,"avg");p=t.makeTensorInfo(h.outShape,r.dtype,_.values)}return p}const DCe={kernelName:ww,backendName:"cpu",kernelFunc:RCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=s;it(r,"avgPool3d");const h=ru(r.shape,i,a,1,o,l,c),p=t.data.get(r.dataId).values,m=NK(p,r.shape,r.dtype,ht(r.shape),h,"avg");return t.makeTensorInfo(m.shape,"float32",m.values)}const OCe={kernelName:Tw,backendName:"cpu",kernelFunc:LCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PCe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=s;it([r,i],"avgPool3DGrad");const h=ru(i.shape,a,o,1,l,c),p=h.strideDepth,m=h.strideHeight,v=h.strideWidth,_=h.filterDepth,w=h.filterHeight,T=h.filterWidth,E=h.dilationDepth,C=h.dilationHeight,A=h.dilationWidth,D=h.effectiveFilterDepth,F=h.effectiveFilterHeight,W=h.effectiveFilterWidth,B=D-1-h.padInfo.front,P=W-1-h.padInfo.left,O=F-1-h.padInfo.top,M=zt(i.shape,"float32"),k=1/(_*w*T),V=t.bufferSync(r);for(let G=0;G<h.batchSize;++G)for(let ae=0;ae<h.inChannels;++ae)for(let J=0;J<h.inDepth;++J)for(let X=0;X<h.inHeight;++X)for(let se=0;se<h.inWidth;++se){const ne=J-B,le=X-O,K=se-P;let ie=0;for(let de=0;de<D;de+=E){const ce=(ne+de)/p;if(!(ce<0||ce>=h.outDepth||Math.floor(ce)!==ce))for(let Se=0;Se<F;Se+=C){const Te=(le+Se)/m;if(!(Te<0||Te>=h.outHeight||Math.floor(Te)!==Te))for(let Ie=0;Ie<W;Ie+=A){const He=(K+Ie)/v;if(He<0||He>=h.outWidth||Math.floor(He)!==He)continue;const qe=V.get(G,ce,Te,He,ae);ie+=qe}}}M.set(ie*k,G,J,X,se,ae)}return t.makeTensorInfo(M.shape,M.dtype,M.values)}const MCe={kernelName:H2,backendName:"cpu",kernelFunc:PCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FCe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,a=i;it([r,i],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=s,h=ho(a.shape,o,l,1,c),p=h.strideHeight,m=h.strideWidth,v=h.filterHeight,_=h.filterWidth,w=h.dilationHeight,T=h.dilationWidth,E=h.effectiveFilterHeight,C=h.effectiveFilterWidth,A=C-1-h.padInfo.left,D=E-1-h.padInfo.top,F=zt(a.shape,"float32"),W=1/(v*_),B=t.data.get(r.dataId).values,P=zt(r.shape,"float32",B);for(let O=0;O<h.batchSize;++O)for(let M=0;M<h.inChannels;++M)for(let k=0;k<h.inHeight;++k)for(let V=0;V<h.inWidth;++V){const G=k-D,ae=V-A;let J=0;for(let X=0;X<E;X+=w){const se=(G+X)/p;if(!(se<0||se>=h.outHeight||Math.floor(se)!==se))for(let ne=0;ne<C;ne+=T){const le=(ae+ne)/m;if(le<0||le>=h.outWidth||Math.floor(le)!==le)continue;const K=P.get(O,se,le,M);J+=K}}F.set(J*W,O,k,V,M)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const jCe={kernelName:W2,backendName:"cpu",kernelFunc:FCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:a,mean:o,variance:l}=e;te(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),te(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),te(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),it([r,o,l,i,a],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const h=t.data.get(r.dataId).values,p=t.data.get(o.dataId).values,m=t.data.get(l.dataId).values,v=i?t.data.get(i.dataId).values:new Float32Array([1]),_=a?t.data.get(a.dataId).values:new Float32Array([0]),w=new Float32Array(h.length),T=_.length,E=v.length,C=m.length,A=p.length;let D=0,F=0,W=0,B=0;for(let P=0;P<h.length;++P)w[P]=_[D++]+(h[P]-p[F++])*v[W++]/Math.sqrt(m[B++]+c),D>=T&&(D=0),F>=A&&(F=0),W>=E&&(W=0),B>=C&&(B=0);return t.makeTensorInfo(r.shape,r.dtype,w)}const zCe={kernelName:Pw,backendName:"cpu",kernelFunc:BCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:a}=s;it([r],"batchToSpaceND");const o=i.reduce((E,C)=>E*C),l=Yb(r.shape,i,o),c=Qb(l.length,i.length),h=Jb(r.shape,i,o),p=mA(a,i.length),m=gA(h,a,i.length),v=Hn({inputs:{x:r},backend:t,attrs:{shape:l}}),_=Li({inputs:{x:v},backend:t,attrs:{perm:c}}),w=Hn({inputs:{x:_},backend:t,attrs:{shape:h}}),T=Ff({inputs:{x:w},backend:t,attrs:{begin:p,size:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(w),T}const UCe={kernelName:Ew,backendName:"cpu",kernelFunc:VCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GCe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:a}=s,o=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,c=eR(o,l,i.dtype,i.shape,a);return t.makeTensorInfo([a],i.dtype,c)}const WCe={kernelName:q2,backendName:"cpu",kernelFunc:GCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HCe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,o=Dt(Array.from(i),Array.from(a));return t.makeTensorInfo([o.length],"int32",Int32Array.from(o))}const qCe={kernelName:QW,backendName:"cpu",kernelFunc:HCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KCe=In(ab,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),XCe={kernelName:ab,backendName:"cpu",kernelFunc:KCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZCe=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(Me(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,a=r.complexTensorInfos.imag,o=t.data.get(i.dataId).values,l=t.data.get(a.dataId).values;for(let c=0;c<o.length;c++){const h=o[c],p=l[c];s[c]=Math.hypot(h,p)}return t.makeOutput(s,e.shape,"float32")},YCe={kernelName:Nw,backendName:"cpu",kernelFunc:ZCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lm(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const QCe={kernelName:h$,backendName:"cpu",kernelFunc:Lm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Om(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=Vt(r,e[0].shape)[0],a=e.map(w=>w.shape);dA(a,i);let o=zl(e.map(w=>w.shape),i);if(Me(o)===0)return t.makeTensorInfo(o,e[0].dtype,[]);const l=e.filter(w=>Me(w.shape)>0);if(l.length===1)return sc({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const w=l.map(D=>Mf({inputs:{input:D},backend:t})),T=l.map(D=>Lm({inputs:{input:D},backend:t})),E=Om({inputs:w,backend:t,attrs:{axis:i}}),C=Om({inputs:T,backend:t,attrs:{axis:i}}),A=Ki({inputs:{real:E,imag:C},backend:t});return w.forEach(D=>t.disposeIntermediateTensorInfo(D)),T.forEach(D=>t.disposeIntermediateTensorInfo(D)),t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(C),A}const c=l.map(w=>{const E=[-1,Me(w.shape.slice(i))];return Hn({inputs:{x:w},backend:t,attrs:{shape:E}})}),h=c.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));o=zl(c.map(w=>w.shape),1);const p=c[0].shape[0]===1,m=A8(h,o,e[0].dtype,p),v=zl(l.map(w=>w.shape),i),_=t.makeTensorInfo(v,e[0].dtype,m);return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),_}const JCe={kernelName:Iw,backendName:"cpu",kernelFunc:Om};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dataFormat:l,dilations:c,dimRoundingMode:h}=s;it([r,i],"conv2d");const p=iu(l),m=Er(r.shape,i.shape,a,c,o,h,!1,p),v=m.filterHeight,_=m.filterWidth,w=m.dilationHeight,T=m.dilationWidth,E=m.padInfo.left,C=m.padInfo.top,A=m.dataFormat==="channelsLast",D=new Sr(m.outShape,r.dtype),F=ht(r.shape),W=ht(i.shape),B=F[0],P=A?F[1]:F[2],O=A?F[2]:1,M=A?1:F[1],k=D.strides[0],V=A?D.strides[1]:D.strides[2],G=A?D.strides[2]:1,ae=A?1:D.strides[1],J=t.data.get(r.dataId).values,X=t.data.get(i.dataId).values,se=D.values;for(let ne=0;ne<m.batchSize;++ne){const le=ne*B,K=ne*k;for(let ie=0;ie<m.outHeight;++ie){const de=K+ie*V,ce=ie*m.strideHeight-C;for(let Se=0;Se<v;++Se){const Te=ce+Se*w;if(Te<0||Te>=m.inHeight)continue;const Ie=Se*W[0],He=le+Te*P;for(let qe=0;qe<m.outWidth;++qe){const Qe=de+qe*G,ut=qe*m.strideWidth-E;for(let mt=0;mt<_;++mt){const At=ut+mt*T;if(At<0||At>=m.inWidth)continue;const Gt=Ie+mt*W[1],gn=He+At*O;let Jt=Gt;for(let Zt=0;Zt<m.inChannels;++Zt){const Pt=J[gn+Zt*M];for(let un=0;un<m.outChannels;++un)se[Qe+un*ae]+=Pt*X[Jt+un];Jt+=m.outChannels}}}}}}return t.makeTensorInfo(D.shape,D.dtype,se)}const eke={kernelName:Cw,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:h}=s;it([r,i],"conv2dBackpropFilter");const p=iu(l),m=Er(r.shape,h,a,1,o,c,!1,p),{strideHeight:v,strideWidth:_,filterHeight:w,filterWidth:T}=m,E=m.dataFormat==="channelsLast",C=new Sr(m.filterShape,"float32"),A=m.padInfo.left,D=m.padInfo.top,F=t.data.get(r.dataId).values,W=t.data.get(i.dataId).values,B=new Sr(r.shape,r.dtype,F),P=new Sr(i.shape,i.dtype,W);for(let O=0;O<w;++O){const M=Math.max(0,Math.ceil((D-O)/v)),k=Math.min(m.outHeight,(m.inHeight+D-O)/v);for(let V=0;V<T;++V){const G=Math.max(0,Math.ceil((A-V)/_)),ae=Math.min(m.outWidth,(m.inWidth+A-V)/_);for(let J=0;J<m.inChannels;++J)for(let X=0;X<m.outChannels;++X){let se=0;for(let ne=0;ne<m.batchSize;++ne)for(let le=M;le<k;++le){const K=O+le*v-D;for(let ie=G;ie<ae;++ie){const de=V+ie*_-A;E?se+=B.get(ne,K,de,J)*P.get(ne,le,ie,X):se+=B.get(ne,J,K,de)*P.get(ne,X,le,ie)}}C.set(se,O,V,J,X)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const nke={kernelName:Z2,backendName:"cpu",kernelFunc:tke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:h}=s;it([r,i],"conv2dBackpropInput");const p=ht(i.shape),m=ht(r.shape);let v=iu(c);const _=Er(a,i.shape,o,1,l,h,!1,v),w=new Sr(_.inShape,"float32"),T=w.values,E=t.data.get(r.dataId).values,C=t.data.get(i.dataId).values,[A,D,F]=p,{batchSize:W,filterHeight:B,filterWidth:P,inChannels:O,inHeight:M,inWidth:k,outChannels:V,outHeight:G,outWidth:ae,strideHeight:J,strideWidth:X}=_;v=_.dataFormat;const se=B-1-_.padInfo.top,ne=P-1-_.padInfo.left,le=v==="channelsLast",K=w.strides[0],ie=le?w.strides[1]:w.strides[2],de=le?w.strides[2]:1,ce=le?1:w.strides[1],Se=m[0],Te=le?m[1]:m[2],Ie=le?m[2]:1,He=le?1:m[1];for(let qe=0;qe<W;++qe)for(let Qe=0;Qe<O;++Qe)for(let ut=0;ut<M;++ut){const mt=ut-se,At=Math.max(0,Math.ceil(mt/J)),Gt=Math.min(G,(B+mt)/J);for(let gn=0;gn<k;++gn){const Jt=gn-ne,Zt=Math.max(0,Math.ceil(Jt/X)),Pt=Math.min(ae,(P+Jt)/X);let un=0;for(let Rn=At;Rn<Gt;++Rn){const zs=Rn*J-mt;for(let Vs=Zt;Vs<Pt;++Vs){const kr=Vs*X-Jt,sr=Se*qe+Te*Rn+Ie*Vs,Zr=A*(B-1-zs)+D*(P-1-kr)+F*Qe;for(let an=0;an<V;++an){const Mt=E[sr+He*an],ts=C[Zr+an];un+=Mt*ts}}}const Cr=K*qe+ie*ut+de*gn+ce*Qe;T[Cr]=un}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const rke={kernelName:kw,backendName:"cpu",kernelFunc:ske};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ike(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dilations:l}=s;it([r,i],"conv3d");const c=td(r.shape,i.shape,a,l,o),{filterDepth:h,filterHeight:p,filterWidth:m,dilationDepth:v,dilationHeight:_,dilationWidth:w,padInfo:T}=c,E=T.front,C=T.left,A=T.top,D=new Sr(c.outShape,r.dtype),F=t.data.get(r.dataId).values,W=t.data.get(i.dataId).values,B=D.values,P=ht(r.shape),O=ht(i.shape);for(let M=0;M<c.batchSize;++M){const k=M*P[0],V=M*D.strides[0];for(let G=0;G<c.outDepth;++G){const ae=V+G*D.strides[1],J=G*c.strideDepth-E;for(let X=0;X<h;++X){const se=J+X*v;if(se<0||se>=c.inDepth)continue;const ne=X*O[0],le=k+se*P[1];for(let K=0;K<c.outHeight;++K){const ie=ae+K*D.strides[2],de=K*c.strideHeight-A;for(let ce=0;ce<p;++ce){const Se=de+ce*_;if(Se<0||Se>=c.inHeight)continue;const Te=ne+ce*O[1],Ie=le+Se*P[2];for(let He=0;He<c.outWidth;++He){const qe=ie+He*c.outChannels,Qe=He*c.strideWidth-C;for(let ut=0;ut<m;++ut){const mt=Qe+ut*w;if(mt<0||mt>=c.inWidth)continue;const At=Te+ut*O[2],Gt=Ie+mt*c.inChannels;let gn=At;for(let Jt=0;Jt<c.inChannels;++Jt){const Zt=F[Gt+Jt];for(let Pt=0;Pt<c.outChannels;++Pt)B[qe+Pt]+=Zt*W[gn+Pt];gn+=c.outChannels}}}}}}}}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const ake={kernelName:$w,backendName:"cpu",kernelFunc:ike};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:a,pad:o,filterShape:l}=s;it([r,i],"conv3dBackpropFilterV2");const c=ht(r.shape),h=ht(i.shape),p=td(r.shape,l,a,1,o),m=p.strideDepth,v=p.strideHeight,_=p.strideWidth,w=p.filterDepth,T=p.filterHeight,E=p.filterWidth,C=new Sr(p.filterShape,"float32"),A=C.values,[D,F,W,B]=C.strides,P=t.data.get(i.dataId).values,[O,M,k,V]=h,G=t.data.get(r.dataId).values,[ae,J,X,se]=c,ne=p.padInfo.front,le=p.padInfo.left,K=p.padInfo.top;for(let ie=0;ie<w;++ie){const de=Math.max(0,Math.ceil((ne-ie)/m)),ce=Math.min(p.outDepth,(p.inDepth+ne-ie)/m),Se=ie*D;for(let Te=0;Te<T;++Te){const Ie=Math.max(0,Math.ceil((K-Te)/v)),He=Math.min(p.outHeight,(p.inHeight+K-Te)/v),qe=Te*F+Se;for(let Qe=0;Qe<E;++Qe){const ut=Math.max(0,Math.ceil((le-Qe)/_)),mt=Math.min(p.outWidth,(p.inWidth+le-Qe)/_),At=Qe*W+qe;for(let Gt=0;Gt<p.inChannels;++Gt){const gn=Gt*B+At;for(let Jt=0;Jt<p.outChannels;++Jt){let Zt=0;for(let Pt=0;Pt<p.batchSize;++Pt){const un=Pt*ae,Cr=Pt*O;for(let Rn=de;Rn<ce;++Rn){const Vs=(ie+Rn*m-ne)*J+un,kr=Rn*M+Cr;for(let sr=Ie;sr<He;++sr){const an=(Te+sr*v-K)*X+Vs,Mt=sr*k+kr;for(let ts=ut;ts<mt;++ts){const mo=(Qe+ts*_-le)*se+an,el=ts*V+Mt;Zt+=G[mo+Gt]*P[el+Jt]}}}}A[gn+Jt]=Zt}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const lke={kernelName:Y2,backendName:"cpu",kernelFunc:oke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:a,strides:o,inputShape:l}=s;it([r],"conv3dBackpropInputV2");const c=ht(r.shape),h=ht(i.shape),p=td(l,i.shape,o,1,a),m=new Sr(p.inShape,"float32"),v=m.values,[_,w,T,E]=m.strides,C=t.data.get(r.dataId).values,[A,D,F,W]=c,B=t.data.get(i.dataId).values,[P,O,M,k]=h,{batchSize:V,filterDepth:G,filterHeight:ae,filterWidth:J,inChannels:X,inDepth:se,inHeight:ne,inWidth:le,outChannels:K,outDepth:ie,outHeight:de,outWidth:ce,strideDepth:Se,strideHeight:Te,strideWidth:Ie}=p,He=G-1-p.padInfo.front,qe=ae-1-p.padInfo.top,Qe=J-1-p.padInfo.left;for(let ut=0;ut<V;++ut)for(let mt=0;mt<X;++mt)for(let At=0;At<se;++At){const Gt=At-He,gn=Math.max(0,Math.ceil(Gt/Se)),Jt=Math.min(ie,(G+Gt)/Se);for(let Zt=0;Zt<ne;++Zt){const Pt=Zt-qe,un=Math.max(0,Math.ceil(Pt/Te)),Cr=Math.min(de,(ae+Pt)/Te);for(let Rn=0;Rn<le;++Rn){const zs=Rn-Qe,Vs=Math.max(0,Math.ceil(zs/Ie)),kr=Math.min(ce,(J+zs)/Ie);let sr=0;for(let Zr=gn;Zr<Jt;++Zr){const an=Zr*Se-Gt;for(let Mt=un;Mt<Cr;++Mt){const ts=Mt*Te-Pt;for(let os=Vs;os<kr;++os){const mo=os*Ie-zs,el=A*ut+D*Zr+F*Mt+W*os,go=P*(G-1-an)+O*(ae-1-ts)+M*(J-1-mo)+k*mt;for(let _i=0;_i<K;++_i){const ta=C[el+_i],Yr=B[go+_i];sr+=ta*Yr}}}}v[_*ut+w*At+T*Zt+E*Rn+mt]=sr}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const uke={kernelName:Q2,backendName:"cpu",kernelFunc:cke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hke=In(ob,n=>Math.cos(n)),dke={kernelName:ob,backendName:"cpu",kernelFunc:hke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fke=In(lb,n=>Math.cosh(n)),pke={kernelName:lb,backendName:"cpu",kernelFunc:fke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mke(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:a}=e,{cropSize:o,method:l,extrapolationValue:c}=s,[h,p,m,v]=r.shape,_=i.shape[0],[w,T]=o,E=zt([_,w,T,v],"float32"),C=t.data.get(i.dataId).values,A=t.data.get(a.dataId).values,D=t.data.get(r.dataId).values,F=ht(r.shape),W=ht(E.shape);for(let B=0;B<_;B++){const P=B*4,O=C[P],M=C[P+1],k=C[P+2],V=C[P+3],G=A[B];if(G>=h)continue;const ae=w>1?(k-O)*(p-1)/(w-1):0,J=T>1?(V-M)*(m-1)/(T-1):0;for(let X=0;X<w;X++){const se=w>1?O*(p-1)+X*ae:.5*(O+k)*(p-1);if(se<0||se>p-1){for(let ne=0;ne<T;ne++)for(let le=0;le<v;le++){const K=le+ne*W[2]+X*W[1]+B*W[0];E.values[K]=c}continue}if(l==="bilinear"){const ne=Math.floor(se),le=Math.ceil(se),K=se-ne;for(let ie=0;ie<T;ie++){const de=T>1?M*(m-1)+ie*J:.5*(M+V)*(m-1);if(de<0||de>m-1){for(let Ie=0;Ie<v;Ie++){const He=Ie+ie*W[2]+X*W[1]+B*W[0];E.values[He]=c}continue}const ce=Math.floor(de),Se=Math.ceil(de),Te=de-ce;for(let Ie=0;Ie<v;Ie++){let He=Ie+ce*F[2]+ne*F[1]+G*F[0];const qe=D[He];He=Ie+Se*F[2]+ne*F[1]+G*F[0];const Qe=D[He];He=Ie+ce*F[2]+le*F[1]+G*F[0];const ut=D[He];He=Ie+Se*F[2]+le*F[1]+G*F[0];const mt=D[He],At=qe+(Qe-qe)*Te,Gt=ut+(mt-ut)*Te;He=Ie+ie*W[2]+X*W[1]+B*W[0],E.values[He]=At+(Gt-At)*K}}}else for(let ne=0;ne<T;++ne){const le=T>1?M*(m-1)+ne*J:.5*(M+V)*(m-1);if(le<0||le>m-1){for(let de=0;de<v;de++){const ce=de+ne*W[2]+X*W[1]+B*W[0];E.values[ce]=c}continue}const K=Math.round(le),ie=Math.round(se);for(let de=0;de<v;de++){const ce=de+K*F[2]+ie*F[1]+G*F[0],Se=de+ne*W[2]+X*W[1]+B*W[0];E.values[Se]=D[ce]}}}}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const gke={kernelName:e$,backendName:"cpu",kernelFunc:mke};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:a,reverse:o}=s;it(r,"cumprod");const l=fs([i],r.shape.length);let c=r;l!=null&&(c=Li({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=Is(1,r.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const p=Qi(c.dtype,"int32"),m=j2(Me(c.shape),p),v=t.data.get(c.dataId).values,_=c.shape[c.shape.length-1],w=o?(E,C)=>E+_-C-1:(E,C)=>E+C;for(let E=0;E<v.length;E+=_)for(let C=0;C<_;C++){const A=w(E,C);if(C===0)m[A]=a?1:v[A];else{const D=w(E,C-1);m[A]=a?v[D]*m[D]:v[A]*m[D]}}const T=t.makeTensorInfo(c.shape,p,m);if(l!=null){const E=nd(l),C=Li({inputs:{x:T},backend:t,attrs:{perm:E}});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(c),C}return T}const vke={kernelName:J2,backendName:"cpu",kernelFunc:yke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:a,reverse:o}=s;it(r,"cumsum");const l=fs([i],r.shape.length);let c=r;l!=null&&(c=Li({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=Is(1,r.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const p=Qi(c.dtype,"int32"),m=Gr(Me(c.shape),p),v=t.data.get(c.dataId).values,_=c.shape[c.shape.length-1],w=o?(E,C)=>E+_-C-1:(E,C)=>E+C;for(let E=0;E<v.length;E+=_)for(let C=0;C<_;C++){const A=w(E,C);if(C===0)m[A]=a?0:v[A];else{const D=w(E,C-1);m[A]=a?v[D]+m[D]:v[A]+m[D]}}const T=t.makeTensorInfo(c.shape,p,m);if(l!=null){const E=nd(l),C=Li({inputs:{x:T},backend:t,attrs:{perm:E}});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(c),C}return T}const _ke={kernelName:Aw,backendName:"cpu",kernelFunc:bke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:a,binaryOutput:o}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,c=t.data.get(i.dataId).values,h=eR(l,c,i.dtype,i.shape,a);return t.makeTensorInfo([a],i.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(i),h=C8(l,c,a,o);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const wke={kernelName:t$,backendName:"cpu",kernelFunc:xke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:a}=s;te(a==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`);const o=r.shape[0],l=r.shape[1],c=r.shape[2],h=r.shape[3],p=l*i,m=c*i,v=h/(i*i),_=t.data.get(r.dataId).values,w=new Float32Array(o*p*m*v);let T=0;for(let E=0;E<o;++E)for(let C=0;C<p;++C){const A=Math.floor(C/i),D=C%i;for(let F=0;F<m;++F){const W=Math.floor(F/i),B=F%i,P=(D*i+B)*v;for(let O=0;O<v;++O){const k=O+P+h*(W+c*(A+l*E));w[T++]=_[k]}}}return t.makeTensorInfo([o,p,m,v],r.dtype,w)}const Ske={kernelName:n$,backendName:"cpu",kernelFunc:Tke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dilations:l,dimRoundingMode:c}=s;it([r,i],"depthwiseConv2DNative");const h=ht(r.shape),p=ht(i.shape);let m=l;m==null&&(m=[1,1]),te(qr(a,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${m}'`);const v=Er(r.shape,i.shape,a,m,o,c,!0),{filterHeight:_,filterWidth:w,dilationHeight:T,dilationWidth:E,padInfo:C}=v,A=C.left,D=C.top,F=v.outChannels/v.inChannels,W=new Sr(v.outShape,r.dtype),B=t.data.get(r.dataId).values,P=t.data.get(i.dataId).values,O=W.values;for(let M=0;M<v.batchSize;++M){const k=M*h[0],V=M*W.strides[0];for(let G=0;G<v.outHeight;++G){const ae=V+G*W.strides[1],J=G*v.strideHeight-D;for(let X=0;X<_;++X){const se=J+X*T;if(se<0||se>=v.inHeight)continue;const ne=X*p[0],le=k+se*h[1];for(let K=0;K<v.outWidth;++K){const ie=ae+K*W.strides[2],de=K*v.strideWidth-A;for(let ce=0;ce<w;++ce){const Se=de+ce*E;if(Se<0||Se>=v.inWidth)continue;const Te=ne+ce*p[1],Ie=le+Se*v.inChannels;let He=ie,qe=Te;for(let Qe=0;Qe<v.inChannels;++Qe){const ut=B[Ie+Qe];for(let mt=0;mt<F;++mt)O[He+mt]+=ut*P[qe+mt];He+=F,qe+=F}}}}}}return t.makeTensorInfo(W.shape,W.dtype,W.values)}const Eke={kernelName:Rw,backendName:"cpu",kernelFunc:CK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:c,filterShape:h}=s;it([r,i],"depthwiseConv2dNativeBackpropFilter");const p=Er(r.shape,h,a,o,l,c,!0),{strideHeight:m,strideWidth:v,filterHeight:_,filterWidth:w}=p,T=new Sr(p.filterShape,"float32"),E=p.padInfo.left,C=p.padInfo.top,A=p.outChannels/p.inChannels,D=t.data.get(r.dataId).values,F=new Sr(r.shape,r.dtype,D),W=t.data.get(i.dataId).values,B=new Sr(i.shape,i.dtype,W);for(let P=0;P<_;++P){const O=Math.max(0,Math.ceil((C-P)/m)),M=Math.min(p.outHeight,(p.inHeight+C-P)/m);for(let k=0;k<w;++k){const V=Math.max(0,Math.ceil((E-k)/v)),G=Math.min(p.outWidth,(p.inWidth+E-k)/v);for(let ae=0;ae<p.outChannels;++ae){const J=Math.trunc(ae/A),X=ae%A;let se=0;for(let ne=0;ne<p.batchSize;++ne)for(let le=O;le<M;++le){const K=P+le*m-C;for(let ie=V;ie<G;++ie){const de=k+ie*v-E;se+=F.get(ne,K,de,J)*B.get(ne,le,ie,ae)}}T.set(se,P,k,J,X)}}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Ike={kernelName:s$,backendName:"cpu",kernelFunc:Nke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cke(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:c,inputShape:h}=s;it([r,i],"depthwiseConv2DNativeBackpropInput");const p=ht(r.shape),m=ht(i.shape),v=Er(h,i.shape,a,o,l,c,!0),_=new Sr(v.inShape,"float32"),w=_.values,[T,E,C]=_.strides,A=t.data.get(r.dataId).values,[D,F,W]=p,B=t.data.get(i.dataId).values,[P,O,M]=m,{batchSize:k,filterHeight:V,filterWidth:G,inChannels:ae,inHeight:J,inWidth:X,outChannels:se,outHeight:ne,outWidth:le,strideHeight:K,strideWidth:ie}=v,de=V-1-v.padInfo.top,ce=G-1-v.padInfo.left,Se=se/ae;for(let Te=0;Te<k;++Te)for(let Ie=0;Ie<ae;++Ie)for(let He=0;He<J;++He){const qe=He-de,Qe=Math.max(0,Math.ceil(qe/K)),ut=Math.min(ne,(V+qe)/K);for(let mt=0;mt<X;++mt){const At=mt-ce,Gt=Math.max(0,Math.ceil(At/ie)),gn=Math.min(le,(G+At)/ie);let Jt=0;for(let Zt=Qe;Zt<ut;++Zt){const Pt=Zt*K-qe;for(let un=Gt;un<gn;++un){const Cr=un*ie-At,Rn=D*Te+F*Zt+W*un,zs=P*(V-1-Pt)+O*(G-1-Cr)+M*Ie;for(let Vs=0;Vs<Se;++Vs){const kr=Ie*Se+Vs,sr=A[Rn+kr],Zr=B[zs+Vs];Jt+=sr*Zr}}}w[T*Te+E*He+C*mt+Ie]=Jt}}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const kke={kernelName:r$,backendName:"cpu",kernelFunc:Cke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ke(n){const{inputs:e,backend:t}=n,{x:s}=e,r=Me(s.shape),i=t.data.get(s.dataId).values,a=zt([r,r],s.dtype),o=a.values;for(let c=0;c<i.length;c++)o[c*r+c]=i[c];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,a.dtype,a.values)}const Ake={kernelName:JW,backendName:"cpu",kernelFunc:$ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rke={kernelName:Dw,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:a,dilations:o}=t,l=e,c=l.data.get(s.dataId).values,h=s.shape.length,p=l.data.get(r.dataId).values,m=r.shape.length,{batchSize:v,inHeight:_,inWidth:w,inChannels:T,outHeight:E,outWidth:C,padInfo:A,strideHeight:D,strideWidth:F,filterHeight:W,filterWidth:B,dilationHeight:P,dilationWidth:O,outShape:M}=Hb(s.shape,r.shape,i,a,"NHWC",o),k=Me(M),V=M.length,G=ws(s.dtype,k);for(let J=0;J<v;++J)for(let X=0;X<E;++X){const se=X*D-A.top;for(let ne=0;ne<C;++ne){const le=ne*F-A.left;for(let K=0;K<T;++K){let ie=Number.MIN_SAFE_INTEGER;for(let ce=0;ce<W;++ce){const Se=se+ce*P;if(Se>=0&&Se<_)for(let Te=0;Te<B;++Te){const Ie=le+Te*O;if(Ie>=0&&Ie<w){const He=jl([J,Se,Ie,K],h,ht(s.shape)),qe=jl([ce,Te,K],m,ht(r.shape)),Qe=c[He]+p[qe];Qe>ie&&(ie=Qe)}}}const de=jl([J,X,ne,K],V,ht(M));G[de]=ie}}}return{dataId:l.write(Wf(G,s.dtype),M,s.dtype),shape:M,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dke={kernelName:zI,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:a,pad:o,dilations:l}=t,c=e,h=Uo(s.shape,c.data.get(s.dataId).values),p=Uo(r.shape,c.data.get(r.dataId).values),{batchSize:m,inHeight:v,inWidth:_,inChannels:w,outHeight:T,outWidth:E,padInfo:C,strideHeight:A,strideWidth:D,filterHeight:F,filterWidth:W,dilationHeight:B,dilationWidth:P,outShape:O}=Hb(s.shape,r.shape,a,o,"NHWC",l);te(i.rank===O.length,()=>`Error in ${zI}, dy must have the same rank as output ${O.length}, but got ${i.rank}`);const M=Uo(O,c.data.get(i.dataId).values),k=XW(r.shape,r.dtype);for(let G=0;G<m;++G)for(let ae=0;ae<T;++ae){const J=ae*A-C.top;for(let X=0;X<E;++X){const se=X*D-C.left;for(let ne=0;ne<w;++ne){let le=Number.MIN_SAFE_INTEGER,K=0,ie=0;for(let de=0;de<F;++de){const ce=J+de*B;if(ce>=0&&ce<v)for(let Se=0;Se<W;++Se){const Te=se+Se*P;if(Te>=0&&Te<_){const Ie=h[G][ce][Te][ne]+p[de][Se][ne];Ie>le&&(le=Ie,K=de,ie=Se)}}}k[K][ie][ne]+=M[G][ae][X][ne]}}}return{dataId:c.write(Wf(k,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lke={kernelName:BI,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:a,pad:o,dilations:l}=t,c=e,h=Uo(s.shape,c.data.get(s.dataId).values),p=Uo(r.shape,c.data.get(r.dataId).values),{batchSize:m,inHeight:v,inWidth:_,inChannels:w,outHeight:T,outWidth:E,padInfo:C,strideHeight:A,strideWidth:D,filterHeight:F,filterWidth:W,dilationHeight:B,dilationWidth:P,outShape:O}=Hb(s.shape,r.shape,a,o,"NHWC",l);te(i.rank===O.length,()=>`Error in ${BI}, dy must have the same rank as output ${O.length}, but got ${i.rank}`);const M=Uo(O,c.data.get(i.dataId).values),k=XW(s.shape,s.dtype);for(let G=0;G<m;++G)for(let ae=0;ae<T;++ae){const J=ae*A-C.top;for(let X=0;X<E;++X){const se=X*D-C.left;for(let ne=0;ne<w;++ne){let le=Number.MIN_SAFE_INTEGER,K=J<0?0:J,ie=se<0?0:se;for(let de=0;de<F;++de){const ce=J+de*B;if(ce>=0&&ce<v)for(let Se=0;Se<W;++Se){const Te=se+Se*P;if(Te>=0&&Te<_){const Ie=h[G][ce][Te][ne]+p[de][Se][ne];Ie>le&&(le=Ie,K=ce,ie=Te)}}}k[G][K][ie][ne]+=M[G][ae][X][ne]}}}return{dataId:c.write(Wf(k,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oke(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:a}=s,{contextOptions:o,imageOptions:l}=a||{},c=l?.alpha||1,h=o?.contextType||"2d";if(h!=="2d")throw new Error(`Context type ${o.contextType} is not supported by the CPU backend.`);const p=i.getContext(h,o?.contextAttributes||{});if(p==null)throw new Error(`Could not get the context with ${h} type.`);const[m,v]=r.shape.slice(0,2),_=r.shape.length===2?1:r.shape[2],w=t.data.get(r.dataId).values,T=r.dtype==="float32"?255:1,E=new Uint8ClampedArray(v*m*4);for(let A=0;A<m*v;++A){const D=[0,0,0,255*c];for(let W=0;W<_;W++){const B=w[A*_+W];if(r.dtype==="float32"){if(B<0||B>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${B}.`)}else if(r.dtype==="int32"&&(B<0||B>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${B}.`);_===1?(D[0]=B*T,D[1]=B*T,D[2]=B*T):D[W]=B*T}const F=A*4;E[F+0]=Math.round(D[0]),E[F+1]=Math.round(D[1]),E[F+2]=Math.round(D[2]),E[F+3]=Math.round(D[3])}i.width=v,i.height=m;const C=new ImageData(E,v,m);return p.putImageData(C,0,0),r}const Pke={kernelName:Dve,backendName:"cpu",kernelFunc:Oke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s;it(r,"sum");let o;r.dtype==="bool"?o=Uh({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):o=sc({inputs:{x:r},backend:t});const l=o.shape.length,c=Vt(i,o.shape),h=fs(c,l);let p=c,m=o;h!=null&&(m=Li({inputs:{x:o},backend:t,attrs:{perm:h}}),p=Is(p.length,l)),Nr("sum",p,m.shape.length);const[v,_]=fr(m.shape,p),w=Qi(m.dtype,"int32");let T=g1(t,v,w);const E=Me(_),C=t.data.get(T.dataId).values,A=t.data.get(m.dataId).values;for(let D=0;D<C.length;++D){const F=D*E;let W=0;for(let B=0;B<E;++B)W+=A[F+B];C[D]=W}if(a){const D=Bs(T.shape,c),F=T;T=Hn({inputs:{x:T},backend:t,attrs:{shape:D}}),t.disposeIntermediateTensorInfo(F)}return t.disposeIntermediateTensorInfo(o),h!=null&&t.disposeIntermediateTensorInfo(m),T}const Mke={kernelName:dT,backendName:"cpu",kernelFunc:l_};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fke(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:a,summedDims:o,idDims:l}=SA(r,i.length);NA(a.length,l,i);const{path:c,steps:h}=IA(o,l),p=h.length;let m=null,v=a.length;const _=[];for(let w=0;w<p;++w){for(const T of h[w]){const{permutationIndices:E,expandDims:C}=EA(v,l[T]);let A;CA(E)?A=i[T]:(A=Li({inputs:{x:i[T]},backend:t,attrs:{perm:E}}),_.push(A));const D=A.shape.slice();for(let F=0;F<C.length;++F)D.splice(C[F],0,1);xn(A.shape,D)||(A=Hn({inputs:{x:A},backend:t,attrs:{shape:D}}),_.push(A)),m===null?m=A:(m=UT({inputs:{a:A,b:m},backend:t}),_.push(m))}w<p-1&&(c[w]>=0&&(m=l_({inputs:{x:m},backend:t,attrs:{axis:c[w]-(a.length-v),keepDims:!1}}),_.push(m)),v--)}for(const w of _)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const jke={kernelName:i$,backendName:"cpu",kernelFunc:Fke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bke(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;it([s,r],"eluGrad");const i=new Float32Array(Me(r.shape)),a=t.data.get(r.dataId).values,o=t.data.get(s.dataId).values;for(let l=0;l<a.length;++l){const c=a[l];c>=0?i[l]=o[l]:i[l]=o[l]*(c+1)}return t.makeTensorInfo(r.shape,"float32",i)}const zke={kernelName:a$,backendName:"cpu",kernelFunc:Bke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vke=yA,Uke=vA,Gke=bA,Wke=_A,Hke=xA,qke=wA,Kke=In(hb,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+Vke*t);return e*(1-((((qke*s+Hke)*s+Wke)*s+Gke)*s+Uke)*s*Math.exp(-t*t))}),Xke={kernelName:hb,backendName:"cpu",kernelFunc:Kke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,a=r.shape.length,o=r.shape.slice();let l=i;return i<0&&(te(-(a+1)<=i,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+i+1),o.splice(l,0,1),Hn({inputs:{x:r},backend:t,attrs:{shape:o}})}const Zke={kernelName:Ow,backendName:"cpu",kernelFunc:b1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yke=ks((n,e)=>n/e),aR=nr(cb,Yke),fC={kernelName:cb,backendName:"cpu",kernelFunc:aR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n,e,t){const s=n.shape,r=s[0],i=s[1],a=t.data.get(n.dataId),o=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,c=[r,i],h=Me(c),p=Ur("float32",h),m=Ur("float32",h);for(let T=0;T<r;T++){const E=Ff({inputs:{x:o},backend:t,attrs:{begin:[T,0],size:[1,i]}}),C=Ff({inputs:{x:l},backend:t,attrs:{begin:[T,0],size:[1,i]}}),A=Ki({inputs:{real:E,imag:C},backend:t}),{real:D,imag:F}=Qke(A,e,t),W=Qc(D,F);for(let B=0;B<i;B++){const P=TA(W,B);p[T*i+B]=P.real,m[T*i+B]=P.imag}t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(A)}const v=t.makeTensorInfo(c,"float32",p),_=t.makeTensorInfo(c,"float32",m),w=Ki({inputs:{real:v,imag:_},backend:t});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(_),w}function Qke(n,e,t){const s=Me(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,a=t.data.get(r.complexTensorInfos.imag.dataId).values;if(Jke(s)){const o=pC(i,a,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",o.real),h=t.makeTensorInfo(l,"float32",o.imag),p=t.makeTensorInfo([],"float32",ed(s,"float32")),m=sc({inputs:{x:p},backend:t}),v=fC.kernelFunc({inputs:{a:c,b:p},backend:t}),_=fC.kernelFunc({inputs:{a:h,b:m},backend:t}),w=t.data.get(v.dataId).values,T=t.data.get(_.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(_),{real:w,imag:T}}return o}else{const o=Qc(i,a),l=e2e(o,s,e);return VH(l)}}function Jke(n){return(n&n-1)===0}function pC(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=Qc(n,e),a=t/2,o=UH(i),l=o.real,c=o.imag,h=[l.length],p=r.makeTensorInfo(h,"float32",l),m=r.makeTensorInfo(h,"float32",c),v=Ki({inputs:{real:p,imag:m},backend:r}),_=GH(i),w=_.real,T=_.imag,E=[w.length],C=r.makeTensorInfo(E,"float32",w),A=r.makeTensorInfo(E,"float32",T),D=Ki({inputs:{real:C,imag:A},backend:r}),F=pC(l,c,a,s,r),W=F.real,B=F.imag,P=[W.length],O=r.makeTensorInfo(P,"float32",W),M=r.makeTensorInfo(P,"float32",B),k=Ki({inputs:{real:O,imag:M},backend:r}),V=pC(w,T,a,s,r),G=V.real,ae=V.imag,J=[G.length],X=r.makeTensorInfo(J,"float32",G),se=r.makeTensorInfo(J,"float32",ae),ne=Ki({inputs:{real:X,imag:se},backend:r}),le=HH(t,s),K=[le.real.length],ie=r.makeTensorInfo(K,"float32",le.real),de=r.makeTensorInfo(K,"float32",le.imag),ce=Ki({inputs:{real:ie,imag:de},backend:r}),Se=UT({inputs:{a:ce,b:ne},backend:r}),Te=Dm({inputs:{a:k,b:Se},backend:r}),Ie=rR({inputs:{a:k,b:Se},backend:r}),He=Mf({inputs:{input:Te},backend:r}),qe=Mf({inputs:{input:Ie},backend:r}),Qe=Lm({inputs:{input:Te},backend:r}),ut=Lm({inputs:{input:Ie},backend:r}),mt=Om({inputs:[He,qe],backend:r,attrs:{axis:0}}),At=Om({inputs:[Qe,ut],backend:r,attrs:{axis:0}}),Gt=r.data.get(mt.dataId).values,gn=r.data.get(At.dataId).values;return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(Se),r.disposeIntermediateTensorInfo(Te),r.disposeIntermediateTensorInfo(Ie),r.disposeIntermediateTensorInfo(He),r.disposeIntermediateTensorInfo(Qe),r.disposeIntermediateTensorInfo(qe),r.disposeIntermediateTensorInfo(ut),r.disposeIntermediateTensorInfo(mt),r.disposeIntermediateTensorInfo(At),{real:Gt,imag:gn}}function e2e(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,a=0;for(let o=0;o<e;o++){const l=qH(r*o,e,t),c=TA(n,o);i+=c.real*l.real-c.imag*l.imag,a+=c.real*l.imag+c.imag*l.real}t&&(i/=e,a/=e),WH(s,i,a,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t2e(n){const{inputs:e,backend:t}=n,{input:s}=e,r=Me(s.shape),i=s.shape[s.shape.length-1],a=r/i,o=Hn({inputs:{x:s},backend:t,attrs:{shape:[a,i]}}),l=kK(o,!1,t),c=Hn({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}const n2e={kernelName:o$,backendName:"cpu",kernelFunc:t2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,a=i||Qm(r),o=ws(a,Me(s));return r2e(o,r,a),e.makeTensorInfo(s,a,o)}const s2e={kernelName:l$,backendName:"cpu",kernelFunc:oR};function r2e(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i2e={kernelName:c$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=Ur(s.dtype,Me(s.shape)),[a,o,l,c]=s.shape,h=r.data.get(s.dataId).values;for(let m=0;m<a;m++){const v=m*l*o*c;for(let _=0;_<o;_++){const w=_*(l*c);for(let T=0;T<l;T++){const E=T*c;for(let C=0;C<c;C++){const A=Math.round(l-T-1),D=v+w+E+C;let F=h[D];if(A>=0&&A<l){const W=A*c,B=v+w+W+C;F=h[B]}i[D]=F}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:a,preluActivationWeights:o}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:m,activation:v,leakyreluAlpha:_}=s;let w=IK({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:m}});if(a){const T=w;if(h==="NCHW"&&a.shape.length===1&&a.shape[0]!==1){const E=Hn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});w=Dm({inputs:{a:w,b:E},backend:t}),t.disposeIntermediateTensorInfo(E)}else w=Dm({inputs:{a:w,b:a},backend:t});t.disposeIntermediateTensorInfo(T)}if(v){const T=w;if(h==="NCHW"&&v==="prelu"&&o.shape.length===1&&o.shape[0]!==1){const E=Hn({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});w=v1(t,w,v,E,_),t.disposeIntermediateTensorInfo(E)}else w=v1(t,w,v,o,_);t.disposeIntermediateTensorInfo(T)}return w}const o2e={kernelName:J0,backendName:"cpu",kernelFunc:a2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:a,preluActivationWeights:o}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:m,activation:v,leakyreluAlpha:_}=s;let w=CK({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:m}});if(a){const T=w;w=Dm({inputs:{a:w,b:a},backend:t}),t.disposeIntermediateTensorInfo(T)}if(v){const T=w;w=v1(t,w,v,o,_),t.disposeIntermediateTensorInfo(T)}return w}const c2e={kernelName:v5,backendName:"cpu",kernelFunc:l2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u2e(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=Me(s.shape),a=r.shape,o=a[a.length-1],[l,c,h,p]=aA(s,r);if(c===0)return t.makeTensorInfo(l,s.dtype,[]);const m=t.data.get(r.dataId).values,v=t.bufferSync(s),_=j8(m,v,s.dtype,c,o,h,p,s.shape,i);return t.makeTensorInfo(l,s.dtype,_.values)}const h2e={kernelName:e5,backendName:"cpu",kernelFunc:u2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:a,batchDims:o}=s;it([r,i],"gatherV2");const l=Vt(a,r.shape)[0],c=t.data.get(i.dataId).values,h=r.shape[l];for(let D=0;D<c.length;++D){const F=c[D];te(F<=h-1&&F>=0,()=>`GatherV2: the index value ${F} is not in [0, ${h-1}]`)}let p=o;o==null&&(p=0);const m=Me(i.shape),v=$A(r,i,l,p),_=Hn({inputs:{x:r},backend:t,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),w=Hn({inputs:{x:i},backend:t,attrs:{shape:[v.batchSize,m/v.batchSize]}}),T=[v.batchSize,v.outerSize,m/v.batchSize,v.sliceSize],E=t.bufferSync(w),C=t.bufferSync(_),A=B8(C,E,T);return t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(v.outputShape,A.dtype,A.values)}const f2e={kernelName:Mw,backendName:"cpu",kernelFunc:d2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2e(n){const{inputs:e,backend:t}=n,{input:s}=e,r=Me(s.shape),i=s.shape[s.shape.length-1],a=r/i,o=Hn({inputs:{x:s},backend:t,attrs:{shape:[a,i]}}),l=kK(o,!0,t),c=Hn({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}const m2e={kernelName:u$,backendName:"cpu",kernelFunc:p2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2e=In(vb,n=>Number.isFinite(n)?1:0,"bool"),y2e={kernelName:vb,backendName:"cpu",kernelFunc:g2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2e=In(bb,n=>Math.abs(n)===1/0?1:0,"bool"),b2e={kernelName:bb,backendName:"cpu",kernelFunc:v2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _2e=In(_b,n=>Number.isNaN(n)?1:0,"bool"),x2e={kernelName:_b,backendName:"cpu",kernelFunc:_2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2e(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,a=W8(s,r,i);return e.makeTensorInfo([a.length],"float32",a)}const T2e={kernelName:t5,backendName:"cpu",kernelFunc:w2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S2e=In(wb,n=>Math.log1p(n)),E2e={kernelName:wb,backendName:"cpu",kernelFunc:S2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2e=ks((n,e)=>n&&e),I2e=nr(Vw,N2e,null,"bool"),C2e={kernelName:Vw,backendName:"cpu",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k2e=In(Uw,n=>n?0:1,"bool"),$2e={kernelName:Uw,backendName:"cpu",kernelFunc:k2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2e=ks((n,e)=>n||e),R2e=nr(Gw,A2e,null,"bool"),D2e={kernelName:Gw,backendName:"cpu",kernelFunc:R2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:a,alpha:o,beta:l}=s;it(r,"LRN");const c=r.shape[3],h=c-1,p=t.data.get(r.dataId).values,m=Me(r.shape),v=new Float32Array(m);function _(w){const T=w%c;let E=w-T+Math.max(0,T-i);const C=w-T+Math.min(T+i,h);let A=0;for(;E<=C;E++){const D=p[E];A+=D*D}return A}for(let w=0;w<m;w++){const T=_(w),E=p[w]*Math.pow(a+o*T,-l);v[w]=E}return t.makeTensorInfo(r.shape,r.dtype,v)}const O2e={kernelName:Ww,backendName:"cpu",kernelFunc:L2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:a}=e,{depthRadius:o,bias:l,alpha:c,beta:h}=s;it(a,"LRNGrad");const p=Me(a.shape),m=a.shape[3],v=t.data.get(a.dataId).values,_=t.data.get(r.dataId).values,w=t.data.get(i.dataId).values,T=new Float32Array(p),E=p;for(let C=0;C<E;C++){const A=C%m,D=C-A+Math.max(0,A-o),F=C-A+Math.min(m,A+o+1);let W=0;for(let B=D;B<F;B++)W+=Math.pow(_[B],2);W=c*W+l;for(let B=D;B<F;B++){let P=-2*c*h*_[B]*w[C]/W;C===B&&(P+=Math.pow(W,-h)),P*=v[C],T[B]+=P}}return t.makeTensorInfo(a.shape,r.dtype,T)}const M2e={kernelName:d$,backendName:"cpu",kernelFunc:P2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:a}=s,o=t;let l=r.shape;const c=l.length,h=Vt(i,l);let p=h;const m=fs(p,c);let v=o.data.get(r.dataId).values;if(m!=null){const D=new Array(c);for(let F=0;F<D.length;F++)D[F]=l[m[F]];v=nR(v,l,r.dtype,m,D),p=Is(p.length,c),l=D}it(r,"max"),Nr("max",p,c);const[_,w]=fr(l,p),T=Me(w),E=q8(v,T,_,r.dtype),C=o.write(E,_,r.dtype);let A=_;return a&&(A=Bs(_,h)),{dataId:C,shape:A,dtype:r.dtype}}const F2e={kernelName:Hw,backendName:"cpu",kernelFunc:$K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;it(r,"maxPool");const{filterSize:i,strides:a,pad:o,dimRoundingMode:l}=s,c=1;te(qr(a,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=ho(r.shape,i,a,c,o,l);let p;if(h.filterWidth===1&&h.filterHeight===1&&xn(h.inShape,h.outShape))p=sc({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,v=ht(r.shape),_=iR(m,r.shape,r.dtype,v,h,"max");p=t.makeTensorInfo(h.outShape,r.dtype,_.values)}return p}const B2e={kernelName:qw,backendName:"cpu",kernelFunc:j2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=s;it(r,"maxPool3d");const h=ru(r.shape,i,a,1,o,l,c),p=t.data.get(r.dataId).values,m=NK(p,r.shape,r.dtype,ht(r.shape),h,"max");return t.makeTensorInfo(m.shape,"float32",m.values)}const V2e={kernelName:Kw,backendName:"cpu",kernelFunc:z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U2e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=s;it([r,i],"maxPool3DGrad");const h=ru(i.shape,a,o,1,l,c),p=t.bufferSync(i),m=ACe(p,h),v=h.strideDepth,_=h.strideHeight,w=h.strideWidth,T=h.dilationDepth,E=h.dilationHeight,C=h.dilationWidth,A=h.effectiveFilterDepth,D=h.effectiveFilterHeight,F=h.effectiveFilterWidth,W=A-1-h.padInfo.front,B=F-1-h.padInfo.left,P=D-1-h.padInfo.top,O=zt(i.shape,"float32"),M=t.bufferSync(r);for(let k=0;k<h.batchSize;++k)for(let V=0;V<h.inChannels;++V)for(let G=0;G<h.inDepth;++G)for(let ae=0;ae<h.inHeight;++ae)for(let J=0;J<h.inWidth;++J){const X=G-W,se=ae-P,ne=J-B;let le=0;for(let K=0;K<A;K+=T){const ie=(X+K)/v;if(!(ie<0||ie>=h.outDepth||Math.floor(ie)!==ie))for(let de=0;de<D;de+=E){const ce=(se+de)/_;if(!(ce<0||ce>=h.outHeight||Math.floor(ce)!==ce))for(let Se=0;Se<F;Se+=C){const Te=(ne+Se)/w;if(Te<0||Te>=h.outWidth||Math.floor(Te)!==Te)continue;const Ie=A*D*F-1-m.get(k,ie,ce,Te,V),He=K*D*F+de*F+Se,qe=Ie===He?1:0;if(qe===0)continue;const Qe=M.get(k,ie,ce,Te,V);le+=Qe*qe}}}O.set(le,k,G,ae,J,V)}return t.makeTensorInfo(O.shape,O.dtype,O.values)}const G2e={kernelName:p$,backendName:"cpu",kernelFunc:U2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:a}=e,o=i;it([i,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:p}=s,m=ho(o.shape,l,c,1,h,p),v=t.data.get(o.dataId).values,_=zt(m.outShape,o.dtype,EK(v,o.shape,o.dtype,m).values),w=m.strideHeight,T=m.strideWidth,E=m.dilationHeight,C=m.dilationWidth,A=m.effectiveFilterHeight,D=m.effectiveFilterWidth,F=D-1-m.padInfo.left,W=A-1-m.padInfo.top,B=zt(o.shape,"float32"),P=t.data.get(r.dataId).values,O=zt(r.shape,"float32",P);for(let M=0;M<m.batchSize;++M)for(let k=0;k<m.inChannels;++k)for(let V=0;V<m.inHeight;++V)for(let G=0;G<m.inWidth;++G){const ae=V-W,J=G-F;let X=0;for(let se=0;se<A;se+=E){const ne=(ae+se)/w;if(!(ne<0||ne>=m.outHeight||Math.floor(ne)!==ne))for(let le=0;le<D;le+=C){const K=(J+le)/T;if(K<0||K>=m.outWidth||Math.floor(K)!==K)continue;const ie=A*D-1-_.get(M,ne,K,k),de=se*D+le,ce=ie===de?1:0;if(ce===0)continue;const Se=O.get(M,ne,K,k);X+=Se*ce}}B.set(X,M,V,G,k)}return t.makeTensorInfo(B.shape,B.dtype,B.values)}const H2e={kernelName:f$,backendName:"cpu",kernelFunc:W2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2e(n,e,t,s,r){const i=ht(e),a=iR(n,e,t,i,r,"max"),o=EK(n,e,t,r,!0,s);return[a.values,o.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2e={kernelName:n5,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:a,includeBatchInIndex:o}=e,l=t;it(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,h=ho(s.shape,r,i,[1,1],a),[p,m]=q2e(c,s.shape,s.dtype,o,h),v=l.write(p,h.outShape,s.dtype),_=l.write(m,h.outShape,s.dtype);return[{dataId:v,shape:h.outShape,dtype:s.dtype},{dataId:_,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s,o=Vt(i,r.shape),c=fr(r.shape,o)[1],h=Me(c),p=[],m=t.makeTensorInfo([],"float32",new Float32Array([h]));p.push(m);const v=Uh({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});p.push(v);const _=aR({inputs:{a:v,b:m},backend:t});p.push(_);const w=l_({inputs:{x:_},backend:t,attrs:{axis:i,keepDims:a}});return p.forEach(T=>t.disposeIntermediateTensorInfo(T)),w}const Z2e={kernelName:Xw,backendName:"cpu",kernelFunc:X2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s;it(r,"min");const o=Vt(i,r.shape);let l=o;const c=fs(l,r.shape.length);let h=r;c!=null&&(h=Li({inputs:{x:r},backend:t,attrs:{perm:c}}),l=Is(l.length,r.shape.length)),Nr("min",l,h.shape.length);const[p,m]=fr(h.shape,l),v=Me(m),_=Gr(Me(p),h.dtype),w=t.data.get(h.dataId).values;for(let E=0;E<_.length;++E){const C=E*v;let A=w[C];for(let D=0;D<v;++D){const F=w[C+D];(Number.isNaN(F)||F<A)&&(A=F)}_[E]=A}c!=null&&t.disposeIntermediateTensorInfo(h);const T=t.makeTensorInfo(p,h.dtype,_);if(a){const E=Bs(p,o),C=Hn({inputs:{x:T},backend:t,attrs:{shape:E}});return t.disposeIntermediateTensorInfo(T),C}return T}const Q2e={kernelName:Zw,backendName:"cpu",kernelFunc:Y2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:a}=s;it(r,"mirrorPad");const o=i.map((A,D)=>A[0]+r.shape[D]+A[1]),l=i.map(A=>A[0]),c=i.map((A,D)=>A[0]+r.shape[D]),h=a==="reflect"?0:1,p=t.data.get(r.dataId).values,m=r.shape.length,v=ht(r.shape),_=Me(o),w=o.length,T=ht(o),E=Ur(r.dtype,_);for(let A=0;A<_;A++){let D=Jm(A,w,T);for(let W=0;W<w;W++)D[W]<l[W]?D[W]=l[W]*2-D[W]-h:D[W]>=c[W]&&(D[W]=(c[W]-1)*2-D[W]+h);D=D.map((W,B)=>W-l[B]);const F=jl(D,m,v);E[A]=p[F]}return{dataId:t.write(E,o,r.dtype),shape:o,dtype:r.dtype}}const e$e={kernelName:Yw,backendName:"cpu",kernelFunc:J2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t$e=ks(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),n$e=nr(Eb,t$e),s$e={kernelName:Eb,backendName:"cpu",kernelFunc:n$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,a=r.shape.length;let o=i;if(o===-1&&(o=a-1),o!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${o}`);const l=Vt([o],r.shape),c=$K({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),h=Bs(c.shape,l),p=Hn({inputs:{x:c},backend:t,attrs:{shape:h}}),m=rR({inputs:{a:r,b:p},backend:t}),v=O8({inputs:{x:m},backend:t}),_=l_({inputs:{x:v},backend:t,attrs:{axis:l,keepDims:!1}}),w=Hn({inputs:{x:_},backend:t,attrs:{shape:h}}),T=aR({inputs:{a:v,b:w},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(w),T}const r$e={kernelName:mT,backendName:"cpu",kernelFunc:AK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i$e(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:a,normalized:o}=s;it(r,"multinomial");const l=o?r:AK({inputs:{logits:r},backend:t,attrs:{dim:-1}}),c=l.shape[0],h=l.shape[1],p=t.data.get(l.dataId).values,m=[c,i],v=Gr(Me(m),"int32");for(let _=0;_<c;++_){const w=_*h,T=new Float32Array(h-1);T[0]=p[w];for(let A=1;A<T.length;++A)T[A]=T[A-1]+p[w+A];const E=Zm.alea(a.toString()),C=_*i;for(let A=0;A<i;++A){const D=E();v[C+A]=T.length;for(let F=0;F<T.length;F++)if(D<T[F]){v[C+A]=F;break}}}return o||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(m,"int32",v)}const a$e={kernelName:s5,backendName:"cpu",kernelFunc:i$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o$e=tA;function l$e(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=s;it(r,"NonMaxSuppression");const c=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,{selectedIndices:p}=o$e(c,h,a,o,l);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}const c$e={kernelName:m$,backendName:"cpu",kernelFunc:l$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u$e=nA;function h$e(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=s;it(r,"NonMaxSuppressionPadded");const h=t.data.get(r.dataId).values,p=t.data.get(i.dataId).values,{selectedIndices:m,validOutputs:v}=u$e(h,p,a,o,l,c);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([v]))]}const d$e={kernelName:g$,backendName:"cpu",kernelFunc:h$e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f$e=sA;function p$e(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=s;it(r,"NonMaxSuppressionWithScore");const h=t.data.get(r.dataId).values,p=t.data.get(i.dataId).values,m=a,v=o,_=l,w=c,{selectedIndices:T,selectedScores:E}=f$e(h,p,m,v,_,w);return[t.makeTensorInfo([T.length],"int32",new Int32Array(T)),t.makeTensorInfo([E.length],"float32",new Float32Array(E))]}const m$e={kernelName:y$,backendName:"cpu",kernelFunc:p$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g$e(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:a,onValue:o,offValue:l}=s;it(r,"oneHot");const c=Me(r.shape),h=new Float32Array(c*a);h.fill(l);const p=t.data.get(r.dataId).values;for(let m=0;m<c;++m)p[m]>=0&&p[m]<a&&(h[m*a+p[m]]=o);return t.makeTensorInfo([...r.shape,a],i,h)}const y$e={kernelName:tT,backendName:"cpu",kernelFunc:g$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Mf({inputs:{input:s},backend:t}),i=_1({inputs:{x:r},backend:t}),a=Lm({inputs:{input:s},backend:t}),o=_1({inputs:{x:a},backend:t}),l=Ki({inputs:{real:i,imag:o},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),l}else return oR({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const v$e={kernelName:vT,backendName:"cpu",kernelFunc:_1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Mf({inputs:{input:s},backend:t}),i=RK({inputs:{x:r},backend:t}),a=Lm({inputs:{input:s},backend:t}),o=_1({inputs:{x:a},backend:t}),l=Ki({inputs:{real:i,imag:o},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),l}else return oR({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const b$e={kernelName:eT,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return b1({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,a=e[0].dtype;e.forEach(h=>{F2(i,h.shape,"All tensors passed to stack must have matching shapes"),te(a===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=e.map(h=>{const p=b1({inputs:{input:h},backend:t,attrs:{dim:r}});return o.push(p),p}),c=Om({inputs:l,backend:t,attrs:{axis:r}});return o.forEach(h=>t.disposeIntermediateTensorInfo(h)),c}const _$e={kernelName:nT,backendName:"cpu",kernelFunc:DK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:a}=s;it(r,"pad");const o=i.map((C,A)=>C[0]+r.shape[A]+C[1]),l=i.map(C=>C[0]),c=t.data.get(r.dataId).values,h=Me(r.shape),p=r.shape.length,m=ht(r.shape),v=Me(o),_=o.length,w=ht(o),T=Ur(r.dtype,v);a!==0&&T.fill(a);for(let C=0;C<h;C++){const D=Jm(C,p,m).map((W,B)=>W+l[B]),F=jl(D,_,w);T[F]=c[C]}return{dataId:t.write(T,o,r.dtype),shape:o,dtype:r.dtype}}const LK={kernelName:sT,backendName:"cpu",kernelFunc:x$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w$e=ks((n,e)=>Math.pow(n,e)),T$e=nr(Ib,w$e),S$e={kernelName:Ib,backendName:"cpu",kernelFunc:T$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E$e(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:a}=e,{outputRaggedRank:o}=s,l=r.map(E=>t.data.get(E.dataId).values),c=r.map(E=>E.shape),h=t.data.get(i.dataId).values,p=t.data.get(a.dataId).values,[m,v,_]=J8(l,c,h,i.shape,i.dtype,p,a.shape),w=m.map(E=>t.makeTensorInfo([E.length],"int32",E)),T=t.makeTensorInfo(_,i.dtype,v);return w.concat([T])}const N$e={kernelName:r5,backendName:"cpu",kernelFunc:E$e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I$e(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,a=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[c,h]=eK(a,s.shape,s.dtype,o,r.shape,l,i.shape),p=t.makeTensorInfo([c.length],"int32",c),m=t.makeTensorInfo([h.length],s.dtype,h);return[p,m]}const C$e={kernelName:i5,backendName:"cpu",kernelFunc:I$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$e(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:a,rowPartitionTensors:o}=e,{rowPartitionTypes:l}=s,c=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,p=t.data.get(a.dataId).values,m=o.map(T=>t.data.get(T.dataId).values),v=o.map(T=>T.shape),[_,w]=tK(c,r.shape,h,i.shape,i.dtype,p,a.shape,m,v,l);return t.makeTensorInfo(_,i.dtype,w)}const $$e={kernelName:a5,backendName:"cpu",kernelFunc:k$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A$e(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:a}=t,o=nK(s,r,a,i);return e.makeTensorInfo([o.length],i,o)}const R$e={kernelName:v$,backendName:"cpu",kernelFunc:A$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D$e=In(Cb,n=>1/n),L$e={kernelName:Cb,backendName:"cpu",kernelFunc:D$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O$e(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:a,size:o}=s;it(r,"resizeBilinear");const l=ht(r.shape),[c,h]=o,[p,m,v,_]=r.shape,w=t.data.get(r.dataId).values,T=new Float32Array(Me([p,c,h,_])),E=[i&&c>1?m-1:m,i&&h>1?v-1:v],C=[i&&c>1?c-1:c,i&&h>1?h-1:h];let A=0;const D=E[0]/C[0],F=E[1]/C[1];for(let W=0;W<p;W++)for(let B=0;B<c;B++){let P;a?P=D*(B+.5)-.5:P=D*B;const O=Math.max(0,Math.floor(P)),M=P-O,k=Math.min(m-1,Math.ceil(P)),V=W*l[0]+O*l[1],G=W*l[0]+k*l[1];for(let ae=0;ae<h;ae++){let J;a?J=F*(ae+.5)-.5:J=F*ae;const X=Math.max(0,Math.floor(J)),se=J-X,ne=Math.min(v-1,Math.ceil(J)),le=V+X*l[2],K=G+X*l[2],ie=V+ne*l[2],de=G+ne*l[2];for(let ce=0;ce<_;ce++){const Se=w[le+ce],Te=w[K+ce],Ie=w[ie+ce],He=w[de+ce],qe=Se+(Ie-Se)*se,Qe=Te+(He-Te)*se,ut=qe+(Qe-qe)*M;T[A++]=ut}}}return t.makeTensorInfo([p,c,h,_],"float32",T)}const P$e={kernelName:lT,backendName:"cpu",kernelFunc:O$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$e(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:a}=s;it([i,r],"resizeBilinearGrad");const o=ht(r.shape),[l,c,h,p]=r.shape,[,m,v]=i.shape,_=new Float32Array(l*c*h*p),w=[a&&m>1?c-1:c,a&&v>1?h-1:h],T=[a&&m>1?m-1:m,a&&v>1?v-1:v],E=w[0]/T[0],C=w[1]/T[1],A=t.data.get(i.dataId).values;let D=0;for(let F=0;F<l;F++){const W=F*o[0];for(let B=0;B<m;B++){const P=B*E,O=Math.floor(P),M=Math.min(Math.ceil(P),c-1),k=W+O*o[1],V=W+M*o[1],G=P-O,ae=1-G;for(let J=0;J<v;J++){const X=J*C,se=Math.floor(X),ne=Math.min(Math.ceil(X),h-1),le=X-se,K=1-le,ie=k+se*o[2],de=k+ne*o[2],ce=V+se*o[2],Se=V+ne*o[2],Te=ae*K,Ie=ae*le,He=G*K,qe=G*le;for(let Qe=0;Qe<p;Qe++){const ut=A[D++];_[ie+Qe]+=ut*Te,_[de+Qe]+=ut*Ie,_[ce+Qe]+=ut*He,_[Se+Qe]+=ut*qe}}}}return t.makeTensorInfo([l,h,c,p],"float32",_)}const F$e={kernelName:x$,backendName:"cpu",kernelFunc:M$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$e(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:a,size:o}=s;it(r,"resizeNearestNeighbor");const l=ht(r.shape),[c,h]=o,[p,m,v,_]=r.shape,w=t.data.get(r.dataId).values,T=new Float32Array(p*c*h*_),E=[i&&c>1?m-1:m,i&&h>1?v-1:v],C=[i&&c>1?c-1:c,i&&h>1?h-1:h],A=E[0]/C[0],D=E[1]/C[1];let F=0;for(let W=0;W<p;W++){const B=W*l[0];for(let P=0;P<c;P++){const O=a?A*(P+.5):A*P;let M=Math.min(m-1,i?Math.round(O):Math.floor(O));a&&(M=Math.max(0,M));const k=B+M*l[1];for(let V=0;V<h;V++){const G=a?D*(V+.5):D*V;let ae=Math.min(v-1,i?Math.round(G):Math.floor(G));a&&(ae=Math.max(0,ae));const J=k+ae*l[2];for(let X=0;X<_;X++){const se=w[J+X];T[F++]=se}}}}return t.makeTensorInfo([p,c,h,_],r.dtype,T)}const B$e={kernelName:oT,backendName:"cpu",kernelFunc:j$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$e(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:a}=s;it([i,r],"resizeNearestNeighborGrad");const o=ht(r.shape),l=ht(i.shape),[c,h,p,m]=r.shape,[,v,_]=i.shape,w=new Float32Array(c*h*p*m),T=t.data.get(i.dataId).values,E=[a&&v>1?h-1:h,a&&_>1?p-1:p],C=[a&&v>1?v-1:v,a&&_>1?_-1:_],A=E[0]/C[0],D=E[1]/C[1],F=1/A,W=1/D,B=Math.ceil(F)*2+2,P=Math.ceil(W)*2+2;for(let O=0;O<c;O++){const M=O*o[0];for(let k=0;k<h;k++){const V=M+k*o[1],G=Math.floor(k*F),ae=Math.floor(G-B/2);for(let J=0;J<p;J++){const X=V+J*o[2],se=Math.floor(J*W),ne=Math.floor(se-P/2);for(let le=0;le<m;le++){let K=0;for(let ie=0;ie<B;ie++){const de=ie+ae;if(de<0||de>=v)continue;const ce=M+de*l[1],Se=de*A,Te=Math.min(h-1,a?Math.round(Se):Math.floor(Se));if(k===Te)for(let Ie=0;Ie<P;Ie++){const He=Ie+ne;if(He<0||He>=_)continue;const qe=ce+He*l[2],Qe=He*D,ut=Math.min(p-1,a?Math.round(Qe):Math.floor(Qe));J===ut&&(K+=T[qe+le])}}w[X+le]=K}}}}return t.makeTensorInfo(r.shape,r.dtype,w)}const V$e={kernelName:_$,backendName:"cpu",kernelFunc:z$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;it(r,"reverse");const a=r.shape.length,o=Vt(i,r.shape);if(a===0)return sc({inputs:{x:r},backend:t});const l=new Sr(r.shape,r.dtype),c=t.bufferSync(r);for(let h=0;h<l.size;h++){const p=l.indexToLoc(h),m=p.slice();o.forEach(v=>m[v]=r.shape[v]-1-m[v]),l.set(c.get(...m),...p)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const G$e={kernelName:cT,backendName:"cpu",kernelFunc:U$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W$e={kernelName:C$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:a}=e,o=t,l=Ur(s.dtype,Me(s.shape)),[c,h,p,m]=s.shape,[v,_]=pA(a,h,p),w=255,T=Math.sin(r),E=Math.cos(r),C=o.data.get(s.dataId).values;for(let D=0;D<c;D++){const F=D*p*h*m;for(let W=0;W<h;W++){const B=W*(p*m);for(let P=0;P<p;P++){const O=P*m;for(let M=0;M<m;M++){const k=[c,W,P,M],V=k[2],G=k[1];let ae=(V-v)*E-(G-_)*T,J=(V-v)*T+(G-_)*E;ae=Math.round(ae+v),J=Math.round(J+_);let X=i;if(typeof i!="number"&&(M===3?X=w:X=i[M]),ae>=0&&ae<p&&J>=0&&J<h){const ne=J*(p*m),le=ae*m,K=F+ne+le+M;X=C[K]}const se=F+B+O+M;l[se]=X}}}}return{dataId:o.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H$e=In(Ab,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),q$e={kernelName:Ab,backendName:"cpu",kernelFunc:H$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$e(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:a}=s,{sliceRank:o,numUpdates:l,sliceSize:c,strides:h,outputSize:p}=Kf(i,r,a),m=!0,v=t.bufferSync(r),_=t.bufferSync(i),w=ef(v,_,a,p,c,l,o,h,0,m);return t.makeTensorInfo(a,w.dtype,w.values)}const X$e={kernelName:o5,backendName:"cpu",kernelFunc:K$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$e(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function Y$e(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function Q$e(n,e,t,s,r,i){const a=ws("int32",t*r);for(let o=0;o<t;++o){const l=n.slice(o*s,(o+1)*s),c=o*r;for(let h=0;h<r;++h)a[c+h]=i==="left"?Z$e(l,e[h+c]):Y$e(l,e[h+c])}return a}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$e(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:a}=s,o=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,c=Q$e(o,l,r.shape[0],r.shape[1],i.shape[1],a);return t.makeTensorInfo(i.shape,"int32",c)}const eAe={kernelName:c5,backendName:"cpu",kernelFunc:J$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tAe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;it([s,r,i],"select");const a=s.shape.length,o=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(i.dataId).values,h=Qi(r.dtype,i.dtype),p=Gr(Me(r.shape),h);let m=0;const v=a===0||a>1||r.shape.length===1?1:Me(r.shape.slice(1));for(let _=0;_<o.length;_++)for(let w=0;w<v;w++)o[_]===1?p[m++]=l[_]:p[m++]=c[_];return t.makeTensorInfo(r.shape,h,p)}const nAe={kernelName:uT,backendName:"cpu",kernelFunc:tAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sAe=$T,rAe=AT,iAe=In(Db,n=>n>=0?rAe*n:sAe*(Math.exp(n)-1)),aAe={kernelName:Db,backendName:"cpu",kernelFunc:iAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oAe=In(Pb,n=>n<0?-1:n>0?1:0),lAe={kernelName:Pb,backendName:"cpu",kernelFunc:oAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cAe=In(Lb,n=>Math.sin(n)),uAe={kernelName:Lb,backendName:"cpu",kernelFunc:cAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hAe=In(Ob,n=>Math.sinh(n)),dAe={kernelName:Ob,backendName:"cpu",kernelFunc:hAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fAe=11920928955078125e-23,z3=Math.log(fAe)+2,pAe=In(Fb,n=>{const e=n>-z3,t=n<z3,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),mAe={kernelName:Fb,backendName:"cpu",kernelFunc:pAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:a}=s;it([r],"spaceToBatchND");const o=Me(i),l=[[0,0]];l.push(...a);for(let W=1+i.length;W<r.shape.length;++W)l.push([0,0]);const c=LK.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),h=Yb(c.shape,i,o,!1),p=Qb(h.length,i.length,!1),m=Jb(c.shape,i,o,!1),w=Hn({inputs:{x:c},backend:t,attrs:{shape:h}}),C=Li({inputs:{x:w},backend:t,attrs:{perm:p}}),F=Hn({inputs:{x:C},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(C),F}const yAe={kernelName:fT,backendName:"cpu",kernelFunc:gAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vAe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:a}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(a.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${a.shape}`);const o=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(i.dataId).values,h=t.data.get(a.dataId).values[0],[p,m,v,_,w]=aK(o,s.shape,s.dtype,l,r.dtype,c,h);return[t.makeTensorInfo(m,s.dtype,p),t.makeTensorInfo([m[0]],r.dtype,v),t.makeTensorInfo([_.length],"bool",new Uint8Array(_.map(T=>Number(T)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const bAe={kernelName:u5,backendName:"cpu",kernelFunc:vAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ae(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const a=Array.from(t.data.get(r.dataId).values),o=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[c,h,p]=oK(o,s.shape,s.dtype,a,l);return[t.makeTensorInfo(h,s.dtype,c),t.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}const xAe={kernelName:h5,backendName:"cpu",kernelFunc:_Ae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wAe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const a=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[c,h]=sR(a,s.shape,s.dtype,o,l,!0);return t.makeTensorInfo(h,s.dtype,c)}const TAe={kernelName:d5,backendName:"cpu",kernelFunc:wAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SAe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const a=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[c,h]=sR(a,s.shape,s.dtype,o,l);return t.makeTensorInfo(h,s.dtype,c)}const EAe={kernelName:f5,backendName:"cpu",kernelFunc:SAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NAe(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:a}=e,{outputShape:o}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:p,outputSize:m}=Kf(i,r,o),v=!1,_=t.bufferSync(r);let w;switch(i.dtype){case"bool":{const T=t.bufferSync(i),E=!!t.data.get(a.dataId).values[0];w=ef(_,T,o,m,h,c,l,p,E,v);break}case"float32":{const T=t.bufferSync(i),E=t.data.get(a.dataId).values[0];w=ef(_,T,o,m,h,c,l,p,E,v);break}case"int32":{const T=t.bufferSync(i),E=t.data.get(a.dataId).values[0];w=ef(_,T,o,m,h,c,l,p,E,v);break}case"string":{const T=t.bufferSync(i),E=Fh(t.data.get(a.dataId).values[0]);w=ef(_,T,o,m,h,c,l,p,E,v);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(o,w.dtype,w.values)}const IAe={kernelName:p5,backendName:"cpu",kernelFunc:NAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:a}=s,o=Vt(a,r.shape)[0],l=kA(r,i,o),c=new Array(r.shape.length).fill(0),h=r.shape.slice();return l.map(p=>{const m=[...h];m[o]=p;const v=Ff({inputs:{x:r},backend:t,attrs:{begin:c,size:m}});return c[o]+=p,v})}const kAe={kernelName:pT,backendName:"cpu",kernelFunc:CAe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ae={kernelName:w$,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;it(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let o=0;o<r.length;++o){const l=r[o];i[o]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AAe=In(Wb,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),RAe={kernelName:Wb,backendName:"cpu",kernelFunc:AAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:a,strides:o,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:p,shrinkAxisMask:m}=s;it(r,"stridedSlice");const{finalShapeSparse:v,finalShape:_,isIdentity:w,sliceDim0:T,isSimpleSlice:E,begin:C,end:A,strides:D}=hA(r.shape,i,a,o,l,c,h,p,m);let F;if(w)F=Hn({inputs:{x:r},backend:t,attrs:{shape:_}});else if(T||E){te(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const W=lA(C,A,D),B=Ff({inputs:{x:r},backend:t,attrs:{begin:C,size:W}});F=Hn({inputs:{x:B},backend:t,attrs:{shape:_}}),t.disposeIntermediateTensorInfo(B)}else{const W=t.bufferSync(r),B=uK(v,W,D,C);F=t.makeTensorInfo(_,B.dtype,B.values)}return F}const LAe={kernelName:S$,backendName:"cpu",kernelFunc:DAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OAe(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:p}=e,m=t.data.get(h.dataId).values,v=t.data.get(p.dataId).values,[_,w]=hK(m,v,r,i,a,o,l,c);return[t.makeTensorInfo([_.length],"string",_),t.makeTensorInfo(p.shape,"int32",w)]}const PAe={kernelName:m5,backendName:"cpu",kernelFunc:OAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MAe(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:a}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(a.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=t.data.get(i.dataId).values,l=t.data.get(a.dataId).values[0],[c,h,p]=dK(o,l,r),m=h.length;return[t.makeTensorInfo([m,2],"int32",c),t.makeTensorInfo([m],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(p))]}const FAe={kernelName:g5,backendName:"cpu",kernelFunc:MAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jAe(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=t.data.get(i.dataId).values,o=fK(a,r);return t.makeTensorInfo(i.shape,"int32",o)}const BAe={kernelName:y5,backendName:"cpu",kernelFunc:jAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zAe=In(Vb,n=>Math.tan(n)),VAe={kernelName:Vb,backendName:"cpu",kernelFunc:zAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UAe=In(Ub,n=>Math.tanh(n)),GAe={kernelName:Ub,backendName:"cpu",kernelFunc:UAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WAe(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:a,numUpdates:o,sliceSize:l,strides:c,outputSize:h}=Kf(i,r,s.shape),p=!1,m=t.bufferSync(r),v=t.bufferSync(i),_=t.bufferSync(s),w=ef(m,v,s.shape,h,l,o,a,c,_,p);return t.makeTensorInfo(s.shape,w.dtype,w.values)}const HAe={kernelName:l5,backendName:"cpu",kernelFunc:WAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;it(r,"tile");const a=mK(t.bufferSync(r),i);return t.makeTensorInfo(a.shape,a.dtype,a.values)}const KAe={kernelName:Gb,backendName:"cpu",kernelFunc:qAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:a}=s;it(r,"topk");const o=t.data.get(r.dataId).values,[l,c]=yK(o,r.shape,r.dtype,i,a);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const ZAe={kernelName:E$,backendName:"cpu",kernelFunc:XAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YAe(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:a,fillMode:o,fillValue:l,outputShape:c}=t,[h,p,m,v]=r.shape,[_,w]=c??[p,m],T=[h,_,w,v],E=ht(r.shape),C=E[0],A=E[1],D=E[2],F=ht(T),W=F[0],B=F[1],P=F[2],O=Ur(r.dtype,Me(T));O.fill(l);const M=s.data.get(r.dataId).values,k=s.data.get(i.dataId).values;for(let G=0;G<h;++G){const ae=i.shape[0]===1?k:k.subarray(G*8,G*8+8);for(let J=0;J<_;++J)for(let X=0;X<w;++X)for(let se=0;se<v;++se){let ne;const le=ae[6]*X+ae[7]*J+1;if(le===0)continue;const K=(ae[0]*X+ae[1]*J+ae[2])/le,ie=(ae[3]*X+ae[4]*J+ae[5])/le,de=V3(K,m,o),ce=V3(ie,p,o);switch(a){case"nearest":ne=sRe(M,p,m,C,A,D,G,ce,de,se,l);break;case"bilinear":ne=rRe(M,p,m,C,A,D,G,ce,de,se,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}const Se=G*W+J*B+X*P+se;O[Se]=ne}return s.makeTensorInfo(T,r.dtype,O)}return{dataId:s.write(O,T,r.dtype),shape:r.shape,dtype:r.dtype}}const QAe={kernelName:N$,backendName:"cpu",kernelFunc:YAe};function V3(n,e,t){switch(t){case"reflect":return JAe(n,e);case"wrap":return eRe(n,e);case"nearest":return nRe(n,e);case"constant":default:return tRe(n)}}function JAe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Nf(0,t,e-1)}function eRe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Nf(0,t,e-1)}function tRe(n,e){return n}function nRe(n,e){return Nf(0,n,e-1)}function Ny(n,e,t,s,r,i,a,o,l,c,h){const p=a*s+o*r+l*i+c;return 0<=o&&o<e&&0<=l&&l<t?n[p]:h}function sRe(n,e,t,s,r,i,a,o,l,c,h){const p=Math.round(o),m=Math.round(l);return Ny(n,e,t,s,r,i,a,p,m,c,h)}function rRe(n,e,t,s,r,i,a,o,l,c,h){const p=Math.floor(o),m=Math.floor(l),v=p+1,_=m+1,w=(_-l)*Ny(n,e,t,s,r,i,a,p,m,c,h)+(l-m)*Ny(n,e,t,s,r,i,a,p,_,c,h),T=(_-l)*Ny(n,e,t,s,r,i,a,v,m,c,h)+(l-m)*Ny(n,e,t,s,r,i,a,v,_,c,h);return(v-o)*w+(o-p)*T}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iRe(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;it(i,"unique");const a=s.data.get(i.dataId).values,{outputValues:o,outputShape:l,indices:c}=vK(a,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,o),s.makeTensorInfo([c.length],"int32",c)]}const aRe={kernelName:I$,backendName:"cpu",kernelFunc:iRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oRe(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const a=r.shape.length,o=r.shape[i],l=new Array(a-1);let c=0;for(let v=0;v<a;v++)v!==i&&(l[c++]=r.shape[v]);const h=new Array(a).fill(0),p=r.shape.slice();p[i]=1;const m=new Array(o);for(let v=0;v<m.length;v++){h[i]=v;const _=Ff({inputs:{x:r},backend:t,attrs:{begin:h,size:p}});m[v]=Hn({inputs:{x:_},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(_)}return m}const lRe={kernelName:gT,backendName:"cpu",kernelFunc:oRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:a}=s;it(r,"unsortedSegmentSum");const o=r.shape.length,l=i.shape.length,c=[],h=[],p=o-l;let m=i;for(let _=0;_<p;++_){const w=b1({inputs:{input:m},backend:t,attrs:{dim:_+1}});m=w,h.push(w)}for(let _=0;_<a;++_){const w=ed(_,"int32"),T=t.makeTensorInfo([],"int32",w),E=D8({inputs:{a:T,b:m},backend:t}),C=Uh({inputs:{x:E},backend:t,attrs:{dtype:"float32"}}),A=UT({inputs:{a:C,b:r},backend:t}),D=l_({inputs:{x:A},backend:t,attrs:{axis:0,keepDims:!1}});c.push(D),h.push(T),h.push(E),h.push(C),h.push(A),h.push(D)}const v=DK({inputs:c,backend:t,attrs:{axis:0}});return h.forEach(_=>t.disposeIntermediateTensorInfo(_)),v}const uRe={kernelName:yT,backendName:"cpu",kernelFunc:cRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hRe=[iCe,jNe,oCe,cCe,WNe,hCe,fCe,mCe,yCe,bCe,xCe,TCe,ECe,CCe,$Ce,DCe,OCe,MCe,jCe,sCe,zCe,UCe,WCe,qNe,qCe,UNe,XNe,XCe,BNe,YCe,JCe,eke,nke,rke,ake,lke,uke,dke,pke,gke,vke,_ke,wke,Ske,Eke,Ike,kke,Ake,Rke,Dke,Lke,Pke,jke,ZIe,zke,ZNe,Xke,YNe,Zke,JNe,n2e,s2e,i2e,tIe,sIe,o2e,c2e,h2e,f2e,iIe,oIe,zNe,m2e,QCe,y2e,b2e,x2e,YIe,cIe,hIe,T2e,fIe,E2e,C2e,$2e,D2e,O2e,M2e,F2e,mIe,B2e,V2e,G2e,H2e,K2e,Z2e,Q2e,yIe,e$e,s$e,a$e,bIe,xIe,c$e,d$e,m$e,TIe,y$e,b$e,_$e,LK,S$e,JIe,NIe,N$e,C$e,$$e,R$e,VNe,fC,L$e,eCe,tCe,nCe,P$e,F$e,B$e,V$e,G$e,W$e,q$e,LIe,X$e,eAe,nAe,aAe,PIe,lAe,uAe,dAe,MIe,r$e,mAe,yAe,bAe,xAe,TAe,EAe,IAe,kAe,BIe,$Ae,VIe,GIe,RAe,LAe,PAe,FAe,BAe,KIe,Mke,VAe,GAe,HAe,KAe,ZAe,QAe,SIe,aRe,lRe,uRe,v$e];for(const n of hRe)b5(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zd={},Rx={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function dRe(n,e){Zd[n]=e}function Yo(n,e){if(!(n in Zd)||e!=null){const s=pRe(n,e);if(s!==null)Zd[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Zd[n];return t==null||t.isContextLost()?(delete Zd[n],Yo(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Zd[n])}function fRe(n){if(!Re().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function pRe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??fRe(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Zd[n]},!1),Re().getBool("SOFTWARE_WEBGL_ENABLED")&&(Rx.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Rx)||t.getContext("experimental-webgl",Rx):t.getContext("webgl2",Rx)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mv;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(mv||(mv={}));var Na;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Na||(Na={}));var Tr;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Tr||(Tr={}));function c_(n,e){return[e,n]}function mRe(n,e){return n*e}function Dx(n){const e=Me(n),t=Math.ceil(e/4);return PI(t)}function og(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function gRe(n,e){const[t,s]=og(n,e);return t*s*4}function lR(n,e){const t=n;let s,r,i,a,o,l,c,h,p,m;return Re().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,a=t.RGBA32F,o=t.RED,c=4,h=1,p=t.HALF_FLOAT,m=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,a=t.RGBA,o=n.RGBA,c=4,h=4,p=e!=null?e.HALF_FLOAT_OES:null,m=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:h,textureTypeHalfFloat:p,textureTypeFloat:m}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function et(n,e){const t=e();return Re().getBool("DEBUG")&&yRe(n),t}function yRe(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+xRe(n,e))}const vRe=596e-10,bRe=65504;function _Re(n){return!!(Re().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||vRe<Math.abs(n)&&Math.abs(n)<bRe)}function xRe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Lx(n,e){return au(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function wRe(n,e){const t=au(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(et(n,()=>n.shaderSource(t,e)),et(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function TRe(n,e){const t=au(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(et(n,()=>n.shaderSource(t,e)),et(n,()=>n.compileShader(t)),Re().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw OK(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const SRe=/ERROR: [0-9]+:([0-9]+):/g;function OK(n,e){const t=SRe.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,a=r.map((p,m)=>cm((m+1).toString(),i)+p);let o=0;for(let p=0;p<a.length;p++)o=Math.max(a[p].length,o);const l=a.slice(0,s-1),c=a.slice(s-1,s),h=a.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${cm(c[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function ERe(n){return au(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function NRe(n,e){if(et(n,()=>n.linkProgram(e)),!Re().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function _N(n,e){if(et(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function IRe(n,e){const t=au(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return et(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),et(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function CRe(n,e){const t=au(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return et(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),et(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function kRe(n){return au(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function $Re(n,e){const t=Re().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function ARe(n){return au(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function U3(n,e,t,s,r,i,a){const o=n.getAttribLocation(e,t);return o===-1?!1:(et(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),et(n,()=>n.vertexAttribPointer(o,r,n.FLOAT,!1,i,a)),et(n,()=>n.enableVertexAttribArray(o)),!0)}function RRe(n,e,t){MRe(n,t),et(n,()=>n.activeTexture(n.TEXTURE0+t)),et(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function DRe(n,e,t){return au(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function LRe(n,e,t){return n.getUniformLocation(e,t)}function ORe(n,e,t,s){et(n,()=>RRe(n,e,s)),et(n,()=>n.uniform1i(t,s))}function xN(n,e,t){et(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),et(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function G3(n,e){et(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),et(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Ox(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+PRe(n,e))}function PRe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function au(n,e,t){const s=et(n,()=>e());if(s==null)throw new Error(t);return s}function MRe(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Pm(n,e=2){return Me(n.slice(0,n.length-e))}function Mm(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Px(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Pm(n),...Mm(n)]),e}function FRe(n,e=!1){let t=Re().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=Re().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&Re().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((o,l)=>l>=n.length-2?M2(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Jh(n).newShape);let r=Me(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const a=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||a)if(e){const o=Pm(n);let l=2,c=2;n.length&&([l,c]=Mm(n)),r=o*(l/2)*(c/2),i=PI(r).map(h=>h*2)}else i=PI(r);return i}function Mx(n){return n%2===0}function x1(n,e){if(n=n.slice(-2),e=e.slice(-2),xn(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Mx(t)&&Mx(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Mx(n[0])&&Mx(e[0])}let wN,TN;function jRe(n){if(wN==null){const e=Yo(n);wN=e.getParameter(e.MAX_TEXTURE_SIZE)}return wN}function BRe(n){if(TN==null){const e=Yo(n);TN=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,TN)}function zRe(n){if(n===0)return 0;let e;const t=Yo(n);return ao(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:ao(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function ao(n,e){return n.getExtension(e)!=null}function W3(n){try{if(Yo(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function VRe(n){if(n===0)return!1;const e=Yo(n);if(n===1){if(!ao(e,"OES_texture_float"))return!1}else if(!ao(e,"EXT_color_buffer_float"))return!1;return mC(e)}function URe(n){if(n===0)return!1;const e=Yo(n);if(n===1){if(!ao(e,"OES_texture_float")||!ao(e,"WEBGL_color_buffer_float"))return!1}else{if(ao(e,"EXT_color_buffer_float"))return mC(e);const s="EXT_color_buffer_half_float";if(ao(e,s)){const r=e.getExtension(s);return GRe(e,r)}return!1}return mC(e)}function mC(n){const e=lR(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),a}function GRe(n,e){const t=lR(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(a),o}function WRe(n){return n!==2?!1:Yo(n).fenceSync!=null}function u_(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&te(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ot=Re();ot.registerFlag("HAS_WEBGL",()=>ot.getNumber("WEBGL_VERSION")>0);ot.registerFlag("WEBGL_VERSION",()=>W3(2)?2:W3(1)?1:0);ot.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ot.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ot.get("WEBGL_VERSION")===2);ot.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ot.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ot.registerFlag("WEBGL_PACK",()=>ot.getBool("HAS_WEBGL"));ot.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_CLIP",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_REDUCE",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_LAZILY_UNPACK",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_CONV_IM2COL",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>jRe(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>BRe(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=ot.getNumber("WEBGL_VERSION");return n===0?0:zRe(n)});ot.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ot.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!R5());ot.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>VRe(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ot.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ot.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ot.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>URe(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_FENCE_API_ENABLED",()=>WRe(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ot.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ot.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});ot.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>R5()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});ot.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ot.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ot.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ot.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ot.registerFlag("WEBGL_EXP_CONV",()=>!1);ot.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ot.getBool("IS_TEST"));ot.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ot.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ot.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ot.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bi(){let n,e,t,s,r,i,a,o,l,c;return Re().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",a="out vec4 outputColor;",o=Re().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",a="",o=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:a,defineSpecialNaN:o,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yf(n,e,t="index"){const s=ht(e);return s.map((r,i)=>{const a=`int ${n[i]} = ${t} / ${r}`,o=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${a}; ${o};`}).join("")}function GT(n,e,t="index"){const s=ht(e);return s.map((r,i)=>{const a=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,o=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${a}; ${o};`}).join("")}function HRe(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function qRe(n,e,t="index"){const s=n.map((i,a)=>a),r=HRe(s,e);return r.map((i,a)=>{const o=`int ${n[a]} = ${t} / ${r[a]}`,l=a===r.length-1?`int ${n[a+1]} = ${t} - ${n[a]} * ${r[a]}`:`index -= ${n[a]} * ${r[a]}`;return`${o}; ${l};`}).join("")}function cR(n){const e=ht(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function uR(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const PK=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:MK}=Mwe;function KRe(n,e,t){const s=[];if(n.forEach(v=>{const _=Me(v.shapeInfo.logicalShape);if(v.shapeInfo.isUniform?s.push(`uniform float ${v.name}${_>1?`[${_}]`:""};`):(s.push(`uniform sampler2D ${v.name};`),s.push(`uniform int offset${v.name};`)),t.enableShapeUniforms){const{uniformShape:w}=hR(t.packedInputs,v.shapeInfo.logicalShape,v.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${v.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${v.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${v.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${v.name}Shape;`);break}s.push(`uniform ivec2 ${v.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(v=>{s.push(`uniform ${v.type} ${v.name}${v.arrayIndex?`[${v.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(v=>XRe(v,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),a=e.texShape,o=bi(),l=QRe(o);let c,h,p=tDe(o);return e.isPacked?(c=ZRe(e.logicalShape,a,t.enableShapeUniforms),h=eDe(o)):(c=YRe(e.logicalShape,a,t.enableShapeUniforms),h=JRe(o)),t.packedInputs&&(p+=iDe),[p,l,h,r,c,i,t.userCode].join(`
`)}function lg(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return yDe(n,e);case 1:return bDe(n,e);case 2:return xDe(n,e);case 3:return TDe(n,e);case 4:return EDe(n,e);case 5:return NDe(n);case 6:return IDe(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function FK(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return gDe(n);case 1:return vDe(n,e);case 2:return _De(n,e);case 3:return wDe(n,e);default:return SDe(n,e)}}function XRe(n,e,t=!1,s){let r="";t?r+=FK(n,s):r+=lg(n,s);const i=n.shapeInfo.logicalShape,a=e.logicalShape;return i.length<=a.length&&(t?r+=CDe(n,e):r+=kDe(n,e)),r}function ZRe(n,e,t){switch(n.length){case 0:return jK();case 1:return aDe(n,e,t);case 2:return pDe(n,e,t);case 3:return lDe(n,e,t);default:return uDe(n,e,t)}}function YRe(n,e,t){switch(n.length){case 0:return jK();case 1:return oDe(n,e,t);case 2:return mDe(n,e,t);case 3:return cDe(n,e,t);case 4:return hDe(n,e,t);case 5:return dDe(n,e);case 6:return fDe(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function QRe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function JRe(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function eDe(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function tDe(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${nDe}
    ${sDe}
    ${rDe}
  `}const nDe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,sDe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,rDe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,iDe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function jK(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function aDe(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function oDe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function lDe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function cDe(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${GT(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Yf(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function uDe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let a=i,o="",l="b, r, c";for(let c=2;c<n.length-1;c++)a*=n[n.length-c-1],o=`
      int b${c} = index / ${a};
      index -= b${c} * ${a};
    `+o,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${o}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function hDe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${GT(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Yf(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function dDe(n,e){const t=Yf(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function fDe(n,e){const t=Yf(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function pDe(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(xn(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function mDe(n,e,t){return xn(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Qf(n){return`offset${n}`}function gDe(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=bi();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function yDe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Qf(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${a});
      return sampleTexture(${t}, uv);
    }
  `;const[o,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${o}, ${l}, ${a});
      return sampleTexture(${t}, uv);
    }
  `}function vDe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=bi();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${a[0]}, ${a[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function bDe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${cg(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],a=r[1];if(a===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=Qf(t);return a===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${o});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${a}, index + ${o});
      return sampleTexture(${t}, uv);
    }
  `}function _De(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,a=i[0],o=i[1],l=bi();if(i!=null&&xn(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${a}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],h=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function xDe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&xn(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=i[0],v=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${v}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:a,keptDims:o}=Jh(t),l=a;if(l.length<t.length){const m=ug(n,l),v=["row","col"];return`
      ${lg(m,e)}
      float ${r}(int row, int col) {
        return ${r}(${hg(v,o)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${cg(n)}
      }
    `;const c=i[0],h=i[1],p=Qf(s);return h===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${p};
    vec2 uv = uvFromFlat(${c}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function wDe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const m=t.slice(1),v=[1,2],_=ug(n,m),w=["b","row","col"];return`
        ${FK(_,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${hg(w,v)});
        }
      `}const o=bi();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${o.texture2D}(${s}, uv);
    }
  `;const l=a[0],c=a[1],h=Math.ceil(t[2]/2),p=h*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${p}, ${h}, b, row, col);
      return ${o.texture2D}(${s}, uv);
    }
  `}function TDe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],a=t[2],{newShape:o,keptDims:l}=Jh(t),c=o;if(c.length<t.length){const w=ug(n,c),T=["row","col","depth"];return`
        ${lg(w,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${hg(T,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${a}, 1)));
        ${cg(n)}
      }
    `;const h=n.shapeInfo.texShape,p=h[0],m=h[1],v=n.shapeInfo.flatOffset;if(m===i&&v==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${a}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${p}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===a&&v==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `;const _=Qf(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${_};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${a} + depth + ${_};
        vec2 uv = uvFromFlat(${p}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function SDe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=bi();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,a=i.length,o=n.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=l[0],h=l[1],p=Math.ceil(i[a-1]/2);let m=p*Math.ceil(i[a-2]/2),v="int b, int row, int col",_=`b * ${m} + (row / 2) * ${p} + (col / 2)`;for(let w=2;w<a-1;w++)v=`int b${w}, `+v,m*=i[a-w-1],_=`b${w} * ${m} + `+_;return`
    vec4 ${s}(${v}) {
      int index = ${_};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${c});
      return ${r.texture2D}(${t}, uv);
    }
  `}function EDe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],a=t[2]*i,o=t[1]*a,{newShape:l,keptDims:c}=Jh(t);if(l.length<t.length){const C=ug(n,l),A=["row","col","depth","depth2"];return`
      ${lg(C,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${hg(A,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${o}, ${a}, ${i}, 1)));
        ${cg(n)}
      }
    `;const h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],v=p[1],_=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,T=`int stride0 = ${s}Shape[1] * stride1;`;if(v===o&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${_}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${a}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${v}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(v===i&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${v}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const E=Qf(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${_}
      ${w}
      ${T}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${E});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${a} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${m}, ${v}, index + ${E});
      return sampleTexture(${s}, uv);
    }
  `}function NDe(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,a=e[2]*i,o=e[1]*a,{newShape:l,keptDims:c}=Jh(e);if(l.length<e.length){const w=ug(n,l),T=["row","col","depth","depth2","depth3"];return`
      ${lg(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${hg(T,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${o}, ${a}, ${i}, ${r})) +
          depth3;
        ${cg(n)}
      }
    `;const h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],v=p[1];if(v===o&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${a}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${v}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(v===r&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${v}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const _=Qf(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${a} + depth * ${i} +
          depth2 * ${r} + depth3 + ${_};
      vec2 uv = uvFromFlat(${m}, ${v}, index);
      return sampleTexture(${t}, uv);
    }
  `}function IDe(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Jh(e);if(r.length<e.length){const T=ug(n,r),E=["row","col","depth","depth2","depth3","depth4"];return`
      ${lg(T)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${hg(E,i)});
      }
    `}const a=e[5],o=e[4]*a,l=e[3]*o,c=e[2]*l,h=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${c}, ${l}, ${o})) +
          dot(
            vec2(depth3, depth4),
            vec2(${a}, 1)));
        ${cg(n)}
      }
    `;const p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,v=m[0],_=m[1];if(_===h&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${o}, ${a})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${_}.0, ${v}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(_===a&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${_}.0, ${v}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=Qf(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} + depth * ${l} +
          depth2 * ${o} + depth3 * ${a} + depth4 + ${w};
      vec2 uv = uvFromFlat(${v}, ${_}, index);
      return sampleTexture(${t}, uv);
    }
  `}function cg(n){const e=n.name,t=Me(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function CDe(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,a=e.logicalShape.length,o=MK(n.shapeInfo.logicalShape,e.logicalShape),l=An(a),c=a-i;let h;const p=["x","y","z","w","u","v"];i===0?h="":a<2&&o.length>=1?h="coords = 0;":h=o.map(C=>`coords.${p[C+c]} = 0;`).join(`
`);let m="";a<2&&i>0?m="coords":m=n.shapeInfo.logicalShape.map((C,A)=>`coords.${p[A+c]}`).join(", ");let v="return outputValue;";const w=Me(n.shapeInfo.logicalShape)===1,E=Me(e.logicalShape)===1;if(i===1&&!w&&!E)v=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!E)a===1?v=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:v=`
        return vec4(outputValue.x);
      `;else if(o.length){const C=i-2,A=i-1;o.indexOf(C)>-1&&o.indexOf(A)>-1?v="return vec4(outputValue.x);":o.indexOf(C)>-1?v="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(A)>-1&&(v="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${m});
      ${v}
    }
  `}function kDe(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,a=n.shapeInfo.texShape,o=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&o===l&&n.shapeInfo.flatOffset==null&&xn(a,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=An(l),h=MK(n.shapeInfo.logicalShape,e.logicalShape),p=l-o;let m;const v=["x","y","z","w","u","v"];o===0?m="":l<2&&h.length>=1?m="coords = 0;":m=h.map(w=>`coords.${v[w+p]} = 0;`).join(`
`);let _="";return l<2&&o>0?_="coords":_=n.shapeInfo.logicalShape.map((w,T)=>`coords.${v[T+p]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${m}
      return get${s}(${_});
    }
  `}function An(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function hR(n,e,t){const{newShape:s,keptDims:r}=Jh(e),i=e.length,a=n&&i===3&&e[0]===1,o=a?e.slice(1):s,l=!n&&i>1&&!xn(e,t)&&s.length<i||a;return{useSqueezeShape:l,uniformShape:l?o:e,keptDims:r}}function ug(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function hg(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $De(n,e,t,s){const r=t.map((h,p)=>{const m={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(m.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[p],shapeInfo:m}}),i=r.map(h=>h.shapeInfo),a={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},o=KRe(r,a,e),l=TRe(n.gl,o),c=n.createProgram(l);return Re().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:i,outShapeInfo:a,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:i,outShapeInfo:a},BK(n,e,c)))}function BK(n,e,t){const s=[],r=[];let i,a,o,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),Re().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const h=!1;for(const p of e.variableNames){const m={name:p,uniform:n.getUniformLocation(t,p,h),offset:n.getUniformLocation(t,`offset${p}`,h)};e.enableShapeUniforms&&(m.shape=n.getUniformLocation(t,`${p}Shape`,h),m.texShape=n.getUniformLocation(t,`${p}TexShape`,h)),s.push(m)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",h),o=n.getUniformLocation(t,"outShapeStrides",h),a=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms)for(const p of e.customUniforms)r.push(n.getUniformLocation(t,p.name,h));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:o,outTexShapeLocation:a}}function H3(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],a=i.shape;if(!xn(r,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${a} must match`);if(t.isUniform&&i.isUniform)return;const o=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!xn(o,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${l} must match`)})}function ADe(n,e,t,s,r){e.program.enableShapeUniforms||(H3(e.inShapeInfos,t),H3([e.outShapeInfo],[s]));const i=s.texData.texture,a=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,a[0],a[1]):n.setOutputMatrixTexture(i.texture,a[0],a[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),Re().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:h,offset:p,shape:m,texShape:v}=e.variablesLocations[l];if(m){const{uniformShape:_}=hR(e.program.packedInputs,c.shape,c.texData.texShape);switch(_.length){case 1:n.gl.uniform1iv(m,new Int32Array(_));break;case 2:n.gl.uniform2iv(m,new Int32Array(_));break;case 3:n.gl.uniform3iv(m,new Int32Array(_));break;case 4:n.gl.uniform4iv(m,new Int32Array(_));break}}if(v&&n.gl.uniform2i(v,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(Me(c.shape)<2)n.gl.uniform1f(h,c.uniformValues[0]);else{let _=c.uniformValues;_ instanceof Float32Array||(_=new Float32Array(_)),n.gl.uniform1fv(h,_)}continue}c.texData.slice!=null&&p!=null&&n.gl.uniform1i(p,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,h,l)}}const o=e.outShapeLocation;if(o)switch(s.shape.length){case 1:n.gl.uniform1iv(o,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(o,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(o,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(o,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=ht(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],h=e.customUniformLocations[l],p=r[l];if(c.type==="float")n.gl.uniform1fv(h,p);else if(c.type==="vec2")n.gl.uniform2fv(h,p);else if(c.type==="vec3")n.gl.uniform3fv(h,p);else if(c.type==="vec4")n.gl.uniform4fv(h,p);else if(c.type==="int")n.gl.uniform1iv(h,p);else if(c.type==="ivec2")n.gl.uniform2iv(h,p);else if(c.type==="ivec3")n.gl.uniform3iv(h,p);else if(c.type==="ivec4")n.gl.uniform4iv(h,p);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function RDe(n,e,t){let s="";e.concat(t).forEach(a=>{const o=a.texData!=null&&a.texData.slice!=null&&a.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!a.isUniform){const l=a.texData.texShape,{useSqueezeShape:c,uniformShape:h,keptDims:p}=hR(n.packedInputs,a.shape,l);let m="",v="",_="";if(h.length===1&&n.packedInputs){const F=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];m=`${F[0]>1}_${F[1]>1}`}else if(h.length===2&&!n.packedInputs)v=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!n.packedInputs){const F=ht(h);_=`${F[0]===l[1]}_${F[F.length-1]===l[1]}`}const w=a.shape.length,T=h.length===2&&xn(a.shape,l),E=Me(a.shape)===1,C=$m(a.shape,t.shape),A=!n.packedInputs&&w===t.shape.length&&xn(l,t.texData.texShape),D=n.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${w}_${A}_${c?p:""}_${h.length}_${E}_${C}_${T}_${m}_${v}_${_}_${D}_${o}`}else{const l=a.isUniform?"uniform":a.texData.texShape;s+=`${a.shape}_${l}_${o}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${Re().getNumber("WEBGL_VERSION")}`,i}function Xr(n){return Re().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DDe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=mv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=bi();this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?GT(["r","c","d"],e):Yf(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LDe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=mv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=bi();this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?GT(["r","c","d"],e):Yf(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ODe{constructor(e){this.variableNames=["A"],this.outTexUsage=Na.DOWNLOAD;const t=bi();this.outputShape=e,this.userCode=`
      ${PK}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PDe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Na.DOWNLOAD;const t=bi();this.outputShape=e,this.userCode=`
      ${PK}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MDe={R:0,G:1,B:2,A:3};class q3{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=bi();this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let a="";for(let o=0;o<s.length;o++){const l=s[o];a+=`
          if(offset == ${o}) {
            result = values[${MDe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?uR():cR(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${a}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FDe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=bi();this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let a=0;a<=1;a++)for(let o=0;o<=1;o++){const l=a*2+o;r+=`
          localCoords = coords;
          if(localCoords[2] + ${o} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${o};
          if (localCoords[1] + ${a} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${a};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?uR():cR(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jDe(n){const e=bi(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return wRe(n,t)}function BDe(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return IRe(n,e)}function zDe(n){const e=new Uint16Array([0,1,2,2,1,3]);return CRe(n,e)}function h_(n,e,t,s,r,i){$Re(e,t);const a=kRe(n),o=n.TEXTURE_2D;return et(n,()=>n.bindTexture(o,a)),et(n,()=>n.texParameteri(o,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),et(n,()=>n.texParameteri(o,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),et(n,()=>n.texParameteri(o,n.TEXTURE_MIN_FILTER,n.NEAREST)),et(n,()=>n.texParameteri(o,n.TEXTURE_MAG_FILTER,n.NEAREST)),Re().getNumber("WEBGL_VERSION")===1?et(n,()=>n.texImage2D(o,0,s,e,t,0,r,i,null)):et(n,()=>n.texStorage2D(o,1,s,e,t)),et(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:a,texShape:[t,e]}}function zK(n){return n.internalFormatFloat}function VDe(n,e,t,s){const[r,i]=c_(e,t);return h_(n,r,i,zK(s),s.textureFormatFloat,n.FLOAT)}function VK(n){return n.internalFormatHalfFloat}function UDe(n,e,t,s){const[r,i]=c_(e,t);return h_(n,r,i,VK(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function UK(n){return n.downloadTextureFormat}function GDe(n,e,t,s){const[r,i]=c_(e,t);return h_(n,r,i,UK(s),n.RGBA,n.UNSIGNED_BYTE)}function GK(n){return n.internalFormatPackedFloat}function WDe(n,e,t,s){const[r,i]=og(e,t);return h_(n,r,i,GK(s),n.RGBA,n.FLOAT)}function WK(n){return n.internalFormatPackedHalfFloat}function HDe(n,e,t,s){const[r,i]=og(e,t);return h_(n,r,i,WK(s),n.RGBA,s.textureTypeHalfFloat)}function qDe(n,e,t){return et(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),U3(n,e,"clipSpacePos",t,3,20,0)&&U3(n,e,"uv",t,2,20,12)}function KDe(n,e,t,s,r,i){et(n,()=>n.bindTexture(n.TEXTURE_2D,e));let a,o,l;r instanceof Uint8Array?(a=new Uint8Array(t*s*4),o=n.UNSIGNED_BYTE,l=n.RGBA):(a=new Float32Array(t*s*4),o=n.FLOAT,l=i.internalFormatPackedFloat),a.set(r),Re().getNumber("WEBGL_VERSION")===2?et(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,o,a)):et(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,o,a)),et(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function XDe(n,e,t){et(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?Re().getNumber("WEBGL_VERSION")===2?et(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):et(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):Re().getNumber("WEBGL_VERSION")===2?et(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):et(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),et(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function ZDe(n,e,t,s){const r=n.createBuffer();et(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const o=4*4*e*t;return et(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)),et(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),et(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function YDe(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function QDe(n,e,t,s){const[r,i]=c_(e,t),a=4,o=new Uint8Array(mRe(e*t,a));return et(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}function JDe(n,e,t,s,r,i,a,o){const l=n,c=new Float32Array(gRe(i,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function eLe(n,e,t){const s=new Float32Array(e*t*4);return et(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SN{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=Re().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,dRe(t,e)):this.gl=Yo(t),e=this.gl,Re().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>et(i,()=>i.createVertexArray()),this.bindVertexArray=a=>et(i,()=>i.bindVertexArray(a)),this.deleteVertexArray=a=>et(i,()=>i.deleteVertexArray(a)),this.getVertexArray=()=>et(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>et(e,()=>i.createVertexArrayOES()),this.bindVertexArray=a=>et(e,()=>i.bindVertexArrayOES(a)),this.deleteVertexArray=a=>et(e,()=>i.deleteVertexArrayOES(a)),this.getVertexArray=()=>et(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Re().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",a="OES_texture_half_float";if(this.textureFloatExtension=Lx(this.gl,i),ao(this.gl,a))this.textureHalfFloatExtension=Lx(this.gl,a);else if(Re().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),ao(this.gl,r))this.colorBufferHalfFloatExtension=Lx(this.gl,r);else if(Re().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",ao(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(ao(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=BDe(this.gl),this.indexBuffer=zDe(this.gl),this.framebuffer=ARe(this.gl),this.textureConfig=lR(this.gl,this.textureHalfFloatExtension)}get debug(){return Re().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;et(e,()=>e.finish()),et(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),et(e,()=>e.deleteFramebuffer(this.framebuffer)),et(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),et(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),et(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),VDe(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),UDe(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),GDe(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),XDe(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),KDe(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),HDe(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),WDe(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(G3(this.gl,this.framebuffer),this.outputTexture=null),et(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>QDe(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,a){return JDe(this.gl,e,t,s,r,i,a,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return YDe(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=ZDe(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(Re().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const a=r.clientWaitSync(i,0,0);return a===r.ALREADY_SIGNALED||a===r.CONDITION_SATISFIED},t=i}else Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>eLe(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=jDe(t));const s=ERe(t);et(t,()=>t.attachShader(s,this.vertexShader)),et(t,()=>t.attachShader(s,e)),NRe(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&_N(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;et(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),qDe(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(et(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&_N(this.gl,this.program),et(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?DRe(this.gl,e,t):LRe(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),et(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),ORe(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=og(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&_N(this.gl,this.program),Ox(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}et(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),et(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Lx(this.gl,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await MM(()=>this.disposed||this.isQueryAvailable(e,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=tLe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in Re().platform&&(s=Re().platform.setTimeoutCustom.bind(Re().platform)),MM(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),xN(this.gl,e,this.framebuffer),this.debug&&Ox(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(xN(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ox(this.gl)):G3(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;xN(r,e,this.framebuffer),this.debug&&Ox(r),this.outputTexture=e,et(r,()=>r.viewport(0,0,t,s)),et(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),et(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function tLe(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:nLe,bincountImpl:HK,bincountReduceImpl:sLe,bitwiseAndImpl:rLe,castImpl:iLe,ceilImpl:aLe,concatImpl:oLe,equalImpl:lLe,expImpl:cLe,expm1Impl:uLe,floorImpl:hLe,gatherNdImpl:dLe,gatherV2Impl:fLe,greaterImpl:pLe,greaterEqualImpl:mLe,lessImpl:gLe,lessEqualImpl:yLe,linSpaceImpl:vLe,logImpl:bLe,maxImpl:_Le,maximumImpl:xLe,minimumImpl:wLe,multiplyImpl:TLe,negImpl:SLe,notEqualImpl:ELe,prodImpl:NLe,raggedGatherImpl:ILe,raggedRangeImpl:CLe,raggedTensorToTensorImpl:kLe,rangeImpl:$Le,rsqrtImpl:ALe,scatterImpl:RLe,sigmoidImpl:DLe,simpleAbsImpl:qK,sliceImpl:LLe,sparseFillEmptyRowsImpl:OLe,sparseReshapeImpl:PLe,sparseSegmentReductionImpl:KK,sqrtImpl:MLe,staticRegexReplaceImpl:FLe,stridedSliceImpl:jLe,stringNGramsImpl:BLe,stringSplitImpl:zLe,stringToHashBucketFastImpl:VLe,subImpl:ULe,tileImpl:GLe,topKImpl:WLe,transposeImpl:dR,uniqueImpl:HLe}=XIe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function pi(n,e){return e===1?[n]:XK(n,e)}function qLe(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KLe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Xr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=pi("rc",this.rank),s=An(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),a=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${a}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let a=2;a<this.rank;a++)i=`${e[e.length-1-a]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZK{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${XLe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?uR():cR(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function XLe(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?qRe(["r","c","d"],"inputShape"):Yf(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZLe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=X3(t,s),i=Z3(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const a=K3(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let o;return r===Tr.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Tr.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Tr.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Tr.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Tr.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),o}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=X3(s,r),a=Z3(t,i,r);a in this.freeTextures||(this.freeTextures[a]=[]);const o=K3(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=Re().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const c=this.usedTextures[a],h=c&&c.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[h]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function YLe(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function K3(n,e,t,s,r){const i=QLe(e,s);let a;if(r){const[l,c]=og(n[0],n[1]);a=l*c}else{const[l,c]=c_(n[0],n[1]);a=l*c}const o=YLe(t,i);return a*o}function QLe(n,e){switch(n){case Tr.PACKED_2X2_FLOAT32:return GK(e);case Tr.PACKED_2X2_FLOAT16:return WK(e);case Tr.UNPACKED_FLOAT32:return zK(e);case Tr.UNPACKED_FLOAT16:return VK(e);case Tr.PACKED_4X1_UNSIGNED_BYTE:return UK(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function JLe(n){return Re().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Tr.PACKED_2X2_FLOAT32:Tr.UNPACKED_FLOAT32:n?Tr.PACKED_2X2_FLOAT16:Tr.UNPACKED_FLOAT16}function X3(n,e){if(n===Na.UPLOAD)return Tr.PACKED_2X2_FLOAT32;if(n===Na.RENDER||n==null)return JLe(e);if(n===Na.DOWNLOAD||n===Na.PIXELS)return Tr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function Z3(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $l{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const po="if (isnan(x)) return x;",eOe="return x;",Y3="return abs(x);",tOe="return (x >= 0.0) ? x : (exp(x) - 1.0);",nOe=po+`
  return (x < 0.0) ? 0.0 : x;
`,sOe=po+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,nh="return x;",rOe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iOe="return x;",aOe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,oOe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lOe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cOe="return 1.0 / (1.0 + exp(-1.0 * x));";class mh{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uOe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length);const t=e.length,s=pi("rc",t),r=An(t),i=qLe(t,s),a=s.slice(-2),o=t<=1?"rc":`vec2(${a.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${o}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hOe=_H,dOe=1e-7,fOe=1e-4,Fx={};function pOe(n){return n in Fx||(Fx[n]={}),Fx[n]}const mOe=Re().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),gOe=600;function yOe(){return Re().global.screen==null?1024:Re().global.screen.height*Re().global.screen.width*window.devicePixelRatio*gOe/1024/1024}class WT extends P2{nextDataId(){return WT.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Re().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof SN)t=e;else{const s=Yo(Re().getNumber("WEBGL_VERSION"),e);t=new SN(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Yo(Re().getNumber("WEBGL_VERSION"));t=new SN(s),this.binaryCache=pOe(Re().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new ZLe(this.gpgpu),this.numMBBeforeWarning=yOe(),this.texData=new GW(this,_l())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,a){const o=this.makeTensorInfo(t,s),l=this.texData.get(o.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const c=Px(t),h=new q3(c,!1,a),p=this.runWebGLProgram(h,[o],s,[[r,i]]);return p.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(o),p.dataId}write(e,t,s){if((Re().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Re().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Na.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(Re().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Na.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:a,shape:o,isPacked:l}=t;if(a!=null){let m;l?m=new mh(o,nh):m=new $l(o,nh);const v=this.runWebGLProgram(m,[{dataId:e,shape:o,dtype:r}],r),_=this.readSync(v.dataId);return this.disposeIntermediateTensorInfo(v),_}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let h;c&&(h=ki());let p;if(r==="complex64"){const m=this.readSync(i.real.dataId),v=this.readSync(i.imag.dataId);p=Qc(m,v)}else p=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=ki()-h),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){const _=this.pendingRead.get(e);return new Promise(w=>_.push(w))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:a,complexTensorInfos:o,isPacked:l}=t;if(i!=null){let _;l?_=new mh(r,nh):_=new $l(r,nh);const w=this.runWebGLProgram(_,[{dataId:e,shape:r,dtype:a}],a),T=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),T}if(s!=null)return this.convertAndCacheOnCPU(e);if(Re().getBool("DEBUG")&&!Re().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Re().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,h;if(a!=="complex64"&&Re().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const _=this.texData.get(h.dataId);c=this.gpgpu.createBufferFromTexture(_.texture.texture,...Dx(r))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){const _=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]),w=_[0],T=_[1];p=Qc(w,T)}else if(c==null)p=this.getValuesFromTexture(e);else{const _=Me(r);p=this.gpgpu.downloadFloat32MatrixFromBuffer(c,_)}if(h!=null&&this.disposeIntermediateTensorInfo(h),c!=null){const _=this.gpgpu.gl;et(_,()=>_.deleteBuffer(c))}const m=this.convertAndCacheOnCPU(e,p),v=this.pendingRead.get(e);return this.pendingRead.delete(e),v.forEach(_=>_(m)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&_l().removeDataId(e,this),this.pendingDeletes--),m}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:a,dtype:o,isPacked:l,texture:c}=s;if(o==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(a!=null){let v;l?v=new mh(i,nh):v=new $l(i,nh);const _=this.runWebGLProgram(v,[{dataId:e,shape:i,dtype:o}],o),w=this.readToGPU(_,t);return this.disposeIntermediateTensorInfo(_),w}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,t.customTexShape),p=_l().makeTensorFromTensorInfo(h),m=this.texData.get(h.dataId);return Object.assign({tensorRef:p},m.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Fh(r));return zt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return zt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!_Re(s))throw Re().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=Me(t);if(Re().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(e),v=this.texData.get(m.dataId),_=this.gpgpu.downloadMatrixFromPackedTexture(v.texture.texture,...Dx(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(m),_}const a=Re().getBool("WEBGL_PACK")&&r===!0,o=a?Px(t):t,l=a?new PDe(o):new ODe(o),c=this.runWebGLProgram(l,[{shape:o,dtype:s,dataId:e}],"float32"),h=this.texData.get(c.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(c),p}timerAvailable(){return Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=If(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),a=If(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);o.kernelMs=_ve(l),o.getExtraProfileInfo=()=>l.map((c,h)=>({name:a[h],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ki(),endMs:null}}endTimer(e){return Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ki(),e)}async getQueryTime(e){if(Re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:a,slice:o}=this.texData.get(e),l=o&&o.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,a)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=mOe){return Re().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&Me(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Ta("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return hOe(e.shape,t)}packedUnaryOp(e,t,s){const r=new mh(e.shape,t),i=this.compileAndRun(r,[e],s);return _l().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=qK(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(Re().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Y3,e.dtype);const t=new $l(e.shape,Y3),s=this.compileAndRun(t,[e]);return _l().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Zv(s[0])){const i=s.map(a=>wh(a));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return _l().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new uOe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new KLe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[Pm(e.shape),...Mm(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[Pm(t),...Mm(t)],a=new ZK(i,s),o=!0,l=[s],c=this.runWebGLProgram(a,[r],e.dtype,l,o);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:a}=s;if(t!=null){const m=Me(i),v=t[0]*t[1]*4;te(m<=v,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const o=Px(i);let l;r?l=new LDe(o):l=new DDe(o);const c=!0,h=[t??Dx(o)],p=this.runWebGLProgram(l,[{shape:o,dtype:a,dataId:e}],a,h,c,t);return{dtype:a,shape:i,dataId:p.dataId}}runWebGLProgram(e,t,s,r,i=!1,a){const o=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(o.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===mv.DENSE){const E=a??Dx(e.outputShape);l.texShape=E.map(C=>C*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Me(o.shape)===0)return l.values=Ur(o.dtype,0),o;const c=[],h=t.map(E=>{if(E.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(E.dataId);if(C.texture==null){if(!e.packedInputs&&Me(E.shape)<=Re().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:E.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=E.shape)}if(this.uploadToGPU(E.dataId),!!C.isPacked!=!!e.packedInputs)E=C.isPacked?this.unpackTensor(E):this.packTensor(E),c.push(E),C=this.texData.get(E.dataId);else if(C.isPacked&&!x1(C.shape,E.shape)){const A=E,D=E.shape;E.shape=C.shape,E=this.packedReshape(E,D),c.push(E),C=this.texData.get(E.dataId),A.shape=D}return{shape:E.shape,texData:C,isUniform:!1}});this.uploadToGPU(o.dataId);const p={shape:o.shape,texData:l,isUniform:!1},m=RDe(e,h,p),v=this.getAndSaveBinary(m,()=>$De(this.gpgpu,e,h,p)),_=this.activeTimers!=null;let w;_&&(w=this.startTimer()),Re().get("ENGINE_COMPILE_ONLY")||ADe(this.gpgpu,v,h,p,r),c.forEach(E=>this.disposeIntermediateTensorInfo(E)),_&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const T=Re().getNumber("WEBGL_FLUSH_THRESHOLD");if(T>0){const E=ki();E-this.lastGlFlushTime>T&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=E)}if(!Re().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const E=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),E}return o}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Re().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ke(()=>{if(!Re().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Re().getBool("DEBUG");Re().set("DEBUG",!1);const t=this.abs(_n(1e-8)).dataSync()[0];if(Re().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?dOe:fOe}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:a,usage:o,isPacked:l}=t;if(a!=null)return;const c=this.activeTimers!=null;let h;c&&(h=ki());let p=t.texShape;if(p==null&&(p=FRe(s,l),t.texShape=p),i!=null){const m=Px(s);let v,_=p[1],w=p[0];const T=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!T)&&([_,w]=og(p[0],p[1])),l?v=new FDe(m,T):v=new q3(m,T);const E=T?[w,_]:p,C=this.makeTensorInfo(E,r),A=this.texData.get(C.dataId);T?A.usage=Na.PIXELS:A.usage=Na.UPLOAD,A.texShape=E,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),_,w,i);const D=[[w,_]],W=this.runWebGLProgram(v,[C],r,D,!0),B=this.texData.get(W.dataId);t.texShape=B.texShape,t.isPacked=B.isPacked,t.usage=B.usage,Re().get("ENGINE_COMPILE_ONLY")?this.disposeData(W.dataId):(t.texture=B.texture,t.values=null,this.texData.delete(W.dataId)),this.disposeIntermediateTensorInfo(C),c&&(this.uploadWaitMs+=ki()-h)}else{const m=this.acquireTexture(p,o,r,l);t.texture=m}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=vOe(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Y0(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await MH(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(OK(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:a,outShapeStridesLocation:o,outTexShapeLocation:l}=BK(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=a,e.outShapeStridesLocation=o,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:a,channels:o}=e,l=_l().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,t,s,i,a,o);return _l().makeTensorFromDataId(c,t,s,l)}}WT.nextDataId=0;function vOe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */D5()&&M5("webgl",()=>new WT,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fR=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class jf{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Dt(t,s),this.enableShapeUniforms=Xr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jf=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class dg{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Dt(t,s);const i=this.outputShape.length;this.enableShapeUniforms=Xr(i);let a="";if(r)if(i===0||Me(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          ${An(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?a+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:a+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=pi("coords",i);this.enableShapeUniforms?a+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:a+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${a}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ea(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const bOe={kernelName:yb,backendName:"webgl",kernelFunc:ea};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ld(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),a=t.texData.get(i.dataId),o=ea({inputs:{x:s},backend:t}),l=ea({inputs:{x:r},backend:t});return a.complexTensorInfos={real:o,imag:l},i}const _Oe={kernelName:X2,backendName:"webgl",kernelFunc:ld};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK="return (a < 0.) ? b * a : a;",QK=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function xOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,a=t.makeTensorInfo([],"float32",ed(i,"float32")),o=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dg(QK,r.shape,a.shape):new jf(YK,r.shape,a.shape),l=t.runWebGLProgram(o,[r,a],"float32");return t.disposeIntermediateTensorInfo(a),l}const wOe={kernelName:jw,backendName:"webgl",kernelFunc:xOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK="return (a < 0.) ? b * a : a;",e7=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function TOe(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dg(e7,s.shape,r.shape):new jf(JK,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const SOe={kernelName:rT,backendName:"webgl",kernelFunc:TOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fg="if (isnan(x)) return x;";function cn({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:a}=r,o=i,l=s||a.dtype;if(o.shouldExecuteOnCPU([a])&&t!=null){const p=o.texData.get(a.dataId),m=t(p.values,l);return o.makeTensorInfo(a.shape,l,m)}const c=Re().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return c?h=new mh(a.shape,e):h=new $l(a.shape,n),o.runWebGLProgram(h,[a],l)}}function Ir({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:a,backend:o})=>{const{a:l,b:c}=a,h=o;if(s&&l.dtype==="complex64"){const _=h.texData.get(l.dataId),w=h.texData.get(c.dataId),[T,E]=[[_.complexTensorInfos.real,w.complexTensorInfos.real],[_.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(A=>{const[D,F]=A,W={dataId:D.dataId,dtype:D.dtype,shape:l.shape},B={dataId:F.dataId,dtype:F.dtype,shape:c.shape},P=new jf(n,l.shape,c.shape);return h.runWebGLProgram(P,[W,B],Qi(D.dtype,F.dtype))}),C=ld({inputs:{real:T,imag:E},backend:h});return h.disposeIntermediateTensorInfo(T),h.disposeIntermediateTensorInfo(E),C}const p=i||Qi(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||h.shouldExecuteOnCPU([l,c]))&&r!=null){const _=h.texData.get(l.dataId).values,w=h.texData.get(c.dataId).values,T=l.dtype==="string"?Jc(_):_,E=l.dtype==="string"?Jc(w):w,[C,A]=r(l.shape,c.shape,T,E,p),D=h.makeTensorInfo(A,p),F=h.texData.get(D.dataId);return F.values=C,D}const m=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let v;return m?v=new dg(e,l.shape,c.shape,t):v=new jf(n,l.shape,c.shape),h.runWebGLProgram(v,[l,c],p)}}function gv(n,e=!1){if(n==="linear")return e?iOe:eOe;if(n==="relu")return e?oOe:nOe;if(n==="elu")return e?aOe:tOe;if(n==="relu6")return e?lOe:sOe;if(n==="prelu")return e?e7:JK;if(n==="leakyrelu")return e?QK:YK;if(n==="sigmoid")return e?cOe:rOe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t7{constructor(e,t,s,r=!1,i=!1,a=!1,o=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Xr(this.outputShape.length);const h=r?e[1]:e[2],p=Math.ceil(h/2),m=r?"i * 2, rc.y":"rc.y, i * 2",v=i?"rc.z, i * 2":"i * 2, rc.z",_=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let T="",E="";o&&(l?T=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${o}
        }`:c?T=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${o}
        }`:T=`vec4 activation(vec4 x) {
          ${o}
        }`,E="result = activation(result);");const C=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let A="rc.x",D="rc.x";e[0]<t[0]?A=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(D=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${T}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${A};
        int batchB = ${D};
        for (int i = 0; i < ${p}; i++) {
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${v});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${_[0]} * ${w[0]});
          result += (${_[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${E}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class J3{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Dt(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eF="return a * b;";function pR(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Qi(s.dtype,r.dtype);if(s.dtype==="complex64"){const o=t.texData.get(s.dataId),l=t.texData.get(r.dataId),c=new J3(Q3.REAL,s.shape,r.shape),h=new J3(Q3.IMAG,s.shape,r.shape),p=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:s.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],m=t.runWebGLProgram(c,p,"float32"),v=t.runWebGLProgram(h,p,"float32"),_=ld({inputs:{real:m,imag:v},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),_}if(t.shouldExecuteOnCPU([s,r])){const o=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[c,h]=TLe(s.shape,r.shape,o.values,l.values,i),p=t.makeTensorInfo(h,i),m=t.texData.get(p.dataId);return m.values=c,p}let a;return Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?a=new dg(eF,s.shape,r.shape):a=new jf(eF,s.shape,r.shape),t.runWebGLProgram(a,[s,r],i)}const EOe={kernelName:Nb,backendName:"webgl",kernelFunc:pR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NOe(n,e,t){const s=[Pm(n.shape),...Mm(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[Pm(e),...Mm(e)],a=new ZK(i,s),o=!0,l=[s],c=t.runWebGLProgram(a,[r],n.dtype,l,o);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,a=t,o=Me(r.shape),l=HW(i,o),c=Me(l);te(o===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`);const h=a.texData.get(r.dataId);return h.isPacked&&!x1(r.shape,l)&&!(h.texture!==null&&x1(h.shape,l))?NOe(r,l,a):(a.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const IOe={kernelName:aT,backendName:"webgl",kernelFunc:Ze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tF{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];const o=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(t!=null){const p=1/t;c=`sumValue += dot(values * ${Im(p)?p.toPrecision(2):p}, ones);`}let h="";i%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${o}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${o};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class COe{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];let o="0.0",l="";t==="prod"?o="1.0":t==="min"?(o="1.0 / 1e-20",l="min"):t==="max"&&(o="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const h=Math.floor(s/4)*4,p=s%4;let m=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,v="vec4";t==="all"?(o="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,v="bvec4"):t==="any"&&(o="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,v="bvec4");let _="";i%s>0&&(_=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${o};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${_}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${o});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${v} values = ${v}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${h};
        if (${p===1}) {
          ${v} values = ${v}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${p===2}) {
          ${v} values = ${v}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${p===3}) {
          ${v} values = ${v}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kOe(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=kT(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function ep(n,e,t,s){const r=kOe(n.shape);let i=n;for(let a=0;a<r.length;a++){const{inSize:o,windowSize:l,outSize:c}=r[a];let h,p;t==="mean"?h=a===0?new tF({windowSize:l,inSize:o,batchSize:n.shape[0],outSize:c},o):new tF({windowSize:l,inSize:o,batchSize:n.shape[0],outSize:c}):h=new COe({windowSize:l,inSize:o,batchSize:n.shape[0],outSize:c},t),p=i,i=s.runWebGLProgram(h,[i],e),p.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(p)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Oe{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let a=0;a<s.length;a++)s[a]=e[t[a]];this.outputShape=s,this.rank=s.length;const r=An(this.rank),i=AOe(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function AOe(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ROe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let h=0;h<s.length;h++)s[h]=e[t[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=An(this.rank),i=XK("rc",this.rank),a=new Array(this.rank);for(let h=0;h<t.length;h++)a[t[h]]=i[h];const o=`vec2(${a.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${a.join()}), ${o})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HT(n,e,t){const s=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ROe(n.shape,e):new $Oe(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DOe(n,e,t,s){const r=e,i=n.shape.length,a=Vt(r,n.shape);let o=a;const l=fs(o,i),c=l!=null;let h=n;c&&(h=HT(n,l,s),o=Is(o.length,i)),Nr("sum",o,i);const[p,m]=fr(h.shape,o);let v=p;t&&(v=Bs(p,a));const _=Me(m),T=Me(n.shape)/_,E=Ze({inputs:{x:h},attrs:{shape:[T,_]},backend:s}),C=k$(n.dtype),A=ep(E,C,"sum",s),D=Ze({inputs:{x:A},attrs:{shape:v},backend:s});return s.disposeIntermediateTensorInfo(E),s.disposeIntermediateTensorInfo(A),c&&s.disposeIntermediateTensorInfo(h),D}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qT(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s;return DOe(r,i,a,t)}const LOe={kernelName:dT,backendName:"webgl",kernelFunc:qT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,a=t,o=r.shape.length,l=new Array(o);for(let h=0;h<l.length;h++)l[h]=r.shape[i[h]];let c;if(a.shouldExecuteOnCPU([r])){const p=a.texData.get(r.dataId).values,m=dR(p,r.shape,r.dtype,i,l);c=a.makeTensorInfo(l,r.dtype);const v=a.texData.get(c.dataId);v.values=m}else c=HT(r,i,a);return c}const OOe={kernelName:um,backendName:"webgl",kernelFunc:yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n7=1e3;function w1({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}){const c=n.shape.length,h=e.shape.length,p=t?n.shape[c-2]:n.shape[c-1],m=s?e.shape[h-1]:e.shape[h-2],v=t?n.shape[c-1]:n.shape[c-2],_=s?e.shape[h-2]:e.shape[h-1],w=n.shape.slice(0,-2),T=e.shape.slice(0,-2),E=Me(w),C=Me(T),D=Dt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([v,_]);te(p===m,()=>`Error in matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const F=t?[E,p,v]:[E,v,p],W=s?[C,_,m]:[C,m,_],B=Ze({inputs:{x:n},backend:r,attrs:{shape:F}}),P=Ze({inputs:{x:e},backend:r,attrs:{shape:W}}),O=[B,P],M=Math.max(E,C),k=t?B.shape[1]:B.shape[2],V=i!=null,G=a!=null,ae=l==="leakyrelu",J=l!=null?gv(l,!0):null,X=V||G||ae||J!=null;let se;if((v===1||_===1)&&k>n7&&X===!1){let le=B,K=P;t&&(le=yi({inputs:{x:B},backend:r,attrs:{perm:[0,2,1]}}),O.push(le)),s&&(K=yi({inputs:{x:P},backend:r,attrs:{perm:[0,2,1]}}),O.push(K));const ie=_!==1,de=_===1;let ce=le;ie&&(ce=Ze({inputs:{x:le},backend:r,attrs:{shape:[M,k,1]}}),O.push(ce));const Se=_===1?2:1;let Te=K;de&&(Te=Ze({inputs:{x:K},backend:r,attrs:{shape:[M,1,k]}}),O.push(Te));const Ie=pR({inputs:{a:ce,b:Te},backend:r});se=qT({inputs:{x:Ie},backend:r,attrs:{axis:Se,keepDims:!0}}),O.push(Ie)}else{const le=Qi(n.dtype,e.dtype),K=new t7(F,W,[M,v,_],t,s,V,J,G,ae),ie=[B,P];if(i!=null&&ie.push(i),G&&ie.push(a),ae){const de=r.makeTensorInfo([],"float32",ed(o,"float32"));ie.push(de),O.push(de)}se=r.runWebGLProgram(K,ie,le)}const ne=Ze({inputs:{x:se},backend:r,attrs:{shape:D}});O.push(se);for(const le of O)r.disposeIntermediateTensorInfo(le);return ne}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function POe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:a,preluActivationWeights:o}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:p}=s;return w1({a:r,b:i,transposeA:l,transposeB:c,backend:t,bias:a,preluActivationWeights:o,leakyreluAlpha:p,activation:h})}const MOe={kernelName:Q0,backendName:"webgl",kernelFunc:POe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nF="return abs(x);";function FOe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),a=qK(i.values);return t.makeTensorInfo(s.shape,s.dtype,a)}let r;return Re().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new mh(s.shape,nF):r=new $l(s.shape,nF),t.runWebGLProgram(r,[s],s.dtype)}const jOe={kernelName:bw,backendName:"webgl",kernelFunc:FOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BOe=po+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,zOe=cn({opSnippet:BOe}),VOe={kernelName:Yv,backendName:"webgl",kernelFunc:zOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UOe=po+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,GOe=cn({opSnippet:UOe}),WOe={kernelName:Qv,backendName:"webgl",kernelFunc:GOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sF="return a + b;",HOe=Ir({opSnippet:sF,packedOpSnippet:sF,supportsComplex:!0,cpuKernelImpl:nLe}),qOe={kernelName:eg,backendName:"webgl",kernelFunc:HOe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KOe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,a)=>`T${a}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XOe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,a)=>`T${a}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return ea({inputs:{x:s[0]},backend:t});if(s.length>Re().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=f0({inputs:s.slice(0,l),backend:t}),h=f0({inputs:s.slice(l),backend:t});return f0({inputs:[c,h],backend:t})}const r=s.map(l=>l.dtype).reduce((l,c)=>Qi(l,c)),i=s.map(l=>l.shape),o=Re().getBool("WEBGL_PACK")?new XOe(s[0].shape,i):new KOe(s[0].shape,i);return t.runWebGLProgram(o,s,r)}const ZOe={kernelName:V2,backendName:"webgl",kernelFunc:f0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s,o=r.shape.length,l=Vt(i,r.shape);let c=l;const h=fs(c,o);let p=r;h!=null&&(p=yi({inputs:{x:r},backend:t,attrs:{perm:h}}),c=Is(c.length,o)),Nr("all",c,o);const[m,v]=fr(p.shape,c),_=Me(v),w=Ze({inputs:{x:p},backend:t,attrs:{shape:[-1,_]}}),T=ep(w,w.dtype,"all",t);let E;if(a){const C=Bs(m,l);E=Ze({inputs:{x:T},backend:t,attrs:{shape:C}})}else E=Ze({inputs:{x:T},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(T),h!=null&&t.disposeIntermediateTensorInfo(p),E}const QOe={kernelName:U2,backendName:"webgl",kernelFunc:YOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s,o=r.shape.length,l=Vt(i,r.shape);let c=l;const h=fs(c,o);let p=r;h!=null&&(p=yi({inputs:{x:r},backend:t,attrs:{perm:h}}),c=Is(c.length,o)),Nr("any",c,o);const[m,v]=fr(p.shape,c),_=Me(v),w=Ze({inputs:{x:p},backend:t,attrs:{shape:[-1,_]}}),T=ep(w,w.dtype,"any",t);let E;if(a){const C=Bs(m,l);E=Ze({inputs:{x:T},backend:t,attrs:{shape:C}})}else E=Ze({inputs:{x:T},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(T),h!=null&&t.disposeIntermediateTensorInfo(p),E}const ePe={kernelName:G2,backendName:"webgl",kernelFunc:JOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tPe{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:a}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];const o=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${o} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nPe{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,te(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,l=o.length,c=An(l),h=pi("coords",l);let p,m;if(a===1){m=l+1;const P=An(m);p=`
        ${P} sourceLocR = ${P}(${h.join()}, 0);
        ++${h[l-1]};
        ${P} sourceLocG = ${P}(${h.join()}, 0);
        ++${h[l-2]};
        ${P} sourceLocA = ${P}(${h.join()}, 0);
        --${h[l-1]};
        ${P} sourceLocB = ${P}(${h.join()}, 0);
        --${h[l-2]};`}else m=l,p=`
        ${c} sourceLocR = coords;
        ++${h[l-1]};
        ${c} sourceLocG = coords;
        ++${h[l-2]};
        ${c} sourceLocA = coords;
        --${h[l-1]};
        ${c} sourceLocB = coords;
        --${h[l-2]};`;const v=["x","y","z","w","u","v"].slice(0,m),_="."+v[m-1],w=v.map(P=>"int "+P),T=pi("sourceLocR",m-1).concat("inIdx.r"),E=pi("sourceLocG",m-1).concat("inIdx.g"),C=pi("sourceLocB",m-1).concat("inIdx.b"),A=pi("sourceLocA",m-1).concat("inIdx.a"),D=s==="max"?"greaterThan":"lessThan",F=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${T.join()}),
                             getBestIndicesAChannel(${E.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${A.join()})));`,W=`vec4(
            getAChannel(${T.join()}),
            hasNextCol ? getAChannel(${E.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${A.join()}) : 0.)`,B=r?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${v.join()}),
                                          vec2(${v.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${v.join()}),
                               vec2(${v.slice(-2).join()}));
      }
      ${B}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${o[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${o[l-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${_}, sourceLocG${_},
          sourceLocB${_}, sourceLocA${_}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${W};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${F}
          vec4 candidate = ${W};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${D}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const a=kT(i),o={windowSize:a,inSize:i,batchSize:r,outSize:Math.ceil(i/a)},l=new tPe(o,t,s==null),c=[e];s!=null&&c.push(s);const h=n.runWebGLProgram(l,c,"int32");if(h.shape[1]===1)return h;const p=s7(n,e,t,h);return n.disposeIntermediateTensorInfo(h),p}function r7(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],a=kT(i),o=new nPe(r,a,t,s==null),l=s==null?[e]:[e,s],c=n.runWebGLProgram(o,l,"int32");if(c.shape.length===e.shape.length){const h=r7(n,e,t,c);return n.disposeIntermediateTensorInfo(c),h}return c}function i7(n,e,t,s){const r=[t];if(Nr("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!Re().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],a=n.texData.get(e.dataId),o=a!==null&&a.isPacked;let l=e;o&&(l=n.unpackTensor(e),i.push(l));const[c,h]=fr(l.shape,r),p=Me(h),m=Ze({inputs:{x:l},backend:n,attrs:{shape:[-1,p]}});i.push(m);const v=s7(n,m,s);i.push(v);const _=Ze({inputs:{x:v},backend:n,attrs:{shape:c}});return i.forEach(w=>n.disposeIntermediateTensorInfo(w)),_}return r7(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let a=Vt(i,r.shape);const o=fs(a,r.shape.length);let l=r;const c=[];o!=null&&(l=yi({inputs:{x:r},backend:t,attrs:{perm:o}}),c.push(l),a=Is(a.length,l.shape.length)),Nr("argMax",[a[0]],l.shape.length);const h=i7(t,l,a[0],"max");return c.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const rPe={kernelName:_w,backendName:"webgl",kernelFunc:sPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let a=Vt(i,r.shape);const o=fs(a,r.shape.length);let l=r;const c=[];o!=null&&(l=yi({inputs:{x:r},backend:t,attrs:{perm:o}}),c.push(l),a=Is(a.length,l.shape.length)),Nr("argMin",[a[0]],l.shape.length);const h=i7(t,l,a[0],"min");return c.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const aPe={kernelName:xw,backendName:"webgl",kernelFunc:iPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oPe=po+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,lPe=cn({opSnippet:oPe}),cPe={kernelName:Jv,backendName:"webgl",kernelFunc:lPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uPe=po+"return log(x + sqrt(x * x + 1.0));",hPe=cn({opSnippet:uPe}),dPe={kernelName:eb,backendName:"webgl",kernelFunc:hPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fPe=po+`
  return atan(x);
`,pPe=cn({opSnippet:fPe}),mPe={kernelName:tb,backendName:"webgl",kernelFunc:pPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gPe=fR+`
  return atan(a, b);
`,yPe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jf+`
  return result;
`,vPe=Ir({opSnippet:gPe,packedOpSnippet:yPe}),bPe={kernelName:sb,backendName:"webgl",kernelFunc:vPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Pe=po+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,xPe=cn({opSnippet:_Pe}),wPe={kernelName:nb,backendName:"webgl",kernelFunc:xPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yv{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.top,_=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",T=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,E=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(w||(C="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${o}, ${l});
        const ivec2 pads = ivec2(${v}, ${_});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?T:E:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const A="max";let D=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(D="avgValue / max(count, 1.0)");const F=Math.floor(a/4)*4,W=a%4,B=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${A}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${l});
      const ivec2 pads = ivec2(${v}, ${_});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${F}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${B}
          }

          int xC = xCCorner + ${F};
          if (${W===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${B}
          } else if (${W===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${B}
          } else if (${W===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${B}
          }
        }
        setOutput(${D});
      }
    `}}class mR{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,o=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=e.dilationDepth,p=e.dilationHeight,m=e.dilationWidth,v=e.effectiveFilterDepth,_=e.effectiveFilterHeight,w=e.effectiveFilterWidth,T=e.padInfo.front,E=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const A=t==="avg";let D="0.0";if(A||(D="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${o}, ${l}, ${c});
        const ivec3 pads = ivec3(${T}, ${E}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${v};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${_};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${_} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const F="max";let W=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(W="avgValue / max(count, 1.0)");const B=Math.floor(a/4)*4,P=a%4,O=`
      if (${A}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${F}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${o}, ${l}, ${c});
      const ivec3 pads = ivec3(${T}, ${E}, ${C});
      const float initializationValue = ${D};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${D});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${v};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${_};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${B}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${O}
            }

            int xC = xCCorner + ${B};
            if (${P===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${O}
            } else if (${P===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${O}
            } else if (${P===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${O}
            }
          }
        }
        setOutput(${W});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;u_(r,"avgPool");const{filterSize:i,strides:a,pad:o,dimRoundingMode:l}=s,c=1;te(qr(a,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=ho(r.shape,i,a,c,o,l);if(h.filterWidth===1&&h.filterHeight===1&&xn(h.inShape,h.outShape))return ea({inputs:{x:r},backend:t});const p=new yv(h,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const SPe={kernelName:ww,backendName:"webgl",kernelFunc:TPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=s,h=[1,1,1],p=ru(r.shape,i,a,h,o,l,c),m=new mR(p,"avg",!1);return t.runWebGLProgram(m,[r],"float32")}const NPe={kernelName:Tw,backendName:"webgl",kernelFunc:EPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IPe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.top,p=c-1-e.padInfo.left,m=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${p});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${a}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${o}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class CPe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,v=e.effectiveFilterWidth,_=p-1-e.padInfo.front,w=m-1-e.padInfo.top,T=v-1-e.padInfo.left,E=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${_}, ${w}, ${T});
      const float avgMultiplier = float(${E});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${a}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${v};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kPe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,a=i,{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=s,p=[1,1,1],m=ru(a.shape,o,l,p,c,h),v=new CPe(m);return t.runWebGLProgram(v,[r],a.dtype)}const $Pe={kernelName:H2,backendName:"webgl",kernelFunc:kPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function APe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,a=i;u_([r,i],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=s,h=ho(a.shape,o,l,1,c),p=new IPe(h);return t.runWebGLProgram(p,[r],a.dtype)}const RPe={kernelName:W2,backendName:"webgl",kernelFunc:APe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DPe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:a,transposeB:o}=s;return w1({a:r,b:i,transposeA:a,transposeB:o,backend:t})}const LPe={kernelName:Sw,backendName:"webgl",kernelFunc:DPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OPe{constructor(e,t,s,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Dt(e,t),Dt(e,s);let o="0.0";r!=null&&(Dt(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let l="1.0";i!=null&&(Dt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${o};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${a}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PPe{constructor(e,t,s,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Dt(e,t),Dt(e,s);let o="vec4(0.0)";r!=null&&(Dt(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(Dt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${o};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${a}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MPe=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:a,scale:o}=n;te(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),te(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),te(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[s,r,i];let h=null;a!=null&&(h=a.shape,c.push(a));let p=null;o!=null&&(p=o.shape,c.push(o));const m=Re().getBool("WEBGL_PACK_NORMALIZATION")?new PPe(s.shape,r.shape,i.shape,h,p,l):new OPe(s.shape,r.shape,i.shape,h,p,l);return e.runWebGLProgram(m,c,c[0].dtype)},FPe={kernelName:Pw,backendName:"webgl",kernelFunc:MPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jPe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=An(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=BPe(this.rank);let r;const i=e.map((a,o)=>`sourceLoc.${gC[o]} = start[${o}] + coords.${gC[o]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const gC=["x","y","z","w","u","v"];function BPe(n){if(n===1)return"sourceLoc";if(n<=6)return gC.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zPe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=An(this.rank),s=pi("coords",this.rank),r=pi("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,a=`getChannel(getSource(${r.join()}), ${i})`,o=`
      result.x = ${a};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${a};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${a};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${a};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((h,p)=>`start[${p}]`).join()});`:e.map((h,p)=>`${r[p]} = ${s[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${o}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VPe(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),a=s.texData.get(i.dataId);Object.assign(a,r),a.refCount=1,a.shape=t,a.dtype=n.dtype;let o=uA(e,ht(n.shape));r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(a.slice.origDataId)||1;return s.dataRefCount.set(a.slice.origDataId,l+1),i}function pg(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:a}=s,[o,l]=CT(r,i,a);if(oA(r,o,l),Me(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const p=t.texData.get(r.dataId),m=LLe(p.values,o,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,m)}const{isPacked:c}=t.texData.get(r.dataId),h=cA(r.shape,o,l);if(c||!h){const p=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zPe(l):new jPe(l),m=[o];return t.runWebGLProgram(p,[r],r.dtype,m)}return t.uploadToGPU(r.dataId),VPe(r,o,l,t)}const UPe={kernelName:hT,backendName:"webgl",kernelFunc:pg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GPe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:a}=s;te(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const o=i.reduce((C,A)=>C*A),l=Yb(r.shape,i,o),c=Qb(l.length,i.length),h=Jb(r.shape,i,o),p=mA(a,i.length),m=gA(h,a,i.length),v=[],_=Ze({inputs:{x:r},backend:t,attrs:{shape:l}}),w=yi({inputs:{x:_},backend:t,attrs:{perm:c}}),T=Ze({inputs:{x:w},backend:t,attrs:{shape:h}}),E=pg({inputs:{x:T},backend:t,attrs:{begin:p,size:m}});return v.push(_),v.push(w),v.push(T),v.forEach(C=>t.disposeIntermediateTensorInfo(C)),E},WPe={kernelName:Ew,backendName:"webgl",kernelFunc:GPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:a}=s,o=t.readSync(r.dataId),l=t.readSync(i.dataId),c=HK(o,l,i.dtype,i.shape,a);return t.makeTensorInfo([a],i.dtype,c)}const qPe={kernelName:q2,backendName:"webgl",kernelFunc:HPe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KPe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,XPe=`
  return float(int(a.r) & int(b.r));
`;function ZPe(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS"),a=Re().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||a===1){const l=t.texData.get(s.dataId).values,c=t.texData.get(r.dataId).values,[h,p]=rLe(s.shape,r.shape,l,c,s.dtype),m=t.makeTensorInfo(p,s.dtype),v=t.texData.get(m.dataId);return v.values=h,m}let o;return i?o=new dg(KPe,s.shape,r.shape,!1):o=new jf(XPe,s.shape,r.shape),t.runWebGLProgram(o,[s,r],s.dtype)}const YPe={kernelName:K2,backendName:"webgl",kernelFunc:ZPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QPe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),o=Dt(Array.from(i),Array.from(a));return t.makeTensorInfo([o.length],"int32",Int32Array.from(o))}const JPe={kernelName:QW,backendName:"webgl",kernelFunc:QPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eMe="return float(a != b);",a7=Ir({opSnippet:eMe,cpuKernelImpl:ELe,dtype:"bool"}),tMe={kernelName:Jw,backendName:"webgl",kernelFunc:a7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ea({inputs:{x:r.complexTensorInfos.real},backend:t})}const nMe={kernelName:b$,backendName:"webgl",kernelFunc:d_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sMe="return float(int(x));";function rMe(n,e){const t=new $l(n.shape,sMe),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return ea({inputs:{x:r},backend:t});const a=ur(r.shape),o=yC({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=ld({inputs:{real:o,imag:a},backend:t});return a.dispose(),t.disposeIntermediateTensorInfo(o),l}if(r.dtype==="complex64"){const a=d_({inputs:{input:r},backend:t}),o=yC({inputs:{x:a},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(a),o}if(!qW(r.dtype,i)){const a=ea({inputs:{x:r},backend:t});return{dataId:a.dataId,shape:a.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const a=t.texData.get(r.dataId).values,[o,l,c]=iLe(a,r.shape,r.dtype,i);return t.makeTensorInfo(o,l,c)}if(i==="int32")return rMe(r,t);if(i==="bool"){const a=t.makeTensorInfo([],"bool",Ur("bool",1)),l=a7({inputs:{a:r,b:a},backend:t});return t.disposeIntermediateTensorInfo(a),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const iMe={kernelName:rb,backendName:"webgl",kernelFunc:yC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rF="return ceil(x);",aMe=cn({opSnippet:rF,packedOpSnippet:rF,cpuKernelImpl:aLe}),oMe={kernelName:ib,backendName:"webgl",kernelFunc:aMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lMe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cMe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:a}=s;let o;Re().getBool("WEBGL_PACK_CLIP")?o=new cMe(r.shape):o=new lMe(r.shape);const l=[[i],[a]];return t.runWebGLProgram(o,[r],r.dtype,l)}const hMe={kernelName:ab,backendName:"webgl",kernelFunc:uMe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dMe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function fMe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new dMe(s.shape),a=[iF(s,r.complexTensorInfos.real),iF(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,a,a[0].dtype)}const pMe={kernelName:Nw,backendName:"webgl",kernelFunc:fMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mMe{constructor(e){this.outputShape=[],this.outputShape=zl(e,1),this.variableNames=e.map((a,o)=>`T${o}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let a=1;a<t.length;a++)t[a]=t[a-1]+e[a][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let a=1;a<t.length;a++){const o=t[a-1];s.push(`else if (yC < ${t[a]}) setOutput(getT${a}(yR, yC-${o}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gMe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=zl(e,t);const s=this.outputShape,r=s.length,i=An(r),a=pi("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((w,T)=>`T${T}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][t];const c=o[t],h=o.slice(-2),p=o.join();let m=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${p}), vec2(${h.join()}));
        }`;for(let w=1;w<l.length;w++){const T=l[w-1];m+=`
        if (${c} < ${l[w]}  && ${c} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${jx(o,c,T)}),
            vec2(${jx(h,c,T)}));
        }`}const v=l.length,_=l[l.length-1];m+=`
        return getChannel(
          getT${v}(${jx(o,c,_)}),
          vec2(${jx(h,c,_)}));`,this.userCode=`
      float getValue(${o.map(w=>"int "+w)}) {
        ${m}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${a}), 0., 0., 0.);

        ${a[r-1]} = ${a[r-1]} + 1;
        if (${a[r-1]} < ${s[r-1]}) {
          result.g = getValue(${a});
        }

        ${a[r-2]} = ${a[r-2]} + 1;
        if (${a[r-2]} < ${s[r-2]}) {
          result.a = getValue(${a});
        }

        ${a[r-1]} = ${a[r-1]} - 1;
        if (${a[r-2]} < ${s[r-2]} &&
            ${a[r-1]} < ${s[r-1]}) {
          result.b = getValue(${a});
        }
        setOutput(result);
      }
    `}}function jx(n,e,t){const s=n.indexOf(e);return n.map((i,a)=>a===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KT(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ea({inputs:{x:r.complexTensorInfos.imag},backend:t})}const yMe={kernelName:h$,backendName:"webgl",kernelFunc:KT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iy(n,e,t){const s=n[0].dtype;if(s==="complex64"){const v=n.map(C=>d_({inputs:{input:C},backend:t})),_=n.map(C=>KT({inputs:{input:C},backend:t})),w=Iy(v,e,t),T=Iy(_,e,t),E=ld({inputs:{real:w,imag:T},backend:t});return v.forEach(C=>t.disposeIntermediateTensorInfo(C)),_.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(T),E}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const v=n.map(D=>{const W=[-1,Me(D.shape.slice(e))];return Ze({inputs:{x:D},backend:t,attrs:{shape:W}})}),_=v.map(D=>({vals:t.readSync(D.dataId),shape:D.shape})),w=zl(v.map(D=>D.shape),1),T=v[0].shape[0]===1,E=oLe(_,w,s,T),C=zl(n.map(D=>D.shape),e),A=t.makeTensorInfo(C,s,E);return v.forEach(D=>t.disposeIntermediateTensorInfo(D)),A}const i=n.filter(v=>Me(v.shape)>0),a=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const v=a?new $l(n[0].shape,nh):new mh(n[0].shape,nh);return t.runWebGLProgram(v,n,s)}const o=Re().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>o){const v=[];for(let w=0;w<i.length;w+=o){const T=i.slice(w,w+o);v.push(Iy(T,e,t))}const _=Iy(v,e,t);for(const w of v)t.disposeIntermediateTensorInfo(w);return _}if(a){const v=new gMe(i.map(_=>_.shape),e);return t.runWebGLProgram(v,i,s)}const{tensors2D:l,outShape:c}=vMe(i,e,t),h=new mMe(l.map(v=>v.shape)),p=t.runWebGLProgram(h,l,s);l.forEach(v=>t.disposeIntermediateTensorInfo(v));const m=Ze({inputs:{x:p},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(p),m}function vMe(n,e,t){const s=zl(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Ze({inputs:{x:i},attrs:{shape:[-1,Me(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=Vt(r,e[0].shape)[0],a=e.map(c=>c.shape);dA(a,i);const o=zl(e.map(c=>c.shape),i);if(Me(o)===0)return t.makeTensorInfo(o,e[0].dtype,[]);const l=e.filter(c=>Me(c.shape)>0);return l.length===1?ea({inputs:{x:l[0]},backend:t}):Iy(l,i,t)}const bMe={kernelName:Iw,backendName:"webgl",kernelFunc:o7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l7{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.padInfo.top,o=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,h=e.dilationHeight,p=e.dilationWidth,m=e.filterHeight,v=e.filterWidth,_=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,T=e.dataFormat==="channelsLast",E=T?1:2,C=T?2:3,A=T?3:1;let D="",F="";s&&(r?D=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?D=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:D=`
          float activation(float x) {
            ${s}
          }
        `,F="result = activation(result);");const W=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${D}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${a}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${A}];

        ivec2 xRCCorner =
            ivec2(coords[${E}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${v}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${_}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${T}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${T}) {
                dotProd +=
                    getX(batch, xR, xC, ${_}) *
                    getW(wR, wC, ${_}, d2);
              } else {
                dotProd +=
                    getX(batch, ${_}, xR, xC) *
                    getW(wR, wC, ${_}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${_}, d2),
                getW(wR, wC, ${_} + 1, d2)
              );

              if (${T}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${_}),
                  getX(batch, xR, xC, ${_} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${_}, xR, xC),
                  getX(batch, ${_} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${_}, d2),
                getW(wR, wC, ${_} + 1, d2),
                getW(wR, wC, ${_} + 2, d2)
              );

              if (${T}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${_}),
                  getX(batch, xR, xC, ${_} + 1),
                  getX(batch, xR, xC, ${_} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${_}, xR, xC),
                  getX(batch, ${_} + 1, xR, xC),
                  getX(batch, ${_} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${W}
        ${F}
        setOutput(result);
      }
    `}}class _Me{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,p=e.filterDepth,m=e.filterHeight,v=e.filterWidth,_=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${a}, ${o});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${v}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${_}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${_}) *
                  getW(wF, wR, wC, ${_}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${_}),
                  getX(batch, xF, xR, xC, ${_} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${_}, d2),
                  getW(wF, wR, wC, ${_} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${_}),
                  getX(batch, xF, xR, xC, ${_} + 1),
                  getX(batch, xF, xR, xC, ${_} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${_}, d2),
                  getW(wF, wR, wC, ${_} + 1, d2),
                  getW(wF, wR, wC, ${_} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c7{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Xr(this.outputShape.length);const a=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,p=h;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let T=0;T<h;T++)m+=`
           vec4 xTexelC${T*2};
           int xTexelC${T*2}Ready;
           vec4 xTexelC${T*2+1};
           int xTexelC${T*2+1}Ready;
           vec4 xC${T};`;m+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let T=0;T<h;T++)m+=`
           xTexelC${T*2} = vec4(0.0);
           xTexelC${T*2}Ready = 0;
           xTexelC${T*2+1} = vec4(0.0);
           xTexelC${T*2+1}Ready = 0;
           xC${T} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let T=0;T<(p+1)/2;T++){const E=T*2;if(m+=`
           xC = xCCorner + ${E*l};
           `,o===1){if(E<h&&(a%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E}Ready == 0) {
                   xTexelC${E} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${E}.zw = vec2(0.0);
                   }
                   xTexelC${E}Ready = 1;
                 }
               `,l===1&&E>0?m+=`
                 xC${E} = vec4(xTexelC${E-2}.zw, xTexelC${E}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${E} = vec4(previous.zw, xTexelC${E}.xy);
                   } else {
                     xC${E} = vec4(0.0, 0.0, xTexelC${E}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${E}Ready == 0) {
                   xTexelC${E} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${E}.zw = vec2(0.0);
                   }
                   xTexelC${E}Ready = 1;
                 }

                 xC${E} = xTexelC${E};
                 `,E+1<h)){const C=a%2===0?M2(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E+1}Ready == 0) {
                     xTexelC${E+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${E+1}.zw = vec2(0.0);
                     }
                     xTexelC${E+1}Ready = 1;
                   }
                   `,l>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${E+1} = vec4(previous.zw, xTexelC${E+1}.xy);
                     } else {
                      xC${E+1} = vec4(0.0, 0.0, xTexelC${E+1}.xy);
                     }
                     `:m+=`
                     xC${E+1} = vec4(xTexelC${E}.zw, xTexelC${E+1}.xy);
                     `):C===1?m+=`
                     xC${E+1} = xTexelC${E};
                     `:m+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E+1}Ready == 0) {
                       xTexelC${E+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${E+1}.zw = vec2(0.0);
                       }
                       xTexelC${E+1}Ready = 1;
                     }

                     xC${E+1} = xTexelC${E+1};
                     `}}else E<h&&(a%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E}Ready == 0) {
                   xTexelC${E} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${E}.zw = vec2(0.0);
                   }
                   xTexelC${E}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${E+1}Ready == 0) {
                   xTexelC${E+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${E+1}.zw = vec2(0.0);
                   }
                   xTexelC${E+1}Ready = 1;
                 }

                 xC${E} = vec4(xTexelC${E}.zw, xTexelC${E+1}.zw);
               `,E+1<h&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${E+1} = vec4(xTexelC${E+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${E}Ready == 0) {
                   xTexelC${E} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${E}.zw = vec2(0.0);
                   }
                   xTexelC${E}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E+1}Ready == 0) {
                   xTexelC${E+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${E+1}.zw = vec2(0.);
                   }
                   xTexelC${E+1}Ready = 1;
                 }

                 xC${E} = vec4(
                   xTexelC${E}.xy, xTexelC${E+1}.xy);
               `,E+1<h&&(m+=`
                   xC${E+1} = vec4(xTexelC${E}.zw, xTexelC${E+1}.zw);
                 `)));E<h&&(m+=`
             wTexel = getW(r, ${E}, d1, d2);
             dotProd += xC${E}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${E}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,E+1<h&&(m+=`
               wTexel = getW(r, ${E+1}, d1, d2);
               dotProd += xC${E+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${E+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let v="",_="";s&&(r?v=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?v=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:v=`vec4 activation(vec4 x) {
           ${s}
         }`,_="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${v}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${_}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xMe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Xr(this.outputShape.length);const{dataFormat:s}=t,r=bi(),i=s==="channelsLast",a=i?1:2,o=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let h=0;h<=1;h++)for(let p=0;p<=1;p++)c+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${a}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${o}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function u7({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:o=null}){const l=n.shape,c=s.texData.get(n.dataId),h=t.inChannels,p=l[0]*l[1]*l[2],m=t.outChannels,v=t.dataFormat==="channelsLast",_=!1,w=!1;let T;const E=[];if(i!=null){const D=T1(i.shape,v);D!=null&&(i=Ze({inputs:{x:i},backend:s,attrs:{shape:D}}),E.push(i))}if(r!=null){const D=T1(r.shape,v);D!=null&&(r=Ze({inputs:{x:r},backend:s,attrs:{shape:D}}),E.push(r))}if(!((p===1||m===1)&&h>n7)&&c.isPacked&&v&&c.texture!=null&&l[2]%2!==0&&xn(c.shape.slice(-3),l.slice(-3))){const D=l[0]*l[1]*(l[2]+1),F={dataId:n.dataId,shape:[1,D,t.inChannels],dtype:n.dtype},W=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,te(x1(c.shape,F.shape),()=>`packed reshape ${c.shape} to ${F.shape} isn't free`);const B=Ze({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});E.push(B);const P=w1({a:F,b:B,backend:s,transposeA:_,transposeB:w,bias:r,activation:o,preluActivationWeights:i,leakyreluAlpha:a}),O=s.texData.get(P.dataId);te(O.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=W,O.shape=t.outShape,T=ea({inputs:{x:P},backend:s}),T.shape=t.outShape,E.push(P)}else{const D=t.outHeight*t.outWidth,F=Ze({inputs:{x:n},backend:s,attrs:{shape:v?[t.batchSize,D,t.inChannels]:[t.batchSize,t.inChannels,D]}}),W=Ze({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),B=w1({a:v?F:W,b:v?W:F,transposeA:!v,transposeB:w,backend:s,bias:r,activation:o,preluActivationWeights:i,leakyreluAlpha:a});T=Ze({inputs:{x:B},backend:s,attrs:{shape:t.outShape}}),E.push(F),E.push(W),E.push(B)}for(const D of E)s.disposeIntermediateTensorInfo(D);return T}function h7({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:o=null}){const{filterWidth:l,filterHeight:c,inChannels:h,outWidth:p,outHeight:m,dataFormat:v}=t,_=v==="channelsLast",w=l*c*h,T=m*p,E=[t.batchSize,w,T],C=!0,A=!1,D=[];if(i!=null){const ne=T1(i.shape,_);ne!=null&&(i=Ze({inputs:{x:i},backend:s,attrs:{shape:ne}}),D.push(i))}if(r!=null){const ne=T1(r.shape,_);ne!=null&&(r=Ze({inputs:{x:r},backend:s,attrs:{shape:ne}}),D.push(r))}const F=Ze({inputs:{x:e},backend:s,attrs:{shape:[1,w,Me(e.shape)/w]}});D.push(F);const W=new xMe(E,t),B=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],P=s.runWebGLProgram(W,[n],"float32",B),O=Ze({inputs:{x:P},backend:s,attrs:{shape:E}});D.push(P),D.push(O);const M=r!=null,k=i!=null,V=o==="leakyrelu",G=o?gv(o,!0):null,ae=new t7(_?O.shape:F.shape,_?F.shape:O.shape,_?[t.batchSize,T,t.outChannels]:[t.batchSize,t.outChannels,T],C,A,M,G,k,V),J=_?[O,F]:[F,O];if(r&&J.push(r),k&&J.push(i),V){const ne=s.makeTensorInfo([],"float32",ed(a,"float32"));J.push(ne),D.push(ne)}const X=s.runWebGLProgram(ae,J,"float32"),se=Ze({inputs:{x:X},backend:s,attrs:{shape:t.outShape}});D.push(X);for(const ne of D)s.disposeIntermediateTensorInfo(ne);return se}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dataFormat:l,dilations:c,dimRoundingMode:h}=s,p=iu(l),m=Er(r.shape,i.shape,a,c,o,h,!1,p);let v;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))v=u7({x:r,filter:i,convInfo:m,backend:t});else if(m.strideWidth<=2&&p==="channelsLast"&&Re().getBool("WEBGL_EXP_CONV")){const w=new c7(m),T=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];v=t.runWebGLProgram(w,[r,i],"float32",T)}else if(Re().getBool("WEBGL_CONV_IM2COL"))v=h7({x:r,filter:i,convInfo:m,backend:t});else{const w=new l7(m);v=t.runWebGLProgram(w,[r,i],"float32")}const _=Ze({inputs:{x:v},backend:t,attrs:{shape:m.outShape}});return t.disposeIntermediateTensorInfo(v),_}const TMe={kernelName:Cw,backendName:"webgl",kernelFunc:wMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SMe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${a?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class EMe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dataFormat==="channelsLast",o=t-1-e.padInfo.top,l=s-1-e.padInfo.left,c=a?1:2,h=a?2:3,p=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${a}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class NMe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${a};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${o};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class IMe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,l=t-1-e.padInfo.front,c=s-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${a}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:h}=s,p=iu(l),m=Er(r.shape,h,a,1,o,c,!1,p),v=new SMe(m);return t.runWebGLProgram(v,[r,i],"float32")}const kMe={kernelName:Z2,backendName:"webgl",kernelFunc:CMe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Me{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Xr(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AMe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:h}=s,p=iu(c),m=Er(a,i.shape,o,1,l,h,!1,p);if(Re().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){const v=[[m.strideHeight,m.strideWidth]],_=new $Me(m);return t.runWebGLProgram(_,[r,i],"float32",v)}else{const v=new EMe(m);return t.runWebGLProgram(v,[r,i],"float32")}}const RMe={kernelName:kw,backendName:"webgl",kernelFunc:AMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dilations:l}=s,c=td(r.shape,i.shape,a,l,o),h=new _Me(c);return t.runWebGLProgram(h,[r,i],"float32")}const LMe={kernelName:$w,backendName:"webgl",kernelFunc:DMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:a,pad:o,filterShape:l}=s,c=td(r.shape,l,a,1,o),h=new NMe(c);return t.runWebGLProgram(h,[r,i],"float32")}const PMe={kernelName:Y2,backendName:"webgl",kernelFunc:OMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MMe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:a,strides:o,inputShape:l}=s,c=td(l,i.shape,o,1,a),h=new IMe(c);return t.runWebGLProgram(h,[r,i],"float32")}const FMe={kernelName:Q2,backendName:"webgl",kernelFunc:MMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jMe=fg+`
  return cos(x);
`,BMe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Jf}
  return result;
`,zMe=cn({opSnippet:jMe,packedOpSnippet:BMe}),VMe={kernelName:ob,backendName:"webgl",kernelFunc:zMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UMe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,GMe=cn({opSnippet:UMe}),WMe={kernelName:lb,backendName:"webgl",kernelFunc:GMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HMe{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,o,l,c]=e,[h]=t,[p,m]=s;this.outputShape=[h,p,m,c];const v=r==="bilinear"?1:0,[_,w]=[`${o-1}.0`,`${l-1}.0`],[T,E,C]=p>1?[`${(o-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${_} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${_}`],[A,D,F]=m>1?[`${(l-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${T});
      const float width_ratio = float(${A});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${a}) {
          return;
        }

        float height_scale = ${E};
        float width_scale = ${D};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${_} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${F};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${v} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qMe=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:a}=e,{cropSize:o,method:l,extrapolationValue:c}=s,h=new HMe(r.shape,i.shape,o,l,c);return t.runWebGLProgram(h,[r,i,a],"float32")},KMe={kernelName:e$,backendName:"webgl",kernelFunc:qMe};var vv;(function(n){n.Prod="*",n.Sum="+"})(vv||(vv={}));class aF{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,a=this.op===vv.Prod?"1.0":"0.0",o=s?a:`getX(${oF(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",h="";s?(c=r?`end != ${l-1}`:"end != 0",h=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${An(i)} coords = getOutputCoords();
        int end = ${lF(i,"coords",this.op)};
        float val = ${o};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${h};
          ${lF(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${oF(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function oF(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function lF(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(n,e,t,s,r,i){const a=e.shape.length,o=fs([s],a);let l=e;o!=null&&(l=yi({inputs:{x:e},backend:t,attrs:{perm:o}}));const c=Is(1,a)[0];if(c!==a-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const h=l.shape[c];let p=ea({inputs:{x:l},backend:t});for(let m=0;m<=Math.ceil(Math.log2(h))-1;m++){const v=new aF(n,l.shape,!1,i),_=[[m]],w=p;p=t.runWebGLProgram(v,[p],p.dtype,_),t.disposeIntermediateTensorInfo(w)}if(r){const m=new aF(n,l.shape,r,i),v=p;p=t.runWebGLProgram(m,[p],p.dtype),t.disposeIntermediateTensorInfo(v)}if(o!=null){const m=nd(o),v=yi({inputs:{x:p},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(l),v}return p}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:a,reverse:o}=s;return d7(vv.Prod,r,t,i,a,o)}const ZMe={kernelName:J2,backendName:"webgl",kernelFunc:XMe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:a,reverse:o}=s;return d7(vv.Sum,r,t,i,a,o)}const QMe={kernelName:Aw,backendName:"webgl",kernelFunc:YMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:a,binaryOutput:o}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),c=t.readSync(i.dataId),h=HK(l,c,i.dtype,i.shape,a);return t.makeTensorInfo([a],i.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(i),h=sLe(l,c,a,o);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const e3e={kernelName:t$,backendName:"webgl",kernelFunc:JMe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t3e{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n3e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:a}=s,o=r.shape[0],l=a==="NHWC"?r.shape[1]:r.shape[2],c=a==="NHWC"?r.shape[2]:r.shape[3],h=a==="NHWC"?r.shape[3]:r.shape[1],p=l*i,m=c*i,v=h/(i*i),_=a==="NHWC"?[o,p,m,v]:[o,v,p,m],w=new t3e(_,i,a);return t.runWebGLProgram(w,[r],r.dtype)}const s3e={kernelName:n$,backendName:"webgl",kernelFunc:n3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f7{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Xr(this.outputShape.length);const a=e.filterHeight,o=e.filterWidth,l=e.outChannels/e.inChannels;let c="",h="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${a}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${o}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p7{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Xr(this.outputShape.length);const a=e.outChannels/e.inChannels,o=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,m=p;let v=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let E=0;E<p;E++)v+=`
          vec4 xTexelC${E*2};
          int xTexelC${E*2}Ready;
          vec4 xTexelC${E*2+1};
          int xTexelC${E*2+1}Ready;
          vec4 xC${E};`;v+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let E=0;E<p;E++)v+=`
          xTexelC${E*2} = vec4(0.0);
          xTexelC${E*2}Ready = 0;
          xTexelC${E*2+1} = vec4(0.0);
          xTexelC${E*2+1}Ready = 0;
          xC${E} = vec4(0.0);`;v+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let E=0;E<(m+1)/2;E++){const C=E*2;if(v+=`
          xC = xCCorner + ${C*c};
          `,l===1){if(C<p&&(o%2===1?(v+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,c===1&&C>0?v+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:v+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):v+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<p)){const A=o%2===0?M2(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(v+=`
                  xCOffset = xC + imod(pads[1], 2) + ${A};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,c>1?v+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:v+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):A===1?v+=`
                    xC${C+1} = xTexelC${C};
                    `:v+=`
                    xCOffset = xC + ${A};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<p&&(o%2===1?(v+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<p&&(v+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<p&&(v+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<p&&(v+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<p&&(v+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}v+=`
    }
  `,v+=`
      }
    `;let _="",w="";s&&(r?_=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?_=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:_=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const T=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${_}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${a};
        int q = d2 - d1 * ${a};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${v}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${T}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dilations:l,dimRoundingMode:c}=s;let h=l;h==null&&(h=[1,1]),te(qr(a,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${h}'`);const p=Er(r.shape,i.shape,a,h,o,c,!0);let m;Re().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?m=new p7(p):m=new f7(p);const v=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return t.runWebGLProgram(m,[r,i],"float32",v)}const i3e={kernelName:Rw,backendName:"webgl",kernelFunc:r3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a3e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${a} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class o3e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l3e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:c,filterShape:h}=s,p=Er(r.shape,h,a,o,l,c,!0),m=new a3e(p);return t.runWebGLProgram(m,[r,i],"float32")}const c3e={kernelName:s$,backendName:"webgl",kernelFunc:l3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u3e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:c,inputShape:h}=s,p=Er(h,i.shape,a,o,l,c,!0),m=new o3e(p);return t.runWebGLProgram(m,[r,i],"float32")}const h3e={kernelName:r$,backendName:"webgl",kernelFunc:u3e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d3e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f3e(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=Me(s.shape),a=Ze({inputs:{x:s},backend:t,attrs:{shape:[i]}}),o=new d3e(i),l=t.runWebGLProgram(o,[a],a.dtype),c=Ze({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const p3e={kernelName:JW,backendName:"webgl",kernelFunc:f3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m3e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:a,filterHeight:o,filterWidth:l,dilationHeight:c,dilationWidth:h}=e,{top:p,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${a});
      const ivec2 pads = ivec2(${p}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${o}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g3e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:a,pad:o,dilations:l}=s,c=Hb(r.shape,i.shape,a,o,"NHWC",l);let h;const p=new m3e(c);h=t.runWebGLProgram(p,[r,i],"float32");const m=Ze({inputs:{x:h},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(h),m}const y3e={kernelName:Dw,backendName:"webgl",kernelFunc:g3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3e(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:a,summedDims:o,idDims:l}=SA(r,i.length);NA(a.length,l,i);const{path:c,steps:h}=IA(o,l),p=h.length;let m=null,v=a.length;const _=[];for(let w=0;w<p;++w){for(const T of h[w]){const{permutationIndices:E,expandDims:C}=EA(v,l[T]);let A;CA(E)?A=i[T]:(A=yi({inputs:{x:i[T]},backend:t,attrs:{perm:E}}),_.push(A));const D=A.shape.slice();for(let F=0;F<C.length;++F)D.splice(C[F],0,1);xn(A.shape,D)||(A=Ze({inputs:{x:A},backend:t,attrs:{shape:D}}),_.push(A)),m===null?m=A:(m=pR({inputs:{a:A,b:m},backend:t}),_.push(m))}w<p-1&&(c[w]>=0&&(m=qT({inputs:{x:m},backend:t,attrs:{axis:c[w]-(a.length-v),keepDims:!1}}),_.push(m)),v--)}for(const w of _)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const b3e={kernelName:i$,backendName:"webgl",kernelFunc:v3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _3e="return (x >= 0.0) ? x : (exp(x) - 1.0);",x3e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,w3e=cn({opSnippet:_3e,packedOpSnippet:x3e}),T3e={kernelName:ub,backendName:"webgl",kernelFunc:w3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S3e="return (b >= 0.0) ? a : a * (b + 1.0);",E3e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,N3e=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=Re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dg(E3e,s.shape,r.shape):new jf(S3e,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},I3e={kernelName:a$,backendName:"webgl",kernelFunc:N3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3e=`
  return vec4(equal(a, b));
`,k3e="return float(a == b);",$3e=Ir({opSnippet:k3e,packedOpSnippet:C3e,dtype:"bool",cpuKernelImpl:lLe}),A3e={kernelName:Lw,backendName:"webgl",kernelFunc:$3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R3e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${yA};
  float a1 = ${vA};
  float a2 = ${bA};
  float a3 = ${_A};
  float a4 = ${xA};
  float a5 = ${wA};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,D3e=cn({opSnippet:R3e}),L3e={kernelName:hb,backendName:"webgl",kernelFunc:D3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3e=fg+`
  return exp(x);
`,P3e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,m7=cn({opSnippet:O3e,packedOpSnippet:P3e,cpuKernelImpl:cLe,dtype:"float32"}),M3e={kernelName:db,backendName:"webgl",kernelFunc:m7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vC(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,a=i.shape.length,o=i.shape.slice();let l=r;return r<0&&(te(-(a+1)<=r,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+r+1),o.splice(l,0,1),Ze({inputs:{x:i},backend:s,attrs:{shape:o}})}const F3e={kernelName:Ow,backendName:"webgl",kernelFunc:vC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cF="return exp(x) - 1.0;",j3e=cn({opSnippet:cF,packedOpSnippet:cF,cpuKernelImpl:uLe}),B3e={kernelName:fb,backendName:"webgl",kernelFunc:j3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uF{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,a=s?`${r}.0`:"1.0";let o;if(e==="real")o="return real * expR - imag * expI;";else if(e==="imag")o="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${o}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${a};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(n,e,t){const s=t.texData.get(n.dataId),r=Me(n.shape),i=n.shape[n.shape.length-1],a=r/i,o=Ze({inputs:{x:n},backend:t,attrs:{shape:[a,i]}}),l=o.shape,c=new uF("real",l,e),h=new uF("imag",l,e),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],m=t.runWebGLProgram(c,p,"float32"),v=t.runWebGLProgram(h,p,"float32"),_=ld({inputs:{real:m,imag:v},backend:t});t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v);const w=Ze({inputs:{x:_},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(_),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3e(n){const{inputs:e,backend:t}=n,{input:s}=e;return g7(s,!1,t)}const V3e={kernelName:o$,backendName:"webgl",kernelFunc:z3e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U3e{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||Qm(r),i==="string"){const a=ws(i,Me(s));return a.fill(r),e.makeTensorInfo(s,i,a)}else{const a=new U3e(s,r),o=[[r]];return e.runWebGLProgram(a,[],i,o)}}const G3e={kernelName:l$,backendName:"webgl",kernelFunc:f_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W3e{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3e={kernelName:c$,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new W3e(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hF="return floor(x);",q3e=cn({opSnippet:hF,packedOpSnippet:hF,cpuKernelImpl:hLe}),K3e={kernelName:pb,backendName:"webgl",kernelFunc:q3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X3e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Z3e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Y3e=Ir({opSnippet:X3e,packedOpSnippet:Z3e,dtype:"int32"}),Q3e={kernelName:mb,backendName:"webgl",kernelFunc:Y3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J3e{constructor(e){this.variableNames=["A"];const t=bi(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eFe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=bi(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tFe={kernelName:Ove,backendName:"webgl",kernelFunc:nFe};let Bp,EN=Re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function nFe(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,a=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,o=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=[c,l],p=[c,l,i];if(o||a){const w=Re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Bp==null||w!==EN)&&(EN=w,Bp=document.createElement("canvas").getContext("2d",{willReadFrequently:EN})),Bp.canvas.width=l,Bp.canvas.height=c,Bp.drawImage(r,0,0,l,c),r=Bp.canvas}const m=t.makeTensorInfo(h,"int32");t.texData.get(m.dataId).usage=Na.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),r);const v=Re().getBool("WEBGL_PACK")?new eFe(p):new J3e(p),_=t.runWebGLProgram(v,[m],"int32");return t.disposeData(m.dataId),_}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:a,preluActivationWeights:o}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:m,activation:v,leakyreluAlpha:_}=s,w=iu(h),T=Er(r.shape,i.shape,l,p,c,m,!1,w);let E;const C=[],A=a!=null,D=o!=null,F=v==="leakyrelu",W=()=>{const P=[r,i],O=(M,k)=>{if(k==="NCHW"&&M.shape.length===1&&M.shape[0]!==1){const V=Ze({inputs:{x:M},backend:t,attrs:{shape:[M.shape[0],1,1]}});return C.push(V),V}return M};if(A&&P.push(O(a,h)),D&&P.push(O(o,h)),F){const M=t.makeTensorInfo([],"float32",ed(_,"float32"));P.push(M),C.push(M)}return P};if(T.filterHeight===1&&T.filterWidth===1&&T.dilationHeight===1&&T.dilationWidth===1&&T.strideHeight===1&&T.strideWidth===1&&(T.padInfo.type==="SAME"||T.padInfo.type==="VALID"))E=u7({x:r,filter:i,convInfo:T,backend:t,bias:a,activation:v,preluActivationWeights:o,leakyreluAlpha:_});else if(T.strideWidth<=2&&w==="channelsLast"&&Re().getBool("WEBGL_EXP_CONV")){const P=v?gv(v,!0):null,O=new c7(T,A,P,D,F),M=[[T.padInfo.top,T.padInfo.left],[T.strideHeight,T.strideWidth],[T.dilationHeight,T.dilationWidth],[T.inHeight,T.inWidth]],k=W();E=t.runWebGLProgram(O,k,"float32",M)}else if(Re().getBool("WEBGL_CONV_IM2COL"))E=h7({x:r,filter:i,convInfo:T,backend:t,bias:a,activation:v,preluActivationWeights:o,leakyreluAlpha:_});else{const P=v?gv(v,!1):null,O=new l7(T,A,P,D,F),M=W();E=t.runWebGLProgram(O,M,"float32")}const B=Ze({inputs:{x:E},backend:t,attrs:{shape:T.outShape}});return C.push(E),C.forEach(P=>t.disposeIntermediateTensorInfo(P)),B}const rFe={kernelName:J0,backendName:"webgl",kernelFunc:sFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:a,preluActivationWeights:o}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:v}=s,_=[];let w=h;w==null&&(w=[1,1]),te(qr(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const T=Er(r.shape,i.shape,l,w,c,p,!0),E=Re().getBool("WEBGL_PACK_DEPTHWISECONV")&&T.strideWidth<=2&&T.outChannels/T.inChannels===1,C=m?gv(m,E):null,A=[r,i],D=a!=null,F=o!=null,W=m==="leakyrelu";if(D&&A.push(a),F&&A.push(o),W){const M=t.makeTensorInfo([],"float32",ed(v,"float32"));A.push(M),_.push(M)}let B;E?B=new p7(T,D,C,F,W):B=new f7(T,D,C,F,W);const P=[[T.padInfo.top,T.padInfo.left],[T.strideHeight,T.strideWidth],[T.dilationHeight,T.dilationWidth],[T.inHeight,T.inWidth]],O=t.runWebGLProgram(B,A,"float32",P);return _.forEach(M=>t.disposeIntermediateTensorInfo(M)),O}const aFe={kernelName:v5,backendName:"webgl",kernelFunc:iFe};class oFe{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=An(s.length);let a=`
    int index;`;for(let o=0;o<this.sliceDim;o++)a+=`
          index = round(getIndices(coords[0], ${o}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[o]};
          flattenIndex += index * ${this.strides[o]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${a}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lFe(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,a=i[i.length-1],o=Me(s.shape),[l,c,h,p]=aA(s,r),m=Ze({inputs:{x:r},backend:t,attrs:{shape:[c,a]}}),v=Ze({inputs:{x:s},backend:t,attrs:{shape:[Me(s.shape)/h,h]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const E=t.readSync(r.dataId),C=t.bufferSync(s),A=dLe(E,C,s.dtype,c,a,h,p,s.shape,o);return t.makeTensorInfo(l,s.dtype,A.values)}const _=new oFe(a,p,[c,h],s.shape),w=t.runWebGLProgram(_,[v,m],v.dtype),T=Ze({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),T}const cFe={kernelName:e5,backendName:"webgl",kernelFunc:lFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uFe{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=An(this.rank),r=hFe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function hFe(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:a,batchDims:o}=s,l=Vt(a,r.shape)[0];if(Re().get("DEBUG")){const C=t.readSync(i.dataId),A=r.shape[l];for(let D=0;D<C.length;++D){const F=C[D];te(F<=A-1&&F>=0,()=>`GatherV2: the index value ${F} is not in [0, ${A-1}]`)}}const c=$A(r,i,l,o),h=Me(i.shape),p=[],m=Ze({inputs:{x:r},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),v=Ze({inputs:{x:i},backend:t,attrs:{shape:[c.batchSize,h/c.batchSize]}});p.push(m),p.push(v);const _=[c.batchSize,c.outerSize,h/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const C=t.bufferSync(v),A=t.bufferSync(m),D=fLe(A,C,_);return p.forEach(F=>t.disposeIntermediateTensorInfo(F)),t.makeTensorInfo(c.outputShape,D.dtype,D.values)}const w=new uFe(m.shape,_),T=t.runWebGLProgram(w,[m,v],m.dtype);p.push(T);const E=Ze({inputs:{x:T},backend:t,attrs:{shape:c.outputShape}});return p.forEach(C=>t.disposeIntermediateTensorInfo(C)),E}const dFe={kernelName:Mw,backendName:"webgl",kernelFunc:y7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fFe="return float(a > b);",pFe=`
  return vec4(greaterThan(a, b));
`,mFe=Ir({opSnippet:fFe,packedOpSnippet:pFe,cpuKernelImpl:pLe,dtype:"bool"}),gFe={kernelName:Fw,backendName:"webgl",kernelFunc:mFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yFe="return float(a >= b);",vFe=`
  return vec4(greaterThanEqual(a, b));
`,bFe=Ir({opSnippet:yFe,packedOpSnippet:vFe,dtype:"bool",cpuKernelImpl:mLe}),_Fe={kernelName:gb,backendName:"webgl",kernelFunc:bFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xFe(n){const{inputs:e,backend:t}=n,{input:s}=e;return g7(s,!0,t)}const wFe={kernelName:u$,backendName:"webgl",kernelFunc:xFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TFe="return float(!isnan(x) && !isinf(x));",SFe=cn({opSnippet:TFe,dtype:"bool"}),EFe={kernelName:vb,backendName:"webgl",kernelFunc:SFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NFe="return float(isinf(x));",IFe=cn({opSnippet:NFe,dtype:"bool"}),CFe={kernelName:bb,backendName:"webgl",kernelFunc:IFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kFe="return float(isnan(x));",$Fe=cn({opSnippet:kFe,dtype:"bool"}),AFe={kernelName:_b,backendName:"webgl",kernelFunc:$Fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RFe="return float(a < b);",DFe=`
  return vec4(lessThan(a, b));
`,LFe=Ir({opSnippet:RFe,packedOpSnippet:DFe,cpuKernelImpl:gLe,dtype:"bool"}),OFe={kernelName:Bw,backendName:"webgl",kernelFunc:LFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PFe="return float(a <= b);",MFe=`
  return vec4(lessThanEqual(a, b));
`,FFe=Ir({opSnippet:PFe,packedOpSnippet:MFe,cpuKernelImpl:yLe,dtype:"bool"}),jFe={kernelName:zw,backendName:"webgl",kernelFunc:FFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BFe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,a=vLe(s,r,i);return e.makeTensorInfo([a.length],"float32",a)}const zFe={kernelName:t5,backendName:"webgl",kernelFunc:BFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VFe=fg+`
  return x < 0.0 ? 0./0. : log(x);
`,UFe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,GFe=cn({opSnippet:VFe,packedOpSnippet:UFe,cpuKernelImpl:bLe}),WFe={kernelName:xb,backendName:"webgl",kernelFunc:GFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HFe=fg+`
  return log(1.0 + x);
`,qFe=cn({opSnippet:HFe}),KFe={kernelName:wb,backendName:"webgl",kernelFunc:qFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XFe="return float(a >= 1.0 && b >= 1.0);",ZFe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,YFe=Ir({opSnippet:XFe,packedOpSnippet:ZFe,dtype:"bool"}),QFe={kernelName:Vw,backendName:"webgl",kernelFunc:YFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JFe="return float(!(x >= 1.0));",eje=cn({opSnippet:JFe}),tje={kernelName:Uw,backendName:"webgl",kernelFunc:eje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nje="return float(a >= 1.0 || b >= 1.0);",sje=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,rje=Ir({opSnippet:nje,packedOpSnippet:sje,dtype:"bool"}),ije={kernelName:Gw,backendName:"webgl",kernelFunc:rje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aje{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const a=t,o=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${a}; j <= ${a}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${o}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oje{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,o=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${a};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${a}; j <= ${a}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lje=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:a,alpha:o,beta:l}=s,c=Re().getBool("WEBGL_PACK_NORMALIZATION")?new oje(r.shape,i,a,o,l):new aje(r.shape,i,a,o,l);return t.runWebGLProgram(c,[r],r.dtype)},cje={kernelName:Ww,backendName:"webgl",kernelFunc:lje};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uje{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hje=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:a}=e,{depthRadius:o,bias:l,alpha:c,beta:h}=s,p=new uje(r.shape,o,l,c,h);return t.runWebGLProgram(p,[r,i,a],r.dtype)},dje={kernelName:d$,backendName:"webgl",kernelFunc:hje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fje(n,e,t,s){const r=Me(e),a=Me(n.shape)/r,o=Ze({inputs:{x:n},attrs:{shape:[a,r]},backend:s}),l=ep(o,n.dtype,"max",s),c=Ze({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:a}=s,o=r.shape.length,l=Vt(i,r.shape);let c=l;const h=fs(c,o),p=h!=null,m=t.shouldExecuteOnCPU([r]);let v=r;if(p){if(m){const A=t.texData.get(v.dataId).values,D=new Array(o);for(let B=0;B<D.length;B++)D[B]=r.shape[h[B]];const F=dR(A,r.shape,r.dtype,h,D);v=t.makeTensorInfo(D,r.dtype);const W=t.texData.get(v.dataId);W.values=F}else v=HT(r,h,t);c=Is(c.length,o)}Nr("max",c,o);const[_,w]=fr(v.shape,c);let T=_;a&&(T=Bs(_,l));let E;if(m){const A=t.texData.get(v.dataId).values,D=_Le(A,Me(w),T,r.dtype);E=t.makeTensorInfo(T,r.dtype);const F=t.texData.get(E.dataId);F.values=D}else E=fje(v,w,T,t);return p&&t.disposeIntermediateTensorInfo(v),E}const pje={kernelName:Hw,backendName:"webgl",kernelFunc:v7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mje=fR+`
  return max(a, b);
`,gje=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jf+`
  return result;
`,yje=Ir({opSnippet:mje,packedOpSnippet:gje,cpuKernelImpl:xLe}),vje={kernelName:Tb,backendName:"webgl",kernelFunc:yje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bje(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;u_(r,"maxPool");const{filterSize:i,strides:a,pad:o,dimRoundingMode:l}=s,c=1;te(qr(a,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=ho(r.shape,i,a,c,o,l);if(h.filterWidth===1&&h.filterHeight===1&&xn(h.inShape,h.outShape))return ea({inputs:{x:r},backend:t});const p=new yv(h,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const _je={kernelName:qw,backendName:"webgl",kernelFunc:bje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xje(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:a,pad:o,dataFormat:l,dimRoundingMode:c}=s,h=[1,1,1],p=ru(r.shape,i,a,h,o,c,l),m=new mR(p,"max",!1);return t.runWebGLProgram(m,[r],r.dtype)}const wje={kernelName:Kw,backendName:"webgl",kernelFunc:xje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tje{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,l=a-1-e.padInfo.left,c=i*a-1;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${a}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${a} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Sje{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=l-1-e.padInfo.front,m=c-1-e.padInfo.top,v=h-1-e.padInfo.left,_=l*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${a}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${o}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${_} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eje(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,a=i,{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=s,p=[1,1,1],m=ru(a.shape,o,l,p,c,h),v=new mR(m,"max",!0),_=t.runWebGLProgram(v,[a],a.dtype),w=new Sje(m),T=t.runWebGLProgram(w,[r,_],a.dtype);return t.disposeIntermediateTensorInfo(_),T}const Nje={kernelName:p$,backendName:"webgl",kernelFunc:Eje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ije(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:a}=e,o=i;u_([i,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:p}=s,m=ho(o.shape,l,c,1,h,p),v=!0,_=new yv(m,"max",v),w=t.runWebGLProgram(_,[o],o.dtype),T=new Tje(m),E=t.runWebGLProgram(T,[r,w],o.dtype);return t.disposeIntermediateTensorInfo(w),E}const Cje={kernelName:f$,backendName:"webgl",kernelFunc:Ije};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kje(n,e,t,s){let r=new yv(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new yv(t,"max",!0,!0,e);const a=s.runWebGLProgram(r,[n],"float32");return[i,a]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $je={kernelName:n5,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:a,includeBatchInIndex:o}=e,l=t;te(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];te(qr(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const h=ho(s.shape,r,i,c,a),[p,m]=kje(s,o,h,l);return[p,m]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aje(n,e,t,s){const r=Me(e),a=Me(n.shape)/r,o=Ze({inputs:{x:n},attrs:{shape:[a,r]},backend:s}),l=ep(o,"float32","mean",s),c=Ze({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rje={kernelName:Xw,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,a=t,o=s.shape.length,l=Vt(i,s.shape);let c=l;const h=fs(c,o),p=h!=null,m=a.shouldExecuteOnCPU([s]),v=[];let _=s;if(p){if(m){const D=a.texData.get(_.dataId).values,F=new Array(o);for(let P=0;P<F.length;P++)F[P]=s.shape[h[P]];const W=dR(D,s.shape,s.dtype,h,F);_=a.makeTensorInfo(F,s.dtype);const B=a.texData.get(_.dataId);B.values=W}else _=HT(s,h,a);v.push(_),c=Is(c.length,o)}Nr("sum",c,o);const[w,T]=fr(_.shape,c);let E=w;r&&(E=Bs(w,l));const C=Aje(_,T,E,a);for(const A of v)a.disposeIntermediateTensorInfo(A);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dje(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s,o=r.shape.length,l=Vt(i,r.shape);let c=l;const h=fs(c,o);let p=r;h!=null&&(p=yi({inputs:{x:r},backend:t,attrs:{perm:h}}),c=Is(c.length,r.shape.length)),Nr("min",c,o);const[m,v]=fr(p.shape,c),_=Me(v),w=Ze({inputs:{x:p},backend:t,attrs:{shape:[-1,_]}}),T=ep(w,w.dtype,"min",t);let E;if(a){const C=Bs(m,l);E=Ze({inputs:{x:T},backend:t,attrs:{shape:C}})}else E=Ze({inputs:{x:T},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(T),h!=null&&t.disposeIntermediateTensorInfo(p),E}const Lje={kernelName:Zw,backendName:"webgl",kernelFunc:Dje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oje=fR+`
  return min(a, b);
`,Pje=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Jf+`
  return result;
`,Mje=Ir({opSnippet:Oje,packedOpSnippet:Pje,cpuKernelImpl:wLe}),Fje={kernelName:Sb,backendName:"webgl",kernelFunc:Mje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jje{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((h,p)=>h[0]+e[p]+h[1]);const r=e.length,i=An(r),a=t.map(h=>h[0]).join(","),o=t.map((h,p)=>h[0]+e[p]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${a};
        int end = ${o};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${a});
      ${i} end = ${i}(${o});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bje{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((_,w)=>_[0]+e[w]+_[1]);const r=e.length,i=An(r),a=t.map(_=>_[0]).join(","),o=t.map((_,w)=>_[0]+e[w]).join(","),l=pi("rc",r),c=pi("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${c.slice(-2).join()})`,m=s==="reflect"?0:1;let v="";if(r===1){const _=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;v=`
        ${i} rc = outputLoc;
        ${_}
        result[0] = getChannel(getX(${c.join()}), ${p});
        ${l[r-1]} += 1;
        if(${h}) {
          ${_}
          result[1] = getChannel(getX(${c.join()}), ${p});
        }
      `}else{const _=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;v=`
        ${i} rc = outputLoc;
        ${_}
        result[0] = getChannel(getX(${c.join()}), ${p});
        ${l[r-1]} += 1;
        if(${h}) {
          ${_}
          result[1] = getChannel(getX(${c.join()}), ${p});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${_}
          result[2] = getChannel(getX(${c.join()}), ${p});
          ${l[r-1]} += 1;
          if(${h}) {
            ${_}
            result[3] = getChannel(getX(${c.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${a});
      const ${i} end = ${i}(${o});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zje=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,a=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Bje(s.shape,r,i):new jje(s.shape,r,i);return e.runWebGLProgram(a,[s],s.dtype)},Vje={kernelName:Yw,backendName:"webgl",kernelFunc:zje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uje=`if (b == 0.0) return NAN;
  return mod(a, b);`,Gje=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Jf+`
  return result;
`,Wje=Ir({opSnippet:Uje,packedOpSnippet:Gje}),Hje={kernelName:Eb,backendName:"webgl",kernelFunc:Wje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qje{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kje=`
if (a == b) {
  return 1.0;
};
return a / b;`,Xje=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,b7=Ir({opSnippet:Kje,packedOpSnippet:Xje,checkOutOfBounds:!0}),Zje={kernelName:cb,backendName:"webgl",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dF="return a - b;",_7=Ir({opSnippet:dF,packedOpSnippet:dF,supportsComplex:!0,cpuKernelImpl:ULe}),Yje={kernelName:zb,backendName:"webgl",kernelFunc:_7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,a=Vt([i],r.shape),o=v7({inputs:{x:r},backend:t,attrs:{reductionIndices:a,keepDims:!1}}),l=Bs(o.shape,a),c=Ze({inputs:{x:o},backend:t,attrs:{shape:l}}),h=_7({inputs:{a:r,b:c},backend:t}),p=m7({inputs:{x:h},backend:t}),m=qT({inputs:{x:p},backend:t,attrs:{axis:a,keepDims:!1}}),v=Ze({inputs:{x:m},backend:t,attrs:{shape:l}}),_=b7({inputs:{a:p,b:v},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),_}const Qje={kernelName:mT,backendName:"webgl",kernelFunc:x7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jje(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:a,normalized:o}=s,l=o?r:x7({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),c=l.shape[0],h=l.shape[1],p=new qje(c,h,i),m=[[a]],v=t.runWebGLProgram(p,[l],"int32",m);return o||t.disposeIntermediateTensorInfo(l),v}const e4e={kernelName:s5,backendName:"webgl",kernelFunc:Jje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t4e=po+`
  return -x;
`,n4e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function s4e(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[a,o]=SLe(i.values,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,a)}let r;return Re().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new mh(s.shape,n4e):r=new $l(s.shape,t4e),t.runWebGLProgram(r,[s],s.dtype)}const r4e={kernelName:Qw,backendName:"webgl",kernelFunc:s4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i4e=tA;function a4e(n){Ta("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=s,c=t.readSync(r.dataId),h=t.readSync(i.dataId),{selectedIndices:p}=i4e(c,h,a,o,l);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}const o4e={kernelName:m$,backendName:"webgl",kernelFunc:a4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l4e=nA;function c4e(n){Ta("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=s,h=t.readSync(r.dataId),p=t.readSync(i.dataId),{selectedIndices:m,validOutputs:v}=l4e(h,p,a,o,l,c);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([v]))]}const u4e={kernelName:g$,backendName:"webgl",kernelFunc:c4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h4e=sA;function d4e(n){Ta("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=s,h=t.readSync(r.dataId),p=t.readSync(i.dataId),m=a,v=o,_=l,w=c,{selectedIndices:T,selectedScores:E}=h4e(h,p,m,v,_,w);return[t.makeTensorInfo([T.length],"int32",new Int32Array(T)),t.makeTensorInfo([E.length],"float32",new Float32Array(E))]}const f4e={kernelName:y$,backendName:"webgl",kernelFunc:d4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p4e{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m4e=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:a,onValue:o,offValue:l}=s,c=Me(r.shape),h=new p4e(c,a,o,l),p=Ze({inputs:{x:r},backend:t,attrs:{shape:[c]}}),m=t.runWebGLProgram(h,[p],i);t.disposeIntermediateTensorInfo(p);const v=[...r.shape,a],_=Ze({inputs:{x:m},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(m),_},g4e={kernelName:tT,backendName:"webgl",kernelFunc:m4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=d_({inputs:{input:s},backend:t}),i=S1({inputs:{x:r},backend:t}),a=KT({inputs:{input:s},backend:t}),o=S1({inputs:{x:a},backend:t}),l=ld({inputs:{real:i,imag:o},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),l}else return f_({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const y4e={kernelName:vT,backendName:"webgl",kernelFunc:S1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=d_({inputs:{input:s},backend:t}),i=w7({inputs:{x:r},backend:t}),a=KT({inputs:{input:s},backend:t}),o=S1({inputs:{x:a},backend:t}),l=ld({inputs:{real:i,imag:o},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(o),l}else return f_({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const v4e={kernelName:eT,backendName:"webgl",kernelFunc:w7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b4e(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return vC({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,a=e[0].dtype;e.forEach(h=>{F2(i,h.shape,"All tensors passed to stack must have matching shapes"),te(a===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=e.map(h=>{const p=vC({inputs:{input:h},backend:t,attrs:{dim:r}});return o.push(p),p}),c=o7({inputs:l,backend:t,attrs:{axis:r}});return o.forEach(h=>t.disposeIntermediateTensorInfo(h)),c}const _4e={kernelName:nT,backendName:"webgl",kernelFunc:b4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x4e{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,h)=>c[0]+e[h]+c[1]);const r=e.length,i=An(r),a=t.map(c=>c[0]).join(","),o=t.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${a};
        int end = ${o};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${a});
      ${i} end = ${i}(${o});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w4e{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,T)=>w[0]+e[T]+w[1]);const r=e.length,i=An(r),a=t.map(w=>w[0]).join(","),o=t.map((w,T)=>w[0]+e[T]).join(","),l=pi("rc",r),c=pi("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${c.slice(-2).join()})`,m=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${h}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${h}) {`],v=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let _="";for(let w=0,T=r===1?2:4;w<T;w++)_+=`
        ${m[w]}
        if (${v}) {
          result[${w}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${w}] = getChannel(getX(${c.join()}), ${p});
        }
      `;_+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${a});
      const ${i} end = ${i}(${o});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${_}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:a}=s;if(Me(r.shape)===0){const c=i.map((h,p)=>h[0]+r.shape[p]+h[1]);return f_({backend:t,attrs:{shape:c,value:a,dtype:r.dtype}})}const o=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new w4e(r.shape,i,a):new x4e(r.shape,i,a),l=[[a]];return t.runWebGLProgram(o,[r],r.dtype,l)},T4e={kernelName:sT,backendName:"webgl",kernelFunc:T7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S4e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,E4e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Jf+`
  return result;
`,N4e=Ir({opSnippet:S4e,packedOpSnippet:E4e}),I4e={kernelName:Ib,backendName:"webgl",kernelFunc:N4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:a}=s,o=r.shape.length,l=[],c=Vt(i,r.shape);let h=c;const p=fs(h,o);let m=r;p!=null&&(m=yi({inputs:{x:r},backend:t,attrs:{perm:p}}),h=Is(h.length,o),l.push(m)),Nr("prod",h,o);let v;if(t.shouldExecuteOnCPU([m])){const _=t.texData.get(m.dataId).values,{outVals:w,outShape:T,outDtype:E}=NLe(m.shape,m.dtype,_,h);v=t.makeTensorInfo(T,E,w)}else{const[_,w]=fr(m.shape,h),T=Me(w),E=Ze({inputs:{x:m},backend:t,attrs:{shape:[-1,T]}}),C=k$(r.dtype),A=ep(E,C,"prod",t);v=Ze({inputs:{x:A},backend:t,attrs:{shape:_}}),l.push(E),l.push(A)}if(a){l.push(v);const _=Bs(v.shape,c);v=Ze({inputs:{x:v},backend:t,attrs:{shape:_}})}return l.forEach(_=>t.disposeIntermediateTensorInfo(_)),v}const k4e={kernelName:iT,backendName:"webgl",kernelFunc:C4e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $4e(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:a}=e,{outputRaggedRank:o}=s,l=r.map(E=>t.readSync(E.dataId)),c=r.map(E=>E.shape),h=t.readSync(i.dataId),p=t.readSync(a.dataId),[m,v,_]=ILe(l,c,h,i.shape,i.dtype,p,a.shape,o),w=m.map(E=>t.makeTensorInfo([E.length],"int32",E)),T=t.makeTensorInfo(_,i.dtype,v);return w.concat([T])}const A4e={kernelName:r5,backendName:"webgl",kernelFunc:$4e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4e(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,a=t.readSync(s.dataId),o=t.readSync(r.dataId),l=t.readSync(i.dataId),[c,h]=CLe(a,s.shape,s.dtype,o,r.shape,l,i.shape),p=t.makeTensorInfo([c.length],"int32",c),m=t.makeTensorInfo([h.length],s.dtype,h);return[p,m]}const D4e={kernelName:i5,backendName:"webgl",kernelFunc:R4e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4e(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:a,rowPartitionTensors:o}=e,{rowPartitionTypes:l}=s,c=t.readSync(r.dataId),h=t.readSync(i.dataId),p=t.readSync(a.dataId),m=o.map(T=>t.readSync(T.dataId)),v=o.map(T=>T.shape),[_,w]=kLe(c,r.shape,h,i.shape,i.dtype,p,a.shape,m,v,l);return t.makeTensorInfo(_,i.dtype,w)}const O4e={kernelName:a5,backendName:"webgl",kernelFunc:L4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:a}=t,o=$Le(s,r,i,a);return e.makeTensorInfo([o.length],a,o)},P4e={kernelName:v$,backendName:"webgl",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M4e="return 1.0 / x;",F4e=cn({opSnippet:M4e}),j4e={kernelName:Cb,backendName:"webgl",kernelFunc:F4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B4e=po+`
  return (x < 0.0) ? 0.0 : x;
`,z4e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,V4e=cn({opSnippet:B4e,packedOpSnippet:z4e}),U4e={kernelName:kb,backendName:"webgl",kernelFunc:V4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G4e=po+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,W4e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,H4e=cn({opSnippet:G4e,packedOpSnippet:W4e}),q4e={kernelName:$b,backendName:"webgl",kernelFunc:H4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K4e{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[a,o,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?o-1:o,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;i?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/p[0]},
          ${h[1]/p[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X4e{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,o,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?o-1:o,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;i?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/p[0]},
          ${h[1]/p[1]},
          ${h[1]/p[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z4e(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:a,size:o}=s,[l,c]=o,h=Re().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new X4e(r.shape,l,c,i,a):new K4e(r.shape,l,c,i,a);return t.runWebGLProgram(h,[r],"float32")}const Y4e={kernelName:lT,backendName:"webgl",kernelFunc:Z4e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q4e{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,o]=e,l=[s&&a>1?r-1:r,s&&o>1?i-1:i],c=[s&&a>1?a-1:a,s&&o>1?o-1:o],h=l[0]/c[0],p=l[1]/c[1],m=1/h,v=1/p,_=Math.ceil(m)*2+2,w=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${p});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${v});

        const int winHeight = int(${_});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${a}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${o}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J4e(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:a}=s,o=new Q4e(i.shape,r.shape,a);return t.runWebGLProgram(o,[i],i.dtype)}const eBe={kernelName:x$,backendName:"webgl",kernelFunc:J4e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tBe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[a,o,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?o-1:o,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let v;i?v="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":v="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/p[0]},
          ${h[1]/p[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${v};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nBe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,o,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?o-1:o,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let v;i?v="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":v="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/p[0]},
          ${h[1]/p[1]},
          ${h[1]/p[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${v};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sBe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:a,size:o}=s,[l,c]=o,h=Re().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new nBe(r.shape,l,c,i,a):new tBe(r.shape,l,c,i,a);return t.runWebGLProgram(h,[r],r.dtype)}const rBe={kernelName:oT,backendName:"webgl",kernelFunc:sBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iBe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,o]=e,l=[s&&a>1?r-1:r,s&&o>1?i-1:i],c=[s&&a>1?a-1:a,s&&o>1?o-1:o],h=l[0]/c[0],p=l[1]/c[1],m=1/h,v=1/p,_=Math.ceil(m)*2+2,w=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${p});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${v});

        const int winHeight = int(${_});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${a}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${o}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aBe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:a}=s,o=new iBe(i.shape,r.shape,a);return t.runWebGLProgram(o,[i],i.dtype)}const oBe={kernelName:_$,backendName:"webgl",kernelFunc:aBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lBe{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=o=>t.indexOf(o)!==-1&&e[o]!==1?`${e[o]} - coords[${o}] - 1`:`coords[${o}]`,i=e.map((o,l)=>r(l)).join(","),a=An(s);this.userCode=`
      void main() {
        ${a} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cBe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=pi("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,a=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,o=An(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${c(r.slice())};
          }
          if(${a}) {
            result.b = ${h(r.slice())};
            if(${i}) {
              result.a = ${p(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(_){return m(_)}function c(_){return _[s-1]="("+_[s-1]+" + 1)",m(_)}function h(_){return _[s-2]="("+_[s-2]+" + 1)",m(_)}function p(_){return _[s-1]="("+_[s-1]+" + 1)",_[s-2]="("+_[s-2]+" + 1)",m(_)}function m(_){const w=e.map((C,A)=>v(A,_)),T=w.join(","),E=w.slice(-2).join(",");return`getChannel(getX(${T}), vec2(${E}))`}function v(_,w){return t.indexOf(_)!==-1&&e[_]!==1?`${e[_]} - ${w[_]} - 1`:`${w[_]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,a=r.shape.length,o=Vt(i,r.shape);if(a===0)return ea({inputs:{x:r},backend:t});const l=Re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cBe(r.shape,o):new lBe(r.shape,o);return t.runWebGLProgram(l,[r],r.dtype)}const hBe={kernelName:cT,backendName:"webgl",kernelFunc:uBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dBe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fBe={kernelName:C$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:a}=e,o=t,l=new dBe(s.shape,i),[c,h]=pA(a,s.shape[1],s.shape[2]),p=[[c,h,Math.sin(r),Math.cos(r)]];return o.runWebGLProgram(l,[s],s.dtype,p)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pBe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,mBe=cn({opSnippet:pBe}),gBe={kernelName:Ab,backendName:"webgl",kernelFunc:mBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yBe="return inversesqrt(x);",vBe=cn({opSnippet:yBe,cpuKernelImpl:ALe}),bBe={kernelName:Rb,backendName:"webgl",kernelFunc:vBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gR{constructor(e,t,s,r,i,a,o=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const c=An(i.length),h=An(a.length);let p="";s===1?p="i":s===2&&(p="i, j");const m=`getIndices(${p})`;let v="";r===1?v="i":r===2&&(v="i, coords[1]");const _=`getUpdates(${v})`;let w="";l&&(w="coords[0], coords[1]");const T=`getDefaultValue(${w})`,E=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${m});
              flattenedIndex += index * ${E};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${_};
              found = true;
            }
          }
          setOutput(mix(${T}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Be{constructor(e,t,s,r,i,a,o=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a;const c=An(i.length),h=An(a.length);let p="";s===1?p="i":s===2&&(p="i, j");const m=`getIndices(${p})`;let v="";r===1?v="i":r===2&&(v="i, coords[1]");const _=`getUpdates(${v})`;let w="";l&&(w="coords[0], coords[1]");const T=`getDefaultValue(${w})`,E=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${m});
              flattenedIndex += index.xz * ${E};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${_};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${T}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xBe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:a}=s,{sliceRank:o,numUpdates:l,sliceSize:c,strides:h,outputSize:p}=Kf(i,r,a),m=[p/c,c];if(p===0)return t.makeTensorInfo(a,r.dtype);const v=Ze({inputs:{x:r},backend:t,attrs:{shape:[l,o]}}),_=Ze({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let T;Re().getBool("WEBGL_PACK")?T=new _Be(l,o,v.shape.length,_.shape.length,h,m):T=new gR(l,o,v.shape.length,_.shape.length,h,m);const E=t.runWebGLProgram(T,[_,v,w],_.dtype),C=Ze({inputs:{x:E},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(w),C}const wBe={kernelName:o5,backendName:"webgl",kernelFunc:xBe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TBe{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",a=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,o=Re().getNumber("WEBGL_VERSION")===2?i:a,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${o}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SBe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:a}=s,o=new TBe(r.shape[0],r.shape[1],i.shape[1],a),l=[[r.shape[1]]];return t.runWebGLProgram(o,[r,i],"int32",l)}const EBe={kernelName:c5,backendName:"webgl",kernelFunc:SBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NBe{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const o=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let h=0;h<t.length;h++)c.push(`${o[h]}`),h<e&&l.push(`${o[h]}`);r=l.join(),i=c.join()}const a=An(s);this.userCode=`
      void main() {
        ${a} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IBe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,a=new NBe(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(a,[s,r,i],Qi(r.dtype,i.dtype))}const CBe={kernelName:uT,backendName:"webgl",kernelFunc:IBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kBe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${$T};
  float scale = ${AT};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,$Be=cn({opSnippet:kBe}),ABe={kernelName:Db,backendName:"webgl",kernelFunc:$Be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RBe=fg+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,DBe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,LBe=cn({opSnippet:RBe,packedOpSnippet:DBe,cpuKernelImpl:DLe}),OBe={kernelName:Mb,backendName:"webgl",kernelFunc:LBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PBe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,MBe=cn({opSnippet:PBe}),FBe={kernelName:Pb,backendName:"webgl",kernelFunc:MBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jBe=fg+`
  return sin(x);
`,BBe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Jf}
  return result;
`,zBe=cn({opSnippet:jBe,packedOpSnippet:BBe}),VBe={kernelName:Lb,backendName:"webgl",kernelFunc:zBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UBe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,GBe=cn({opSnippet:UBe}),WBe={kernelName:Ob,backendName:"webgl",kernelFunc:GBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HBe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,qBe=cn({opSnippet:HBe}),KBe={kernelName:Fb,backendName:"webgl",kernelFunc:qBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XBe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:a}=s;te(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const o=i.reduce((E,C)=>E*C),l=[[0,0]];l.push(...a);for(let E=1+i.length;E<r.shape.length;++E)l.push([0,0]);const c=[],h=T7({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),p=Yb(h.shape,i,o,!1),m=Qb(p.length,i.length,!1),v=Jb(h.shape,i,o,!1),_=Ze({inputs:{x:h},backend:t,attrs:{shape:p}}),w=yi({inputs:{x:_},backend:t,attrs:{perm:m}}),T=Ze({inputs:{x:w},backend:t,attrs:{shape:v}});return c.push(h),c.push(_),c.push(w),c.forEach(E=>t.disposeIntermediateTensorInfo(E)),T},ZBe={kernelName:fT,backendName:"webgl",kernelFunc:XBe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YBe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:a}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(a.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${a.shape}`);const o=t.readSync(s.dataId),l=t.readSync(r.dataId),c=t.readSync(i.dataId),h=t.readSync(a.dataId)[0],[p,m,v,_,w]=OLe(o,s.shape,s.dtype,l,r.dtype,c,h);return[t.makeTensorInfo(m,s.dtype,p),t.makeTensorInfo([m[0]],r.dtype,v),t.makeTensorInfo([_.length],"bool",new Uint8Array(_.map(T=>Number(T)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const QBe={kernelName:u5,backendName:"webgl",kernelFunc:YBe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JBe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const a=Array.from(t.readSync(r.dataId)),o=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[c,h,p]=PLe(o,s.shape,s.dtype,a,l);return[t.makeTensorInfo(h,s.dtype,c),t.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}const eze={kernelName:h5,backendName:"webgl",kernelFunc:JBe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tze(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const a=t.readSync(s.dataId),o=t.readSync(r.dataId),l=t.readSync(i.dataId),[c,h]=KK(a,s.shape,s.dtype,o,l,!0);return t.makeTensorInfo(h,s.dtype,c)}const nze={kernelName:d5,backendName:"webgl",kernelFunc:tze};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sze(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const a=t.readSync(s.dataId),o=t.readSync(r.dataId),l=t.readSync(i.dataId),[c,h]=KK(a,s.shape,s.dtype,o,l);return t.makeTensorInfo(h,s.dtype,c)}const rze={kernelName:f5,backendName:"webgl",kernelFunc:sze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ize(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:a}=e,{outputShape:o}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:p,outputSize:m}=Kf(i,r,o),v=!1;if(i.dtype==="string"){const E=t.bufferSync(r),C=t.bufferSync(i),A=Fh(t.readSync(a.dataId)[0]),D=RLe(E,C,o,m,h,c,l,p,A,v);return t.makeTensorInfo(o,D.dtype,D.values)}const _=new gR(c,l,r.shape.length,i.shape.length,p,[m,1],v),w=t.runWebGLProgram(_,[i,r,a],i.dtype),T=Ze({inputs:{x:w},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(w),T}const aze={kernelName:p5,backendName:"webgl",kernelFunc:ize};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:a}=s,o=Vt(a,r.shape)[0],l=kA(r,i,o),c=r.shape.length,h=new Array(c).fill(0),p=r.shape.slice();return l.map(m=>{const v=[...p];v[o]=m;const _=pg({inputs:{x:r},backend:t,attrs:{begin:h,size:v}});return h[o]+=m,_})}const lze={kernelName:pT,backendName:"webgl",kernelFunc:oze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF="return sqrt(x);",cze=cn({opSnippet:fF,packedOpSnippet:fF,cpuKernelImpl:MLe}),uze={kernelName:jb,backendName:"webgl",kernelFunc:cze};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hze="return x * x;",dze=cn({opSnippet:hze}),fze={kernelName:w$,backendName:"webgl",kernelFunc:dze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pF="return (a - b) * (a - b);",pze=Ir({opSnippet:pF,packedOpSnippet:pF}),mze={kernelName:Bb,backendName:"webgl",kernelFunc:pze};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),a=Jc(i),o=FLe(a,"string",s);return t.makeTensorInfo(r.shape,"string",o)}const yze={kernelName:T$,backendName:"webgl",kernelFunc:gze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vze({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=po+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new $l(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const bze={kernelName:Wb,backendName:"webgl",kernelFunc:vze};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ze{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=An(s.length),a=An(s.length);let o="";if(r===1)o="coords * strides + begin";else{let l=0;o=s.map((c,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${a} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:a,strides:o,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:p,shrinkAxisMask:m}=s,{finalShapeSparse:v,finalShape:_,isIdentity:w,sliceDim0:T,isSimpleSlice:E,begin:C,end:A,strides:D}=hA(r.shape,i,a,o,l,c,h,p,m);let F;if(w)F=Ze({inputs:{x:r},backend:t,attrs:{shape:_}});else if(T||E){te(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const B=lA(C,A,D),P=pg({inputs:{x:r},backend:t,attrs:{begin:C,size:B}});F=Ze({inputs:{x:P},backend:t,attrs:{shape:_}}),t.disposeIntermediateTensorInfo(P)}else if(t.shouldExecuteOnCPU([r])){const P=t.readSync(r.dataId),O=zt(r.shape,r.dtype,P),M=jLe(v,O,D,C);F=t.makeTensorInfo(_,r.dtype,M.values)}else{const P=new _ze(C,D,v);F=t.runWebGLProgram(P,[r],r.dtype)}const W=Ze({inputs:{x:F},backend:t,attrs:{shape:_}});return t.disposeIntermediateTensorInfo(F),W}const wze={kernelName:S$,backendName:"webgl",kernelFunc:xze};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tze(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:p}=e,m=t.readSync(h.dataId),v=t.readSync(p.dataId),[_,w]=BLe(m,v,r,i,a,o,l,c);return[t.makeTensorInfo([_.length],"string",_),t.makeTensorInfo(p.shape,"int32",w)]}const Sze={kernelName:m5,backendName:"webgl",kernelFunc:Tze};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eze(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:a}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(a.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=t.readSync(i.dataId),l=t.readSync(a.dataId)[0],[c,h,p]=zLe(o,l,r),m=h.length;return[t.makeTensorInfo([m,2],"int32",c),t.makeTensorInfo([m],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(p))]}const Nze={kernelName:g5,backendName:"webgl",kernelFunc:Eze};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ize(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=t.readSync(i.dataId),o=VLe(a,r);return t.makeTensorInfo(i.shape,"int32",o)}const Cze={kernelName:y5,backendName:"webgl",kernelFunc:Ize};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kze="return tan(x);",$ze=cn({opSnippet:kze}),Aze={kernelName:Vb,backendName:"webgl",kernelFunc:$ze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rze=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Dze=cn({opSnippet:Rze}),Lze={kernelName:Ub,backendName:"webgl",kernelFunc:Dze};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oze(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:a}=e,{sliceRank:o,numUpdates:l,sliceSize:c,strides:h,outputSize:p}=Kf(a,i,r.shape),m=[p/c,c];if(p===0)return t.makeTensorInfo(r.shape,i.dtype);const v=Ze({inputs:{x:i},backend:t,attrs:{shape:[l,o]}}),_=Ze({inputs:{x:a},backend:t,attrs:{shape:[l,c]}}),w=Ze({inputs:{x:r},backend:t,attrs:{shape:m}}),T=new gR(l,o,v.shape.length,_.shape.length,h,m,!1,!0),E=t.runWebGLProgram(T,[_,v,w],w.dtype),C=Ze({inputs:{x:E},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(E),C}const Pze={kernelName:l5,backendName:"webgl",kernelFunc:Oze};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mze{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let a=0;a<s.length;a++)s[a]=e[a]*t[a];this.outputShape=s,this.rank=s.length;const r=An(this.rank),i=Fze(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Fze(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),c=r.dtype==="string"?l.map(m=>Fh(m)):l,h=zt(r.shape,r.dtype,c),p=GLe(h,i);return t.makeTensorInfo(p.shape,p.dtype,p.values)}const a=new Mze(r.shape,i);return t.runWebGLProgram(a,[r],r.dtype)}const jze={kernelName:Gb,backendName:"webgl",kernelFunc:E7};class Bze{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class zze{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ud(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function mF(n){let e=1;for(;e<n;)e*=2;return e}function Vze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:a}=s,o=Re().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Re().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,h=c[c.length-1];if(t.shouldExecuteOnCPU([r])||h<o||i>l){const M=t.readSync(r.dataId),[k,V]=WLe(M,c,r.dtype,i,a);return[t.makeTensorInfo(k.shape,k.dtype,k.values),t.makeTensorInfo(V.shape,V.dtype,V.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,r.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(h===1)return[r,f_({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const p=t.texData.get(r.dataId),m=p!==null&&p.isPacked,v=m?t.unpackTensor(r):r,w=Me(c)/h,T=Ze({inputs:{x:v},attrs:{shape:[w,h]},backend:t});m&&Ud(t,v);const E=mF(i),C=mF(h);let A=null;const D=()=>A===null?[T,T]:[T,A],F=(M,k,V)=>{const G=D(),ae=new Bze(V),X=[[h],[A===null?1:0],[Number.NEGATIVE_INFINITY],[M],[k]],se=A;A=t.runWebGLProgram(ae,G,"int32",X),Ud(t,se)};for(let M=1;M<E;M*=2){const k=M*2;for(let V=M;V>=1;V/=2)F(k,V,[w,C])}for(let M=C;M>E;M/=2){const k=D(),V=new zze([w,M/2]),ae=[[h],[A===null?1:0],[E]],J=A;A=t.runWebGLProgram(V,k,"int32",ae),Ud(t,J);const X=E/2,se=X*2;for(let ne=X;ne>=1;ne/=2)F(se,ne,A.shape)}let W=A;A=pg({inputs:{x:A},backend:t,attrs:{begin:0,size:[w,i]}}),Ud(t,W);let B=y7({inputs:{x:T,indices:A},backend:t,attrs:{axis:1,batchDims:1}});Ud(t,T);const P=c.slice(0,-1);P.push(i),W=A,A=Ze({inputs:{x:A},attrs:{shape:P},backend:t}),Ud(t,W);const O=B;return B=Ze({inputs:{x:B},attrs:{shape:P},backend:t}),Ud(t,O),[B,A]}const Uze={kernelName:E$,backendName:"webgl",kernelFunc:Vze};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gze{constructor(e,t,s,r,i,a){this.variableNames=["Image","Transforms"],this.outputShape=a;const o=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${o} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wze(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:a,fillMode:o,fillValue:l,outputShape:c}=s,[h,p,m,v]=r.shape,[_,w]=c??[p,m],T=[h,_,w,v],E=new Gze(p,m,a,o,l,T);return t.runWebGLProgram(E,[r,i],"float32")}const Hze={kernelName:N$,backendName:"webgl",kernelFunc:Wze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qze(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;u_(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const a=s.readSync(i.dataId),{outputValues:o,outputShape:l,indices:c}=HLe(a,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,o),s.makeTensorInfo([c.length],"int32",c)]}const Kze={kernelName:I$,backendName:"webgl",kernelFunc:qze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xze(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const a=r,o=a.shape.length,l=r.shape[i],c=new Array(o-1);let h=0;for(let w=0;w<o;w++)w!==i&&(c[h++]=a.shape[w]);const p=[],m=new Array(o).fill(0),v=a.shape.slice();v[i]=1;const _=new Array(l);for(let w=0;w<_.length;w++){m[i]=w;const T=pg({inputs:{x:a},backend:t,attrs:{begin:m,size:v}}),E=Ze({inputs:{x:T},backend:t,attrs:{shape:c}});_[w]=E,p.push(T)}return p.forEach(w=>t.disposeIntermediateTensorInfo(w)),_}const Zze={kernelName:gT,backendName:"webgl",kernelFunc:Xze};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yze{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/s);this.outputShape=[r,o];const l="0.0",c="sumValue",h=Math.floor(s/4)*4,p=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let v="";i%s>0&&(v=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let _="";i%s>0&&(_=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${v}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${_}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${a})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${a})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${h};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:a}=s,o=r.shape.length,l=[];let c=0;const h=fs([c],o);let p=r;h!=null&&(p=yi({inputs:{x:r},backend:t,attrs:{perm:h}}),l.push(p),c=Is(1,o)[0]);const m=aq(p.shape,c,a),v=Me([p.shape[c]]),_=Ze({inputs:{x:p},backend:t,attrs:{shape:[-1,v]}});l.push(_);const w=k$(r.dtype),T=(D,F,W,B,P)=>{const O=D.shape[0],M=D.shape[1],k=iq(M,P),V={windowSize:k,inSize:M,batchSize:O,numSegments:P},G=new Yze(V,F),ae=t.compileAndRun(G,[D,W],B);if(l.push(ae),ae.shape[1]===P)return ae;const J=S7({backend:t,attrs:{start:0,stop:P,step:1,dtype:"float32"}}),X=E7({inputs:{x:J},backend:t,attrs:{reps:[M/k]}});return l.push(J),l.push(X),T(ae,F,X,B,P)},E=T(_,"unsortedSegmentSum",i,w,a),C=Ze({inputs:{x:E},backend:t,attrs:{shape:m}});let A=C;if(h!=null){l.push(C);const D=nd(h);A=yi({inputs:{x:A},backend:t,attrs:{perm:D}})}return l.forEach(D=>t.disposeIntermediateTensorInfo(D)),A}const Jze={kernelName:yT,backendName:"webgl",kernelFunc:Qze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eVe=[MOe,jOe,VOe,WOe,qOe,ZOe,QOe,ePe,rPe,aPe,cPe,dPe,mPe,bPe,wPe,SPe,NPe,$Pe,RPe,LPe,FPe,WPe,qPe,YPe,JPe,iMe,oMe,hMe,_Oe,pMe,bMe,TMe,kMe,RMe,LMe,PMe,FMe,VMe,WMe,KMe,ZMe,QMe,e3e,s3e,i3e,c3e,h3e,p3e,y3e,b3e,T3e,I3e,A3e,L3e,M3e,F3e,B3e,V3e,G3e,H3e,K3e,Q3e,tFe,rFe,aFe,cFe,dFe,gFe,_Fe,bOe,wFe,yMe,EFe,CFe,AFe,wOe,OFe,jFe,zFe,WFe,KFe,QFe,tje,ije,cje,dje,pje,vje,_je,wje,Nje,Cje,$je,Rje,Lje,Fje,Vje,Hje,e4e,EOe,r4e,o4e,u4e,f4e,tMe,g4e,v4e,_4e,T4e,I4e,SOe,k4e,A4e,D4e,O4e,P4e,nMe,Zje,j4e,U4e,q4e,IOe,Y4e,eBe,rBe,oBe,hBe,fBe,gBe,bBe,wBe,EBe,CBe,ABe,OBe,FBe,VBe,WBe,UPe,Qje,KBe,ZBe,QBe,eze,nze,rze,aze,lze,uze,fze,mze,yze,bze,wze,Sze,Nze,Cze,Yje,LOe,Aze,Lze,Pze,jze,Uze,Hze,OOe,Kze,Zze,Jze,y4e];for(const n of eVe)b5(n);function tVe(){const[n,e]=ve.useState([]),[t,s]=ve.useState(null),[r,i]=ve.useState(1),[a,o]=ve.useState(""),[l,c]=ve.useState(""),h=ve.useRef(null),p=ve.useRef(null),m=ve.useRef([]),v=ve.useRef(null),_=ve.useRef(null),w=ve.useRef([]),[T,E]=ve.useState(null),[C,A]=ve.useState("Model not loaded"),[D,F]=ve.useState([]);ve.useEffect(()=>{(async()=>{const se=(await Dc(Rh(jr,"projects"))).docs.map(ne=>({id:ne.id,...ne.data()}));e(se)})()},[]);const W=async J=>{if(!t)return alert("No project selected!");const X=ql(jr,"projects",t.id),se={step:`Step ${r}`,reviewer:"Admin User",date:new Date().toISOString().split("T")[0],status:J,notes:a},ne=J==="approved"?"verified":J==="rejected"?"rejected":"under_review";try{await L0(X,{status:ne,verificationHistory:[...t.verificationHistory||[],se]}),e(le=>le.map(K=>K.id===t.id?{...K,status:ne,verificationHistory:[...K.verificationHistory||[],se]}:K)),s(le=>({...le,status:ne,verificationHistory:[...le.verificationHistory||[],se]})),o(""),i(le=>le+1),alert(`Project ${J} successfully!`)}catch(le){console.error("Firestore update failed:",le),alert("Failed to update project. Check console for details.")}},B=async()=>{if(!t||t.status!=="verified"){alert("Credits can only be generated for a verified project.");return}const J=parseFloat(l);if(isNaN(J)||J<=0){alert("Please enter a valid number of credits to generate.");return}const X=ql(jr,"projects",t.id);try{console.log(`Simulating blockchain transaction for ${J} credits...`);const se=`tx_${new Date().getTime()}`;await L0(X,{creditsGenerated:(t.creditsGenerated||0)+J,blockchainTx:se}),e(ne=>ne.map(le=>le.id===t.id?{...le,creditsGenerated:(le.creditsGenerated||0)+J,blockchainTx:se}:le)),s(ne=>({...ne,creditsGenerated:(ne.creditsGenerated||0)+J,blockchainTx:se})),c(""),alert(`${J} carbon credits successfully generated!`)}catch(se){console.error("Failed to generate credits:",se),alert("Failed to generate credits. Check console for details.")}},P=J=>{switch(J){case"pending":return"status-badge pending";case"under_review":return"status-badge active";case"verified":return"status-badge verified";case"rejected":return"status-badge rejected";default:return"status-badge no-reports"}},O=J=>{switch(J){case"pending":return"Pending Review";case"under_review":return"Under Review";case"verified":return"Verified";case"rejected":return"Rejected";default:return"Unknown"}};async function M(){A("Loading model...");try{const J=await mve({base:"ade20k",quantizationBytes:2});E(J),A("✅ Model loaded (ADE20K)!")}catch(J){console.error("Failed to load model:",J),A("❌ Failed to load model")}}function k(J){try{const X=document.createElement("canvas"),se=X.getContext("2d");X.width=J.naturalWidth||J.width,X.height=J.naturalHeight||J.height,se.drawImage(J,0,0);const{data:ne}=se.getImageData(0,0,X.width,X.height);let le=0;const K=X.width*X.height;for(let de=0;de<ne.length;de+=4){const ce=ne[de],Se=ne[de+1],Te=ne[de+2];2*Se-ce-Te>20&&le++}const ie=(le/K*100).toFixed(1);return{percentage:parseFloat(ie),greenPixels:le,totalPixels:K}}catch(X){return console.error("ExG calculation failed:",X),{percentage:0,greenPixels:0,totalPixels:0}}}async function V(J,X,se,ne){if(!X){ae(ne,`❌ ${J}: Image not found`);return}if(!T)return G(J,X,ne);A(`Analyzing ${J}...`);try{const le=await T.segment(X),K=le.data||le.segmentationMap,ie=[21,22,47,66,120];let de=0;for(let He=0;He<K.length;He++)ie.includes(K[He])&&de++;const ce=de/K.length*100,Se=se.current,Te=Se.getContext("2d");Se.width=le.width,Se.height=le.height;const Ie=Te.createImageData(Se.width,Se.height);for(let He=0;He<K.length;He++){const qe=He*4;ie.includes(K[He])?(Ie.data[qe]=0,Ie.data[qe+1]=255,Ie.data[qe+2]=0,Ie.data[qe+3]=120):Ie.data[qe+3]=0}if(Te.putImageData(Ie,0,0),ce>1)ae(ne,`✅ ${J}: Vegetation detected (${ce.toFixed(1)}% via ADE20K)`);else return G(J,X,ne);A("✅ Done")}catch(le){return console.error("AI analysis failed, falling back to ExG:",le),G(J,X,ne)}}async function G(J,X,se){try{X.complete||await new Promise((de,ce)=>{X.onload=de,X.onerror=ce,setTimeout(ce,5e3)});const ne=k(X),le=ne.percentage>15?"High vegetation coverage":ne.percentage>5?"Moderate vegetation coverage":"Low vegetation coverage",ie=`${ne.percentage>15?"🌿":ne.percentage>5?"🌱":"🟫"} ${J}: ${ne.percentage}% green coverage (${ne.greenPixels.toLocaleString()}/${ne.totalPixels.toLocaleString()} pixels) - ${le}`;ae(se,ie),A("✅ ExG analysis complete")}catch(ne){console.error(`ExG analysis failed for ${J}:`,ne),ae(se,`❌ ${J}: ExG analysis failed`),A("❌ ExG analysis failed")}}function ae(J,X){F(se=>{const ne=[...se];return ne[J]=X,ne})}return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"🌱 Project Verification Dashboard"}),y.jsx("p",{className:"page-subtitle",children:"Review submitted blue carbon projects and update verification status"})]}),y.jsxs("div",{className:"verification-layout",children:[y.jsxs("div",{className:"projects-sidebar",children:[y.jsxs("h3",{children:["Projects (",n.length,")"]}),y.jsx("div",{className:"projects-list",children:n.map(J=>y.jsxs("div",{className:`project-tile ${t?.id===J.id?"selected":""}`,onClick:()=>{s(J),i(1),o(""),F([]),m.current=[],w.current=[]},children:[y.jsxs("div",{className:"tile-header",children:[y.jsx("h4",{children:J.projectName||J.name}),y.jsx("span",{className:P(J.status),children:O(J.status)})]}),y.jsxs("div",{className:"tile-info",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"Type:"})," ",J.projectType||J.type]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Location:"})," ",J.location]}),y.jsxs("p",{children:[y.jsx("strong",{children:"Area:"})," ",J.area||"-"," ha"]})]})]},J.id))})]}),t?y.jsxs("div",{className:"project-details-panel",children:[y.jsxs("div",{className:"project-overview",children:[y.jsx("h2",{children:t.projectName||"-"}),y.jsx("span",{className:P(t.status),children:O(t.status)}),y.jsxs("div",{className:"overview-grid",children:[y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Type"}),t.projectType||"-"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Location"}),t.location||"-"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Area"}),t.area||"-"," ha"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Expected Credits"}),t.expectedCredits||"-"," tons CO₂"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Timeline"}),t.timeline||"-"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Methodology"}),t.methodology||"-"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Coordinates"}),t.coordinates||"-"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Generated Credits"}),t.creditsGenerated||"-"," tons CO₂"]}),y.jsxs("div",{className:"overview-item",children:[y.jsx("label",{children:"Blockchain Tx ID"}),y.jsx("span",{className:"tx-id",children:t.blockchainTx||"-"})]})]}),y.jsxs("div",{className:"project-description",children:[y.jsx("label",{children:"Description"}),y.jsx("p",{children:t.description||"-"})]}),t.capturedPhoto&&y.jsxs("div",{className:"verifier-image-block",children:[y.jsx("label",{children:"Captured Photo"}),y.jsx("img",{ref:h,src:t.capturedPhoto,alt:"Captured",className:"project-image",crossOrigin:"anonymous"}),y.jsx("canvas",{ref:v,className:"overlay-canvas"}),y.jsxs("div",{className:"analysis-buttons",children:[y.jsx("button",{onClick:()=>V("Captured Photo",h.current,v,0),children:"🤖 AI Analysis"}),y.jsx("button",{onClick:()=>G("Captured Photo",h.current,0),children:"🌿 ExG Only"})]})]}),t.satImage&&y.jsxs("div",{className:"verifier-image-block",children:[y.jsx("label",{children:"Satellite Image"}),y.jsx("img",{ref:p,src:t.satImage,alt:"Satellite",className:"project-image",crossOrigin:"anonymous"}),y.jsx("canvas",{ref:_,className:"overlay-canvas"}),y.jsxs("div",{className:"analysis-buttons",children:[y.jsx("button",{onClick:()=>V("Satellite Image",p.current,_,1),children:"🤖 AI Analysis"}),y.jsx("button",{onClick:()=>G("Satellite Image",p.current,1),children:"🛰️ ExG Only"})]})]}),t.documents?.length>0&&t.documents.map((J,X)=>y.jsxs("div",{className:"verifier-image-block",children:[y.jsxs("label",{children:["Uploaded Image ",X+1]}),y.jsx("img",{ref:se=>m.current[X]=se,src:J,alt:`Doc ${X}`,className:"project-image",crossOrigin:"anonymous"}),y.jsx("canvas",{ref:se=>w.current[X]=se,className:"overlay-canvas"}),y.jsxs("div",{className:"analysis-buttons",children:[y.jsx("button",{onClick:()=>V(`Uploaded Image ${X+1}`,m.current[X],w.current[X],X+2),children:"🤖 AI Analysis"}),y.jsx("button",{onClick:()=>G(`Uploaded Image ${X+1}`,m.current[X],X+2),children:"📸 ExG Only"})]})]},X)),y.jsxs("div",{className:"ai-panel",children:[y.jsx("div",{className:"ai-controls",children:y.jsx("button",{onClick:M,disabled:!!T,children:T?"✅ Model Ready":"Load AI Model"})}),y.jsx("div",{className:"ai-status",children:C}),y.jsx("div",{className:"ai-results",children:D.map((J,X)=>y.jsx("div",{className:"result-item",children:J},X))})]})]}),y.jsxs("div",{className:"verification-actions",children:[y.jsx("textarea",{value:a,onChange:J=>o(J.target.value),placeholder:"Add verification notes...",rows:"4"}),y.jsx("button",{onClick:()=>W("approved"),children:"✅ Approve"}),y.jsx("button",{onClick:()=>W("under_review"),children:"📝 Request Revision"}),y.jsx("button",{onClick:()=>W("rejected"),children:"❌ Reject"}),y.jsx("hr",{style:{margin:"1rem 0"}}),y.jsxs("div",{className:"credit-generation-controls",children:[y.jsx("input",{type:"number",placeholder:"Enter credits to generate...",value:l,onChange:J=>c(J.target.value),min:"0"}),y.jsx("button",{onClick:B,disabled:!t||t.status!=="verified",children:"🪙 Generate Credits"})]})]}),t.verificationHistory?.length>0&&y.jsxs("div",{className:"verification-history",children:[y.jsx("h4",{children:"📜 Verification History"}),t.verificationHistory.map((J,X)=>y.jsxs("div",{className:"history-item",children:[y.jsxs("strong",{children:[J.step,":"]})," ",J.status," by ",J.reviewer," on ",J.date," ",J.notes&&`- Notes: ${J.notes}`]},X))]})]}):y.jsx("div",{className:"no-selection",children:y.jsx("h3",{children:"👈 Select a project to view details"})})]})]})}function nVe(){const[n,e]=ve.useState([]),[t,s]=ve.useState(""),[r,i]=ve.useState("all"),[a,o]=ve.useState(!1),[l,c]=ve.useState({name:"",email:"",role:"farmer",organization:"",phone:"",location:""});ve.useEffect(()=>{(async()=>{try{const T=(await Dc(Rh(jr,"users"))).docs.map(E=>({id:E.id,...E.data()}));e(T)}catch(w){console.error("Error fetching users:",w)}})()},[]);const h=async()=>{try{const _={name:l.name||"Unnamed User",email:l.email||"no-email@example.com",role:l.role||"farmer",organization:l.organization||"N/A",phone:l.phone||"N/A",location:l.location||"N/A",joinDate:new Date().toISOString().split("T")[0],lastActive:new Date().toISOString().split("T")[0],status:"pending",projects:0,credits:0,avatar:l.role==="farmer"?"👩‍🌾":l.role==="buyer"?"👨‍💼":"👨‍💻"},w=await lB(Rh(jr,"users"),_);e([...n,{id:w.id,..._}]),c({name:"",email:"",role:"farmer",organization:"",phone:"",location:""}),o(!1)}catch(_){console.error("Error adding user:",_)}},p=async(_,w)=>{try{const T=ql(jr,"users",_);await L0(T,{role:w}),e(n.map(E=>E.id===_?{...E,role:w}:E))}catch(T){console.error("Error updating role:",T)}},m=async(_,w)=>{try{const T=ql(jr,"users",_);await L0(T,{status:w}),e(n.map(E=>E.id===_?{...E,status:w}:E))}catch(T){console.error("Error updating status:",T)}},v=n.filter(_=>{const w=(_.name||"").toLowerCase(),T=(_.email||"").toLowerCase(),E=(_.organization||"").toLowerCase(),C=w.includes(t.toLowerCase())||T.includes(t.toLowerCase())||E.includes(t.toLowerCase()),A=r==="all"||_.role===r;return C&&A});return y.jsxs("div",{className:"user-management",children:[y.jsx("h2",{children:"👥 User Management"}),y.jsxs("div",{className:"controls",children:[y.jsx("input",{type:"text",placeholder:"🔍 Search by name, email, org...",value:t,onChange:_=>s(_.target.value)}),y.jsxs("select",{value:r,onChange:_=>i(_.target.value),children:[y.jsx("option",{value:"all",children:"All Roles"}),y.jsx("option",{value:"farmer",children:"Farmers"}),y.jsx("option",{value:"buyer",children:"Buyers"}),y.jsx("option",{value:"verifier",children:"Verifiers"})]}),y.jsx("button",{onClick:()=>o(!0),children:"+ Add User"})]}),a&&y.jsxs("div",{className:"add-user-form",children:[y.jsx("input",{type:"text",placeholder:"Name",value:l.name,onChange:_=>c({...l,name:_.target.value})}),y.jsx("input",{type:"email",placeholder:"Email",value:l.email,onChange:_=>c({...l,email:_.target.value})}),y.jsxs("select",{value:l.role,onChange:_=>c({...l,role:_.target.value}),children:[y.jsx("option",{value:"farmer",children:"Farmer"}),y.jsx("option",{value:"buyer",children:"Buyer"}),y.jsx("option",{value:"verifier",children:"Verifier"})]}),y.jsx("input",{type:"text",placeholder:"Organization",value:l.organization,onChange:_=>c({...l,organization:_.target.value})}),y.jsx("input",{type:"text",placeholder:"Phone",value:l.phone,onChange:_=>c({...l,phone:_.target.value})}),y.jsx("input",{type:"text",placeholder:"Location",value:l.location,onChange:_=>c({...l,location:_.target.value})}),y.jsx("button",{onClick:h,children:"Save User"})]}),y.jsx("div",{className:"user-list",children:v.length===0?y.jsx("p",{children:"No users found"}):v.map(_=>y.jsxs("div",{className:"user-card",children:[y.jsxs("div",{className:"user-header",children:[y.jsx("span",{className:"avatar",children:_.avatar||"👤"}),y.jsxs("div",{children:[y.jsx("h4",{children:_.name||"Unnamed User"}),y.jsx("p",{className:"user-email",children:_.email||"No email"})]})]}),y.jsxs("div",{className:"user-details",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"📌 Organization:"})," ",_.organization||"N/A"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"📍 Location:"})," ",_.location||"N/A"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"📞 Phone:"})," ",_.phone||"N/A"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"📅 Joined:"})," ",_.joinDate||"-"]}),y.jsxs("p",{children:[y.jsx("strong",{children:"⏳ Last Active:"})," ",_.lastActive||"-"]})]}),y.jsxs("div",{className:"user-actions",children:[y.jsxs("label",{children:["Status:",y.jsxs("select",{value:_.status||"pending",onChange:w=>m(_.id,w.target.value),children:[y.jsx("option",{value:"active",children:"Active"}),y.jsx("option",{value:"pending",children:"Pending"}),y.jsx("option",{value:"blocked",children:"Blocked"})]})]}),y.jsxs("label",{children:["Role:",y.jsxs("select",{value:_.role||"farmer",onChange:w=>p(_.id,w.target.value),children:[y.jsx("option",{value:"farmer",children:"Farmer"}),y.jsx("option",{value:"buyer",children:"Buyer"}),y.jsx("option",{value:"verifier",children:"Verifier"})]})]})]}),y.jsxs("div",{className:"user-stats",children:[y.jsxs("p",{children:[y.jsx("strong",{children:"📂 Projects:"})," ",_.projects||0]}),y.jsxs("p",{children:[y.jsx("strong",{children:"🌱 Credits:"})," ",_.credits||0]})]})]},_.id))})]})}function sVe(){const[n,e]=ve.useState([]),[t,s]=ve.useState([]),[r,i]=ve.useState(""),[a,o]=ve.useState("all"),[l,c]=ve.useState("all"),[h,p]=ve.useState("all"),[m,v]=ve.useState(null);ve.useEffect(()=>{const F=[{id:"TXN-001",type:"credit_purchase",buyer:"James Chen",seller:"Dr. Marina Santos",project:"Mangrove Restoration - Sundarbans",amount:500,pricePerTon:25.5,totalAmount:12750,currency:"USD",status:"completed",date:"2024-01-20",timestamp:"2024-01-20T14:30:00Z",paymentMethod:"Bank Transfer",transactionHash:"0x742d35cc6cd8f9a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4",blockchainNetwork:"Ethereum",verificationStatus:"verified",notes:"Carbon credit purchase for corporate sustainability goals"},{id:"TXN-002",type:"credit_sale",buyer:"Lisa Thompson",seller:"Sarah Williams",project:"Coral Reef Protection Initiative",amount:300,pricePerTon:28.75,totalAmount:8625,currency:"USD",status:"pending",date:"2024-01-19",timestamp:"2024-01-19T16:45:00Z",paymentMethod:"Credit Card",transactionHash:"0x923c45dd7de8f0a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5",blockchainNetwork:"Ethereum",verificationStatus:"pending",notes:"Partial payment received, awaiting full confirmation"},{id:"TXN-003",type:"credit_purchase",buyer:"Green Investment Corp",seller:"Miguel Rodriguez",project:"Blue Carbon Assessment",amount:800,pricePerTon:22,totalAmount:17600,currency:"USD",status:"completed",date:"2024-01-18",timestamp:"2024-01-18T11:20:00Z",paymentMethod:"Wire Transfer",transactionHash:"0x456e78ff9ef0a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7",blockchainNetwork:"Ethereum",verificationStatus:"verified",notes:"Bulk purchase for portfolio diversification"},{id:"TXN-004",type:"credit_sale",buyer:"Eco Investment Partners",seller:"Dr. Marina Santos",project:"Mangrove Restoration - Sundarbans",amount:200,pricePerTon:26.25,totalAmount:5250,currency:"USD",status:"failed",date:"2024-01-17",timestamp:"2024-01-17T09:15:00Z",paymentMethod:"Bank Transfer",transactionHash:null,blockchainNetwork:"Ethereum",verificationStatus:"failed",notes:"Transaction failed due to insufficient funds"},{id:"TXN-005",type:"credit_purchase",buyer:"James Chen",seller:"Sarah Williams",project:"Coral Reef Protection Initiative",amount:150,pricePerTon:30,totalAmount:4500,currency:"USD",status:"processing",date:"2024-01-16",timestamp:"2024-01-16T13:45:00Z",paymentMethod:"Cryptocurrency",transactionHash:"0x789f01aa0bf1a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8",blockchainNetwork:"Ethereum",verificationStatus:"processing",notes:"Cryptocurrency payment in progress"},{id:"TXN-006",type:"platform_fee",buyer:"Platform",seller:"Dr. Marina Santos",project:"Mangrove Restoration - Sundarbans",amount:0,pricePerTon:0,totalAmount:127.5,currency:"USD",status:"completed",date:"2024-01-20",timestamp:"2024-01-20T14:30:00Z",paymentMethod:"Automatic",transactionHash:"0x123a45bb1cf2a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9",blockchainNetwork:"Ethereum",verificationStatus:"verified",notes:"Platform fee (1% of transaction value)"}];e(F),s(F)},[]),ve.useEffect(()=>{let F=n;if(r&&(F=F.filter(W=>W.id.toLowerCase().includes(r.toLowerCase())||W.buyer.toLowerCase().includes(r.toLowerCase())||W.seller.toLowerCase().includes(r.toLowerCase())||W.project.toLowerCase().includes(r.toLowerCase()))),a!=="all"&&(F=F.filter(W=>W.type===a)),l!=="all"&&(F=F.filter(W=>W.status===l)),h!=="all"){const W=new Date,B=new Date;switch(h){case"today":B.setHours(0,0,0,0);break;case"week":B.setDate(W.getDate()-7);break;case"month":B.setMonth(W.getMonth()-1);break;case"year":B.setFullYear(W.getFullYear()-1);break}F=F.filter(P=>new Date(P.date)>=B)}s(F)},[n,r,a,l,h]);const _=F=>{switch(F){case"credit_purchase":return"type-badge purchase";case"credit_sale":return"type-badge sale";case"platform_fee":return"type-badge fee";default:return"type-badge default"}},w=F=>{switch(F){case"completed":return"status-badge verified";case"pending":return"status-badge pending";case"processing":return"status-badge active";case"failed":return"status-badge rejected";default:return"status-badge no-reports"}},T=F=>{switch(F){case"credit_purchase":return"🛒";case"credit_sale":return"💰";case"platform_fee":return"🏛️";default:return"📄"}},E=(F,W)=>new Intl.NumberFormat("en-US",{style:"currency",currency:W}).format(F),C=F=>new Date(F).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),A=F=>new Date(F).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),D={total:t.length,completed:t.filter(F=>F.status==="completed").length,pending:t.filter(F=>F.status==="pending").length,processing:t.filter(F=>F.status==="processing").length,failed:t.filter(F=>F.status==="failed").length,totalVolume:t.reduce((F,W)=>F+W.totalAmount,0),totalCredits:t.reduce((F,W)=>F+W.amount,0)};return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"💳 Transactions"}),y.jsx("p",{className:"page-subtitle",children:"Track all carbon credit transactions, payments, and financial records"})]}),y.jsxs("div",{className:"transaction-stats-grid",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"📊"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:D.total}),y.jsx("div",{className:"stat-label",children:"Total Transactions"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"✅"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:D.completed}),y.jsx("div",{className:"stat-label",children:"Completed"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"⏳"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:D.pending}),y.jsx("div",{className:"stat-label",children:"Pending"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"💰"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:E(D.totalVolume,"USD")}),y.jsx("div",{className:"stat-label",children:"Total Volume"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🌱"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:D.totalCredits.toLocaleString()}),y.jsx("div",{className:"stat-label",children:"Credits Traded (tons)"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"📈"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:D.total>0?E(D.totalVolume/D.totalCredits,"USD"):"$0.00"}),y.jsx("div",{className:"stat-label",children:"Avg Price/Ton"})]})]})]}),y.jsxs("div",{className:"transaction-controls",children:[y.jsxs("div",{className:"search-filter",children:[y.jsx("input",{type:"text",placeholder:"Search transactions...",value:r,onChange:F=>i(F.target.value),className:"search-input"}),y.jsxs("select",{value:a,onChange:F=>o(F.target.value),className:"filter-select",children:[y.jsx("option",{value:"all",children:"All Types"}),y.jsx("option",{value:"credit_purchase",children:"Credit Purchase"}),y.jsx("option",{value:"credit_sale",children:"Credit Sale"}),y.jsx("option",{value:"platform_fee",children:"Platform Fee"})]}),y.jsxs("select",{value:l,onChange:F=>c(F.target.value),className:"filter-select",children:[y.jsx("option",{value:"all",children:"All Status"}),y.jsx("option",{value:"completed",children:"Completed"}),y.jsx("option",{value:"pending",children:"Pending"}),y.jsx("option",{value:"processing",children:"Processing"}),y.jsx("option",{value:"failed",children:"Failed"})]}),y.jsxs("select",{value:h,onChange:F=>p(F.target.value),className:"filter-select",children:[y.jsx("option",{value:"all",children:"All Time"}),y.jsx("option",{value:"today",children:"Today"}),y.jsx("option",{value:"week",children:"This Week"}),y.jsx("option",{value:"month",children:"This Month"}),y.jsx("option",{value:"year",children:"This Year"})]})]}),y.jsx("button",{className:"btn-primary",children:"📊 Export Report"})]}),y.jsxs("div",{className:"transactions-content",children:[y.jsxs("div",{className:"transactions-list",children:[y.jsx("div",{className:"list-header",children:y.jsxs("h3",{children:["💳 Transaction History (",t.length,")"]})}),y.jsxs("div",{className:"transactions-table",children:[y.jsxs("div",{className:"table-header",children:[y.jsx("div",{className:"col-id",children:"ID"}),y.jsx("div",{className:"col-type",children:"Type"}),y.jsx("div",{className:"col-parties",children:"Parties"}),y.jsx("div",{className:"col-project",children:"Project"}),y.jsx("div",{className:"col-amount",children:"Amount"}),y.jsx("div",{className:"col-price",children:"Price/Ton"}),y.jsx("div",{className:"col-total",children:"Total"}),y.jsx("div",{className:"col-status",children:"Status"}),y.jsx("div",{className:"col-date",children:"Date"}),y.jsx("div",{className:"col-actions",children:"Actions"})]}),y.jsx("div",{className:"table-body",children:t.map(F=>y.jsxs("div",{className:`table-row ${m?.id===F.id?"selected":""}`,onClick:()=>v(F),children:[y.jsx("div",{className:"col-id",children:y.jsx("span",{className:"transaction-id",children:F.id})}),y.jsx("div",{className:"col-type",children:y.jsxs("span",{className:`type-badge ${_(F.type)}`,children:[T(F.type)," ",F.type.replace("_"," ")]})}),y.jsx("div",{className:"col-parties",children:y.jsxs("div",{className:"parties-info",children:[y.jsxs("span",{className:"buyer",children:["👤 ",F.buyer]}),y.jsxs("span",{className:"seller",children:["👤 ",F.seller]})]})}),y.jsx("div",{className:"col-project",children:y.jsx("span",{className:"project-name",children:F.project})}),y.jsx("div",{className:"col-amount",children:y.jsxs("span",{className:"amount",children:[F.amount.toLocaleString()," tons"]})}),y.jsx("div",{className:"col-price",children:y.jsx("span",{className:"price",children:E(F.pricePerTon,F.currency)})}),y.jsx("div",{className:"col-total",children:y.jsx("span",{className:"total",children:E(F.totalAmount,F.currency)})}),y.jsx("div",{className:"col-status",children:y.jsx("span",{className:w(F.status),children:F.status.charAt(0).toUpperCase()+F.status.slice(1)})}),y.jsx("div",{className:"col-date",children:y.jsx("span",{className:"date",children:C(F.date)})}),y.jsx("div",{className:"col-actions",children:y.jsx("button",{className:"btn-small",onClick:W=>{W.stopPropagation(),v(F)},children:"👁️ View"})})]},F.id))})]})]}),m&&y.jsxs("div",{className:"transaction-details-panel",children:[y.jsxs("div",{className:"panel-header",children:[y.jsx("h3",{children:"💳 Transaction Details"}),y.jsx("span",{className:"transaction-id",children:m.id})]}),y.jsxs("div",{className:"transaction-details",children:[y.jsxs("div",{className:"detail-section",children:[y.jsx("h4",{children:"📋 Basic Information"}),y.jsxs("div",{className:"detail-grid",children:[y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Transaction ID:"}),y.jsx("span",{children:m.id})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Type:"}),y.jsxs("span",{className:_(m.type),children:[T(m.type)," ",m.type.replace("_"," ")]})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Status:"}),y.jsx("span",{className:w(m.status),children:m.status.charAt(0).toUpperCase()+m.status.slice(1)})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Date:"}),y.jsx("span",{children:A(m.timestamp)})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Buyer:"}),y.jsx("span",{children:m.buyer})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Seller:"}),y.jsx("span",{children:m.seller})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Project:"}),y.jsx("span",{children:m.project})]}),y.jsxs("div",{className:"detail-item",children:[y.jsx("label",{children:"Payment Method:"}),y.jsx("span",{children:m.paymentMethod})]})]})]}),y.jsxs("div",{className:"detail-section",children:[y.jsx("h4",{children:"💰 Financial Details"}),y.jsxs("div",{className:"financial-grid",children:[y.jsxs("div",{className:"financial-item",children:[y.jsx("label",{children:"Credits Amount:"}),y.jsxs("span",{className:"amount",children:[m.amount.toLocaleString()," tons CO₂"]})]}),y.jsxs("div",{className:"financial-item",children:[y.jsx("label",{children:"Price per Ton:"}),y.jsx("span",{className:"price",children:E(m.pricePerTon,m.currency)})]}),y.jsxs("div",{className:"financial-item",children:[y.jsx("label",{children:"Total Amount:"}),y.jsx("span",{className:"total",children:E(m.totalAmount,m.currency)})]}),y.jsxs("div",{className:"financial-item",children:[y.jsx("label",{children:"Currency:"}),y.jsx("span",{children:m.currency})]})]})]}),y.jsxs("div",{className:"detail-section",children:[y.jsx("h4",{children:"🔗 Blockchain Information"}),y.jsxs("div",{className:"blockchain-info",children:[y.jsxs("div",{className:"blockchain-item",children:[y.jsx("label",{children:"Network:"}),y.jsx("span",{children:m.blockchainNetwork})]}),y.jsxs("div",{className:"blockchain-item",children:[y.jsx("label",{children:"Transaction Hash:"}),y.jsx("span",{className:"hash",children:m.transactionHash?`${m.transactionHash.substring(0,20)}...`:"Not available"})]}),y.jsxs("div",{className:"blockchain-item",children:[y.jsx("label",{children:"Verification Status:"}),y.jsx("span",{className:w(m.verificationStatus),children:m.verificationStatus.charAt(0).toUpperCase()+m.verificationStatus.slice(1)})]})]})]}),y.jsxs("div",{className:"detail-section",children:[y.jsx("h4",{children:"📝 Notes"}),y.jsx("div",{className:"notes-content",children:y.jsx("p",{children:m.notes})})]}),y.jsxs("div",{className:"transaction-actions",children:[y.jsx("button",{className:"btn-primary",children:"📧 Contact Parties"}),y.jsx("button",{className:"btn-secondary",children:"🔗 View on Blockchain"}),y.jsx("button",{className:"btn-secondary",children:"📄 Download Receipt"}),m.status==="pending"&&y.jsx("button",{className:"btn-danger",children:"❌ Cancel Transaction"})]})]})]})]})]})}function rVe(){const[n,e]=ve.useState("overview"),[t,s]=ve.useState("month"),[r,i]=ve.useState("all"),[a,o]=ve.useState({});ve.useEffect(()=>{o({overview:{totalProjects:45,totalUsers:156,totalCredits:12500,totalVolume:312500,averagePrice:25,growthRate:15.2,topProjects:[{name:"Mangrove Restoration - Sundarbans",credits:1500,revenue:38250},{name:"Coral Reef Protection Initiative",credits:2e3,revenue:57500},{name:"Seagrass Carbon Sequestration",credits:800,revenue:23e3},{name:"Blue Carbon Assessment",credits:600,revenue:13200}],monthlyTrends:[{month:"Jan",credits:1200,revenue:3e4},{month:"Feb",credits:1500,revenue:37500},{month:"Mar",credits:1800,revenue:45e3},{month:"Apr",credits:2100,revenue:52500},{month:"May",credits:1900,revenue:47500},{month:"Jun",credits:2200,revenue:55e3}]},financial:{totalRevenue:312500,totalExpenses:45e3,netProfit:267500,platformFees:3125,transactionFees:1875,operationalCosts:4e4,revenueByMonth:[{month:"Jan",revenue:3e4,expenses:3500},{month:"Feb",revenue:37500,expenses:4e3},{month:"Mar",revenue:45e3,expenses:4500},{month:"Apr",revenue:52500,expenses:5e3},{month:"May",revenue:47500,expenses:4500},{month:"Jun",revenue:55e3,expenses:5500}],topEarners:[{name:"Dr. Marina Santos",earnings:38250,projects:5},{name:"Sarah Williams",earnings:57500,projects:8},{name:"Miguel Rodriguez",earnings:13200,projects:2}]},environmental:{totalCarbonSequestration:12500,mangroveCredits:4500,seagrassCredits:3200,coralCredits:4800,averageSequestrationRate:2.5,environmentalImpact:{co2Reduction:12500,equivalentTrees:520833,equivalentCars:2708,equivalentFlights:156},projectTypes:[{type:"Mangrove Restoration",credits:4500,percentage:36},{type:"Coral Reef Conservation",credits:4800,percentage:38.4},{type:"Seagrass Restoration",credits:3200,percentage:25.6}]},user:{totalUsers:156,activeUsers:142,newUsers:23,userRetention:91,usersByRole:[{role:"Farmers",count:89,percentage:57.1},{role:"Buyers",count:45,percentage:28.8},{role:"Admins",count:22,percentage:14.1}],userActivity:[{period:"Week 1",active:120,new:5},{period:"Week 2",active:135,new:8},{period:"Week 3",active:142,new:6},{period:"Week 4",active:138,new:4}],topActiveUsers:[{name:"Dr. Marina Santos",activity:95,projects:5},{name:"Sarah Williams",activity:92,projects:8},{name:"James Chen",activity:88,purchases:12}]}})},[]);const l=w=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(w),c=w=>new Intl.NumberFormat("en-US").format(w),h=()=>{const w=a.overview;return w?y.jsxs("div",{className:"report-content",children:[y.jsxs("div",{className:"report-stats-grid",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"📊"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:w.totalProjects}),y.jsx("div",{className:"stat-label",children:"Total Projects"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"👥"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:w.totalUsers}),y.jsx("div",{className:"stat-label",children:"Total Users"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🌱"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:c(w.totalCredits)}),y.jsx("div",{className:"stat-label",children:"Carbon Credits (tons)"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"💰"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:l(w.totalVolume)}),y.jsx("div",{className:"stat-label",children:"Total Volume"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"📈"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:l(w.averagePrice)}),y.jsx("div",{className:"stat-label",children:"Avg Price/Ton"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🚀"}),y.jsxs("div",{className:"stat-content",children:[y.jsxs("div",{className:"stat-number",children:[w.growthRate,"%"]}),y.jsx("div",{className:"stat-label",children:"Growth Rate"})]})]})]}),y.jsxs("div",{className:"report-charts",children:[y.jsxs("div",{className:"chart-section",children:[y.jsx("h3",{children:"📈 Monthly Trends"}),y.jsxs("div",{className:"chart-container",children:[y.jsx("div",{className:"chart-bars",children:w.monthlyTrends.map((T,E)=>y.jsxs("div",{className:"chart-bar-group",children:[y.jsx("div",{className:"chart-bar",children:y.jsx("div",{className:"bar credits-bar",style:{height:`${T.credits/2500*100}%`}})}),y.jsx("div",{className:"chart-bar",children:y.jsx("div",{className:"bar revenue-bar",style:{height:`${T.revenue/6e4*100}%`}})}),y.jsx("div",{className:"chart-label",children:T.month})]},E))}),y.jsxs("div",{className:"chart-legend",children:[y.jsxs("div",{className:"legend-item",children:[y.jsx("div",{className:"legend-color credits-color"}),y.jsx("span",{children:"Credits (tons)"})]}),y.jsxs("div",{className:"legend-item",children:[y.jsx("div",{className:"legend-color revenue-color"}),y.jsx("span",{children:"Revenue ($)"})]})]})]})]}),y.jsxs("div",{className:"chart-section",children:[y.jsx("h3",{children:"🏆 Top Performing Projects"}),y.jsx("div",{className:"top-projects-list",children:w.topProjects.map((T,E)=>y.jsxs("div",{className:"project-item",children:[y.jsxs("div",{className:"project-rank",children:["#",E+1]}),y.jsxs("div",{className:"project-info",children:[y.jsx("h4",{children:T.name}),y.jsxs("div",{className:"project-stats",children:[y.jsxs("span",{className:"credits",children:[c(T.credits)," tons"]}),y.jsx("span",{className:"revenue",children:l(T.revenue)})]})]}),y.jsx("div",{className:"project-chart",children:y.jsx("div",{className:"project-bar",style:{width:`${T.credits/2e3*100}%`}})})]},E))})]})]})]}):null},p=()=>{const w=a.financial;return w?y.jsxs("div",{className:"report-content",children:[y.jsxs("div",{className:"financial-summary",children:[y.jsxs("div",{className:"summary-card revenue",children:[y.jsx("h3",{children:"💰 Total Revenue"}),y.jsx("div",{className:"summary-amount",children:l(w.totalRevenue)})]}),y.jsxs("div",{className:"summary-card expenses",children:[y.jsx("h3",{children:"💸 Total Expenses"}),y.jsx("div",{className:"summary-amount",children:l(w.totalExpenses)})]}),y.jsxs("div",{className:"summary-card profit",children:[y.jsx("h3",{children:"📈 Net Profit"}),y.jsx("div",{className:"summary-amount",children:l(w.netProfit)})]})]}),y.jsxs("div",{className:"financial-breakdown",children:[y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"💳 Revenue Breakdown"}),y.jsxs("div",{className:"breakdown-items",children:[y.jsxs("div",{className:"breakdown-item",children:[y.jsx("span",{className:"label",children:"Platform Fees (1%):"}),y.jsx("span",{className:"amount",children:l(w.platformFees)})]}),y.jsxs("div",{className:"breakdown-item",children:[y.jsx("span",{className:"label",children:"Transaction Fees:"}),y.jsx("span",{className:"amount",children:l(w.transactionFees)})]}),y.jsxs("div",{className:"breakdown-item",children:[y.jsx("span",{className:"label",children:"Operational Costs:"}),y.jsx("span",{className:"amount",children:l(w.operationalCosts)})]})]})]}),y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"📊 Monthly Revenue vs Expenses"}),y.jsx("div",{className:"revenue-chart",children:w.revenueByMonth.map((T,E)=>y.jsxs("div",{className:"month-item",children:[y.jsx("div",{className:"month-label",children:T.month}),y.jsxs("div",{className:"month-bars",children:[y.jsxs("div",{className:"revenue-bar",children:[y.jsx("div",{className:"bar",style:{height:`${T.revenue/6e4*100}%`}}),y.jsx("span",{className:"bar-label",children:l(T.revenue)})]}),y.jsxs("div",{className:"expense-bar",children:[y.jsx("div",{className:"bar",style:{height:`${T.expenses/6e3*100}%`}}),y.jsx("span",{className:"bar-label",children:l(T.expenses)})]})]})]},E))})]}),y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"🏆 Top Earners"}),y.jsx("div",{className:"earners-list",children:w.topEarners.map((T,E)=>y.jsxs("div",{className:"earner-item",children:[y.jsxs("div",{className:"earner-rank",children:["#",E+1]}),y.jsxs("div",{className:"earner-info",children:[y.jsx("h4",{children:T.name}),y.jsxs("p",{children:[T.projects," projects"]})]}),y.jsx("div",{className:"earner-amount",children:l(T.earnings)})]},E))})]})]})]}):null},m=()=>{const w=a.environmental;return w?y.jsxs("div",{className:"report-content",children:[y.jsxs("div",{className:"environmental-impact",children:[y.jsx("h3",{children:"🌍 Environmental Impact Summary"}),y.jsxs("div",{className:"impact-grid",children:[y.jsxs("div",{className:"impact-card",children:[y.jsx("div",{className:"impact-icon",children:"🌱"}),y.jsxs("div",{className:"impact-content",children:[y.jsx("div",{className:"impact-number",children:c(w.environmentalImpact.co2Reduction)}),y.jsx("div",{className:"impact-label",children:"Tons CO₂ Sequestered"})]})]}),y.jsxs("div",{className:"impact-card",children:[y.jsx("div",{className:"impact-icon",children:"🌳"}),y.jsxs("div",{className:"impact-content",children:[y.jsx("div",{className:"impact-number",children:c(w.environmentalImpact.equivalentTrees)}),y.jsx("div",{className:"impact-label",children:"Equivalent Trees"})]})]}),y.jsxs("div",{className:"impact-card",children:[y.jsx("div",{className:"impact-icon",children:"🚗"}),y.jsxs("div",{className:"impact-content",children:[y.jsx("div",{className:"impact-number",children:c(w.environmentalImpact.equivalentCars)}),y.jsx("div",{className:"impact-label",children:"Cars Off Road (yearly)"})]})]}),y.jsxs("div",{className:"impact-card",children:[y.jsx("div",{className:"impact-icon",children:"✈️"}),y.jsxs("div",{className:"impact-content",children:[y.jsx("div",{className:"impact-number",children:c(w.environmentalImpact.equivalentFlights)}),y.jsx("div",{className:"impact-label",children:"Flights Offset"})]})]})]})]}),y.jsxs("div",{className:"credits-breakdown",children:[y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"🌊 Credits by Ecosystem Type"}),y.jsx("div",{className:"ecosystem-chart",children:w.projectTypes.map((T,E)=>y.jsxs("div",{className:"ecosystem-item",children:[y.jsxs("div",{className:"ecosystem-info",children:[y.jsx("h4",{children:T.type}),y.jsxs("div",{className:"ecosystem-stats",children:[y.jsxs("span",{className:"credits",children:[c(T.credits)," tons"]}),y.jsxs("span",{className:"percentage",children:[T.percentage,"%"]})]})]}),y.jsx("div",{className:"ecosystem-bar",children:y.jsx("div",{className:"bar",style:{width:`${T.percentage}%`}})})]},E))})]}),y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"📊 Carbon Sequestration Breakdown"}),y.jsxs("div",{className:"sequestration-grid",children:[y.jsxs("div",{className:"seq-item",children:[y.jsx("div",{className:"seq-icon",children:"🌿"}),y.jsxs("div",{className:"seq-content",children:[y.jsx("div",{className:"seq-number",children:c(w.mangroveCredits)}),y.jsx("div",{className:"seq-label",children:"Mangrove Credits"})]})]}),y.jsxs("div",{className:"seq-item",children:[y.jsx("div",{className:"seq-icon",children:"🌊"}),y.jsxs("div",{className:"seq-content",children:[y.jsx("div",{className:"seq-number",children:c(w.seagrassCredits)}),y.jsx("div",{className:"seq-label",children:"Seagrass Credits"})]})]}),y.jsxs("div",{className:"seq-item",children:[y.jsx("div",{className:"seq-icon",children:"🪸"}),y.jsxs("div",{className:"seq-content",children:[y.jsx("div",{className:"seq-number",children:c(w.coralCredits)}),y.jsx("div",{className:"seq-label",children:"Coral Credits"})]})]})]})]})]})]}):null},v=()=>{const w=a.user;return w?y.jsxs("div",{className:"report-content",children:[y.jsxs("div",{className:"user-stats-grid",children:[y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"👥"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:w.totalUsers}),y.jsx("div",{className:"stat-label",children:"Total Users"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"✅"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:w.activeUsers}),y.jsx("div",{className:"stat-label",children:"Active Users"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"🆕"}),y.jsxs("div",{className:"stat-content",children:[y.jsx("div",{className:"stat-number",children:w.newUsers}),y.jsx("div",{className:"stat-label",children:"New Users"})]})]}),y.jsxs("div",{className:"stat-card",children:[y.jsx("div",{className:"stat-icon",children:"📈"}),y.jsxs("div",{className:"stat-content",children:[y.jsxs("div",{className:"stat-number",children:[w.userRetention,"%"]}),y.jsx("div",{className:"stat-label",children:"Retention Rate"})]})]})]}),y.jsxs("div",{className:"user-breakdown",children:[y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"👥 Users by Role"}),y.jsx("div",{className:"role-chart",children:w.usersByRole.map((T,E)=>y.jsxs("div",{className:"role-item",children:[y.jsxs("div",{className:"role-info",children:[y.jsx("h4",{children:T.role}),y.jsxs("div",{className:"role-stats",children:[y.jsxs("span",{className:"count",children:[T.count," users"]}),y.jsxs("span",{className:"percentage",children:[T.percentage,"%"]})]})]}),y.jsx("div",{className:"role-bar",children:y.jsx("div",{className:"bar",style:{width:`${T.percentage}%`}})})]},E))})]}),y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"📊 Weekly User Activity"}),y.jsx("div",{className:"activity-chart",children:w.userActivity.map((T,E)=>y.jsxs("div",{className:"week-item",children:[y.jsx("div",{className:"week-label",children:T.period}),y.jsxs("div",{className:"week-bars",children:[y.jsxs("div",{className:"active-bar",children:[y.jsx("div",{className:"bar",style:{height:`${T.active/150*100}%`}}),y.jsxs("span",{className:"bar-label",children:[T.active," active"]})]}),y.jsxs("div",{className:"new-bar",children:[y.jsx("div",{className:"bar",style:{height:`${T.new/10*100}%`}}),y.jsxs("span",{className:"bar-label",children:[T.new," new"]})]})]})]},E))})]}),y.jsxs("div",{className:"breakdown-section",children:[y.jsx("h3",{children:"🏆 Most Active Users"}),y.jsx("div",{className:"active-users-list",children:w.topActiveUsers.map((T,E)=>y.jsxs("div",{className:"user-item",children:[y.jsxs("div",{className:"user-rank",children:["#",E+1]}),y.jsxs("div",{className:"user-info",children:[y.jsx("h4",{children:T.name}),y.jsx("p",{children:T.projects?`${T.projects} projects`:`${T.purchases} purchases`})]}),y.jsxs("div",{className:"user-activity",children:[T.activity,"% active"]})]},E))})]})]})]}):null},_=()=>{switch(n){case"overview":return h();case"financial":return p();case"environmental":return m();case"user":return v();default:return h()}};return y.jsxs("div",{className:"page-container",children:[y.jsxs("div",{className:"page-header",children:[y.jsx("h1",{className:"page-title",children:"📊 Reports & Analytics"}),y.jsx("p",{className:"page-subtitle",children:"Comprehensive analytics and reporting for platform performance and environmental impact"})]}),y.jsxs("div",{className:"report-controls",children:[y.jsxs("div",{className:"control-group",children:[y.jsx("label",{children:"Report Type:"}),y.jsxs("select",{value:n,onChange:w=>e(w.target.value),className:"control-select",children:[y.jsx("option",{value:"overview",children:"📊 Overview"}),y.jsx("option",{value:"financial",children:"💰 Financial"}),y.jsx("option",{value:"environmental",children:"🌍 Environmental"}),y.jsx("option",{value:"user",children:"👥 User Analytics"})]})]}),y.jsxs("div",{className:"control-group",children:[y.jsx("label",{children:"Date Range:"}),y.jsxs("select",{value:t,onChange:w=>s(w.target.value),className:"control-select",children:[y.jsx("option",{value:"week",children:"This Week"}),y.jsx("option",{value:"month",children:"This Month"}),y.jsx("option",{value:"quarter",children:"This Quarter"}),y.jsx("option",{value:"year",children:"This Year"}),y.jsx("option",{value:"all",children:"All Time"})]})]}),y.jsxs("div",{className:"control-group",children:[y.jsx("label",{children:"Project:"}),y.jsxs("select",{value:r,onChange:w=>i(w.target.value),className:"control-select",children:[y.jsx("option",{value:"all",children:"All Projects"}),y.jsx("option",{value:"mangrove",children:"Mangrove Projects"}),y.jsx("option",{value:"seagrass",children:"Seagrass Projects"}),y.jsx("option",{value:"coral",children:"Coral Projects"})]})]}),y.jsxs("div",{className:"control-actions",children:[y.jsx("button",{className:"btn-primary",children:"📄 Export PDF"}),y.jsx("button",{className:"btn-secondary",children:"📊 Export Excel"}),y.jsx("button",{className:"btn-secondary",children:"🔄 Refresh Data"})]})]}),y.jsx("div",{className:"reports-content",children:_()})]})}function iVe(){const n=Qo(),e=n.pathname==="/login"||n.pathname==="/signup"||n.pathname==="/"||n.pathname==="/dashboard"||n.pathname==="/about"||n.pathname==="/contact";return y.jsxs(y.Fragment,{children:[!e&&y.jsx(xY,{}),y.jsxs(jZ,{children:[y.jsx(Ls,{path:"/",element:y.jsx(wY,{})}),y.jsx(Ls,{path:"/dashboard",element:y.jsx(TY,{})}),y.jsx(Ls,{path:"/login",element:y.jsx(Uie,{})}),y.jsx(Ls,{path:"/signup",element:y.jsx(Gie,{})}),y.jsx(Ls,{path:"/farmer",element:y.jsx(Hie,{})}),y.jsx(Ls,{path:"/buyer",element:y.jsx(vY,{})}),y.jsx(Ls,{path:"/admin",element:y.jsx(Kie,{})}),y.jsx(Ls,{path:"/profile",element:y.jsx(eM,{})}),y.jsx(Ls,{path:"/profile-form",element:y.jsx(Xie,{})}),y.jsx(Ls,{path:"/profile-display",element:y.jsx(eM,{})}),y.jsx(Ls,{path:"/add-project",element:y.jsx(yae,{})}),y.jsx(Ls,{path:"/mrv-dashboard-farmer",element:y.jsx(vae,{})}),y.jsx(Ls,{path:"/marketplace",element:y.jsx(_ae,{})}),y.jsx(Ls,{path:"/mrv-dashboard-buyer",element:y.jsx(bae,{})}),y.jsx(Ls,{path:"/contact",element:y.jsx(xae,{})}),y.jsx(Ls,{path:"/about",element:y.jsx(wae,{})}),y.jsx(Ls,{path:"/project-verification",element:y.jsx(tVe,{})}),y.jsx(Ls,{path:"/user-management",element:y.jsx(nVe,{})}),y.jsx(Ls,{path:"/transactions",element:y.jsx(sVe,{})}),y.jsx(Ls,{path:"/reports",element:y.jsx(rVe,{})})]})]})}function aVe(){return y.jsx(iVe,{})}XX.createRoot(document.getElementById("root")).render(y.jsx(ve.StrictMode,{children:y.jsx(lY,{basename:"/",children:y.jsx(aVe,{})})}));
